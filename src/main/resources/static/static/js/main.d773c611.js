/*! For license information please see main.d773c611.js.LICENSE.txt */
(()=>{var __webpack_modules__={3361:(e,t,n)=>{"use strict";n.d(t,{Z:()=>ie});var r=function(){function e(e){var t=this;this._insertTag=function(e){var n;n=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,n),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{n.insertRule(e,n.cssRules.length)}catch(r){0}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),this.tags=[],this.ctr=0},e}(),i=Math.abs,o=String.fromCharCode,s=Object.assign;function a(e){return e.trim()}function c(e,t,n){return e.replace(t,n)}function l(e,t){return e.indexOf(t)}function u(e,t){return 0|e.charCodeAt(t)}function d(e,t,n){return e.slice(t,n)}function h(e){return e.length}function p(e){return e.length}function f(e,t){return t.push(e),e}var m=1,g=1,_=0,E=0,v=0,y="";function b(e,t,n,r,i,o,s){return{value:e,root:t,parent:n,type:r,props:i,children:o,line:m,column:g,length:s,return:""}}function S(e,t){return s(b("",null,null,"",null,null,0),e,{length:-e.length},t)}function T(){return v=E>0?u(y,--E):0,g--,10===v&&(g=1,m--),v}function w(){return v=E<_?u(y,E++):0,g++,10===v&&(g=1,m++),v}function C(){return u(y,E)}function R(){return E}function I(e,t){return d(y,e,t)}function O(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function A(e){return m=g=1,_=h(y=e),E=0,[]}function N(e){return y="",e}function k(e){return a(I(E-1,L(91===e?e+2:40===e?e+1:e)))}function P(e){for(;(v=C())&&v<33;)w();return O(e)>2||O(v)>3?"":" "}function D(e,t){for(;--t&&w()&&!(v<48||v>102||v>57&&v<65||v>70&&v<97););return I(e,R()+(t<6&&32==C()&&32==w()))}function L(e){for(;w();)switch(v){case e:return E;case 34:case 39:34!==e&&39!==e&&L(v);break;case 40:41===e&&L(e);break;case 92:w()}return E}function x(e,t){for(;w()&&e+v!==57&&(e+v!==84||47!==C()););return"/*"+I(t,E-1)+"*"+o(47===e?e:w())}function M(e){for(;!O(C());)w();return I(e,E)}var U="-ms-",F="-moz-",j="-webkit-",V="comm",B="rule",G="decl",q="@keyframes";function W(e,t){for(var n="",r=p(e),i=0;i<r;i++)n+=t(e[i],i,e,t)||"";return n}function z(e,t,n,r){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case G:return e.return=e.return||e.value;case V:return"";case q:return e.return=e.value+"{"+W(e.children,r)+"}";case B:e.value=e.props.join(",")}return h(n=W(e.children,r))?e.return=e.value+"{"+n+"}":""}function H(e){return N(K("",null,null,null,[""],e=A(e),0,[0],e))}function K(e,t,n,r,i,s,a,d,p){for(var m=0,g=0,_=a,E=0,v=0,y=0,b=1,S=1,I=1,O=0,A="",N=i,L=s,U=r,F=A;S;)switch(y=O,O=w()){case 40:if(108!=y&&58==u(F,_-1)){-1!=l(F+=c(k(O),"&","&\f"),"&\f")&&(I=-1);break}case 34:case 39:case 91:F+=k(O);break;case 9:case 10:case 13:case 32:F+=P(y);break;case 92:F+=D(R()-1,7);continue;case 47:switch(C()){case 42:case 47:f(Z(x(w(),R()),t,n),p);break;default:F+="/"}break;case 123*b:d[m++]=h(F)*I;case 125*b:case 59:case 0:switch(O){case 0:case 125:S=0;case 59+g:-1==I&&(F=c(F,/\f/g,"")),v>0&&h(F)-_&&f(v>32?J(F+";",r,n,_-1):J(c(F," ","")+";",r,n,_-2),p);break;case 59:F+=";";default:if(f(U=Y(F,t,n,m,g,i,d,A,N=[],L=[],_),s),123===O)if(0===g)K(F,t,U,U,N,s,_,d,L);else switch(99===E&&110===u(F,3)?100:E){case 100:case 108:case 109:case 115:K(e,U,U,r&&f(Y(e,U,U,0,0,i,d,A,i,N=[],_),L),i,L,_,d,r?N:L);break;default:K(F,U,U,U,[""],L,0,d,L)}}m=g=v=0,b=I=1,A=F="",_=a;break;case 58:_=1+h(F),v=y;default:if(b<1)if(123==O)--b;else if(125==O&&0==b++&&125==T())continue;switch(F+=o(O),O*b){case 38:I=g>0?1:(F+="\f",-1);break;case 44:d[m++]=(h(F)-1)*I,I=1;break;case 64:45===C()&&(F+=k(w())),E=C(),g=_=h(A=F+=M(R())),O++;break;case 45:45===y&&2==h(F)&&(b=0)}}return s}function Y(e,t,n,r,o,s,l,u,h,f,m){for(var g=o-1,_=0===o?s:[""],E=p(_),v=0,y=0,S=0;v<r;++v)for(var T=0,w=d(e,g+1,g=i(y=l[v])),C=e;T<E;++T)(C=a(y>0?_[T]+" "+w:c(w,/&\f/g,_[T])))&&(h[S++]=C);return b(e,t,n,0===o?B:u,h,f,m)}function Z(e,t,n){return b(e,t,n,V,o(v),d(e,2,-2),0)}function J(e,t,n,r){return b(e,t,n,G,d(e,0,r),d(e,r+1,-1),r)}var X=function(e,t,n){for(var r=0,i=0;r=i,i=C(),38===r&&12===i&&(t[n]=1),!O(i);)w();return I(e,E)},Q=function(e,t){return N(function(e,t){var n=-1,r=44;do{switch(O(r)){case 0:38===r&&12===C()&&(t[n]=1),e[n]+=X(E-1,t,n);break;case 2:e[n]+=k(r);break;case 4:if(44===r){e[++n]=58===C()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=o(r)}}while(r=w());return e}(A(e),t))},$=new WeakMap,ee=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,r=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||$.get(n))&&!r){$.set(e,!0);for(var i=[],o=Q(t,i),s=n.props,a=0,c=0;a<o.length;a++)for(var l=0;l<s.length;l++,c++)e.props[c]=i[a]?o[a].replace(/&\f/g,s[l]):s[l]+" "+o[a]}}},te=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}};function ne(e,t){switch(function(e,t){return 45^u(e,0)?(((t<<2^u(e,0))<<2^u(e,1))<<2^u(e,2))<<2^u(e,3):0}(e,t)){case 5103:return j+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return j+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return j+e+F+e+U+e+e;case 6828:case 4268:return j+e+U+e+e;case 6165:return j+e+U+"flex-"+e+e;case 5187:return j+e+c(e,/(\w+).+(:[^]+)/,j+"box-$1$2"+U+"flex-$1$2")+e;case 5443:return j+e+U+"flex-item-"+c(e,/flex-|-self/,"")+e;case 4675:return j+e+U+"flex-line-pack"+c(e,/align-content|flex-|-self/,"")+e;case 5548:return j+e+U+c(e,"shrink","negative")+e;case 5292:return j+e+U+c(e,"basis","preferred-size")+e;case 6060:return j+"box-"+c(e,"-grow","")+j+e+U+c(e,"grow","positive")+e;case 4554:return j+c(e,/([^-])(transform)/g,"$1"+j+"$2")+e;case 6187:return c(c(c(e,/(zoom-|grab)/,j+"$1"),/(image-set)/,j+"$1"),e,"")+e;case 5495:case 3959:return c(e,/(image-set\([^]*)/,j+"$1$`$1");case 4968:return c(c(e,/(.+:)(flex-)?(.*)/,j+"box-pack:$3"+U+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+j+e+e;case 4095:case 3583:case 4068:case 2532:return c(e,/(.+)-inline(.+)/,j+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(h(e)-1-t>6)switch(u(e,t+1)){case 109:if(45!==u(e,t+4))break;case 102:return c(e,/(.+:)(.+)-([^]+)/,"$1"+j+"$2-$3$1"+F+(108==u(e,t+3)?"$3":"$2-$3"))+e;case 115:return~l(e,"stretch")?ne(c(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==u(e,t+1))break;case 6444:switch(u(e,h(e)-3-(~l(e,"!important")&&10))){case 107:return c(e,":",":"+j)+e;case 101:return c(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+j+(45===u(e,14)?"inline-":"")+"box$3$1"+j+"$2$3$1"+U+"$2box$3")+e}break;case 5936:switch(u(e,t+11)){case 114:return j+e+U+c(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return j+e+U+c(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return j+e+U+c(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return j+e+U+e+e}return e}var re=[function(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case G:e.return=ne(e.value,e.length);break;case q:return W([S(e,{value:c(e.value,"@","@"+j)})],r);case B:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return W([S(e,{props:[c(t,/:(read-\w+)/,":-moz-$1")]})],r);case"::placeholder":return W([S(e,{props:[c(t,/:(plac\w+)/,":"+j+"input-$1")]}),S(e,{props:[c(t,/:(plac\w+)/,":-moz-$1")]}),S(e,{props:[c(t,/:(plac\w+)/,U+"input-$1")]})],r)}return""}))}}],ie=function(e){var t=e.key;if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var i=e.stylisPlugins||re;var o,s,a={},c=[];o=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)a[t[n]]=!0;c.push(e)}));var l,u,d=[z,(u=function(e){l.insert(e)},function(e){e.root||(e=e.return)&&u(e)})],h=function(e){var t=p(e);return function(n,r,i,o){for(var s="",a=0;a<t;a++)s+=e[a](n,r,i,o)||"";return s}}([ee,te].concat(i,d));s=function(e,t,n,r){l=n,W(H(e?e+"{"+t.styles+"}":t.styles),h),r&&(f.inserted[t.name]=!0)};var f={key:t,sheet:new r({key:t,container:o,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:a,registered:{},insert:s};return f.sheet.hydrate(c),f}},9797:(e,t,n)=>{"use strict";function r(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}n.d(t,{Z:()=>r})},2564:(e,t,n)=>{"use strict";n.d(t,{T:()=>c,i:()=>o,w:()=>a});var r=n(2791),i=n(3361),o=(n(9140),n(2561),!0),s=r.createContext("undefined"!==typeof HTMLElement?(0,i.Z)({key:"css"}):null);s.Provider;var a=function(e){return(0,r.forwardRef)((function(t,n){var i=(0,r.useContext)(s);return e(t,i,n)}))};o||(a=function(e){return function(t){var n=(0,r.useContext)(s);return null===n?(n=(0,i.Z)({key:"css"}),r.createElement(s.Provider,{value:n},e(t,n))):e(t,n)}});var c=r.createContext({})},9140:(e,t,n)=>{"use strict";n.d(t,{O:()=>f});var r={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},i=n(9797),o=/[A-Z]|^ms/g,s=/_EMO_([^_]+?)_([^]*?)_EMO_/g,a=function(e){return 45===e.charCodeAt(1)},c=function(e){return null!=e&&"boolean"!==typeof e},l=(0,i.Z)((function(e){return a(e)?e:e.replace(o,"-$&").toLowerCase()})),u=function(e,t){switch(e){case"animation":case"animationName":if("string"===typeof t)return t.replace(s,(function(e,t,n){return h={name:t,styles:n,next:h},t}))}return 1===r[e]||a(e)||"number"!==typeof t||0===t?t:t+"px"};function d(e,t,n){if(null==n)return"";if(void 0!==n.__emotion_styles)return n;switch(typeof n){case"boolean":return"";case"object":if(1===n.anim)return h={name:n.name,styles:n.styles,next:h},n.name;if(void 0!==n.styles){var r=n.next;if(void 0!==r)for(;void 0!==r;)h={name:r.name,styles:r.styles,next:h},r=r.next;return n.styles+";"}return function(e,t,n){var r="";if(Array.isArray(n))for(var i=0;i<n.length;i++)r+=d(e,t,n[i])+";";else for(var o in n){var s=n[o];if("object"!==typeof s)null!=t&&void 0!==t[s]?r+=o+"{"+t[s]+"}":c(s)&&(r+=l(o)+":"+u(o,s)+";");else if(!Array.isArray(s)||"string"!==typeof s[0]||null!=t&&void 0!==t[s[0]]){var a=d(e,t,s);switch(o){case"animation":case"animationName":r+=l(o)+":"+a+";";break;default:r+=o+"{"+a+"}"}}else for(var h=0;h<s.length;h++)c(s[h])&&(r+=l(o)+":"+u(o,s[h])+";")}return r}(e,t,n);case"function":if(void 0!==e){var i=h,o=n(e);return h=i,d(e,t,o)}}if(null==t)return n;var s=t[n];return void 0!==s?s:n}var h,p=/label:\s*([^\s;\n{]+)\s*(;|$)/g;var f=function(e,t,n){if(1===e.length&&"object"===typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var r=!0,i="";h=void 0;var o=e[0];null==o||void 0===o.raw?(r=!1,i+=d(n,t,o)):i+=o[0];for(var s=1;s<e.length;s++)i+=d(n,t,e[s]),r&&(i+=o[s]);p.lastIndex=0;for(var a,c="";null!==(a=p.exec(i));)c+="-"+a[1];var l=function(e){for(var t,n=0,r=0,i=e.length;i>=4;++r,i-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(i){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(i)+c;return{name:l,styles:i,next:h}}},2561:(e,t,n)=>{"use strict";var r;n.d(t,{L:()=>s,j:()=>a});var i=n(2791),o=!!(r||(r=n.t(i,2))).useInsertionEffect&&(r||(r=n.t(i,2))).useInsertionEffect,s=o||function(e){return e()},a=o||i.useLayoutEffect},5438:(e,t,n)=>{"use strict";n.d(t,{My:()=>o,fp:()=>r,hC:()=>i});function r(e,t,n){var r="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):r+=n+" "})),r}var i=function(e,t,n){var r=e.key+"-"+t.name;!1===n&&void 0===e.registered[r]&&(e.registered[r]=t.styles)},o=function(e,t,n){i(e,t,n);var r=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var o=t;do{e.insert(t===o?"."+r:"",o,e.sheet,!0),o=o.next}while(void 0!==o)}}},9027:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5649)),o=n(184),s=(0,i.default)([(0,o.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"},"0"),(0,o.jsx)("path",{d:"M14 17H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"},"1")],"ArticleOutlined");t.Z=s},1598:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5649)),o=n(184),s=(0,i.default)((0,o.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"}),"CloseOutlined");t.Z=s},5649:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=n(4454)},6532:(e,t)=>{"use strict";var n,r=Symbol.for("react.element"),i=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.server_context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.offscreen");function _(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case o:case a:case s:case h:case p:return e;default:switch(e=e&&e.$$typeof){case u:case l:case d:case m:case f:case c:return e;default:return t}}case i:return t}}}n=Symbol.for("react.module.reference")},8457:(e,t,n)=>{"use strict";n(6532)},7107:(e,t,n)=>{"use strict";n.d(t,{Z:()=>j});var r=n(7462),i=n(3366),o=n(6189),s=n(2466),a=n(5080),c=n(7416),l=n(104);var u=n(2065);const d={black:"#000",white:"#fff"},h={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},p={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},f={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},m={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},g={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},_={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},E={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},v=["mode","contrastThreshold","tonalOffset"],y={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:d.white,default:d.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},b={text:{primary:d.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:d.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function S(e,t,n,r){const i=r.light||r,o=r.dark||1.5*r;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=(0,u.$n)(e.main,i):"dark"===t&&(e.dark=(0,u._j)(e.main,o)))}function T(e){const{mode:t="light",contrastThreshold:n=3,tonalOffset:a=.2}=e,c=(0,i.Z)(e,v),l=e.primary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:g[200],light:g[50],dark:g[400]}:{main:g[700],light:g[400],dark:g[800]}}(t),T=e.secondary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:p[200],light:p[50],dark:p[400]}:{main:p[500],light:p[300],dark:p[700]}}(t),w=e.error||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:f[500],light:f[300],dark:f[700]}:{main:f[700],light:f[400],dark:f[800]}}(t),C=e.info||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:_[400],light:_[300],dark:_[700]}:{main:_[700],light:_[500],dark:_[900]}}(t),R=e.success||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:E[400],light:E[300],dark:E[700]}:{main:E[800],light:E[500],dark:E[900]}}(t),I=e.warning||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:m[400],light:m[300],dark:m[700]}:{main:"#ed6c02",light:m[500],dark:m[900]}}(t);function O(e){return(0,u.mi)(e,b.text.primary)>=n?b.text.primary:y.text.primary}const A=e=>{let{color:t,name:n,mainShade:i=500,lightShade:s=300,darkShade:c=700}=e;if(t=(0,r.Z)({},t),!t.main&&t[i]&&(t.main=t[i]),!t.hasOwnProperty("main"))throw new Error((0,o.Z)(11,n?" (".concat(n,")"):"",i));if("string"!==typeof t.main)throw new Error((0,o.Z)(12,n?" (".concat(n,")"):"",JSON.stringify(t.main)));return S(t,"light",s,a),S(t,"dark",c,a),t.contrastText||(t.contrastText=O(t.main)),t},N={dark:b,light:y};return(0,s.Z)((0,r.Z)({common:(0,r.Z)({},d),mode:t,primary:A({color:l,name:"primary"}),secondary:A({color:T,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:A({color:w,name:"error"}),warning:A({color:I,name:"warning"}),info:A({color:C,name:"info"}),success:A({color:R,name:"success"}),grey:h,contrastThreshold:n,getContrastText:O,augmentColor:A,tonalOffset:a},N[t]),c)}const w=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];const C={textTransform:"uppercase"},R='"Roboto", "Helvetica", "Arial", sans-serif';function I(e,t){const n="function"===typeof t?t(e):t,{fontFamily:o=R,fontSize:a=14,fontWeightLight:c=300,fontWeightRegular:l=400,fontWeightMedium:u=500,fontWeightBold:d=700,htmlFontSize:h=16,allVariants:p,pxToRem:f}=n,m=(0,i.Z)(n,w);const g=a/14,_=f||(e=>"".concat(e/h*g,"rem")),E=(e,t,n,i,s)=>{return(0,r.Z)({fontFamily:o,fontWeight:e,fontSize:_(t),lineHeight:n},o===R?{letterSpacing:"".concat((a=i/t,Math.round(1e5*a)/1e5),"em")}:{},s,p);var a},v={h1:E(c,96,1.167,-1.5),h2:E(c,60,1.2,-.5),h3:E(l,48,1.167,0),h4:E(l,34,1.235,.25),h5:E(l,24,1.334,0),h6:E(u,20,1.6,.15),subtitle1:E(l,16,1.75,.15),subtitle2:E(u,14,1.57,.1),body1:E(l,16,1.5,.15),body2:E(l,14,1.43,.15),button:E(u,14,1.75,.4,C),caption:E(l,12,1.66,.4),overline:E(l,12,2.66,1,C),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return(0,s.Z)((0,r.Z)({htmlFontSize:h,pxToRem:_,fontFamily:o,fontSize:a,fontWeightLight:c,fontWeightRegular:l,fontWeightMedium:u,fontWeightBold:d},v),m,{clone:!1})}function O(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(.2,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(.14,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(.12,")")].join(",")}const A=["none",O(0,2,1,-1,0,1,1,0,0,1,3,0),O(0,3,1,-2,0,2,2,0,0,1,5,0),O(0,3,3,-2,0,3,4,0,0,1,8,0),O(0,2,4,-1,0,4,5,0,0,1,10,0),O(0,3,5,-1,0,5,8,0,0,1,14,0),O(0,3,5,-1,0,6,10,0,0,1,18,0),O(0,4,5,-2,0,7,10,1,0,2,16,1),O(0,5,5,-3,0,8,10,1,0,3,14,2),O(0,5,6,-3,0,9,12,1,0,3,16,2),O(0,6,6,-3,0,10,14,1,0,4,18,3),O(0,6,7,-4,0,11,15,1,0,4,20,3),O(0,7,8,-4,0,12,17,2,0,5,22,4),O(0,7,8,-4,0,13,19,2,0,5,24,4),O(0,7,9,-4,0,14,21,2,0,5,26,4),O(0,8,9,-5,0,15,22,2,0,6,28,5),O(0,8,10,-5,0,16,24,2,0,6,30,5),O(0,8,11,-5,0,17,26,2,0,6,32,5),O(0,9,11,-5,0,18,28,2,0,7,34,6),O(0,9,12,-6,0,19,29,2,0,7,36,6),O(0,10,13,-6,0,20,31,3,0,8,38,7),O(0,10,13,-6,0,21,33,3,0,8,40,7),O(0,10,14,-6,0,22,35,3,0,8,42,7),O(0,11,14,-7,0,23,36,3,0,9,44,8),O(0,11,15,-7,0,24,38,3,0,9,46,8)],N=["duration","easing","delay"],k={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},P={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function D(e){return"".concat(Math.round(e),"ms")}function L(e){if(!e)return 0;const t=e/36;return Math.round(10*(4+15*t**.25+t/5))}function x(e){const t=(0,r.Z)({},k,e.easing),n=(0,r.Z)({},P,e.duration);return(0,r.Z)({getAutoHeightDuration:L,create:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{duration:o=n.standard,easing:s=t.easeInOut,delay:a=0}=r;(0,i.Z)(r,N);return(Array.isArray(e)?e:[e]).map((e=>"".concat(e," ").concat("string"===typeof o?o:D(o)," ").concat(s," ").concat("string"===typeof a?a:D(a)))).join(",")}},e,{easing:t,duration:n})}const M={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},U=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function F(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{mixins:t={},palette:n={},transitions:u={},typography:d={}}=e,h=(0,i.Z)(e,U);if(e.vars)throw new Error((0,o.Z)(18));const p=T(n),f=(0,a.Z)(e);let m=(0,s.Z)(f,{mixins:(g=f.breakpoints,_=t,(0,r.Z)({toolbar:{minHeight:56,[g.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[g.up("sm")]:{minHeight:64}}},_)),palette:p,shadows:A.slice(),typography:I(p,d),transitions:x(u),zIndex:(0,r.Z)({},M)});var g,_;m=(0,s.Z)(m,h);for(var E=arguments.length,v=new Array(E>1?E-1:0),y=1;y<E;y++)v[y-1]=arguments[y];return m=v.reduce(((e,t)=>(0,s.Z)(e,t)),m),m.unstable_sxConfig=(0,r.Z)({},c.Z,null==h?void 0:h.unstable_sxConfig),m.unstable_sx=function(e){return(0,l.Z)({sx:e,theme:this})},m}const j=F},6482:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=(0,n(7107).Z)()},988:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r="$$material"},7630:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>I,FO:()=>w,Dz:()=>C});var r=n(3366),i=n(7462),o=n(2421),s=n(2466),a=n(5080),c=n(1122);const l=["variant"];function u(e){return 0===e.length}function d(e){const{variant:t}=e,n=(0,r.Z)(e,l);let i=t||"";return Object.keys(n).sort().forEach((t=>{i+="color"===t?u(i)?e[t]:(0,c.Z)(e[t]):"".concat(u(i)?t:(0,c.Z)(t)).concat((0,c.Z)(e[t].toString()))})),i}var h=n(104);const p=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];const f=e=>{const t={};return e&&e.forEach((e=>{const n=d(e.props);t[n]=e.style})),t},m=(e,t,n)=>{const{ownerState:r={}}=e,i=[];return n&&n.forEach((n=>{let o=!0;Object.keys(n.props).forEach((t=>{r[t]!==n.props[t]&&e[t]!==n.props[t]&&(o=!1)})),o&&i.push(t[d(n.props)])})),i};function g(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}const _=(0,a.Z)(),E=e=>e?e.charAt(0).toLowerCase()+e.slice(1):e;function v(e){let{defaultTheme:t,theme:n,themeId:r}=e;return i=n,0===Object.keys(i).length?t:n[r]||n;var i}function y(e){return e?(t,n)=>n[e]:null}const b=e=>{let{styledArg:t,props:n,defaultTheme:r,themeId:o}=e;const s=t((0,i.Z)({},n,{theme:v((0,i.Z)({},n,{defaultTheme:r,themeId:o}))}));let a;if(s&&s.variants&&(a=s.variants,delete s.variants),a){return[s,...m(n,f(a),a)]}return s};var S=n(6482),T=n(988);const w=e=>g(e)&&"classes"!==e,C=g,R=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:n=_,rootShouldForwardProp:a=g,slotShouldForwardProp:c=g}=e,l=e=>(0,h.Z)((0,i.Z)({},e,{theme:v((0,i.Z)({},e,{defaultTheme:n,themeId:t}))}));return l.__mui_systemSx=!0,function(e){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,o.Co)(e,(e=>e.filter((e=>!(null!=e&&e.__mui_systemSx)))));const{name:d,slot:h,skipVariantsResolver:_,skipSx:S,overridesResolver:T=y(E(h))}=u,w=(0,r.Z)(u,p),C=void 0!==_?_:h&&"Root"!==h&&"root"!==h||!1,R=S||!1;let I=g;"Root"===h||"root"===h?I=a:h?I=c:function(e){return"string"===typeof e&&e.charCodeAt(0)>96}(e)&&(I=void 0);const O=(0,o.ZP)(e,(0,i.Z)({shouldForwardProp:I,label:undefined},w)),A=function(r){for(var o=arguments.length,a=new Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];const u=a?a.map((e=>{if("function"===typeof e&&e.__emotion_real!==e)return r=>b({styledArg:e,props:r,defaultTheme:n,themeId:t});if((0,s.P)(e)){let t,n=e;return e&&e.variants&&(t=e.variants,delete n.variants,n=n=>{let r=e;return m(n,f(t),t).forEach((e=>{r=(0,s.Z)(r,e)})),r}),n}return e})):[];let h=r;if((0,s.P)(r)){let e;r&&r.variants&&(e=r.variants,delete h.variants,h=t=>{let n=r;return m(t,f(e),e).forEach((e=>{n=(0,s.Z)(n,e)})),n})}else"function"===typeof r&&r.__emotion_real!==r&&(h=e=>b({styledArg:r,props:e,defaultTheme:n,themeId:t}));d&&T&&u.push((e=>{const r=v((0,i.Z)({},e,{defaultTheme:n,themeId:t})),o=((e,t)=>t.components&&t.components[e]&&t.components[e].styleOverrides?t.components[e].styleOverrides:null)(d,r);if(o){const t={};return Object.entries(o).forEach((n=>{let[o,s]=n;t[o]="function"===typeof s?s((0,i.Z)({},e,{theme:r})):s})),T(e,t)}return null})),d&&!C&&u.push((e=>{const r=v((0,i.Z)({},e,{defaultTheme:n,themeId:t}));return((e,t,n,r)=>{var i;const o=null==n||null==(i=n.components)||null==(i=i[r])?void 0:i.variants;return m(e,t,o)})(e,((e,t)=>{let n=[];return t&&t.components&&t.components[e]&&t.components[e].variants&&(n=t.components[e].variants),f(n)})(d,r),r,d)})),R||u.push(l);const p=u.length-a.length;if(Array.isArray(r)&&p>0){const e=new Array(p).fill("");h=[...r,...e],h.raw=[...r.raw,...e]}const g=O(h,...u);return e.muiName&&(g.muiName=e.muiName),g};return O.withConfig&&(A.withConfig=O.withConfig),A}}({themeId:T.Z,defaultTheme:S.Z,rootShouldForwardProp:w}),I=R},1046:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(5735);var i=n(3459);function o(e){let{props:t,name:n,defaultTheme:o,themeId:s}=e,a=(0,i.Z)(o);s&&(a=a[s]||a);const c=function(e){const{theme:t,name:n,props:i}=e;return t&&t.components&&t.components[n]&&t.components[n].defaultProps?(0,r.Z)(t.components[n].defaultProps,i):i}({theme:a,name:n,props:t});return c}var s=n(6482),a=n(988);function c(e){let{props:t,name:n}=e;return o({props:t,name:n,defaultTheme:s.Z,themeId:a.Z})}},4036:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(1122).Z},9201:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var r=n(7462),i=n(2791),o=n(3366),s=n(3733),a=n(4419),c=n(4036),l=n(1046),u=n(7630),d=n(5878),h=n(1217);function p(e){return(0,h.Z)("MuiSvgIcon",e)}(0,d.Z)("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);var f=n(184);const m=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],g=(0,u.ZP)("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"inherit"!==n.color&&t["color".concat((0,c.Z)(n.color))],t["fontSize".concat((0,c.Z)(n.fontSize))]]}})((e=>{let{theme:t,ownerState:n}=e;var r,i,o,s,a,c,l,u,d,h,p,f,m;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:n.hasSvgAsChild?void 0:"currentColor",flexShrink:0,transition:null==(r=t.transitions)||null==(i=r.create)?void 0:i.call(r,"fill",{duration:null==(o=t.transitions)||null==(o=o.duration)?void 0:o.shorter}),fontSize:{inherit:"inherit",small:(null==(s=t.typography)||null==(a=s.pxToRem)?void 0:a.call(s,20))||"1.25rem",medium:(null==(c=t.typography)||null==(l=c.pxToRem)?void 0:l.call(c,24))||"1.5rem",large:(null==(u=t.typography)||null==(d=u.pxToRem)?void 0:d.call(u,35))||"2.1875rem"}[n.fontSize],color:null!=(h=null==(p=(t.vars||t).palette)||null==(p=p[n.color])?void 0:p.main)?h:{action:null==(f=(t.vars||t).palette)||null==(f=f.action)?void 0:f.active,disabled:null==(m=(t.vars||t).palette)||null==(m=m.action)?void 0:m.disabled,inherit:void 0}[n.color]}})),_=i.forwardRef((function(e,t){const n=(0,l.Z)({props:e,name:"MuiSvgIcon"}),{children:u,className:d,color:h="inherit",component:_="svg",fontSize:E="medium",htmlColor:v,inheritViewBox:y=!1,titleAccess:b,viewBox:S="0 0 24 24"}=n,T=(0,o.Z)(n,m),w=i.isValidElement(u)&&"svg"===u.type,C=(0,r.Z)({},n,{color:h,component:_,fontSize:E,instanceFontSize:e.fontSize,inheritViewBox:y,viewBox:S,hasSvgAsChild:w}),R={};y||(R.viewBox=S);const I=(e=>{const{color:t,fontSize:n,classes:r}=e,i={root:["root","inherit"!==t&&"color".concat((0,c.Z)(t)),"fontSize".concat((0,c.Z)(n))]};return(0,a.Z)(i,p,r)})(C);return(0,f.jsxs)(g,(0,r.Z)({as:_,className:(0,s.Z)(I.root,d),focusable:"false",color:v,"aria-hidden":!b||void 0,role:b?"img":void 0,ref:t},R,T,w&&u.props,{ownerState:C,children:[w?u.props.children:u,b?(0,f.jsx)("title",{children:b}):null]}))}));_.muiName="SvgIcon";const E=_;function v(e,t){function n(n,i){return(0,f.jsx)(E,(0,r.Z)({"data-testid":"".concat(t,"Icon"),ref:i},n,{children:e}))}return n.muiName=E.muiName,i.memo(i.forwardRef(n))}},3199:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(2254).Z},4454:(e,t,n)=>{"use strict";n.r(t),n.d(t,{capitalize:()=>i.Z,createChainedFunction:()=>o,createSvgIcon:()=>s.Z,debounce:()=>a.Z,deprecatedPropType:()=>c,isMuiElement:()=>l.Z,ownerDocument:()=>u.Z,ownerWindow:()=>d.Z,requirePropFactory:()=>h,setRef:()=>p,unstable_ClassNameGenerator:()=>b,unstable_useEnhancedEffect:()=>f.Z,unstable_useId:()=>m,unsupportedProp:()=>g,useControlled:()=>_.Z,useEventCallback:()=>E.Z,useForkRef:()=>v.Z,useIsFocusVisible:()=>y.Z});var r=n(5902),i=n(4036);const o=n(8949).Z;var s=n(9201),a=n(3199);const c=function(e,t){return()=>null};var l=n(9103),u=n(8301),d=n(7602);n(7462);const h=function(e,t){return()=>null};const p=n(2971).Z;var f=n(162);const m=n(8252).Z;const g=function(e,t,n,r,i){return null};var _=n(5158),E=n(9683),v=n(2071),y=n(3031);const b={configure:e=>{r.Z.configure(e)}}},9103:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(2791);const i=function(e,t){var n,i;return r.isValidElement(e)&&-1!==t.indexOf(null!=(n=e.type.muiName)?n:null==(i=e.type)||null==(i=i._payload)||null==(i=i.value)?void 0:i.muiName)}},8301:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(4913).Z},7602:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(5202).Z},5158:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(2791);const i=function(e){let{controlled:t,default:n,name:i,state:o="value"}=e;const{current:s}=r.useRef(void 0!==t),[a,c]=r.useState(n);return[s?t:a,r.useCallback((e=>{s||c(e)}),[])]}},162:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(2876).Z},9683:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(7054).Z},2071:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(6117).Z},3031:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(2791);let i,o=!0,s=!1;const a={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function c(e){e.metaKey||e.altKey||e.ctrlKey||(o=!0)}function l(){o=!1}function u(){"hidden"===this.visibilityState&&s&&(o=!0)}function d(e){const{target:t}=e;try{return t.matches(":focus-visible")}catch(n){}return o||function(e){const{type:t,tagName:n}=e;return!("INPUT"!==n||!a[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}(t)}const h=function(){const e=r.useCallback((e=>{var t;null!=e&&((t=e.ownerDocument).addEventListener("keydown",c,!0),t.addEventListener("mousedown",l,!0),t.addEventListener("pointerdown",l,!0),t.addEventListener("touchstart",l,!0),t.addEventListener("visibilitychange",u,!0))}),[]),t=r.useRef(!1);return{isFocusVisibleRef:t,onFocus:function(e){return!!d(e)&&(t.current=!0,!0)},onBlur:function(){return!!t.current&&(s=!0,window.clearTimeout(i),i=window.setTimeout((()=>{s=!1}),100),t.current=!1,!0)},ref:e}}},2421:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>E,Co:()=>v});var r=n(7462),i=n(2791),o=n(9797),s=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,a=(0,o.Z)((function(e){return s.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),c=n(2564),l=n(5438),u=n(9140),d=n(2561),h=a,p=function(e){return"theme"!==e},f=function(e){return"string"===typeof e&&e.charCodeAt(0)>96?h:p},m=function(e,t,n){var r;if(t){var i=t.shouldForwardProp;r=e.__emotion_forwardProp&&i?function(t){return e.__emotion_forwardProp(t)&&i(t)}:i}return"function"!==typeof r&&n&&(r=e.__emotion_forwardProp),r},g=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;return(0,l.hC)(t,n,r),(0,d.L)((function(){return(0,l.My)(t,n,r)})),null},_=function e(t,n){var o,s,a=t.__emotion_real===t,d=a&&t.__emotion_base||t;void 0!==n&&(o=n.label,s=n.target);var h=m(t,n,a),p=h||f(d),_=!p("as");return function(){var E=arguments,v=a&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==o&&v.push("label:"+o+";"),null==E[0]||void 0===E[0].raw)v.push.apply(v,E);else{0,v.push(E[0][0]);for(var y=E.length,b=1;b<y;b++)v.push(E[b],E[0][b])}var S=(0,c.w)((function(e,t,n){var r=_&&e.as||d,o="",a=[],m=e;if(null==e.theme){for(var E in m={},e)m[E]=e[E];m.theme=i.useContext(c.T)}"string"===typeof e.className?o=(0,l.fp)(t.registered,a,e.className):null!=e.className&&(o=e.className+" ");var y=(0,u.O)(v.concat(a),t.registered,m);o+=t.key+"-"+y.name,void 0!==s&&(o+=" "+s);var b=_&&void 0===h?f(r):p,S={};for(var T in e)_&&"as"===T||b(T)&&(S[T]=e[T]);return S.className=o,S.ref=n,i.createElement(i.Fragment,null,i.createElement(g,{cache:t,serialized:y,isStringTag:"string"===typeof r}),i.createElement(r,S))}));return S.displayName=void 0!==o?o:"Styled("+("string"===typeof d?d:d.displayName||d.name||"Component")+")",S.defaultProps=t.defaultProps,S.__emotion_real=S,S.__emotion_base=d,S.__emotion_styles=v,S.__emotion_forwardProp=h,Object.defineProperty(S,"toString",{value:function(){return"."+s}}),S.withComponent=function(t,i){return e(t,(0,r.Z)({},n,i,{shouldForwardProp:m(S,i,!0)})).apply(void 0,v)},S}}.bind();function E(e,t){return _(e,t)}["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){_[e]=_(e)}));const v=(e,t)=>{Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))}},1184:(e,t,n)=>{"use strict";n.d(t,{L7:()=>a,VO:()=>r,W8:()=>s,k9:()=>o});const r={xs:0,sm:600,md:900,lg:1200,xl:1536},i={keys:["xs","sm","md","lg","xl"],up:e=>"@media (min-width:".concat(r[e],"px)")};function o(e,t,n){const o=e.theme||{};if(Array.isArray(t)){const e=o.breakpoints||i;return t.reduce(((r,i,o)=>(r[e.up(e.keys[o])]=n(t[o]),r)),{})}if("object"===typeof t){const e=o.breakpoints||i;return Object.keys(t).reduce(((i,o)=>{if(-1!==Object.keys(e.values||r).indexOf(o)){i[e.up(o)]=n(t[o],o)}else{const e=o;i[e]=t[e]}return i}),{})}return n(t)}function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;return(null==(t=e.keys)?void 0:t.reduce(((t,n)=>(t[e.up(n)]={},t)),{}))||{}}function a(e,t){return e.reduce(((e,t)=>{const n=e[t];return(!n||0===Object.keys(n).length)&&delete e[t],e}),t)}},2065:(e,t,n)=>{"use strict";n.d(t,{$n:()=>d,Fq:()=>l,_j:()=>u,mi:()=>c});var r=n(6189);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(t,e),n)}function o(e){if(e.type)return e;if("#"===e.charAt(0))return o(function(e){e=e.slice(1);const t=new RegExp(".{1,".concat(e.length>=6?2:1,"}"),"g");let n=e.match(t);return n&&1===n[0].length&&(n=n.map((e=>e+e))),n?"rgb".concat(4===n.length?"a":"","(").concat(n.map(((e,t)=>t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3)).join(", "),")"):""}(e));const t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(n))throw new Error((0,r.Z)(9,e));let i,s=e.substring(t+1,e.length-1);if("color"===n){if(s=s.split(" "),i=s.shift(),4===s.length&&"/"===s[3].charAt(0)&&(s[3]=s[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(i))throw new Error((0,r.Z)(10,i))}else s=s.split(",");return s=s.map((e=>parseFloat(e))),{type:n,values:s,colorSpace:i}}function s(e){const{type:t,colorSpace:n}=e;let{values:r}=e;return-1!==t.indexOf("rgb")?r=r.map(((e,t)=>t<3?parseInt(e,10):e)):-1!==t.indexOf("hsl")&&(r[1]="".concat(r[1],"%"),r[2]="".concat(r[2],"%")),r=-1!==t.indexOf("color")?"".concat(n," ").concat(r.join(" ")):"".concat(r.join(", ")),"".concat(t,"(").concat(r,")")}function a(e){let t="hsl"===(e=o(e)).type||"hsla"===e.type?o(function(e){e=o(e);const{values:t}=e,n=t[0],r=t[1]/100,i=t[2]/100,a=r*Math.min(i,1-i),c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return i-a*Math.max(Math.min(t-3,9-t,1),-1)};let l="rgb";const u=[Math.round(255*c(0)),Math.round(255*c(8)),Math.round(255*c(4))];return"hsla"===e.type&&(l+="a",u.push(t[3])),s({type:l,values:u})}(e)).values:e.values;return t=t.map((t=>("color"!==e.type&&(t/=255),t<=.03928?t/12.92:((t+.055)/1.055)**2.4))),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function c(e,t){const n=a(e),r=a(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)}function l(e,t){return e=o(e),t=i(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]="/".concat(t):e.values[3]=t,s(e)}function u(e,t){if(e=o(e),t=i(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb")||-1!==e.type.indexOf("color"))for(let n=0;n<3;n+=1)e.values[n]*=1-t;return s(e)}function d(e,t){if(e=o(e),t=i(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(let n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;else if(-1!==e.type.indexOf("color"))for(let n=0;n<3;n+=1)e.values[n]+=(1-e.values[n])*t;return s(e)}},5080:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(7462),i=n(3366),o=n(2466);const s=["values","unit","step"],a=e=>{const t=Object.keys(e).map((t=>({key:t,val:e[t]})))||[];return t.sort(((e,t)=>e.val-t.val)),t.reduce(((e,t)=>(0,r.Z)({},e,{[t.key]:t.val})),{})};const c={borderRadius:4};var l=n(5682);var u=n(104),d=n(7416);const h=["breakpoints","palette","spacing","shape"];const p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{breakpoints:t={},palette:n={},spacing:p,shape:f={}}=e,m=(0,i.Z)(e,h),g=function(e){const{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:n="px",step:o=5}=e,c=(0,i.Z)(e,s),l=a(t),u=Object.keys(l);function d(e){const r="number"===typeof t[e]?t[e]:e;return"@media (min-width:".concat(r).concat(n,")")}function h(e){const r="number"===typeof t[e]?t[e]:e;return"@media (max-width:".concat(r-o/100).concat(n,")")}function p(e,r){const i=u.indexOf(r);return"@media (min-width:".concat("number"===typeof t[e]?t[e]:e).concat(n,") and ")+"(max-width:".concat((-1!==i&&"number"===typeof t[u[i]]?t[u[i]]:r)-o/100).concat(n,")")}return(0,r.Z)({keys:u,values:l,up:d,down:h,between:p,only:function(e){return u.indexOf(e)+1<u.length?p(e,u[u.indexOf(e)+1]):d(e)},not:function(e){const t=u.indexOf(e);return 0===t?d(u[1]):t===u.length-1?h(u[t]):p(e,u[u.indexOf(e)+1]).replace("@media","@media not all and")},unit:n},c)}(t),_=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;const t=(0,l.hB)({spacing:e}),n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(0===n.length?[1]:n).map((e=>{const n=t(e);return"number"===typeof n?"".concat(n,"px"):n})).join(" ")};return n.mui=!0,n}(p);let E=(0,o.Z)({breakpoints:g,direction:"ltr",components:{},palette:(0,r.Z)({mode:"light"},n),spacing:_,shape:(0,r.Z)({},c,f)},m);for(var v=arguments.length,y=new Array(v>1?v-1:0),b=1;b<v;b++)y[b-1]=arguments[b];return E=y.reduce(((e,t)=>(0,o.Z)(e,t)),E),E.unstable_sxConfig=(0,r.Z)({},d.Z,null==m?void 0:m.unstable_sxConfig),E.unstable_sx=function(e){return(0,u.Z)({sx:e,theme:this})},E}},8247:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(2466);const i=function(e,t){return t?(0,r.Z)(e,t,{clone:!1}):e}},5682:(e,t,n)=>{"use strict";n.d(t,{hB:()=>f,eI:()=>p,NA:()=>m,e6:()=>E,o3:()=>v});var r=n(1184),i=n(8529),o=n(8247);const s={m:"margin",p:"padding"},a={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},c={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},l=function(e){const t={};return n=>(void 0===t[n]&&(t[n]=e(n)),t[n])}((e=>{if(e.length>2){if(!c[e])return[e];e=c[e]}const[t,n]=e.split(""),r=s[t],i=a[n]||"";return Array.isArray(i)?i.map((e=>r+e)):[r+i]})),u=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],d=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],h=[...u,...d];function p(e,t,n,r){var o;const s=null!=(o=(0,i.DW)(e,t,!1))?o:n;return"number"===typeof s?e=>"string"===typeof e?e:s*e:Array.isArray(s)?e=>"string"===typeof e?e:s[e]:"function"===typeof s?s:()=>{}}function f(e){return p(e,"spacing",8)}function m(e,t){if("string"===typeof t||null==t)return t;const n=e(Math.abs(t));return t>=0?n:"number"===typeof n?-n:"-".concat(n)}function g(e,t,n,i){if(-1===t.indexOf(n))return null;const o=function(e,t){return n=>e.reduce(((e,r)=>(e[r]=m(t,n),e)),{})}(l(n),i),s=e[n];return(0,r.k9)(e,s,o)}function _(e,t){const n=f(e.theme);return Object.keys(e).map((r=>g(e,t,r,n))).reduce(o.Z,{})}function E(e){return _(e,u)}function v(e){return _(e,d)}function y(e){return _(e,h)}E.propTypes={},E.filterProps=u,v.propTypes={},v.filterProps=d,y.propTypes={},y.filterProps=h},8529:(e,t,n)=>{"use strict";n.d(t,{DW:()=>o,Jq:()=>s,ZP:()=>a});var r=n(1122),i=n(1184);function o(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||"string"!==typeof t)return null;if(e&&e.vars&&n){const n="vars.".concat(t).split(".").reduce(((e,t)=>e&&e[t]?e[t]:null),e);if(null!=n)return n}return t.split(".").reduce(((e,t)=>e&&null!=e[t]?e[t]:null),e)}function s(e,t,n){let r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return r="function"===typeof e?e(n):Array.isArray(e)?e[n]||i:o(e,n)||i,t&&(r=t(r,i,e)),r}const a=function(e){const{prop:t,cssProperty:n=e.prop,themeKey:a,transform:c}=e,l=e=>{if(null==e[t])return null;const l=e[t],u=o(e.theme,a)||{};return(0,i.k9)(e,l,(e=>{let i=s(u,c,e);return e===i&&"string"===typeof e&&(i=s(u,c,"".concat(t).concat("default"===e?"":(0,r.Z)(e)),e)),!1===n?i:{[n]:i}}))};return l.propTypes={},l.filterProps=[t],l}},7416:(e,t,n)=>{"use strict";n.d(t,{Z:()=>L});var r=n(5682),i=n(8529),o=n(8247);const s=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce(((e,t)=>(t.filterProps.forEach((n=>{e[n]=t})),e)),{}),i=e=>Object.keys(e).reduce(((t,n)=>r[n]?(0,o.Z)(t,r[n](e)):t),{});return i.propTypes={},i.filterProps=t.reduce(((e,t)=>e.concat(t.filterProps)),[]),i};var a=n(1184);function c(e){return"number"!==typeof e?e:"".concat(e,"px solid")}function l(e,t){return(0,i.ZP)({prop:e,themeKey:"borders",transform:t})}const u=l("border",c),d=l("borderTop",c),h=l("borderRight",c),p=l("borderBottom",c),f=l("borderLeft",c),m=l("borderColor"),g=l("borderTopColor"),_=l("borderRightColor"),E=l("borderBottomColor"),v=l("borderLeftColor"),y=l("outline",c),b=l("outlineColor"),S=e=>{if(void 0!==e.borderRadius&&null!==e.borderRadius){const t=(0,r.eI)(e.theme,"shape.borderRadius",4,"borderRadius"),n=e=>({borderRadius:(0,r.NA)(t,e)});return(0,a.k9)(e,e.borderRadius,n)}return null};S.propTypes={},S.filterProps=["borderRadius"];s(u,d,h,p,f,m,g,_,E,v,S,y,b);const T=e=>{if(void 0!==e.gap&&null!==e.gap){const t=(0,r.eI)(e.theme,"spacing",8,"gap"),n=e=>({gap:(0,r.NA)(t,e)});return(0,a.k9)(e,e.gap,n)}return null};T.propTypes={},T.filterProps=["gap"];const w=e=>{if(void 0!==e.columnGap&&null!==e.columnGap){const t=(0,r.eI)(e.theme,"spacing",8,"columnGap"),n=e=>({columnGap:(0,r.NA)(t,e)});return(0,a.k9)(e,e.columnGap,n)}return null};w.propTypes={},w.filterProps=["columnGap"];const C=e=>{if(void 0!==e.rowGap&&null!==e.rowGap){const t=(0,r.eI)(e.theme,"spacing",8,"rowGap"),n=e=>({rowGap:(0,r.NA)(t,e)});return(0,a.k9)(e,e.rowGap,n)}return null};C.propTypes={},C.filterProps=["rowGap"];s(T,w,C,(0,i.ZP)({prop:"gridColumn"}),(0,i.ZP)({prop:"gridRow"}),(0,i.ZP)({prop:"gridAutoFlow"}),(0,i.ZP)({prop:"gridAutoColumns"}),(0,i.ZP)({prop:"gridAutoRows"}),(0,i.ZP)({prop:"gridTemplateColumns"}),(0,i.ZP)({prop:"gridTemplateRows"}),(0,i.ZP)({prop:"gridTemplateAreas"}),(0,i.ZP)({prop:"gridArea"}));function R(e,t){return"grey"===t?t:e}s((0,i.ZP)({prop:"color",themeKey:"palette",transform:R}),(0,i.ZP)({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:R}),(0,i.ZP)({prop:"backgroundColor",themeKey:"palette",transform:R}));function I(e){return e<=1&&0!==e?"".concat(100*e,"%"):e}const O=(0,i.ZP)({prop:"width",transform:I}),A=e=>{if(void 0!==e.maxWidth&&null!==e.maxWidth){const t=t=>{var n,r;const i=(null==(n=e.theme)||null==(n=n.breakpoints)||null==(n=n.values)?void 0:n[t])||a.VO[t];return i?"px"!==(null==(r=e.theme)||null==(r=r.breakpoints)?void 0:r.unit)?{maxWidth:"".concat(i).concat(e.theme.breakpoints.unit)}:{maxWidth:i}:{maxWidth:I(t)}};return(0,a.k9)(e,e.maxWidth,t)}return null};A.filterProps=["maxWidth"];const N=(0,i.ZP)({prop:"minWidth",transform:I}),k=(0,i.ZP)({prop:"height",transform:I}),P=(0,i.ZP)({prop:"maxHeight",transform:I}),D=(0,i.ZP)({prop:"minHeight",transform:I}),L=((0,i.ZP)({prop:"size",cssProperty:"width",transform:I}),(0,i.ZP)({prop:"size",cssProperty:"height",transform:I}),s(O,A,N,k,P,D,(0,i.ZP)({prop:"boxSizing"})),{border:{themeKey:"borders",transform:c},borderTop:{themeKey:"borders",transform:c},borderRight:{themeKey:"borders",transform:c},borderBottom:{themeKey:"borders",transform:c},borderLeft:{themeKey:"borders",transform:c},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:c},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:S},color:{themeKey:"palette",transform:R},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:R},backgroundColor:{themeKey:"palette",transform:R},p:{style:r.o3},pt:{style:r.o3},pr:{style:r.o3},pb:{style:r.o3},pl:{style:r.o3},px:{style:r.o3},py:{style:r.o3},padding:{style:r.o3},paddingTop:{style:r.o3},paddingRight:{style:r.o3},paddingBottom:{style:r.o3},paddingLeft:{style:r.o3},paddingX:{style:r.o3},paddingY:{style:r.o3},paddingInline:{style:r.o3},paddingInlineStart:{style:r.o3},paddingInlineEnd:{style:r.o3},paddingBlock:{style:r.o3},paddingBlockStart:{style:r.o3},paddingBlockEnd:{style:r.o3},m:{style:r.e6},mt:{style:r.e6},mr:{style:r.e6},mb:{style:r.e6},ml:{style:r.e6},mx:{style:r.e6},my:{style:r.e6},margin:{style:r.e6},marginTop:{style:r.e6},marginRight:{style:r.e6},marginBottom:{style:r.e6},marginLeft:{style:r.e6},marginX:{style:r.e6},marginY:{style:r.e6},marginInline:{style:r.e6},marginInlineStart:{style:r.e6},marginInlineEnd:{style:r.e6},marginBlock:{style:r.e6},marginBlockStart:{style:r.e6},marginBlockEnd:{style:r.e6},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:T},rowGap:{style:C},columnGap:{style:w},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:I},maxWidth:{style:A},minWidth:{transform:I},height:{transform:I},maxHeight:{transform:I},minHeight:{transform:I},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}})},104:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(1122),i=n(8247),o=n(8529),s=n(1184),a=n(7416);const c=function(){function e(e,t,n,i){const a={[e]:t,theme:n},c=i[e];if(!c)return{[e]:t};const{cssProperty:l=e,themeKey:u,transform:d,style:h}=c;if(null==t)return null;if("typography"===u&&"inherit"===t)return{[e]:t};const p=(0,o.DW)(n,u)||{};if(h)return h(a);return(0,s.k9)(a,t,(t=>{let n=(0,o.Jq)(p,d,t);return t===n&&"string"===typeof t&&(n=(0,o.Jq)(p,d,"".concat(e).concat("default"===t?"":(0,r.Z)(t)),t)),!1===l?n:{[l]:n}}))}return function t(n){var r;const{sx:o,theme:c={}}=n||{};if(!o)return null;const l=null!=(r=c.unstable_sxConfig)?r:a.Z;function u(n){let r=n;if("function"===typeof n)r=n(c);else if("object"!==typeof n)return n;if(!r)return null;const o=(0,s.W8)(c.breakpoints),a=Object.keys(o);let u=o;return Object.keys(r).forEach((n=>{const o=(a=r[n],d=c,"function"===typeof a?a(d):a);var a,d;if(null!==o&&void 0!==o)if("object"===typeof o)if(l[n])u=(0,i.Z)(u,e(n,o,c,l));else{const e=(0,s.k9)({theme:c},o,(e=>({[n]:e})));!function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce(((e,t)=>e.concat(Object.keys(t))),[]),i=new Set(r);return t.every((e=>i.size===Object.keys(e).length))}(e,o)?u=(0,i.Z)(u,e):u[n]=t({sx:o,theme:c})}else u=(0,i.Z)(u,e(n,o,c,l))})),(0,s.L7)(a,u)}return Array.isArray(o)?o.map(u):u(o)}}();c.filterProps=["sx"];const l=c},3459:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(5080),i=n(2791),o=n(2564);const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=i.useContext(o.T);return t&&(n=t,0!==Object.keys(n).length)?t:e;var n},a=(0,r.Z)();const c=function(){return s(arguments.length>0&&void 0!==arguments[0]?arguments[0]:a)}},5902:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const r=e=>e,i=(()=>{let e=r;return{configure(t){e=t},generate:t=>e(t),reset(){e=r}}})()},1122:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(6189);function i(e){if("string"!==typeof e)throw new Error((0,r.Z)(7));return e.charAt(0).toUpperCase()+e.slice(1)}},4419:(e,t,n)=>{"use strict";function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const r={};return Object.keys(e).forEach((i=>{r[i]=e[i].reduce(((e,r)=>{if(r){const i=t(r);""!==i&&e.push(i),n&&n[r]&&e.push(n[r])}return e}),[]).join(" ")})),r}n.d(t,{Z:()=>r})},8949:(e,t,n)=>{"use strict";function r(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>null==t?e:function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r),t.apply(this,r)}),(()=>{}))}n.d(t,{Z:()=>r})},2254:(e,t,n)=>{"use strict";function r(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function r(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];clearTimeout(t),t=setTimeout((()=>{e.apply(this,i)}),n)}return r.clear=()=>{clearTimeout(t)},r}n.d(t,{Z:()=>r})},2466:(e,t,n)=>{"use strict";n.d(t,{P:()=>i,Z:()=>s});var r=n(7462);function i(e){return null!==e&&"object"===typeof e&&e.constructor===Object}function o(e){if(!i(e))return e;const t={};return Object.keys(e).forEach((n=>{t[n]=o(e[n])})),t}function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0};const a=n.clone?(0,r.Z)({},e):e;return i(e)&&i(t)&&Object.keys(t).forEach((r=>{"__proto__"!==r&&(i(t[r])&&r in e&&i(e[r])?a[r]=s(e[r],t[r],n):n.clone?a[r]=i(t[r])?o(t[r]):t[r]:a[r]=t[r])})),a}},6189:(e,t,n)=>{"use strict";function r(e){let t="https://mui.com/production-error/?code="+e;for(let n=1;n<arguments.length;n+=1)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}n.d(t,{Z:()=>r})},1217:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(5902);const i={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const o=i[t];return o?"".concat(n,"-").concat(o):"".concat(r.Z.generate(e),"-").concat(t)}},5878:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(1217);function i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const i={};return t.forEach((t=>{i[t]=(0,r.Z)(e,t,n)})),i}},4913:(e,t,n)=>{"use strict";function r(e){return e&&e.ownerDocument||document}n.d(t,{Z:()=>r})},5202:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(4913);function i(e){return(0,r.Z)(e).defaultView||window}},5735:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(7462);function i(e,t){const n=(0,r.Z)({},t);return Object.keys(e).forEach((o=>{if(o.toString().match(/^(components|slots)$/))n[o]=(0,r.Z)({},e[o],n[o]);else if(o.toString().match(/^(componentsProps|slotProps)$/)){const s=e[o]||{},a=t[o];n[o]={},a&&Object.keys(a)?s&&Object.keys(s)?(n[o]=(0,r.Z)({},a),Object.keys(s).forEach((e=>{n[o][e]=i(s[e],a[e])}))):n[o]=a:n[o]=s}else void 0===n[o]&&(n[o]=e[o])})),n}},2971:(e,t,n)=>{"use strict";function r(e,t){"function"===typeof e?e(t):e&&(e.current=t)}n.d(t,{Z:()=>r})},2876:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(2791);const i="undefined"!==typeof window?r.useLayoutEffect:r.useEffect},7054:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(2791),i=n(2876);const o=function(e){const t=r.useRef(e);return(0,i.Z)((()=>{t.current=e})),r.useRef((function(){return(0,t.current)(...arguments)})).current}},6117:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(2791),i=n(2971);function o(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.useMemo((()=>t.every((e=>null==e))?null:e=>{t.forEach((t=>{(0,i.Z)(t,e)}))}),t)}},8252:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>a});var i=n(2791);let o=0;const s=(r||(r=n.t(i,2)))["useId".toString()];function a(e){if(void 0!==s){const t=s();return null!=e?e:t}return function(e){const[t,n]=i.useState(e),r=e||t;return i.useEffect((()=>{null==t&&(o+=1,n("mui-".concat(o)))}),[t]),r}(e)}},3322:function(e,t,n){e.exports=function(){"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}let t=!0,r=!0;function i(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function o(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function s(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(t=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function a(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function c(){if("object"==typeof window){if(t)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function l(e,t){r&&console.warn(e+" is deprecated, please use "+t+" instead.")}function u(e){return"[object Object]"===Object.prototype.toString.call(e)}function d(e){return u(e)?Object.keys(e).reduce((function(t,n){const r=u(e[n]),i=r?d(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function h(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?h(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{h(e,e.get(t),n)}))})))}function p(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&h(e,n,i)}))})),i}const f=c;function m(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const s=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let s=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!s&&n.length&&t.includes("back")&&(s=n[n.length-1]),s&&(e.video.deviceId=o.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=r(e.video),f("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return f("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function g(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function _(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else o(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function E(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function v(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])})).then(n,r)}}function y(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>p(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),o(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>p(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function b(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function S(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return b(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[n.id];if(i)i.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function T(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function w(e,t){o(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var C=Object.freeze({__proto__:null,fixNegotiationNeeded:w,shimAddTrackRemoveTrack:S,shimAddTrackRemoveTrackWithNative:b,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:E,shimGetStats:v,shimGetUserMedia:m,shimMediaStream:g,shimOnTrack:_,shimPeerConnection:T,shimSenderReceiverGetStats:y});function R(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){l("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function I(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function O(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}function A(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function N(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),o(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function k(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){l("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function P(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function D(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function L(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function x(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function M(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var U=Object.freeze({__proto__:null,shimAddTransceiver:D,shimCreateAnswer:M,shimCreateOffer:x,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:L,shimGetUserMedia:R,shimOnTrack:I,shimPeerConnection:O,shimRTCDataChannel:P,shimReceiverGetStats:N,shimRemoveStream:k,shimSenderGetStats:A});function F(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function j(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function V(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let a=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=a,a=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=a,a=function(e,t,n){const r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=a}function B(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(G(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function G(e){return e&&void 0!==e.video?Object.assign({},e,{video:d(e.video)}):e}function q(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(l("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function W(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function z(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function H(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var K=Object.freeze({__proto__:null,shimAudioContext:H,shimCallbacksAPI:V,shimConstraints:G,shimCreateOfferLegacy:z,shimGetUserMedia:B,shimLocalStreamsAPI:F,shimRTCIceServerUrls:q,shimRemoteStreamsAPI:j,shimTrackEventTransceiver:W}),Y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function Z(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var J={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let i=0;i<r.length;i++)n=r[i].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let o=3;o<r.length;o++){const i=r[o],s=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(s){const r=t.parseRtpMap(s),o=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=o.length?t.parseFmtp(o[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{i.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=s.length>0&&s[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===a&&(c=l[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&a&&n.push({ssrc:a});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=u}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let t=0;t<r.length;t++)switch(r[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(J);var X=J.exports,Q=Z(X),$=e({__proto__:null,default:Q},[X]);function ee(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Q.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,o(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function te(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||o(e,"icecandidate",(e=>{if(e.candidate){const t=Q.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function ne(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Q.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Q.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Q.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=o(arguments[0],e);let s;s=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>s}),this._sctp=a}return s.apply(this,arguments)}}function re(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},o(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function ie(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function oe(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function se(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ae(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var ce=Object.freeze({__proto__:null,removeExtmapAllowMixed:oe,shimAddIceCandidateNullOrEmpty:se,shimConnectionState:ie,shimMaxMessageSize:ne,shimParameterlessSetLocalDescription:ae,shimRTCIceCandidate:ee,shimRTCIceCandidateRelayProtocol:te,shimSendThrowTypeError:re});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=c,r=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=i(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=i(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=i(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),o={browserDetails:r,commonShim:ce,extractVersion:i,disableLog:s,disableWarnings:a,sdp:$};switch(r.browser){case"chrome":if(!C||!T||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=C,se(e,r),ae(e),m(e,r),g(e),T(e,r),_(e),S(e,r),E(e),v(e),y(e),w(e,r),ee(e),te(e),ie(e),ne(e,r),re(e),oe(e,r);break;case"firefox":if(!U||!O||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=U,se(e,r),ae(e),R(e,r),O(e,r),I(e),k(e),A(e),N(e),P(e),D(e),L(e),x(e),M(e),ee(e),ie(e),ne(e,r),re(e);break;case"safari":if(!K||!t.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=K,se(e,r),ae(e),q(e),z(e),V(e),F(e),j(e),W(e),B(e),H(e),ee(e),te(e),ne(e,r),re(e),oe(e,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var le=function(e){try{return!!e()}catch(e){return!0}},ue=!le((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),de=ue,he=Function.prototype,pe=he.call,fe=de&&he.bind.bind(pe,pe),me=de?fe:function(e){return function(){return pe.apply(e,arguments)}},ge=me({}.isPrototypeOf),_e=function(e){return e&&e.Math==Math&&e},Ee=_e("object"==typeof globalThis&&globalThis)||_e("object"==typeof window&&window)||_e("object"==typeof self&&self)||_e("object"==typeof Y&&Y)||function(){return this}()||Y||Function("return this")(),ve=ue,ye=Function.prototype,be=ye.apply,Se=ye.call,Te="object"==typeof Reflect&&Reflect.apply||(ve?Se.bind(be):function(){return Se.apply(be,arguments)}),we=me,Ce=we({}.toString),Re=we("".slice),Ie=function(e){return Re(Ce(e),8,-1)},Oe=Ie,Ae=me,Ne=function(e){if("Function"===Oe(e))return Ae(e)},ke="object"==typeof document&&document.all,Pe={all:ke,IS_HTMLDDA:void 0===ke&&void 0!==ke},De=Pe.all,Le=Pe.IS_HTMLDDA?function(e){return"function"==typeof e||e===De}:function(e){return"function"==typeof e},xe={},Me=!le((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Ue=ue,Fe=Function.prototype.call,je=Ue?Fe.bind(Fe):function(){return Fe.apply(Fe,arguments)},Ve={},Be={}.propertyIsEnumerable,Ge=Object.getOwnPropertyDescriptor,qe=Ge&&!Be.call({1:2},1);Ve.f=qe?function(e){var t=Ge(this,e);return!!t&&t.enumerable}:Be;var We,ze,He=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ke=le,Ye=Ie,Ze=Object,Je=me("".split),Xe=Ke((function(){return!Ze("z").propertyIsEnumerable(0)}))?function(e){return"String"==Ye(e)?Je(e,""):Ze(e)}:Ze,Qe=function(e){return null==e},$e=Qe,et=TypeError,tt=function(e){if($e(e))throw et("Can't call method on "+e);return e},nt=Xe,rt=tt,it=function(e){return nt(rt(e))},ot=Le,st=Pe.all,at=Pe.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:ot(e)||e===st}:function(e){return"object"==typeof e?null!==e:ot(e)},ct={},lt=ct,ut=Ee,dt=Le,ht=function(e){return dt(e)?e:void 0},pt=function(e,t){return arguments.length<2?ht(lt[e])||ht(ut[e]):lt[e]&&lt[e][t]||ut[e]&&ut[e][t]},ft="undefined"!=typeof navigator&&String(navigator.userAgent)||"",mt=Ee,gt=ft,_t=mt.process,Et=mt.Deno,vt=_t&&_t.versions||Et&&Et.version,yt=vt&&vt.v8;yt&&(ze=(We=yt.split("."))[0]>0&&We[0]<4?1:+(We[0]+We[1])),!ze&&gt&&(!(We=gt.match(/Edge\/(\d+)/))||We[1]>=74)&&(We=gt.match(/Chrome\/(\d+)/))&&(ze=+We[1]);var bt=ze,St=bt,Tt=le,wt=Ee.String,Ct=!!Object.getOwnPropertySymbols&&!Tt((function(){var e=Symbol();return!wt(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&St&&St<41})),Rt=Ct&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,It=pt,Ot=Le,At=ge,Nt=Object,kt=Rt?function(e){return"symbol"==typeof e}:function(e){var t=It("Symbol");return Ot(t)&&At(t.prototype,Nt(e))},Pt=String,Dt=function(e){try{return Pt(e)}catch(e){return"Object"}},Lt=Le,xt=Dt,Mt=TypeError,Ut=function(e){if(Lt(e))return e;throw Mt(xt(e)+" is not a function")},Ft=Ut,jt=Qe,Vt=function(e,t){var n=e[t];return jt(n)?void 0:Ft(n)},Bt=je,Gt=Le,qt=at,Wt=TypeError,zt={exports:{}},Ht=Ee,Kt=Object.defineProperty,Yt=function(e,t){try{Kt(Ht,e,{value:t,configurable:!0,writable:!0})}catch(r){Ht[e]=t}return t},Zt="__core-js_shared__",Jt=Ee[Zt]||Yt(Zt,{}),Xt=Jt;(zt.exports=function(e,t){return Xt[e]||(Xt[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Qt=zt.exports,$t=tt,en=Object,tn=function(e){return en($t(e))},nn=tn,rn=me({}.hasOwnProperty),on=Object.hasOwn||function(e,t){return rn(nn(e),t)},sn=me,an=0,cn=Math.random(),ln=sn(1..toString),un=function(e){return"Symbol("+(void 0===e?"":e)+")_"+ln(++an+cn,36)},dn=Qt,hn=on,pn=un,fn=Ct,mn=Rt,gn=Ee.Symbol,_n=dn("wks"),En=mn?gn.for||gn:gn&&gn.withoutSetter||pn,vn=function(e){return hn(_n,e)||(_n[e]=fn&&hn(gn,e)?gn[e]:En("Symbol."+e)),_n[e]},yn=je,bn=at,Sn=kt,Tn=Vt,wn=function(e,t){var n,r;if("string"===t&&Gt(n=e.toString)&&!qt(r=Bt(n,e)))return r;if(Gt(n=e.valueOf)&&!qt(r=Bt(n,e)))return r;if("string"!==t&&Gt(n=e.toString)&&!qt(r=Bt(n,e)))return r;throw Wt("Can't convert object to primitive value")},Cn=TypeError,Rn=vn("toPrimitive"),In=function(e,t){if(!bn(e)||Sn(e))return e;var n,r=Tn(e,Rn);if(r){if(void 0===t&&(t="default"),n=yn(r,e,t),!bn(n)||Sn(n))return n;throw Cn("Can't convert object to primitive value")}return void 0===t&&(t="number"),wn(e,t)},On=kt,An=function(e){var t=In(e,"string");return On(t)?t:t+""},Nn=at,kn=Ee.document,Pn=Nn(kn)&&Nn(kn.createElement),Dn=function(e){return Pn?kn.createElement(e):{}},Ln=Dn,xn=!Me&&!le((function(){return 7!=Object.defineProperty(Ln("div"),"a",{get:function(){return 7}}).a})),Mn=Me,Un=je,Fn=Ve,jn=He,Vn=it,Bn=An,Gn=on,qn=xn,Wn=Object.getOwnPropertyDescriptor;xe.f=Mn?Wn:function(e,t){if(e=Vn(e),t=Bn(t),qn)try{return Wn(e,t)}catch(e){}if(Gn(e,t))return jn(!Un(Fn.f,e,t),e[t])};var zn=le,Hn=Le,Kn=/#|\.prototype\./,Yn=function(e,t){var n=Jn[Zn(e)];return n==Qn||n!=Xn&&(Hn(t)?zn(t):!!t)},Zn=Yn.normalize=function(e){return String(e).replace(Kn,".").toLowerCase()},Jn=Yn.data={},Xn=Yn.NATIVE="N",Qn=Yn.POLYFILL="P",$n=Yn,er=Ut,tr=ue,nr=Ne(Ne.bind),rr=function(e,t){return er(e),void 0===t?e:tr?nr(e,t):function(){return e.apply(t,arguments)}},ir={},or=Me&&le((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),sr=at,ar=String,cr=TypeError,lr=function(e){if(sr(e))return e;throw cr(ar(e)+" is not an object")},ur=Me,dr=xn,hr=or,pr=lr,fr=An,mr=TypeError,gr=Object.defineProperty,_r=Object.getOwnPropertyDescriptor,Er="enumerable",vr="configurable",yr="writable";ir.f=ur?hr?function(e,t,n){if(pr(e),t=fr(t),pr(n),"function"==typeof e&&"prototype"===t&&"value"in n&&yr in n&&!n[yr]){var r=_r(e,t);r&&r[yr]&&(e[t]=n.value,n={configurable:vr in n?n[vr]:r[vr],enumerable:Er in n?n[Er]:r[Er],writable:!1})}return gr(e,t,n)}:gr:function(e,t,n){if(pr(e),t=fr(t),pr(n),dr)try{return gr(e,t,n)}catch(e){}if("get"in n||"set"in n)throw mr("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var br=ir,Sr=He,Tr=Me?function(e,t,n){return br.f(e,t,Sr(1,n))}:function(e,t,n){return e[t]=n,e},wr=Ee,Cr=Te,Rr=Ne,Ir=Le,Or=xe.f,Ar=$n,Nr=ct,kr=rr,Pr=Tr,Dr=on,Lr=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return Cr(e,this,arguments)};return t.prototype=e.prototype,t},xr=function(e,t){var n,r,i,o,s,a,c,l,u,d=e.target,h=e.global,p=e.stat,f=e.proto,m=h?wr:p?wr[d]:(wr[d]||{}).prototype,g=h?Nr:Nr[d]||Pr(Nr,d,{})[d],_=g.prototype;for(o in t)r=!(n=Ar(h?o:d+(p?".":"#")+o,e.forced))&&m&&Dr(m,o),a=g[o],r&&(c=e.dontCallGetSet?(u=Or(m,o))&&u.value:m[o]),s=r&&c?c:t[o],r&&typeof a==typeof s||(l=e.bind&&r?kr(s,wr):e.wrap&&r?Lr(s):f&&Ir(s)?Rr(s):s,(e.sham||s&&s.sham||a&&a.sham)&&Pr(l,"sham",!0),Pr(g,o,l),f&&(Dr(Nr,i=d+"Prototype")||Pr(Nr,i,{}),Pr(Nr[i],o,s),e.real&&_&&(n||!_[o])&&Pr(_,o,s)))},Mr=Math.ceil,Ur=Math.floor,Fr=Math.trunc||function(e){var t=+e;return(t>0?Ur:Mr)(t)},jr=function(e){var t=+e;return t!=t||0===t?0:Fr(t)},Vr=jr,Br=Math.max,Gr=Math.min,qr=function(e,t){var n=Vr(e);return n<0?Br(n+t,0):Gr(n,t)},Wr=jr,zr=Math.min,Hr=function(e){return e>0?zr(Wr(e),9007199254740991):0},Kr=function(e){return Hr(e.length)},Yr=it,Zr=qr,Jr=Kr,Xr=function(e){return function(t,n,r){var i,o=Yr(t),s=Jr(o),a=Zr(r,s);if(e&&n!=n){for(;s>a;)if((i=o[a++])!=i)return!0}else for(;s>a;a++)if((e||a in o)&&o[a]===n)return e||a||0;return!e&&-1}},Qr={includes:Xr(!0),indexOf:Xr(!1)},$r=Qr.includes;xr({target:"Array",proto:!0,forced:le((function(){return!Array(1).includes()}))},{includes:function(e){return $r(this,e,arguments.length>1?arguments[1]:void 0)}});var ei=ct,ti=function(e){return ei[e+"Prototype"]},ni=ti("Array").includes,ri=at,ii=Ie,oi=vn("match"),si=function(e){var t;return ri(e)&&(void 0!==(t=e[oi])?!!t:"RegExp"==ii(e))},ai=TypeError,ci={};ci[vn("toStringTag")]="z";var li="[object z]"===String(ci),ui=li,di=Le,hi=Ie,pi=vn("toStringTag"),fi=Object,mi="Arguments"==hi(function(){return arguments}()),gi=ui?hi:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=fi(e),pi))?n:mi?hi(t):"Object"==(r=hi(t))&&di(t.callee)?"Arguments":r},_i=gi,Ei=String,vi=function(e){if("Symbol"===_i(e))throw TypeError("Cannot convert a Symbol value to a string");return Ei(e)},yi=vn("match"),bi=xr,Si=function(e){if(si(e))throw ai("The method doesn't accept regular expressions");return e},Ti=tt,wi=vi,Ci=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[yi]=!1,"/./"[e](t)}catch(e){}}return!1},Ri=me("".indexOf);bi({target:"String",proto:!0,forced:!Ci("includes")},{includes:function(e){return!!~Ri(wi(Ti(this)),wi(Si(e)),arguments.length>1?arguments[1]:void 0)}});var Ii=ti("String").includes,Oi=ge,Ai=ni,Ni=Ii,ki=Array.prototype,Pi=String.prototype,Di=Z((function(e){var t=e.includes;return e===ki||Oi(ki,e)&&t===ki.includes?Ai:"string"==typeof e||e===Pi||Oi(Pi,e)&&t===Pi.includes?Ni:t})),Li={exports:{}},xi=xr,Mi=Me,Ui=ir.f;xi({target:"Object",stat:!0,forced:Object.defineProperty!==Ui,sham:!Mi},{defineProperty:Ui});var Fi=ct.Object,ji=Li.exports=function(e,t,n){return Fi.defineProperty(e,t,n)};Fi.defineProperty.sham&&(ji.sham=!0);var Vi=Z(Li.exports),Bi=Ie,Gi=Array.isArray||function(e){return"Array"==Bi(e)},qi=TypeError,Wi=An,zi=ir,Hi=He,Ki=function(e,t,n){var r=Wi(t);r in e?zi.f(e,r,Hi(0,n)):e[r]=n},Yi=Le,Zi=Jt,Ji=me(Function.toString);Yi(Zi.inspectSource)||(Zi.inspectSource=function(e){return Ji(e)});var Xi=Zi.inspectSource,Qi=me,$i=le,eo=Le,to=gi,no=Xi,ro=function(){},io=[],oo=pt("Reflect","construct"),so=/^\s*(?:class|function)\b/,ao=Qi(so.exec),co=!so.exec(ro),lo=function(e){if(!eo(e))return!1;try{return oo(ro,io,e),!0}catch(e){return!1}},uo=function(e){if(!eo(e))return!1;switch(to(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return co||!!ao(so,no(e))}catch(e){return!0}};uo.sham=!0;var ho=!oo||$i((function(){var e;return lo(lo.call)||!lo(Object)||!lo((function(){e=!0}))||e}))?uo:lo,po=Gi,fo=ho,mo=at,go=vn("species"),_o=Array,Eo=function(e){var t;return po(e)&&(t=e.constructor,(fo(t)&&(t===_o||po(t.prototype))||mo(t)&&null===(t=t[go]))&&(t=void 0)),void 0===t?_o:t},vo=function(e,t){return new(Eo(e))(0===t?0:t)},yo=le,bo=bt,So=vn("species"),To=xr,wo=le,Co=Gi,Ro=at,Io=tn,Oo=Kr,Ao=function(e){if(e>9007199254740991)throw qi("Maximum allowed index exceeded");return e},No=Ki,ko=vo,Po=function(e){return bo>=51||!yo((function(){var t=[];return(t.constructor={})[So]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Do=bt,Lo=vn("isConcatSpreadable"),xo=Do>=51||!wo((function(){var e=[];return e[Lo]=!1,e.concat()[0]!==e})),Mo=function(e){if(!Ro(e))return!1;var t=e[Lo];return void 0!==t?!!t:Co(e)};To({target:"Array",proto:!0,arity:1,forced:!xo||!Po("concat")},{concat:function(e){var t,n,r,i,o,s=Io(this),a=ko(s,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(Mo(o=-1===t?s:arguments[t]))for(i=Oo(o),Ao(c+i),n=0;n<i;n++,c++)n in o&&No(a,c,o[n]);else Ao(c+1),No(a,c++,o);return a.length=c,a}});var Uo={},Fo={},jo=on,Vo=it,Bo=Qr.indexOf,Go=Fo,qo=me([].push),Wo=function(e,t){var n,r=Vo(e),i=0,o=[];for(n in r)!jo(Go,n)&&jo(r,n)&&qo(o,n);for(;t.length>i;)jo(r,n=t[i++])&&(~Bo(o,n)||qo(o,n));return o},zo=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ho=Wo,Ko=zo,Yo=Object.keys||function(e){return Ho(e,Ko)},Zo=Me,Jo=or,Xo=ir,Qo=lr,$o=it,es=Yo;Uo.f=Zo&&!Jo?Object.defineProperties:function(e,t){Qo(e);for(var n,r=$o(t),i=es(t),o=i.length,s=0;o>s;)Xo.f(e,n=i[s++],r[n]);return e};var ts,ns=pt("document","documentElement"),rs=un,is=Qt("keys"),os=function(e){return is[e]||(is[e]=rs(e))},ss=lr,as=Uo,cs=zo,ls=Fo,us=ns,ds=Dn,hs="prototype",ps="script",fs=os("IE_PROTO"),ms=function(){},gs=function(e){return"<"+ps+">"+e+"</"+ps+">"},_s=function(e){e.write(gs("")),e.close();var t=e.parentWindow.Object;return e=null,t},Es=function(){try{ts=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;Es="undefined"!=typeof document?document.domain&&ts?_s(ts):(t=ds("iframe"),n="java"+ps+":",t.style.display="none",us.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(gs("document.F=Object")),e.close(),e.F):_s(ts);for(var r=cs.length;r--;)delete Es[hs][cs[r]];return Es()};ls[fs]=!0;var vs=Object.create||function(e,t){var n;return null!==e?(ms[hs]=ss(e),n=new ms,ms[hs]=null,n[fs]=e):n=Es(),void 0===t?n:as.f(n,t)},ys={},bs=Wo,Ss=zo.concat("length","prototype");ys.f=Object.getOwnPropertyNames||function(e){return bs(e,Ss)};var Ts={},ws=qr,Cs=Kr,Rs=Ki,Is=Array,Os=Math.max,As=function(e,t,n){for(var r=Cs(e),i=ws(t,r),o=ws(void 0===n?r:n,r),s=Is(Os(o-i,0)),a=0;i<o;i++,a++)Rs(s,a,e[i]);return s.length=a,s},Ns=Ie,ks=it,Ps=ys.f,Ds=As,Ls="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Ts.f=function(e){return Ls&&"Window"==Ns(e)?function(e){try{return Ps(e)}catch(e){return Ds(Ls)}}(e):Ps(ks(e))};var xs={};xs.f=Object.getOwnPropertySymbols;var Ms=Tr,Us=function(e,t,n,r){return r&&r.enumerable?e[t]=n:Ms(e,t,n),e},Fs=ir,js=function(e,t,n){return Fs.f(e,t,n)},Vs={},Bs=vn;Vs.f=Bs;var Gs,qs,Ws,zs=ct,Hs=on,Ks=Vs,Ys=ir.f,Zs=function(e){var t=zs.Symbol||(zs.Symbol={});Hs(t,e)||Ys(t,e,{value:Ks.f(e)})},Js=je,Xs=pt,Qs=vn,$s=Us,ea=function(){var e=Xs("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=Qs("toPrimitive");t&&!t[r]&&$s(t,r,(function(e){return Js(n,this)}),{arity:1})},ta=gi,na=li?{}.toString:function(){return"[object "+ta(this)+"]"},ra=li,ia=ir.f,oa=Tr,sa=on,aa=na,ca=vn("toStringTag"),la=function(e,t,n,r){if(e){var i=n?e:e.prototype;sa(i,ca)||ia(i,ca,{configurable:!0,value:t}),r&&!ra&&oa(i,"toString",aa)}},ua=Le,da=Ee.WeakMap,ha=ua(da)&&/native code/.test(String(da)),pa=Ee,fa=at,ma=Tr,ga=on,_a=Jt,Ea=os,va=Fo,ya="Object already initialized",ba=pa.TypeError,Sa=pa.WeakMap;if(ha||_a.state){var Ta=_a.state||(_a.state=new Sa);Ta.get=Ta.get,Ta.has=Ta.has,Ta.set=Ta.set,Gs=function(e,t){if(Ta.has(e))throw ba(ya);return t.facade=e,Ta.set(e,t),t},qs=function(e){return Ta.get(e)||{}},Ws=function(e){return Ta.has(e)}}else{var wa=Ea("state");va[wa]=!0,Gs=function(e,t){if(ga(e,wa))throw ba(ya);return t.facade=e,ma(e,wa,t),t},qs=function(e){return ga(e,wa)?e[wa]:{}},Ws=function(e){return ga(e,wa)}}var Ca={set:Gs,get:qs,has:Ws,enforce:function(e){return Ws(e)?qs(e):Gs(e,{})},getterFor:function(e){return function(t){var n;if(!fa(t)||(n=qs(t)).type!==e)throw ba("Incompatible receiver, "+e+" required");return n}}},Ra=rr,Ia=Xe,Oa=tn,Aa=Kr,Na=vo,ka=me([].push),Pa=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,s=7==e,a=5==e||o;return function(c,l,u,d){for(var h,p,f=Oa(c),m=Ia(f),g=Ra(l,u),_=Aa(m),E=0,v=d||Na,y=t?v(c,_):n||s?v(c,0):void 0;_>E;E++)if((a||E in m)&&(p=g(h=m[E],E,f),e))if(t)y[E]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return E;case 2:ka(y,h)}else switch(e){case 4:return!1;case 7:ka(y,h)}return o?-1:r||i?i:y}},Da={forEach:Pa(0),map:Pa(1),filter:Pa(2),some:Pa(3),every:Pa(4),find:Pa(5),findIndex:Pa(6),filterReject:Pa(7)},La=xr,xa=Ee,Ma=je,Ua=me,Fa=Me,ja=Ct,Va=le,Ba=on,Ga=ge,qa=lr,Wa=it,za=An,Ha=vi,Ka=He,Ya=vs,Za=Yo,Ja=ys,Xa=Ts,Qa=xs,$a=xe,ec=ir,tc=Uo,nc=Ve,rc=Us,ic=js,oc=Qt,sc=Fo,ac=un,cc=vn,lc=Vs,uc=Zs,dc=ea,hc=la,pc=Ca,fc=Da.forEach,mc=os("hidden"),gc="Symbol",_c="prototype",Ec=pc.set,vc=pc.getterFor(gc),yc=Object[_c],bc=xa.Symbol,Sc=bc&&bc[_c],Tc=xa.TypeError,wc=xa.QObject,Cc=$a.f,Rc=ec.f,Ic=Xa.f,Oc=nc.f,Ac=Ua([].push),Nc=oc("symbols"),kc=oc("op-symbols"),Pc=oc("wks"),Dc=!wc||!wc[_c]||!wc[_c].findChild,Lc=Fa&&Va((function(){return 7!=Ya(Rc({},"a",{get:function(){return Rc(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=Cc(yc,t);r&&delete yc[t],Rc(e,t,n),r&&e!==yc&&Rc(yc,t,r)}:Rc,xc=function(e,t){var n=Nc[e]=Ya(Sc);return Ec(n,{type:gc,tag:e,description:t}),Fa||(n.description=t),n},Mc=function(e,t,n){e===yc&&Mc(kc,t,n),qa(e);var r=za(t);return qa(n),Ba(Nc,r)?(n.enumerable?(Ba(e,mc)&&e[mc][r]&&(e[mc][r]=!1),n=Ya(n,{enumerable:Ka(0,!1)})):(Ba(e,mc)||Rc(e,mc,Ka(1,{})),e[mc][r]=!0),Lc(e,r,n)):Rc(e,r,n)},Uc=function(e,t){qa(e);var n=Wa(t),r=Za(n).concat(Bc(n));return fc(r,(function(t){Fa&&!Ma(Fc,n,t)||Mc(e,t,n[t])})),e},Fc=function(e){var t=za(e),n=Ma(Oc,this,t);return!(this===yc&&Ba(Nc,t)&&!Ba(kc,t))&&(!(n||!Ba(this,t)||!Ba(Nc,t)||Ba(this,mc)&&this[mc][t])||n)},jc=function(e,t){var n=Wa(e),r=za(t);if(n!==yc||!Ba(Nc,r)||Ba(kc,r)){var i=Cc(n,r);return!i||!Ba(Nc,r)||Ba(n,mc)&&n[mc][r]||(i.enumerable=!0),i}},Vc=function(e){var t=Ic(Wa(e)),n=[];return fc(t,(function(e){Ba(Nc,e)||Ba(sc,e)||Ac(n,e)})),n},Bc=function(e){var t=e===yc,n=Ic(t?kc:Wa(e)),r=[];return fc(n,(function(e){!Ba(Nc,e)||t&&!Ba(yc,e)||Ac(r,Nc[e])})),r};ja||(bc=function(){if(Ga(Sc,this))throw Tc("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Ha(arguments[0]):void 0,t=ac(e),n=function(e){this===yc&&Ma(n,kc,e),Ba(this,mc)&&Ba(this[mc],t)&&(this[mc][t]=!1),Lc(this,t,Ka(1,e))};return Fa&&Dc&&Lc(yc,t,{configurable:!0,set:n}),xc(t,e)},rc(Sc=bc[_c],"toString",(function(){return vc(this).tag})),rc(bc,"withoutSetter",(function(e){return xc(ac(e),e)})),nc.f=Fc,ec.f=Mc,tc.f=Uc,$a.f=jc,Ja.f=Xa.f=Vc,Qa.f=Bc,lc.f=function(e){return xc(cc(e),e)},Fa&&ic(Sc,"description",{configurable:!0,get:function(){return vc(this).description}})),La({global:!0,constructor:!0,wrap:!0,forced:!ja,sham:!ja},{Symbol:bc}),fc(Za(Pc),(function(e){uc(e)})),La({target:gc,stat:!0,forced:!ja},{useSetter:function(){Dc=!0},useSimple:function(){Dc=!1}}),La({target:"Object",stat:!0,forced:!ja,sham:!Fa},{create:function(e,t){return void 0===t?Ya(e):Uc(Ya(e),t)},defineProperty:Mc,defineProperties:Uc,getOwnPropertyDescriptor:jc}),La({target:"Object",stat:!0,forced:!ja},{getOwnPropertyNames:Vc}),dc(),hc(bc,gc),sc[mc]=!0;var Gc=Ct&&!!Symbol.for&&!!Symbol.keyFor,qc=xr,Wc=pt,zc=on,Hc=vi,Kc=Qt,Yc=Gc,Zc=Kc("string-to-symbol-registry"),Jc=Kc("symbol-to-string-registry");qc({target:"Symbol",stat:!0,forced:!Yc},{for:function(e){var t=Hc(e);if(zc(Zc,t))return Zc[t];var n=Wc("Symbol")(t);return Zc[t]=n,Jc[n]=t,n}});var Xc=xr,Qc=on,$c=kt,el=Dt,tl=Gc,nl=Qt("symbol-to-string-registry");Xc({target:"Symbol",stat:!0,forced:!tl},{keyFor:function(e){if(!$c(e))throw TypeError(el(e)+" is not a symbol");if(Qc(nl,e))return nl[e]}});var rl=me([].slice),il=Gi,ol=Le,sl=Ie,al=vi,cl=me([].push),ll=xr,ul=pt,dl=Te,hl=je,pl=me,fl=le,ml=Le,gl=kt,_l=rl,El=function(e){if(ol(e))return e;if(il(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?cl(n,i):"number"!=typeof i&&"Number"!=sl(i)&&"String"!=sl(i)||cl(n,al(i))}var o=n.length,s=!0;return function(e,t){if(s)return s=!1,t;if(il(this))return t;for(var r=0;r<o;r++)if(n[r]===e)return t}}},vl=Ct,yl=String,bl=ul("JSON","stringify"),Sl=pl(/./.exec),Tl=pl("".charAt),wl=pl("".charCodeAt),Cl=pl("".replace),Rl=pl(1..toString),Il=/[\uD800-\uDFFF]/g,Ol=/^[\uD800-\uDBFF]$/,Al=/^[\uDC00-\uDFFF]$/,Nl=!vl||fl((function(){var e=ul("Symbol")();return"[null]"!=bl([e])||"{}"!=bl({a:e})||"{}"!=bl(Object(e))})),kl=fl((function(){return'"\\udf06\\ud834"'!==bl("\udf06\ud834")||'"\\udead"'!==bl("\udead")})),Pl=function(e,t){var n=_l(arguments),r=El(t);if(ml(r)||void 0!==e&&!gl(e))return n[1]=function(e,t){if(ml(r)&&(t=hl(r,this,yl(e),t)),!gl(t))return t},dl(bl,null,n)},Dl=function(e,t,n){var r=Tl(n,t-1),i=Tl(n,t+1);return Sl(Ol,e)&&!Sl(Al,i)||Sl(Al,e)&&!Sl(Ol,r)?"\\u"+Rl(wl(e,0),16):e};bl&&ll({target:"JSON",stat:!0,arity:3,forced:Nl||kl},{stringify:function(e,t,n){var r=_l(arguments),i=dl(Nl?Pl:bl,null,r);return kl&&"string"==typeof i?Cl(i,Il,Dl):i}});var Ll=xs,xl=tn;xr({target:"Object",stat:!0,forced:!Ct||le((function(){Ll.f(1)}))},{getOwnPropertySymbols:function(e){var t=Ll.f;return t?t(xl(e)):[]}}),Zs("asyncIterator"),Zs("hasInstance"),Zs("isConcatSpreadable"),Zs("iterator"),Zs("match"),Zs("matchAll"),Zs("replace"),Zs("search"),Zs("species"),Zs("split");var Ml=ea;Zs("toPrimitive"),Ml();var Ul=pt,Fl=la;Zs("toStringTag"),Fl(Ul("Symbol"),"Symbol"),Zs("unscopables"),la(Ee.JSON,"JSON",!0);var jl,Vl,Bl,Gl=ct.Symbol,ql={},Wl=Me,zl=on,Hl=Function.prototype,Kl=Wl&&Object.getOwnPropertyDescriptor,Yl=zl(Hl,"name"),Zl={EXISTS:Yl,PROPER:Yl&&"something"===function(){}.name,CONFIGURABLE:Yl&&(!Wl||Wl&&Kl(Hl,"name").configurable)},Jl=!le((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Xl=on,Ql=Le,$l=tn,eu=Jl,tu=os("IE_PROTO"),nu=Object,ru=nu.prototype,iu=eu?nu.getPrototypeOf:function(e){var t=$l(e);if(Xl(t,tu))return t[tu];var n=t.constructor;return Ql(n)&&t instanceof n?n.prototype:t instanceof nu?ru:null},ou=le,su=Le,au=at,cu=vs,lu=iu,uu=Us,du=vn("iterator"),hu=!1;[].keys&&("next"in(Bl=[].keys())?(Vl=lu(lu(Bl)))!==Object.prototype&&(jl=Vl):hu=!0);var pu=!au(jl)||ou((function(){var e={};return jl[du].call(e)!==e}));su((jl=pu?{}:cu(jl))[du])||uu(jl,du,(function(){return this}));var fu={IteratorPrototype:jl,BUGGY_SAFARI_ITERATORS:hu},mu=fu.IteratorPrototype,gu=vs,_u=He,Eu=la,vu=ql,yu=function(){return this},bu=me,Su=Ut,Tu=Le,wu=String,Cu=TypeError,Ru=function(e,t,n){try{return bu(Su(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}},Iu=lr,Ou=function(e){if("object"==typeof e||Tu(e))return e;throw Cu("Can't set "+wu(e)+" as a prototype")},Au=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Ru(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Iu(n),Ou(r),t?e(n,r):n.__proto__=r,n}}():void 0),Nu=xr,ku=je,Pu=function(e,t,n,r){var i=t+" Iterator";return e.prototype=gu(mu,{next:_u(+!r,n)}),Eu(e,i,!1,!0),vu[i]=yu,e},Du=iu,Lu=la,xu=Us,Mu=ql,Uu=fu,Fu=Zl.PROPER,ju=Uu.BUGGY_SAFARI_ITERATORS,Vu=vn("iterator"),Bu="keys",Gu="values",qu="entries",Wu=function(){return this},zu=function(e,t,n,r,i,o,s){Pu(n,t,r);var a,c,l,u=function(e){if(e===i&&m)return m;if(!ju&&e in p)return p[e];switch(e){case Bu:case Gu:case qu:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",h=!1,p=e.prototype,f=p[Vu]||p["@@iterator"]||i&&p[i],m=!ju&&f||u(i),g="Array"==t&&p.entries||f;if(g&&(a=Du(g.call(new e)))!==Object.prototype&&a.next&&(Lu(a,d,!0,!0),Mu[d]=Wu),Fu&&i==Gu&&f&&f.name!==Gu&&(h=!0,m=function(){return ku(f,this)}),i)if(c={values:u(Gu),keys:o?m:u(Bu),entries:u(qu)},s)for(l in c)(ju||h||!(l in p))&&xu(p,l,c[l]);else Nu({target:t,proto:!0,forced:ju||h},c);return s&&p[Vu]!==m&&xu(p,Vu,m,{name:i}),Mu[t]=m,c},Hu=function(e,t){return{value:e,done:t}},Ku=it,Yu=ql,Zu=Ca;ir.f;var Ju=zu,Xu=Hu,Qu="Array Iterator",$u=Zu.set,ed=Zu.getterFor(Qu);Ju(Array,"Array",(function(e,t){$u(this,{type:Qu,target:Ku(e),index:0,kind:t})}),(function(){var e=ed(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,Xu(void 0,!0)):Xu("keys"==n?r:"values"==n?t[r]:[r,t[r]],!1)}),"values"),Yu.Arguments=Yu.Array;var td={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},nd=Ee,rd=gi,id=Tr,od=ql,sd=vn("toStringTag");for(var ad in td){var cd=nd[ad],ld=cd&&cd.prototype;ld&&rd(ld)!==sd&&id(ld,sd,ad),od[ad]=od.Array}var ud=Gl,dd=vn,hd=ir.f,pd=dd("metadata"),fd=Function.prototype;void 0===fd[pd]&&hd(fd,pd,{value:null}),Zs("dispose"),Zs("metadata");var md=ud;Zs("asyncDispose");var gd=me,_d=pt("Symbol"),Ed=_d.keyFor,vd=gd(_d.prototype.valueOf),yd=_d.isRegisteredSymbol||function(e){try{return void 0!==Ed(vd(e))}catch(e){return!1}};xr({target:"Symbol",stat:!0},{isRegisteredSymbol:yd});for(var bd=Qt,Sd=pt,Td=me,wd=kt,Cd=vn,Rd=Sd("Symbol"),Id=Rd.isWellKnownSymbol,Od=Sd("Object","getOwnPropertyNames"),Ad=Td(Rd.prototype.valueOf),Nd=bd("wks"),kd=0,Pd=Od(Rd),Dd=Pd.length;kd<Dd;kd++)try{var Ld=Pd[kd];wd(Rd[Ld])&&Cd(Ld)}catch(e){}var xd=function(e){if(Id&&Id(e))return!0;try{for(var t=Ad(e),n=0,r=Od(Nd),i=r.length;n<i;n++)if(Nd[r[n]]==t)return!0}catch(e){}return!1};xr({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:xd}),Zs("matcher"),Zs("observable"),xr({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:yd}),xr({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:xd}),Zs("metadataKey"),Zs("patternMatch"),Zs("replaceAll");var Md=Z(md),Ud=me,Fd=jr,jd=vi,Vd=tt,Bd=Ud("".charAt),Gd=Ud("".charCodeAt),qd=Ud("".slice),Wd=function(e){return function(t,n){var r,i,o=jd(Vd(t)),s=Fd(n),a=o.length;return s<0||s>=a?e?"":void 0:(r=Gd(o,s))<55296||r>56319||s+1===a||(i=Gd(o,s+1))<56320||i>57343?e?Bd(o,s):r:e?qd(o,s,s+2):i-56320+(r-55296<<10)+65536}},zd=(Wd(!1),Wd(!0)),Hd=vi,Kd=Ca,Yd=zu,Zd=Hu,Jd="String Iterator",Xd=Kd.set,Qd=Kd.getterFor(Jd);Yd(String,"String",(function(e){Xd(this,{type:Jd,string:Hd(e),index:0})}),(function(){var e,t=Qd(this),n=t.string,r=t.index;return r>=n.length?Zd(void 0,!0):(e=zd(n,r),t.index+=e.length,Zd(e,!1))}));var $d=Z(Vs.f("iterator"));function eh(e){return eh="function"==typeof Md&&"symbol"==typeof $d?function(e){return typeof e}:function(e){return e&&"function"==typeof Md&&e.constructor===Md&&e!==Md.prototype?"symbol":typeof e},eh(e)}var th=Z(Vs.f("toPrimitive"));function nh(e){var t=function(e,t){if("object"!==eh(e)||null===e)return e;var n=e[th];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==eh(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===eh(t)?t:String(t)}function rh(e,t,n){return(t=nh(t))in e?Vi(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ih=ti("Array").keys,oh=gi,sh=on,ah=ge,ch=ih,lh=Array.prototype,uh={DOMTokenList:!0,NodeList:!0},dh=Z((function(e){var t=e.keys;return e===lh||ah(lh,e)&&t===lh.keys||sh(uh,oh(e))?ch:t})),hh=Dt,ph=TypeError,fh=As,mh=Math.floor,gh=function(e,t){var n=e.length,r=mh(n/2);return n<8?_h(e,t):Eh(e,gh(fh(e,0,r),t),gh(fh(e,r),t),t)},_h=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},Eh=function(e,t,n,r){for(var i=t.length,o=n.length,s=0,a=0;s<i||a<o;)e[s+a]=s<i&&a<o?r(t[s],n[a])<=0?t[s++]:n[a++]:s<i?t[s++]:n[a++];return e},vh=gh,yh=le,bh=function(e,t){var n=[][e];return!!n&&yh((function(){n.call(null,t||function(){return 1},1)}))},Sh=ft.match(/firefox\/(\d+)/i),Th=!!Sh&&+Sh[1],wh=/MSIE|Trident/.test(ft),Ch=ft.match(/AppleWebKit\/(\d+)\./),Rh=!!Ch&&+Ch[1],Ih=xr,Oh=me,Ah=Ut,Nh=tn,kh=Kr,Ph=function(e,t){if(!delete e[t])throw ph("Cannot delete property "+hh(t)+" of "+hh(e))},Dh=vi,Lh=le,xh=vh,Mh=bh,Uh=Th,Fh=wh,jh=bt,Vh=Rh,Bh=[],Gh=Oh(Bh.sort),qh=Oh(Bh.push),Wh=Lh((function(){Bh.sort(void 0)})),zh=Lh((function(){Bh.sort(null)})),Hh=Mh("sort"),Kh=!Lh((function(){if(jh)return jh<70;if(!(Uh&&Uh>3)){if(Fh)return!0;if(Vh)return Vh<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Bh.push({k:t+r,v:n})}for(Bh.sort((function(e,t){return t.v-e.v})),r=0;r<Bh.length;r++)t=Bh[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));Ih({target:"Array",proto:!0,forced:Wh||!zh||!Hh||!Kh},{sort:function(e){void 0!==e&&Ah(e);var t=Nh(this);if(Kh)return void 0===e?Gh(t):Gh(t,e);var n,r,i=[],o=kh(t);for(r=0;r<o;r++)r in t&&qh(i,t[r]);for(xh(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Dh(t)>Dh(n)?1:-1}}(e)),n=kh(i),r=0;r<n;)t[r]=i[r++];for(;r<o;)Ph(t,r++);return t}});var Yh=ti("Array").sort,Zh=ge,Jh=Yh,Xh=Array.prototype,Qh=Z((function(e){var t=e.sort;return e===Xh||Zh(Xh,e)&&t===Xh.sort?Jh:t})),$h=pt,ep=ys,tp=xs,np=lr,rp=me([].concat),ip=$h("Reflect","ownKeys")||function(e){var t=ep.f(np(e)),n=tp.f;return n?rp(t,n(e)):t},op=on,sp=ip,ap=xe,cp=ir,lp=at,up=Tr,dp=Error,hp=me("".replace),pp=String(dp("zxcasd").stack),fp=/\n\s*at [^:]*:[^\n]*/,mp=fp.test(pp),gp=He,_p=!le((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",gp(1,7)),7!==e.stack)})),Ep=Tr,vp=function(e,t){if(mp&&"string"==typeof e&&!dp.prepareStackTrace)for(;t--;)e=hp(e,fp,"");return e},yp=_p,bp=Error.captureStackTrace,Sp=ql,Tp=vn("iterator"),wp=Array.prototype,Cp=gi,Rp=Vt,Ip=Qe,Op=ql,Ap=vn("iterator"),Np=function(e){if(!Ip(e))return Rp(e,Ap)||Rp(e,"@@iterator")||Op[Cp(e)]},kp=je,Pp=Ut,Dp=lr,Lp=Dt,xp=Np,Mp=TypeError,Up=je,Fp=lr,jp=Vt,Vp=rr,Bp=je,Gp=lr,qp=Dt,Wp=function(e){return void 0!==e&&(Sp.Array===e||wp[Tp]===e)},zp=Kr,Hp=ge,Kp=function(e,t){var n=arguments.length<2?xp(e):t;if(Pp(n))return Dp(kp(n,e));throw Mp(Lp(e)+" is not iterable")},Yp=Np,Zp=function(e,t,n){var r,i;Fp(e);try{if(!(r=jp(e,"return"))){if("throw"===t)throw n;return n}r=Up(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return Fp(r),n},Jp=TypeError,Xp=function(e,t){this.stopped=e,this.result=t},Qp=Xp.prototype,$p=function(e,t,n){var r,i,o,s,a,c,l,u=n&&n.that,d=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),f=!(!n||!n.INTERRUPTED),m=Vp(t,u),g=function(e){return r&&Zp(r,"normal",e),new Xp(!0,e)},_=function(e){return d?(Gp(e),f?m(e[0],e[1],g):m(e[0],e[1])):f?m(e,g):m(e)};if(h)r=e.iterator;else if(p)r=e;else{if(!(i=Yp(e)))throw Jp(qp(e)+" is not iterable");if(Wp(i)){for(o=0,s=zp(e);s>o;o++)if((a=_(e[o]))&&Hp(Qp,a))return a;return new Xp(!1)}r=Kp(e,i)}for(c=h?e.next:r.next;!(l=Bp(c,r)).done;){try{a=_(l.value)}catch(e){Zp(r,"throw",e)}if("object"==typeof a&&a&&Hp(Qp,a))return a}return new Xp(!1)},ef=vi,tf=xr,nf=ge,rf=iu,of=Au,sf=function(e,t,n){for(var r=sp(t),i=cp.f,o=ap.f,s=0;s<r.length;s++){var a=r[s];op(e,a)||n&&op(n,a)||i(e,a,o(t,a))}},af=vs,cf=Tr,lf=He,uf=function(e,t){lp(t)&&"cause"in t&&up(e,"cause",t.cause)},df=function(e,t,n,r){yp&&(bp?bp(e,t):Ep(e,"stack",vp(n,r)))},hf=$p,pf=function(e,t){return void 0===e?arguments.length<2?"":t:ef(e)},ff=vn("toStringTag"),mf=Error,gf=[].push,_f=function(e,t){var n,r=nf(Ef,this);of?n=of(mf(),r?rf(this):Ef):(n=r?this:af(Ef),cf(n,ff,"Error")),void 0!==t&&cf(n,"message",pf(t)),df(n,_f,n.stack,1),arguments.length>2&&uf(n,arguments[2]);var i=[];return hf(e,gf,{that:i}),cf(n,"errors",i),n};of?of(_f,mf):sf(_f,mf,{name:!0});var Ef=_f.prototype=af(mf.prototype,{constructor:lf(1,_f),message:lf(1,""),name:lf(1,"AggregateError")});tf({global:!0,constructor:!0,arity:2},{AggregateError:_f});var vf,yf,bf,Sf,Tf="undefined"!=typeof process&&"process"==Ie(process),wf=pt,Cf=js,Rf=Me,If=vn("species"),Of=ge,Af=TypeError,Nf=ho,kf=Dt,Pf=TypeError,Df=lr,Lf=function(e){if(Nf(e))return e;throw Pf(kf(e)+" is not a constructor")},xf=Qe,Mf=vn("species"),Uf=function(e,t){var n,r=Df(e).constructor;return void 0===r||xf(n=Df(r)[Mf])?t:Lf(n)},Ff=TypeError,jf=/(?:ipad|iphone|ipod).*applewebkit/i.test(ft),Vf=Ee,Bf=Te,Gf=rr,qf=Le,Wf=on,zf=le,Hf=ns,Kf=rl,Yf=Dn,Zf=function(e,t){if(e<t)throw Ff("Not enough arguments");return e},Jf=jf,Xf=Tf,Qf=Vf.setImmediate,$f=Vf.clearImmediate,em=Vf.process,tm=Vf.Dispatch,nm=Vf.Function,rm=Vf.MessageChannel,im=Vf.String,om=0,sm={},am="onreadystatechange";zf((function(){vf=Vf.location}));var cm=function(e){if(Wf(sm,e)){var t=sm[e];delete sm[e],t()}},lm=function(e){return function(){cm(e)}},um=function(e){cm(e.data)},dm=function(e){Vf.postMessage(im(e),vf.protocol+"//"+vf.host)};Qf&&$f||(Qf=function(e){Zf(arguments.length,1);var t=qf(e)?e:nm(e),n=Kf(arguments,1);return sm[++om]=function(){Bf(t,void 0,n)},yf(om),om},$f=function(e){delete sm[e]},Xf?yf=function(e){em.nextTick(lm(e))}:tm&&tm.now?yf=function(e){tm.now(lm(e))}:rm&&!Jf?(Sf=(bf=new rm).port2,bf.port1.onmessage=um,yf=Gf(Sf.postMessage,Sf)):Vf.addEventListener&&qf(Vf.postMessage)&&!Vf.importScripts&&vf&&"file:"!==vf.protocol&&!zf(dm)?(yf=dm,Vf.addEventListener("message",um,!1)):yf=am in Yf("script")?function(e){Hf.appendChild(Yf("script"))[am]=function(){Hf.removeChild(this),cm(e)}}:function(e){setTimeout(lm(e),0)});var hm={set:Qf,clear:$f},pm=function(){this.head=null,this.tail=null};pm.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var fm,mm,gm,_m,Em,vm=pm,ym=/ipad|iphone|ipod/i.test(ft)&&"undefined"!=typeof Pebble,bm=/web0s(?!.*chrome)/i.test(ft),Sm=Ee,Tm=rr,wm=xe.f,Cm=hm.set,Rm=vm,Im=jf,Om=ym,Am=bm,Nm=Tf,km=Sm.MutationObserver||Sm.WebKitMutationObserver,Pm=Sm.document,Dm=Sm.process,Lm=Sm.Promise,xm=wm(Sm,"queueMicrotask"),Mm=xm&&xm.value;if(!Mm){var Um=new Rm,Fm=function(){var e,t;for(Nm&&(e=Dm.domain)&&e.exit();t=Um.get();)try{t()}catch(e){throw Um.head&&fm(),e}e&&e.enter()};Im||Nm||Am||!km||!Pm?!Om&&Lm&&Lm.resolve?((_m=Lm.resolve(void 0)).constructor=Lm,Em=Tm(_m.then,_m),fm=function(){Em(Fm)}):Nm?fm=function(){Dm.nextTick(Fm)}:(Cm=Tm(Cm,Sm),fm=function(){Cm(Fm)}):(mm=!0,gm=Pm.createTextNode(""),new km(Fm).observe(gm,{characterData:!0}),fm=function(){gm.data=mm=!mm}),Mm=function(e){Um.head||fm(),Um.add(e)}}var jm=Mm,Vm=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Bm=Ee.Promise,Gm="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,qm=!Gm&&!Tf&&"object"==typeof window&&"object"==typeof document,Wm=Ee,zm=Bm,Hm=Le,Km=$n,Ym=Xi,Zm=vn,Jm=qm,Xm=Gm,Qm=bt,$m=zm&&zm.prototype,eg=Zm("species"),tg=!1,ng=Hm(Wm.PromiseRejectionEvent),rg=Km("Promise",(function(){var e=Ym(zm),t=e!==String(zm);if(!t&&66===Qm)return!0;if(!$m.catch||!$m.finally)return!0;if(!Qm||Qm<51||!/native code/.test(e)){var n=new zm((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[eg]=r,!(tg=n.then((function(){}))instanceof r))return!0}return!t&&(Jm||Xm)&&!ng})),ig={CONSTRUCTOR:rg,REJECTION_EVENT:ng,SUBCLASSING:tg},og={},sg=Ut,ag=TypeError,cg=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw ag("Bad Promise constructor");t=e,n=r})),this.resolve=sg(t),this.reject=sg(n)};og.f=function(e){return new cg(e)};var lg,ug,dg=xr,hg=Tf,pg=Ee,fg=je,mg=Us,gg=la,_g=function(e){var t=wf(e);Rf&&t&&!t[If]&&Cf(t,If,{configurable:!0,get:function(){return this}})},Eg=Ut,vg=Le,yg=at,bg=function(e,t){if(Of(t,e))return e;throw Af("Incorrect invocation")},Sg=Uf,Tg=hm.set,wg=jm,Cg=function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(e){}},Rg=Vm,Ig=vm,Og=Ca,Ag=Bm,Ng=ig,kg=og,Pg="Promise",Dg=Ng.CONSTRUCTOR,Lg=Ng.REJECTION_EVENT,xg=Og.getterFor(Pg),Mg=Og.set,Ug=Ag&&Ag.prototype,Fg=Ag,jg=Ug,Vg=pg.TypeError,Bg=pg.document,Gg=pg.process,qg=kg.f,Wg=qg,zg=!!(Bg&&Bg.createEvent&&pg.dispatchEvent),Hg="unhandledrejection",Kg=function(e){var t;return!(!yg(e)||!vg(t=e.then))&&t},Yg=function(e,t){var n,r,i,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,l=e.reject,u=e.domain;try{a?(s||(2===t.rejection&&$g(t),t.rejection=1),!0===a?n=o:(u&&u.enter(),n=a(o),u&&(u.exit(),i=!0)),n===e.promise?l(Vg("Promise-chain cycle")):(r=Kg(n))?fg(r,n,c,l):c(n)):l(o)}catch(e){u&&!i&&u.exit(),l(e)}},Zg=function(e,t){e.notified||(e.notified=!0,wg((function(){for(var n,r=e.reactions;n=r.get();)Yg(n,e);e.notified=!1,t&&!e.rejection&&Xg(e)})))},Jg=function(e,t,n){var r,i;zg?((r=Bg.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),pg.dispatchEvent(r)):r={promise:t,reason:n},!Lg&&(i=pg["on"+e])?i(r):e===Hg&&Cg("Unhandled promise rejection",n)},Xg=function(e){fg(Tg,pg,(function(){var t,n=e.facade,r=e.value;if(Qg(e)&&(t=Rg((function(){hg?Gg.emit("unhandledRejection",r,n):Jg(Hg,n,r)})),e.rejection=hg||Qg(e)?2:1,t.error))throw t.value}))},Qg=function(e){return 1!==e.rejection&&!e.parent},$g=function(e){fg(Tg,pg,(function(){var t=e.facade;hg?Gg.emit("rejectionHandled",t):Jg("rejectionhandled",t,e.value)}))},e_=function(e,t,n){return function(r){e(t,r,n)}},t_=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Zg(e,!0))},n_=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Vg("Promise can't be resolved itself");var r=Kg(t);r?wg((function(){var n={done:!1};try{fg(r,t,e_(n_,n,e),e_(t_,n,e))}catch(t){t_(n,t,e)}})):(e.value=t,e.state=1,Zg(e,!1))}catch(t){t_({done:!1},t,e)}}};Dg&&(jg=(Fg=function(e){bg(this,jg),Eg(e),fg(lg,this);var t=xg(this);try{e(e_(n_,t),e_(t_,t))}catch(e){t_(t,e)}}).prototype,(lg=function(e){Mg(this,{type:Pg,done:!1,notified:!1,parent:!1,reactions:new Ig,rejection:!1,state:0,value:void 0})}).prototype=mg(jg,"then",(function(e,t){var n=xg(this),r=qg(Sg(this,Fg));return n.parent=!0,r.ok=!vg(e)||e,r.fail=vg(t)&&t,r.domain=hg?Gg.domain:void 0,0==n.state?n.reactions.add(r):wg((function(){Yg(r,n)})),r.promise})),ug=function(){var e=new lg,t=xg(e);this.promise=e,this.resolve=e_(n_,t),this.reject=e_(t_,t)},kg.f=qg=function(e){return e===Fg||void 0===e?new ug(e):Wg(e)}),dg({global:!0,constructor:!0,wrap:!0,forced:Dg},{Promise:Fg}),gg(Fg,Pg,!1,!0),_g(Pg);var r_=vn("iterator"),i_=!1;try{var o_=0,s_={next:function(){return{done:!!o_++}},return:function(){i_=!0}};s_[r_]=function(){return this},Array.from(s_,(function(){throw 2}))}catch(e){}var a_=Bm,c_=function(e,t){if(!t&&!i_)return!1;var n=!1;try{var r={};r[r_]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},l_=ig.CONSTRUCTOR||!c_((function(e){a_.all(e).then(void 0,(function(){}))})),u_=je,d_=Ut,h_=og,p_=Vm,f_=$p;xr({target:"Promise",stat:!0,forced:l_},{all:function(e){var t=this,n=h_.f(t),r=n.resolve,i=n.reject,o=p_((function(){var n=d_(t.resolve),o=[],s=0,a=1;f_(e,(function(e){var c=s++,l=!1;a++,u_(n,t,e).then((function(e){l||(l=!0,o[c]=e,--a||r(o))}),i)})),--a||r(o)}));return o.error&&i(o.value),n.promise}});var m_=xr,g_=ig.CONSTRUCTOR;Bm&&Bm.prototype,m_({target:"Promise",proto:!0,forced:g_,real:!0},{catch:function(e){return this.then(void 0,e)}});var __=je,E_=Ut,v_=og,y_=Vm,b_=$p;xr({target:"Promise",stat:!0,forced:l_},{race:function(e){var t=this,n=v_.f(t),r=n.reject,i=y_((function(){var i=E_(t.resolve);b_(e,(function(e){__(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var S_=je,T_=og;xr({target:"Promise",stat:!0,forced:ig.CONSTRUCTOR},{reject:function(e){var t=T_.f(this);return S_(t.reject,void 0,e),t.promise}});var w_=lr,C_=at,R_=og,I_=function(e,t){if(w_(e),C_(t)&&t.constructor===e)return t;var n=R_.f(e);return(0,n.resolve)(t),n.promise},O_=xr,A_=Bm,N_=ig.CONSTRUCTOR,k_=I_,P_=pt("Promise"),D_=!N_;O_({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return k_(D_&&this===P_?A_:this,e)}});var L_=je,x_=Ut,M_=og,U_=Vm,F_=$p;xr({target:"Promise",stat:!0,forced:l_},{allSettled:function(e){var t=this,n=M_.f(t),r=n.resolve,i=n.reject,o=U_((function(){var n=x_(t.resolve),i=[],o=0,s=1;F_(e,(function(e){var a=o++,c=!1;s++,L_(n,t,e).then((function(e){c||(c=!0,i[a]={status:"fulfilled",value:e},--s||r(i))}),(function(e){c||(c=!0,i[a]={status:"rejected",reason:e},--s||r(i))}))})),--s||r(i)}));return o.error&&i(o.value),n.promise}});var j_=je,V_=Ut,B_=pt,G_=og,q_=Vm,W_=$p,z_="No one promise resolved";xr({target:"Promise",stat:!0,forced:l_},{any:function(e){var t=this,n=B_("AggregateError"),r=G_.f(t),i=r.resolve,o=r.reject,s=q_((function(){var r=V_(t.resolve),s=[],a=0,c=1,l=!1;W_(e,(function(e){var u=a++,d=!1;c++,j_(r,t,e).then((function(e){d||l||(l=!0,i(e))}),(function(e){d||l||(d=!0,s[u]=e,--c||o(new n(s,z_)))}))})),--c||o(new n(s,z_))}));return s.error&&o(s.value),r.promise}});var H_=xr,K_=Bm,Y_=le,Z_=pt,J_=Le,X_=Uf,Q_=I_,$_=K_&&K_.prototype;H_({target:"Promise",proto:!0,real:!0,forced:!!K_&&Y_((function(){$_.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=X_(this,Z_("Promise")),n=J_(e);return this.then(n?function(n){return Q_(t,e()).then((function(){return n}))}:e,n?function(n){return Q_(t,e()).then((function(){throw n}))}:e)}});var eE=ct.Promise,tE=Z(eE);const nE=()=>{};function rE(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:nE};return e.promise=new tE(((t,n)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}})),e}const iE=new Map,oE=new Map,sE=new Map;var aE,cE;!function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(aE||(aE={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(cE||(cE={}));var lE={exports:{}};!function(e,t){!function(n,r){var i="function",o="undefined",s="object",a="string",c="major",l="model",u="name",d="type",h="vendor",p="version",f="architecture",m="console",g="mobile",_="tablet",E="smarttv",v="wearable",y="embedded",b="Amazon",S="Apple",T="ASUS",w="BlackBerry",C="Browser",R="Chrome",I="Firefox",O="Google",A="Huawei",N="LG",k="Microsoft",P="Motorola",D="Opera",L="Samsung",x="Sharp",M="Sony",U="Xiaomi",F="Zebra",j="Facebook",V="Chromium OS",B="Mac OS",G=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},q=function(e,t){return typeof e===a&&-1!==W(t).indexOf(W(e))},W=function(e){return e.toLowerCase()},z=function(e,t){if(typeof e===a)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},H=function(e,t){for(var n,o,a,c,l,u,d=0;d<t.length&&!l;){var h=t[d],p=t[d+1];for(n=o=0;n<h.length&&!l&&h[n];)if(l=h[n++].exec(e))for(a=0;a<p.length;a++)u=l[++o],typeof(c=p[a])===s&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,u):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=u?u.replace(c[1],c[2]):r:this[c[0]]=u?c[1].call(this,u,c[2]):r:4===c.length&&(this[c[0]]=u?c[3].call(this,u.replace(c[1],c[2])):r):this[c]=u||r;d+=2}},K=function(e,t){for(var n in t)if(typeof t[n]===s&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(q(t[n][i],e))return"?"===n?r:n}else if(q(t[n],e))return"?"===n?r:n;return e},Y={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Z={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,p],[/opios[\/ ]+([\w\.]+)/i],[p,[u,D+" Mini"]],[/\bopr\/([\w\.]+)/i],[p,[u,D]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[u,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[u,"UC"+C]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[p,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[u,"IE"]],[/yabrowser\/([\w\.]+)/i],[p,[u,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+C],p],[/\bfocus\/([\w\.]+)/i],[p,[u,I+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[u,D+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[u,D+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[u,"MIUI "+C]],[/fxios\/([-\w\.]+)/i],[p,[u,I]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 "+C]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1 "+C],p],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[u,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,j],p],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[u,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[u,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[u,R+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,R+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[u,"Android "+C]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[p,K,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[u,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[u,I+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[u,p],[/(cobalt)\/([\w\.]+)/i],[u,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,W]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",W]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,W]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[h,L],[d,_]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[l,[h,L],[d,g]],[/\((ip(?:hone|od)[\w ]*);/i],[l,[h,S],[d,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[h,S],[d,_]],[/(macintosh);/i],[l,[h,S]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[h,x],[d,g]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[h,A],[d,_]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[h,A],[d,g]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[l,/_/g," "],[h,U],[d,g]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[h,U],[d,_]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[h,"OPPO"],[d,g]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[h,"Vivo"],[d,g]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[l,[h,"Realme"],[d,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[h,P],[d,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[h,P],[d,_]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[h,N],[d,_]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[h,N],[d,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[h,"Lenovo"],[d,_]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[h,"Nokia"],[d,g]],[/(pixel c)\b/i],[l,[h,O],[d,_]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[h,O],[d,g]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[h,M],[d,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[h,M],[d,_]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[h,"OnePlus"],[d,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[h,b],[d,_]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[h,b],[d,g]],[/(playbook);[-\w\),; ]+(rim)/i],[l,h,[d,_]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[h,w],[d,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[h,T],[d,_]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[h,T],[d,g]],[/(nexus 9)/i],[l,[h,"HTC"],[d,_]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[l,/_/g," "],[d,g]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[h,"Acer"],[d,_]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[h,"Meizu"],[d,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,l,[d,g]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,l,[d,_]],[/(surface duo)/i],[l,[h,k],[d,_]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[h,"Fairphone"],[d,g]],[/(u304aa)/i],[l,[h,"AT&T"],[d,g]],[/\bsie-(\w*)/i],[l,[h,"Siemens"],[d,g]],[/\b(rct\w+) b/i],[l,[h,"RCA"],[d,_]],[/\b(venue[\d ]{2,7}) b/i],[l,[h,"Dell"],[d,_]],[/\b(q(?:mv|ta)\w+) b/i],[l,[h,"Verizon"],[d,_]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[h,"Barnes & Noble"],[d,_]],[/\b(tm\d{3}\w+) b/i],[l,[h,"NuVision"],[d,_]],[/\b(k88) b/i],[l,[h,"ZTE"],[d,_]],[/\b(nx\d{3}j) b/i],[l,[h,"ZTE"],[d,g]],[/\b(gen\d{3}) b.+49h/i],[l,[h,"Swiss"],[d,g]],[/\b(zur\d{3}) b/i],[l,[h,"Swiss"],[d,_]],[/\b((zeki)?tb.*\b) b/i],[l,[h,"Zeki"],[d,_]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],l,[d,_]],[/\b(ns-?\w{0,9}) b/i],[l,[h,"Insignia"],[d,_]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[h,"NextBook"],[d,_]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],l,[d,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],l,[d,g]],[/\b(ph-1) /i],[l,[h,"Essential"],[d,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[h,"Envizen"],[d,_]],[/\b(trio[-\w\. ]+) b/i],[l,[h,"MachSpeed"],[d,_]],[/\btu_(1491) b/i],[l,[h,"Rotor"],[d,_]],[/(shield[\w ]+) b/i],[l,[h,"Nvidia"],[d,_]],[/(sprint) (\w+)/i],[h,l,[d,g]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[h,k],[d,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[h,F],[d,_]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[h,F],[d,g]],[/smart-tv.+(samsung)/i],[h,[d,E]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[h,L],[d,E]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,N],[d,E]],[/(apple) ?tv/i],[h,[l,S+" TV"],[d,E]],[/crkey/i],[[l,R+"cast"],[h,O],[d,E]],[/droid.+aft(\w)( bui|\))/i],[l,[h,b],[d,E]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[h,x],[d,E]],[/(bravia[\w ]+)( bui|\))/i],[l,[h,M],[d,E]],[/(mitv-\w{5}) bui/i],[l,[h,U],[d,E]],[/Hbbtv.*(technisat) (.*);/i],[h,l,[d,E]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,z],[l,z],[d,E]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,E]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,l,[d,m]],[/droid.+; (shield) bui/i],[l,[h,"Nvidia"],[d,m]],[/(playstation [345portablevi]+)/i],[l,[h,M],[d,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[h,k],[d,m]],[/((pebble))app/i],[h,l,[d,v]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[h,S],[d,v]],[/droid.+; (glass) \d/i],[l,[h,O],[d,v]],[/droid.+; (wt63?0{2,3})\)/i],[l,[h,F],[d,v]],[/(quest( 2| pro)?)/i],[l,[h,j],[d,v]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[d,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[l,[d,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[d,_]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,_]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,g]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[u,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[u,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[u,[p,K,Y]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[u,"Windows"],[p,K,Y]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,B],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,p],[/\(bb(10);/i],[p,[u,w]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[u,I+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[u,R+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,V],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,p],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[u,p]]},J=function(e,t){if(typeof e===s&&(t=e,e=r),!(this instanceof J))return new J(e,t).getResult();var m=typeof n!==o&&n.navigator?n.navigator:r,E=e||(m&&m.userAgent?m.userAgent:""),v=m&&m.userAgentData?m.userAgentData:r,y=t?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(Z,t):Z;return this.getBrowser=function(){var e={};return e[u]=r,e[p]=r,H.call(e,E,y.browser),e[c]=function(e){return typeof e===a?e.replace(/[^\d\.]/g,"").split(".")[0]:r}(e[p]),m&&m.brave&&typeof m.brave.isBrave==i&&(e[u]="Brave"),e},this.getCPU=function(){var e={};return e[f]=r,H.call(e,E,y.cpu),e},this.getDevice=function(){var e={};return e[h]=r,e[l]=r,e[d]=r,H.call(e,E,y.device),!e[d]&&v&&v.mobile&&(e[d]=g),"Macintosh"==e[l]&&m&&typeof m.standalone!==o&&m.maxTouchPoints&&m.maxTouchPoints>2&&(e[l]="iPad",e[d]=_),e},this.getEngine=function(){var e={};return e[u]=r,e[p]=r,H.call(e,E,y.engine),e},this.getOS=function(){var e={};return e[u]=r,e[p]=r,H.call(e,E,y.os),!e[u]&&v&&"Unknown"!=v.platform&&(e[u]=v.platform.replace(/chrome os/i,V).replace(/macos/i,B)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return E},this.setUA=function(e){return E=typeof e===a&&e.length>350?z(e,350):e,this},this.setUA(E),this};J.VERSION="0.7.34",J.BROWSER=G([u,p,c]),J.CPU=G([f]),J.DEVICE=G([l,h,d,m,g,E,_,v,y]),J.ENGINE=J.OS=G([u,p]),e.exports&&(t=e.exports=J),t.UAParser=J;var X=typeof n!==o&&(n.jQuery||n.Zepto);if(X&&!X.ua){var Q=new J;X.ua=Q.getResult(),X.ua.get=function(){return Q.getUA()},X.ua.set=function(e){Q.setUA(e);var t=Q.getResult();for(var n in t)X.ua[n]=t[n]}}}("object"==typeof window?window:Y)}(lE,lE.exports);const uE=new(Z(lE.exports));let dE=uE.getResult(),hE=null;function pE(e){if(!hE){e&&uE.setUA(e),dE=uE.getResult();const t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return cE.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return cE.CHROME;case"Safari":case"Mobile Safari":return cE.SAFARI;case"Edge":return cE.EDGE;case"Firefox":return cE.FIREFOX;case"QQBrowser":return cE.QQ;case"Opera":return cE.OPERA;case"WeChat":return cE.WECHAT;default:return e.browser.name||""}}(dE),n=function(e){let t;return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",t.split(".")[0]}(dE),r=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(dE),i=dE.os.version;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i};hE={name:t,version:n,os:r,osVersion:i}}return hE}function fE(){return pE().os}function mE(){const e=pE();return"".concat(e.os," ").concat(e.osVersion)}function gE(){const e=pE();return!!("WebKit"===dE.engine.name&&e.os===aE.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==cE.SAFARI||SE()&&e.name!==cE.SAFARI)}function _E(){const e=pE();if(gE()){if(e.os===aE.MAC_OS)return!0;if(e.os===aE.IOS){const e=dE.os.version&&dE.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}function EE(){return"WebKit"===dE.engine.name}function vE(){return pE().name===cE.CHROME}function yE(){return pE().name===cE.SAFARI}function bE(){return pE().name===cE.FIREFOX}function SE(){return pE().os===aE.IOS}function TE(e){const t=pE();return!(t.name!==cE.CHROME||!t.osVersion)&&Number(t.version)>=e}function wE(e){const t=pE();return!(t.name!==cE.EDGE||!t.osVersion)&&Number(t.version)>=e}function CE(e){const t=pE();return!(t.name!==cE.OPERA||!t.osVersion)&&Number(t.version)>=e}function RE(){const e=pE();return!(e.name!==cE.CHROME||!e.osVersion)&&Number(e.version)<=90}function IE(){const e=pE();if(e.os!==aE.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function OE(){const e=pE();if(e.os!==aE.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function AE(){const e=pE();if(e.os!==aE.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function NE(){const e=pE();if(e.os!==aE.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function kE(){return yE()&&navigator.maxTouchPoints>0}function PE(){return pE().name===cE.WECHAT}function DE(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function LE(){const e=pE();return e.name!==cE.EDGE&&e.name!==cE.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function xE(){return fE()===aE.ANDROID}function ME(){const e=pE();return xE()&&(e.name===cE.CHROME||e.name===cE.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var UE;!function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"}(UE||(UE={}));let FE=class extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),rh(this,"code",void 0),rh(this,"message",void 0),rh(this,"data",void 0),rh(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function jE(e,t){if("boolean"!=typeof e)throw new FE(UE.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function VE(e,t,n){if(!Di(n).call(n,e))throw new FE(UE.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function BE(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e))throw new FE(UE.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function GE(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new FE(UE.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&BE(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&BE(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&BE(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&BE(e.ideal,"".concat(t,".ideal"),1,1/0)}else BE(e,t,1,1/0)}function qE(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new FE(UE.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!HE(e,n,r,i))throw new FE(UE.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function WE(e,t){if(!Array.isArray(e))throw new FE(UE.INVALID_PARAMS,"".concat(t," should be an array"))}function zE(e){return null==e}function HE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}function KE(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const r=e.getUint32(t,n),i=e.getUint32(t+4,n),o=Number(!!n),s=Number(!n);return BigInt(r*s+i*o)<<BigInt(32)|BigInt(r*o+i*s)}function YE(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);const i=Number(n>>BigInt(32)),o=Number(n&BigInt(4294967295));r?(e.setUint32(t+4,i,r),e.setUint32(t,o,r)):(e.setUint32(t,i,r),e.setUint32(t+4,o,r))}var ZE,JE;!function(e){e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE"}(ZE||(ZE={})),function(e){e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(JE||(JE={}));const XE=new class{constructor(){rh(this,"_clientSize",null),rh(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),rh(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),rh(this,"getStyle",(e=>window.getComputedStyle(e,null))),rh(this,"checkCssVisibleProperty",(e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:o,opacity:s,filter:a}=r;return("none"===i||Di(t=["hidden","collapse"]).call(t,o)||Number(s)<.1)&&(n=!1),!!n&&(a&&a.split(" ").filter((e=>{var t;const n=e.split("(")[0];return Di(t=["brightness","blur","opacity"]).call(t,n)})).map((e=>{const[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]})).forEach((e=>{const[t,r]=e;switch(t){case"brightness":(r<.1||r>3)&&(n=!1);break;case"blur":r>3&&(n=!1);break;case"opacity":r<.1&&(n=!1)}})),n)})),rh(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let n=!0,r=!0;const i=e=>t(e);let o=e;for(;o&&r;)i(o)||(n=!1,r=!1),o=o.parentElement,o||(r=!1);return n})),rh(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),rh(this,"getSizeAboutClient",(e=>{const{width:t,height:n,left:r,right:i,top:o,bottom:s}=e.getBoundingClientRect(),a=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:o,bottom:s,clientWidth:a,clientHeight:c,clientMin:Math.min(a,c)}})),rh(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)})),rh(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),rh(this,"checkCoverForAPoint",((e,t,n)=>{const r=this.elementFromPoint(e,t);return null!==r&&r!==n})),rh(this,"getPointPositionList",(()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,o=t/6,s=[],a=10**6;for(let c=0;c<5;c++)for(let e=0;e<5;e++){const t=(n*a+(0===c?.1:4===c?(i*c*a-1e5)/a:i*c)*a)/a,l=(r*a+(0===e?.1:4===e?(o*e*a-1e5)/a:o*e)*a)/a;s.push({x:t,y:l})}return[...s]})),rh(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((e=>!!e)).length>6)),rh(this,"checkSizeIsVisible",((e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10))),rh(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:o,clientMin:s}=this._clientSize;let a,c,l,u;if(e<0)a=0;else{if(!(e<o))return!1;a=e}if(t<0)return!1;if(c=t<o?t:o,n<0)l=0;else{if(!(n<i))return!1;l=n}if(r<0)return!1;u=r<i?r:i;const d=c-a,h=u-l;return this.checkSizeIsVisible(d,h,s)})),rh(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),rh(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(ZE.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(ZE.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(ZE.SIZE)}}return this.returnHiddenResult(ZE.STYLE)}return this.returnHiddenResult(JE.UNMOUNTED)}return this.returnHiddenResult(JE.INVALID_HTML_ELEMENT)})),rh(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))))}};function QE(e){return(new TextEncoder).encode(e)}const $E=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},ev=async e=>{const t=function(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=QE(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,r);return function(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(i))},tv=async e=>function(e,t){let n="";return new Uint8Array(e).forEach((e=>{n+=e.toString(t).padStart(2,"0")})),n}(await crypto.subtle.digest("SHA-256",QE(e)),16);class nv{constructor(){rh(this,"_events",{}),rh(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map((e=>e.listener)):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map((e=>e));for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let o=0;o<t.length;o+=1){const n=t[o];n.once&&this.off(e,n.listener),n.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach((t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}}))}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}}let rv=null;function iv(){if(rv)return rv;if(window.electron)return rv=window.electron;if(!window.require)return null;try{return rv=window.require("electron"),rv}catch(e){return null}}var ov,sv,av,cv,lv,uv,dv,hv;function pv(e){return BE(e.timeout,"config.timeout",0,1e5),BE(e.timeoutFactor,"config.timeoutFactor",0,100,!1),BE(e.maxRetryCount,"config.maxRetryConfig",0,1/0),BE(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function fv(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((e=>{if(!e.urls)throw Error()}))}catch(e){return!1}return!0}function mv(e){return qE(e.turnServerURL,"turnServerURL"),qE(e.username,"username"),qE(e.password,"password"),e.udpport&&BE(e.udpport,"udpport",1,99999,!0),e.forceturn&&jE(e.forceturn,"forceturn"),e.security&&jE(e.security,"security"),e.tcpport&&BE(e.tcpport,"tcpport",1,99999,!0),!0}function gv(e){return void 0!==e.level&&VE(e.level,"level",[1,2,3]),void 0!==e.delay&&BE(e.delay,"delay",0,3e3,!0),!0}function _v(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?tE.reject(new FE(UE.UNEXPECTED_ERROR,"can not emit promise")):new tE(((n,i)=>{e.emit(t,...r,n,i)}))}function Ev(e,t){if(0===e.getListeners(t).length)return tE.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return _v(e,t,...r)}function vv(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return yv(e,t,...r)}function yv(e,t){let n=null,r=null;for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];if(e.emit(t,...o,(e=>{n=e}),(e=>{r=e})),null!==r)throw r;if(null===n)throw new FE(UE.UNEXPECTED_ERROR,"handler is not sync");return n}!function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload"}(ov||(ov={})),function(e){e.TRACER="tracer"}(sv||(sv={})),function(e){e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(av||(av={})),function(e){e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE"}(cv||(cv={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(lv||(lv={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(uv||(uv={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(dv||(dv={})),function(e){e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(hv||(hv={}));const bv=new class extends nv{set networkState(e){this.emit(hv.NETWORK_STATE_CHANGE,e,this._networkState),e===dv.ONLINE?this.emit(hv.ONLINE):e===dv.OFFLINE&&(this.onlineWaiter=new tE((e=>{this.once(hv.ONLINE,(()=>{this.onlineWaiter=void 0,e(dv.ONLINE)}))})),this.emit(hv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===dv.ONLINE}constructor(){super(),rh(this,"_moduleName","network-indicator"),rh(this,"_networkState",dv.ONLINE),rh(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=dv.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=dv.OFFLINE}))}};function Sv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sv(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sv(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wv(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}function Cv(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}function Rv(e){void 0!==tE?tE.resolve().then(e):setTimeout(e,0)}function Iv(e){return JSON.parse(JSON.stringify(e))}function Ov(e){try{return Iv(e)}catch(t){return e}}const Av={};function Nv(e,t){Av[t]||(Av[t]=!0,e())}function kv(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function Pv(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function Dv(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function Lv(e){let t=0;return/DingTalk/i.test(navigator.userAgent)&&e.realFormData&&(e=e.realFormData),e.forEach((e=>{t+="string"==typeof e?Dv(e):e.size})),t+138}function xv(e){const t=new FE(UE.TIMEOUT,"timeout");return new tE(((n,r)=>{window.setTimeout((()=>r(t)),e)}))}function Mv(e){return new tE((t=>{window.setTimeout(t,e)}))}function Uv(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Uv(e-n.length,"")}function Fv(){return Uv(32,"").toUpperCase()}const jv=()=>{},Vv=new class{constructor(){rh(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,o=new Array(i>4?i-4:0),s=4;s<i;s++)o[s-4]=arguments[s];if(this.fnMap.has(t)){const i=this.fnMap.get(t);if(i.threshold!==n){i.fn(...i.args),clearTimeout(i.timer);const s=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:s,args:o,skipFn:r})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,Tv(Tv({},i),{},{fn:e,args:o,skipFn:r}))}else{const i=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:i,args:o,skipFn:r})}}},Bv=Vv.throttleByKey.bind(Vv);function Gv(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function qv(e,t){if(!Gv(e)||!Gv(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=qv(e[r],t[r]);return n}{const n=Tv({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=qv(e[r],t[r]):n[r]=t[r]);return n}}let Wv=1,zv=console;class Hv{static setLogger(e){zv=e}constructor(e){rh(this,"lockingPromise",tE.resolve()),rh(this,"locks",0),rh(this,"name",""),rh(this,"lockId",void 0),this.lockId=Wv++,e&&(this.name=e),zv.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,zv.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:""));const n=new tE((n=>{t=()=>{this.locks-=1,zv.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:"")),n()}})),r=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>n)),r}}function Kv(e,t){return function(n,r,i){const o=i.value;if("function"!=typeof o)throw new Error("Cannot use mutex on object property.");return i.value=async function(){const n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const i=await n.lock("From ".concat(e,".").concat(r));try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return await o.apply(this,a)}finally{i()}},i}}const Yv={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Zv(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Jv(e,t,n,r){const i=Object.assign({},Yv,r);let o=i.timeout;const s=async()=>{await function(e){return new tE((t=>{window.setTimeout(t,e)}))}(o),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)};let a=!1;const c=new tE((async(r,o)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(a)return o(new FE(UE.OPERATION_ABORTED));try{const n=await e();if(!t(n,c))return r(n);if(c+1===i.maxRetryCount)return r(n);await s()}catch(e){if(!n(e,c))return o(e);if(c+1===i.maxRetryCount)return o(e);await s()}}}));return c.cancel=()=>a=!0,c}var Xv=Ut,Qv=tn,$v=Xe,ey=Kr,ty=TypeError,ny=function(e){return function(t,n,r,i){Xv(n);var o=Qv(t),s=$v(o),a=ey(o),c=e?a-1:0,l=e?-1:1;if(r<2)for(;;){if(c in s){i=s[c],c+=l;break}if(c+=l,e?c<0:a<=c)throw ty("Reduce of empty array with no initial value")}for(;e?c>=0:a>c;c+=l)c in s&&(i=n(i,s[c],c,o));return i}},ry=[ny(!1),ny(!0)][0];xr({target:"Array",proto:!0,forced:!Tf&&bt>79&&bt<83||!bh("reduce")},{reduce:function(e){var t=arguments.length;return ry(this,e,t,t>1?arguments[1]:void 0)}});var iy=ti("Array").reduce,oy=ge,sy=iy,ay=Array.prototype,cy=Z((function(e){var t=e.reduce;return e===ay||oy(ay,e)&&t===ay.reduce?sy:t}));let ly=class{constructor(e){rh(this,"input",[]),rh(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:cy(e=this.input).call(e,((e,t)=>e+t))/this.input.length}};var uy,dy={exports:{}},hy=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},py=hy,fy=Object.prototype.toString,my=(uy=Object.create(null),function(e){var t=fy.call(e);return uy[t]||(uy[t]=t.slice(8,-1).toLowerCase())});function gy(e){return e=e.toLowerCase(),function(t){return my(t)===e}}function _y(e){return Array.isArray(e)}function Ey(e){return void 0===e}var vy=gy("ArrayBuffer");function yy(e){return null!==e&&"object"==typeof e}function by(e){if("object"!==my(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var Sy=gy("Date"),Ty=gy("File"),wy=gy("Blob"),Cy=gy("FileList");function Ry(e){return"[object Function]"===fy.call(e)}var Iy=gy("URLSearchParams");function Oy(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),_y(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var Ay,Ny=(Ay="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return Ay&&e instanceof Ay}),ky={isArray:_y,isArrayBuffer:vy,isBuffer:function(e){return null!==e&&!Ey(e)&&null!==e.constructor&&!Ey(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||fy.call(e)===t||Ry(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&vy(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:yy,isPlainObject:by,isUndefined:Ey,isDate:Sy,isFile:Ty,isBlob:wy,isFunction:Ry,isStream:function(e){return yy(e)&&Ry(e.pipe)},isURLSearchParams:Iy,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:Oy,merge:function e(){var t={};function n(n,r){by(t[r])&&by(n)?t[r]=e(t[r],n):by(n)?t[r]=e({},n):_y(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)Oy(arguments[r],n);return t},extend:function(e,t,n){return Oy(t,(function(t,r){e[r]=n&&"function"==typeof t?py(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var r,i,o,s={};t=t||{};do{for(i=(r=Object.getOwnPropertyNames(e)).length;i-- >0;)s[o=r[i]]||(t[o]=e[o],s[o]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:my,kindOfTest:gy,endsWith:function(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n},toArray:function(e){if(!e)return null;var t=e.length;if(Ey(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:Ny,isFileList:Cy},Py=ky;function Dy(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Ly=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(Py.isURLSearchParams(t))r=t.toString();else{var i=[];Py.forEach(t,(function(e,t){null!=e&&(Py.isArray(e)?t+="[]":e=[e],Py.forEach(e,(function(e){Py.isDate(e)?e=e.toISOString():Py.isObject(e)&&(e=JSON.stringify(e)),i.push(Dy(t)+"="+Dy(e))})))})),r=i.join("&")}if(r){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e},xy=ky;function My(){this.handlers=[]}My.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},My.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},My.prototype.forEach=function(e){xy.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var Uy,Fy,jy=My,Vy=ky;function By(){if(Fy)return Uy;Fy=1;var e=ky;function t(e,t,n,r,i){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}e.inherits(t,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var n=t.prototype,r={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){r[e]={value:e}})),Object.defineProperties(t,r),Object.defineProperty(n,"isAxiosError",{value:!0}),t.from=function(r,i,o,s,a,c){var l=Object.create(n);return e.toFlatObject(r,l,(function(e){return e!==Error.prototype})),t.call(l,r.message,i,o,s,a),l.name=r.name,c&&Object.assign(l,c),l},Uy=t}var Gy,qy,Wy,zy,Hy,Ky,Yy={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function Zy(){if(qy)return Gy;qy=1;var e=ky;return Gy=function(t,n){n=n||new FormData;var r=[];function i(t){return null===t?"":e.isDate(t)?t.toISOString():e.isArrayBuffer(t)||e.isTypedArray(t)?"function"==typeof Blob?new Blob([t]):Buffer.from(t):t}return function t(o,s){if(e.isPlainObject(o)||e.isArray(o)){if(-1!==r.indexOf(o))throw Error("Circular reference detected in "+s);r.push(o),e.forEach(o,(function(r,o){if(!e.isUndefined(r)){var a,c=s?s+"."+o:o;if(r&&!s&&"object"==typeof r)if(e.endsWith(o,"{}"))r=JSON.stringify(r);else if(e.endsWith(o,"[]")&&(a=e.toArray(r)))return void a.forEach((function(t){!e.isUndefined(t)&&n.append(c,i(t))}));t(r,c)}})),r.pop()}else n.append(s,i(o))}(t),n},Gy}function Jy(){if(zy)return Wy;zy=1;var e=By();return Wy=function(t,n,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?n(new e("Request failed with status code "+r.status,[e.ERR_BAD_REQUEST,e.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):t(r)}}function Xy(){if(Ky)return Hy;Ky=1;var e=ky;return Hy=e.isStandardBrowserEnv()?{write:function(t,n,r,i,o,s){var a=[];a.push(t+"="+encodeURIComponent(n)),e.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),e.isString(i)&&a.push("path="+i),e.isString(o)&&a.push("domain="+o),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Hy}var Qy,$y,eb,tb,nb,rb,ib,ob,sb,ab,cb,lb,ub=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},db=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},hb=function(e,t){return e&&!ub(t)?db(e,t):t};function pb(){if($y)return Qy;$y=1;var e=ky,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Qy=function(n){var r,i,o,s={};return n?(e.forEach(n.split("\n"),(function(n){if(o=n.indexOf(":"),r=e.trim(n.substr(0,o)).toLowerCase(),i=e.trim(n.substr(o+1)),r){if(s[r]&&t.indexOf(r)>=0)return;s[r]="set-cookie"===r?(s[r]?s[r]:[]).concat([i]):s[r]?s[r]+", "+i:i}})),s):s},Qy}function fb(){if(tb)return eb;tb=1;var e=ky;return eb=e.isStandardBrowserEnv()?function(){var t,n=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(e){var t=e;return n&&(r.setAttribute("href",t),t=r.href),r.setAttribute("href",t),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=i(window.location.href),function(n){var r=e.isString(n)?i(n):n;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0}}function mb(){if(rb)return nb;rb=1;var e=By();function t(t){e.call(this,null==t?"canceled":t,e.ERR_CANCELED),this.name="CanceledError"}return ky.inherits(t,e,{__CANCEL__:!0}),nb=t}function gb(){return ob||(ob=1,ib=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}),ib}function _b(){if(ab)return sb;ab=1;var e=ky,t=Jy(),n=Xy(),r=Ly,i=hb,o=pb(),s=fb(),a=Yy,c=By(),l=mb(),u=gb();return sb=function(d){return new Promise((function(h,p){var f,m=d.data,g=d.headers,_=d.responseType;function E(){d.cancelToken&&d.cancelToken.unsubscribe(f),d.signal&&d.signal.removeEventListener("abort",f)}e.isFormData(m)&&e.isStandardBrowserEnv()&&delete g["Content-Type"];var v=new XMLHttpRequest;if(d.auth){var y=d.auth.username||"",b=d.auth.password?unescape(encodeURIComponent(d.auth.password)):"";g.Authorization="Basic "+btoa(y+":"+b)}var S=i(d.baseURL,d.url);function T(){if(v){var e="getAllResponseHeaders"in v?o(v.getAllResponseHeaders()):null,n={data:_&&"text"!==_&&"json"!==_?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:e,config:d,request:v};t((function(e){h(e),E()}),(function(e){p(e),E()}),n),v=null}}if(v.open(d.method.toUpperCase(),r(S,d.params,d.paramsSerializer),!0),v.timeout=d.timeout,"onloadend"in v?v.onloadend=T:v.onreadystatechange=function(){v&&4===v.readyState&&(0!==v.status||v.responseURL&&0===v.responseURL.indexOf("file:"))&&setTimeout(T)},v.onabort=function(){v&&(p(new c("Request aborted",c.ECONNABORTED,d,v)),v=null)},v.onerror=function(){p(new c("Network Error",c.ERR_NETWORK,d,v,v)),v=null},v.ontimeout=function(){var e=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",t=d.transitional||a;d.timeoutErrorMessage&&(e=d.timeoutErrorMessage),p(new c(e,t.clarifyTimeoutError?c.ETIMEDOUT:c.ECONNABORTED,d,v)),v=null},e.isStandardBrowserEnv()){var w=(d.withCredentials||s(S))&&d.xsrfCookieName?n.read(d.xsrfCookieName):void 0;w&&(g[d.xsrfHeaderName]=w)}"setRequestHeader"in v&&e.forEach(g,(function(e,t){void 0===m&&"content-type"===t.toLowerCase()?delete g[t]:v.setRequestHeader(t,e)})),e.isUndefined(d.withCredentials)||(v.withCredentials=!!d.withCredentials),_&&"json"!==_&&(v.responseType=d.responseType),"function"==typeof d.onDownloadProgress&&v.addEventListener("progress",d.onDownloadProgress),"function"==typeof d.onUploadProgress&&v.upload&&v.upload.addEventListener("progress",d.onUploadProgress),(d.cancelToken||d.signal)&&(f=function(e){v&&(p(!e||e&&e.type?new l:e),v.abort(),v=null)},d.cancelToken&&d.cancelToken.subscribe(f),d.signal&&(d.signal.aborted?f():d.signal.addEventListener("abort",f))),m||(m=null);var C=u(S);C&&-1===["http","https","file"].indexOf(C)?p(new c("Unsupported protocol "+C+":",c.ERR_BAD_REQUEST,d)):v.send(m)}))},sb}var Eb=ky,vb=function(e,t){Vy.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},yb=By(),bb=Yy,Sb=Zy(),Tb={"Content-Type":"application/x-www-form-urlencoded"};function wb(e,t){!Eb.isUndefined(e)&&Eb.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var Cb,Rb={transitional:bb,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(Cb=_b()),Cb),transformRequest:[function(e,t){if(vb(t,"Accept"),vb(t,"Content-Type"),Eb.isFormData(e)||Eb.isArrayBuffer(e)||Eb.isBuffer(e)||Eb.isStream(e)||Eb.isFile(e)||Eb.isBlob(e))return e;if(Eb.isArrayBufferView(e))return e.buffer;if(Eb.isURLSearchParams(e))return wb(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,r=Eb.isObject(e),i=t&&t["Content-Type"];if((n=Eb.isFileList(e))||r&&"multipart/form-data"===i){var o=this.env&&this.env.FormData;return Sb(n?{"files[]":e}:e,o&&new o)}return r||"application/json"===i?(wb(t,"application/json"),function(e,t,n){if(Eb.isString(e))try{return(t||JSON.parse)(e),Eb.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||Rb.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,i=!n&&"json"===this.responseType;if(i||r&&Eb.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw yb.from(e,yb.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:lb?cb:(lb=1,cb=null)},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Eb.forEach(["delete","get","head"],(function(e){Rb.headers[e]={}})),Eb.forEach(["post","put","patch"],(function(e){Rb.headers[e]=Eb.merge(Tb)}));var Ib,Ob,Ab=Rb,Nb=ky,kb=Ab;function Pb(){return Ob?Ib:(Ob=1,Ib=function(e){return!(!e||!e.__CANCEL__)})}var Db=ky,Lb=function(e,t,n){var r=this||kb;return Nb.forEach(n,(function(n){e=n.call(r,e,t)})),e},xb=Pb(),Mb=Ab,Ub=mb();function Fb(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ub}var jb,Vb,Bb=ky,Gb=function(e,t){t=t||{};var n={};function r(e,t){return Bb.isPlainObject(e)&&Bb.isPlainObject(t)?Bb.merge(e,t):Bb.isPlainObject(t)?Bb.merge({},t):Bb.isArray(t)?t.slice():t}function i(n){return Bb.isUndefined(t[n])?Bb.isUndefined(e[n])?void 0:r(void 0,e[n]):r(e[n],t[n])}function o(e){if(!Bb.isUndefined(t[e]))return r(void 0,t[e])}function s(n){return Bb.isUndefined(t[n])?Bb.isUndefined(e[n])?void 0:r(void 0,e[n]):r(void 0,t[n])}function a(n){return n in t?r(e[n],t[n]):n in e?r(void 0,e[n]):void 0}var c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a};return Bb.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,r=t(e);Bb.isUndefined(r)&&t!==a||(n[e]=r)})),n};function qb(){return Vb?jb:(Vb=1,jb={version:"0.27.2"})}var Wb=qb().version,zb=By(),Hb={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){Hb[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var Kb={};Hb.transitional=function(e,t,n){function r(e,t){return"[Axios v"+Wb+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,o){if(!1===e)throw new zb(r(i," has been removed"+(t?" in "+t:"")),zb.ERR_DEPRECATED);return t&&!Kb[i]&&(Kb[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}};var Yb,Zb,Jb,Xb,Qb,$b,eS={assertOptions:function(e,t,n){if("object"!=typeof e)throw new zb("options must be an object",zb.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),i=r.length;i-- >0;){var o=r[i],s=t[o];if(s){var a=e[o],c=void 0===a||s(a,o,e);if(!0!==c)throw new zb("option "+o+" must be "+c,zb.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new zb("Unknown option "+o,zb.ERR_BAD_OPTION)}},validators:Hb},tS=ky,nS=Ly,rS=jy,iS=function(e){return Fb(e),e.headers=e.headers||{},e.data=Lb.call(e,e.data,e.headers,e.transformRequest),e.headers=Db.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),Db.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||Mb.adapter)(e).then((function(t){return Fb(e),t.data=Lb.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return xb(t)||(Fb(e),t&&t.response&&(t.response.data=Lb.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},oS=Gb,sS=hb,aS=eS,cS=aS.validators;function lS(e){this.defaults=e,this.interceptors={request:new rS,response:new rS}}lS.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=oS(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&aS.assertOptions(n,{silentJSONParsing:cS.transitional(cS.boolean),forcedJSONParsing:cS.transitional(cS.boolean),clarifyTimeoutError:cS.transitional(cS.boolean)},!1);var r=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var o,s=[];if(this.interceptors.response.forEach((function(e){s.push(e.fulfilled,e.rejected)})),!i){var a=[iS,void 0];for(Array.prototype.unshift.apply(a,r),a=a.concat(s),o=Promise.resolve(t);a.length;)o=o.then(a.shift(),a.shift());return o}for(var c=t;r.length;){var l=r.shift(),u=r.shift();try{c=l(c)}catch(e){u(e);break}}try{o=iS(c)}catch(e){return Promise.reject(e)}for(;s.length;)o=o.then(s.shift(),s.shift());return o},lS.prototype.getUri=function(e){e=oS(this.defaults,e);var t=sS(e.baseURL,e.url);return nS(t,e.params,e.paramsSerializer)},tS.forEach(["delete","get","head","options"],(function(e){lS.prototype[e]=function(t,n){return this.request(oS(n||{},{method:e,url:t,data:(n||{}).data}))}})),tS.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(oS(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}lS.prototype[e]=t(),lS.prototype[e+"Form"]=t(!0)}));var uS=ky,dS=hy,hS=lS,pS=Gb,fS=function e(t){var n=new hS(t),r=dS(hS.prototype.request,n);return uS.extend(r,hS.prototype,n),uS.extend(r,n),r.create=function(n){return e(pS(t,n))},r}(Ab);fS.Axios=hS,fS.CanceledError=mb(),fS.CancelToken=function(){if(Zb)return Yb;Zb=1;var e=mb();function t(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var n;this.promise=new Promise((function(e){n=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},t((function(t){r.reason||(r.reason=new e(t),n(r.reason))}))}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},t.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},t.source=function(){var e;return{token:new t((function(t){e=t})),cancel:e}},Yb=t}(),fS.isCancel=Pb(),fS.VERSION=qb().version,fS.toFormData=Zy(),fS.AxiosError=By(),fS.Cancel=fS.CanceledError,fS.all=function(e){return Promise.all(e)},fS.spread=Xb?Jb:(Xb=1,Jb=function(e){return function(t){return e.apply(null,t)}}),fS.isAxiosError=function(){if($b)return Qb;$b=1;var e=ky;return Qb=function(t){return e.isObject(t)&&!0===t.isAxiosError}}(),dy.exports=fS,dy.exports.default=fS;var mS=Z(dy.exports);function gS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gS(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let ES,vS=0,yS=0;function bS(e,t,n,r){return new tE(((i,o)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),vS+=Dv(t.data)):n&&(t.data.size?vS+=t.data.size:t.data instanceof FormData?vS+=Lv(t.data):vS+=Dv(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,mS.request(t).then((e=>{"string"==typeof e.data?yS+=Dv(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?yS+=e.data.byteLength:yS+=Dv(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{mS.isCancel(e)?o(new FE(UE.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new FE(UE.NETWORK_TIMEOUT,e.message)):e.response?o(new FE(UE.NETWORK_RESPONSE_ERROR,e.response.status)):o(new FE(UE.NETWORK_ERROR,e.message))}))}))}async function SS(e,t){const n=new Blob([t.data],{type:"buffer"});return await bS(e,_S(_S({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const TS=()=>"HTTPS"===(ES||ES||(ES=(window.location.protocol.split(":")[0]||"").toUpperCase(),ES)),wS=()=>void 0!==window.isSecureContext;function CS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function RS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CS(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var IS;!function(e){e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",e.SET_USE_P2P="SET_USE_P2P"}(IS||(IS={}));class OS{constructor(e,t,n,r){rh(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case IS.SET_SESSION_ID:return RS(RS({},e),{},{sessionId:t.sessionId});case IS.SET_P2P_ID:return RS(RS({},e),{},{p2pId:t.p2pId});case IS.SET_UID:return RS(RS({},e),{},{uid:t.uid});case IS.SET_PUB_ID:return RS(RS({},e),{},{pubId:t.pubId});case IS.KEY_METRIC_CLIENT_CREATED:return RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{clientCreated:t.metric})});case IS.KEY_METRIC_JOIN_START:return RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{joinStart:t.metric})});case IS.AVOID_JOIN_START:return RS(RS({},e),{},{avoidJoinStart:t.avoidJoinStart});case IS.KEY_METRIC_JOIN_END:return RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{joinEnd:t.metric})});case IS.KEY_METRIC_REQUEST_AP_START:return RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{requestAPStart:t.metric})});case IS.KEY_METRIC_REQUEST_AP_END:return RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{requestAPEnd:t.metric})});case IS.KEY_METRIC_JOIN_GATEWAY_START:return RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case IS.KEY_METRIC_JOIN_GATEWAY_END:return RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case IS.KEY_METRIC_PEER_CONNECTION_START:return RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case IS.KEY_METRIC_PEER_CONNECTION_END:return RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case IS.KEY_METRIC_DESCRIPTION_START:return RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{descriptionStart:t.metric})});case IS.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case IS.KEY_METRIC_ICE_CONNECTION_END:return RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case IS.KEY_METRIC_PUBLISH:{const n=e.keyMetrics.publish,r=n.findIndex((e=>e.trackId===t.metric.trackId));return-1!==r?(n[r]=RS(RS({},n[r]),t.metric),RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{publish:[...n]})})):RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case IS.KEY_METRIC_SUBSCRIBE:{const n=e.keyMetrics.subscribe,r=n.findIndex((e=>e.userId===t.metric.userId&&e.type===t.metric.type));return-1!==r?(n[r]=RS(RS({},n[r]),t.metric),RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{subscribe:[...n]})})):RS(RS({},e),{},{keyMetrics:RS(RS({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case IS.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case IS.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=RS(RS({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case IS.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case IS.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case IS.SET_USE_DATACHANNEL:return RS(RS({},e),{},{useDataChannel:t.val});case IS.SET_USE_P2P:return RS(RS({},e),{},{useP2P:t.val});default:return e}}(this.state,e)}set sessionId(e){this.dispatch({type:IS.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:IS.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:IS.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:IS.SET_UID,uid:e})}get uid(){return this.state.uid}set pubId(e){this.dispatch({type:IS.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:IS.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(e){this.dispatch({type:IS.SET_USE_DATACHANNEL,val:e})}get useDataChannel(){return this.state.useDataChannel}set useP2P(e){this.dispatch({type:IS.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}clientCreated(){this.dispatch({type:IS.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:IS.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:IS.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:IS.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:IS.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:IS.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:IS.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:IS.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:IS.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:IS.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:IS.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:IS.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,r){this.dispatch({type:IS.KEY_METRIC_PUBLISH,metric:RS(RS({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}subscribe(e,t,n,r,i,o,s){this.dispatch({type:IS.KEY_METRIC_SUBSCRIBE,metric:RS(RS(RS(RS(RS({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),o&&{streamAdded:o}),s&&{firstDecoded:s})})}massSubscribe(e,t,n,r){e.forEach((e=>{this.dispatch({type:IS.KEY_METRIC_SUBSCRIBE,metric:RS(RS(RS({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return"number"!=typeof t?(this.dispatch({type:IS.RECORD_JOIN_CHANNEL_SERVICE,record:RS(RS({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:IS.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:IS.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:IS.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:IS.AVOID_JOIN_START,avoidJoinStart:e})}}const AS=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[1],n=t[2];return"".concat(e,".").concat(n)}const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const e=n[1],t=n[2];return"".concat(e,".").concat(100*(Number(t)+1))}return"4.0.0.999"}("4.19.3"),NS=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}(),kS="v4.19.3-0-gb2ca8ca7(11/2/2023, 2:57:33 PM)",PS={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:100,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[]};function DS(e,t,n){var r,i;Di(r=Object.keys(PS)).call(r,e)&&(!n&&Di(i=Object.keys(xS)).call(i,e)||(PS[e]=t))}function LS(e){return PS[e]}const xS={};var MS,US;!function(e){e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1"}(MS||(MS={})),function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}(US||(US={}));const FS=new class extends nv{reportLogUploadError(e){this.emit("REPORT_LOG_UPLOAD",e)}};class jS{constructor(e){rh(this,"logger",void 0),rh(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function VS(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function BS(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const GS={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},qS=Date.now(),WS=e=>{for(const t in GS)if(Object.prototype.hasOwnProperty.call(GS,t)&&GS[t]===e)return t;return"DEFAULT"},zS=new class{constructor(){rh(this,"proxyServerURL",void 0),rh(this,"logLevel",GS.DEBUG),rh(this,"uploadState","collecting"),rh(this,"uploadLogWaitingList",[]),rh(this,"uploadLogUploadingList",[]),rh(this,"uploadErrorCount",0),rh(this,"currentLogID",0),rh(this,"url",void 0),rh(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[GS.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[GS.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[GS.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[GS.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[GS.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){DS("UPLOAD_LOG",!0)}disableLogUpload(){DS("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new jS(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-qS<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-qS);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=VS()+" Agora-SDK [".concat(WS(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=VS()+" %cAgora-SDK [".concat(WS(r),"]:");let o=[];if(!LS("USE_NEW_LOG"))switch(r){case GS.DEBUG:o=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case GS.INFO:o=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case GS.WARNING:o=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case GS.ERROR:o=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-qS<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-qS);const r=Math.max(0,Math.min(4,t[0]));t[0]=VS()+" Agora-SDK [".concat(WS(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!LS("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=BS()+" Agora-SDK [".concat(WS(e),"]:"):n[0]=BS()+" Agora-SDK [".concat(WS(e),"]:");let i="";n.forEach((e=>{"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:AS,process_id:LS("PROCESS_ID"),payload:JSON.stringify(e)};return Jv((async()=>{const e=await mS.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(LS("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(LS("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){const t=new Error("unexpected upload log response");throw t.response=e,t}}),(()=>(this.uploadLogUploadingList=[],!1)),(e=>(e.response?FS.reportLogUploadError({status:e.response.status,data:e.response.data,headers:e.response.headers,message:e.message}):e.request?FS.reportLogUploadError({status:e.request.status,message:e.message}):FS.reportLogUploadError({status:-1,message:e.message}),!0)),{timeout:LS("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:LS("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,LS("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),LS("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),LS("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),LS("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var HS,KS;function YS(e){return qE(e.reportId,"params.reportId",0,100,!1),qE(e.category,"params.category",0,100,!1),qE(e.event,"params.event",0,100,!1),qE(e.label,"params.label",0,100,!1),BE(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}!function(e){e.FREE="free",e.UPLOADING="uploading"}(HS||(HS={})),function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}(KS||(KS={}));const ZS={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var JS,XS,QS,$S;function eT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eT(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats"}(JS||(JS={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats"}(XS||(XS={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(QS||(QS={})),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}($S||($S={}));class nT{constructor(){rh(this,"baseInfoMap",new Map),rh(this,"proxyServer",void 0),rh(this,"eventUploadTimer",void 0),rh(this,"setSessionIdTimer",void 0),rh(this,"url",void 0),rh(this,"backupUrl",void 0),rh(this,"_appId",void 0),rh(this,"keyEventUploadPendingItems",[]),rh(this,"normalEventUploadPendingItems",[]),rh(this,"apiInvokeUploadPendingItems",[]),rh(this,"apiInvokeCount",0),rh(this,"ltsList",[]),rh(this,"lastSendNormalEventTime",Date.now()),rh(this,"customReportCounterTimer",void 0),rh(this,"customReportCount",0),rh(this,"extApiInvoke",(async e=>{for(const t of e){const e=tT(tT({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:sv.TRACER});this.sendApiInvoke(e)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),LS("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),LS("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void zS.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),n=Date.now(),r=t.startTime;t.startTime=n,zS.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-r,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,o=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null}),s=!!LS("SHOW_REPORT_INVOKER_LOG");s&&zS.info("".concat(t.name," start"),t.options);let a=!1;Mv(t.timeout).then((()=>{a||(this.sendApiInvoke(tT(tT({},o()),{},{error:UE.API_INVOKE_TIMEOUT,success:!1})),zS.debug("".concat(t.name," timeout")))}));const c=new FE(UE.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const r=()=>{if(a)throw c;return a=!0,this.sendApiInvoke(tT(tT({},o()),{},{success:!0},t.reportResult&&{result:e})),s&&zS.info("".concat(t.name," onSuccess")),e};return n?Bv(r,t.name+"Success",n,(()=>a=!0)):r()},onError:e=>{const r=()=>{if(a)throw e;a=!0,this.sendApiInvoke(tT(tT({},o()),{},{success:!1,error:e})),s&&zS.info("".concat(t.name," onFailure"),e.toString())};return n?Bv(r,t.name+"Error",n,(()=>a=!0)):r()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:LS("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:NS?"global":"oversea",areas:LS("AREAS")&&LS("AREAS").join(",")},t.extend),o=Date.now(),s=tT(tT({},r),{},{eventType:JS.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:kS,lts:o,elapse:o-n,extend:JSON.stringify(i),mode:t.mode,process:LS("PROCESS_ID"),appType:LS("APP_TYPE"),success:!0,version:AS});this.send({type:XS.SESSION,data:s},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=tT(tT({},r),{},{eventType:JS.JOIN_CHOOSE_SERVER,lts:i,eventElapse:i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:XS.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=tT(tT({},r),{},{eventType:JS.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:XS.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:o,avoidJoinStartTime:s,isProxy:a,addr:c}=t,l=i-(o&&s?s:n.startTime),u=tT(tT({},r),{},{eventType:JS.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:l,eventElapse:i-t.lts,firstSuccess:o,signalChannel:t.signalChannel}),d=u.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),o)this.send({type:XS.JOIN_GATEWAY,data:u},!0);else{let e;if(c)if(a){const t=c.match(/h=(\d{1,3}-){3}\d{1,3}/g),n=c.match(/p=[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split("=")[1]:"",isProxy:a?1:0}}else{const t=c.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),n=c.match(/(:|p=)[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split(/:|p=/g)[1]:"",isProxy:a?1:0}}else e={isSuccess:d,gatewayIp:"",port:"",isProxy:a?1:0};delete u.success,delete u.eventType,delete u.firstSuccess,u.vid=Number(u.vid);const t=Object.assign({},u,e,{eventType:JS.REJOIN_GATEWAY});this.send({type:XS.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=tT(tT({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:XS.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=tT(tT({},r),{},{eventType:JS.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:XS.PUBLISH,data:o},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,o=Date.now(),s=tT(tT({},i),{},{eventType:JS.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?s.peerSuid=t.peerid:s.peer=t.peerid,this.send({type:XS.SUBSCRIBE,data:s},!0)}wsCompressorInit(e){var t;const n=[...dh(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const o=i.info,s=Date.now(),a=tT(tT({},o),{},{eventType:JS.WS_COMPRESSOR_INIT,lts:s,eventElapse:e.eventElapse,elapse:s-i.startTime,status:e.status?1:2});this.send({type:XS.WS_COMPRESSOR_INIT,data:a},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=tT(tT(tT({},o),r),{},{elapse:s-i.startTime,eventType:t,lts:s,firstDecodeFrame:Math.max(s-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:a},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=tT(tT(tT({},o),r),{},{elapse:s-i.startTime,eventType:t,lts:s});this.send({type:n,data:a},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=tT(tT(tT({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:JS.PC_STATS,lts:i});this.send({type:XS.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,t){this.reportApiInvoke(e,{name:"Client.updateRemoteRTPCapabilities",options:t,tag:sv.TRACER}).onSuccess()}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=tT(tT(tT({},o),r),{},{eventType:t,lts:s});this.send({type:n,data:a},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=tT(tT({},r),{},{eventType:JS.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:XS.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=tT(tT({},r),{},{eventType:JS.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:XS.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=tT(tT({},r),{},{eventType:JS.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:XS.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?zS.debug("reportProxyServerurl: ".concat(e)):zS.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=tT(tT({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:XS.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=function(e,t,n){const r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";const i=Dv(JSON.stringify(e));let o=0;const s=[];let a=0;for(let c=0;c<r.length;c++)a+=r.charCodeAt(c)<=127?1:3,a<=n-i||(s[s.length]=Tv(Tv({},e),{},{[t]:r.substring(o,c)}),o=c,a=r.charCodeAt(c)<=127?1:3);return o!==r.length-1&&(s[s.length]=Tv(Tv({},e),{},{[t]:r.substring(o)})),s}(tT(tT(tT({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300);o.forEach((e=>this.send({type:XS.WORKER_EVENT,data:e},!0)))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=tT(tT(tT({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:XS.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=tT(tT(tT({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:XS.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=tT(tT(tT({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:XS.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>LS("CUSTOM_REPORT_LIMIT"))throw new FE(UE.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const n=Date.now(),r=t.map((t=>({type:XS.USER_ANALYTICS,data:tT(tT({sid:e},t),{},{lts:n})})));try{LS("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(e){throw zS.error("send custom report message failed",e.toString()),new FE(UE.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){const t=LS("NOT_REPORT_EVENT");if(e.tag&&Di(t)&&Di(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:o}=n.info;let s;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof FE){const{code:t,message:n}=e.error;s=t||n||e.error.toString()}else s=e.error.toString();const a={invokeId:e.invokeId,sid:e.sid,cname:r,cid:o,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?s:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:XS.API_INVOKE,data:a},!1),!0}appendSessionId(){nT.__CLIENT_LIST__.forEach((e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){const t=this.apiInvokeUploadPendingItems.shift();t&&(t.sid=e._sessionId,this.sendApiInvoke(Object.assign({},t)))}}}))}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>LS("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const t=e.shift();n.length<20?n.push(t):r.push(t)}e.push(...r);for(const o of[...n]){var i;-1!==this.ltsList.indexOf(o.data.lts)?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),Qh(i=this.ltsList).call(i,((e,t)=>e-t)))}return t||(this.lastSendNormalEventTime=Date.now()),LS("ENABLE_EVENT_REPORT")?(n.length&&(LS("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{LS("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>LS("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-LS("NORMAL_EVENT_QUEUE_CAPACITY")),zS.warning("report: drop normal events"))))})(n)),e):e}async postDataToStatsCollector2(e){bv.networkState===dv.OFFLINE&&await tE.race([bv.onlineWaiter,Mv(2*Yv.maxRetryTimeout)]);const t=e=>{let t=new Uint8Array;return e.forEach((e=>{const n=QE(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=(e=>{let t=0;return Object.entries(XS).forEach((n=>{let[r,i]=n;i===e.type&&(t=EventNameToID[r])})),t})(e),o=new DataView(r);o.setUint16(0,n.byteLength,!0),o.setUint8(2,255&i),o.setUint8(3,i>>>8&255),o.setUint8(4,i>>>16&255),t=$E(t,new Uint8Array(r)),t=$E(t,n)})),t},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(LS("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(LS("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){1===i&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(LS("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(LS("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await bS(r,{timeout:1e4,data:t(e),headers:tT(tT({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===i)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((e=>JSON.stringify(e))),vid:(e=>{const t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0])};bv.networkState===dv.OFFLINE&&await tE.race([bv.onlineWaiter,Mv(2*Yv.maxRetryTimeout)]);const r=t?"/events/proto-raws":"/events/messages";let i=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(LS("EVENT_REPORT_DOMAIN"),"&p=").concat(LS("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(LS("EVENT_REPORT_DOMAIN"),":").concat(LS("STATS_COLLECTOR_PORT")).concat(r));for(let o=0;o<2;o+=1){1===o&&(i=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(LS("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(LS("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(LS("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(LS("STATS_COLLECTOR_PORT")).concat(r)));try{t?await SS(i,{timeout:1e4,data:n}):await bS(i,{timeout:1e4,data:n})}catch(t){if(1===o)throw t;continue}return}}createBaseInfo(e,t){const n=Object.assign({},ZS);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:sv.TRACER}).onSuccess()}}function rT(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){const i=r.value;if("function"==typeof i){const o=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];let a=r;if(e.argsMap)try{a=e.argsMap(this,...r)}catch(e){zS.warning(e),a=[]}try{JSON.stringify(a)}catch(e){zS.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),a=[]}const c=(e.report||iT).reportApiInvoke(this._sessionId||null,{name:"".concat(o,".").concat(String(n)),options:a,tag:sv.TRACER,reportResult:e.reportResult},e.throttleTime);try{const t=i.apply(this,r);return t instanceof tE?t.then((t=>(c.onSuccess(e.reportResult&&t),t))).catch((e=>{throw c.onError(e),e})):(c.onSuccess(e.reportResult&&t),t)}catch(e){throw c.onError(e),e}}}return r}}rh(nT,"__CLIENT_LIST__",[]);const iT=new nT;FS.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=bv.networkState,iT.reportApiInvoke(null,{name:"logUploadError",options:e,tag:sv.TRACER})}));const oT=["CHINA","GLOBAL"],sT=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let a=0;a<6;a++)i.push("1");const o=i.join(""),s={};return s[e]=r,s[t]=o,Object.assign(s,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=sT,NS||(PS.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],PS.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],PS.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],PS.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],PS.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],PS.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],PS.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",PS.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",PS.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",PS.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",PS.AREAS=["NORTH_AMERICA","OVERSEA"]);const aT=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],cT=[];function lT(e,t){return!!t&&cT.some((n=>n.uid===e&&n.channelName===t))}nT.__CLIENT_LIST__=cT;var uT,dT,hT,pT,fT,mT,gT,_T,ET,vT,yT,bT,ST,TT,wT,CT,RT,IT=ti("Array").values,OT=gi,AT=on,NT=ge,kT=IT,PT=Array.prototype,DT={DOMTokenList:!0,NodeList:!0},LT=Z((function(e){var t=e.values;return e===PT||NT(PT,e)&&t===PT.values||AT(DT,OT(e))?kT:t}));function xT(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function MT(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e){e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY"}(uT||(uT={})),function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"}(dT||(dT={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(hT||(hT={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(pT||(pT={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(fT||(fT={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(mT||(mT={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(gT||(gT={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(_T||(_T={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_START="p2p_start",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(ET||(ET={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag"}(vT||(vT={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.TRANSPORT_STATS="transport_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats"}(yT||(yT={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list"}(bT||(bT={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.NEED_CONTROL="NEED_CONTROL",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(ST||(ST={})),function(e){e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY"}(TT||(TT={})),function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(wT||(wT={}));class UT extends FE{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),rh(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,zS)}throw(){super.throw(zS)}}function FT(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw zS.error("Invalid Channel Name ".concat(e)),new UT(UE.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function jT(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||HE(e,1,255)))throw new UT(UE.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&zS.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}!function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(CT||(CT={})),function(e){e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(RT||(RT={}));const VT={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},BT={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function GT(e,t){qE(e.url,"".concat(t,".url"),1,1e3,!1),zE(e.x)||BE(e.x,"".concat(t,".x"),0,1e4),zE(e.y)||BE(e.y,"".concat(t,".y"),0,1e4),zE(e.width)||BE(e.width,"".concat(t,".width"),0,1e4),zE(e.height)||BE(e.height,"".concat(t,".height"),0,1e4),zE(e.zOrder)||BE(e.zOrder,"".concat(t,".zOrder"),0,255),zE(e.alpha)||BE(e.alpha,"".concat(t,".alpha"),0,1,!1)}const qT={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},WT={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var zT,HT,KT,YT,ZT,JT,XT,QT,$T,ew,tw,nw,rw,iw;function ow(e){if(!e.channelName)throw new UT(UE.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new UT(UE.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&qE(e.token,"info.token",1,2047),jT(e.uid),FT(e.channelName),!0}!function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(zT||(zT={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(HT||(HT={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(KT||(KT={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(YT||(YT={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(ZT||(ZT={})),function(e){e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(JT||(JT={})),function(e){e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(XT||(XT={})),function(e){e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(QT||(QT={})),function(e){e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low"}($T||($T={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal"}(ew||(ew={})),function(e){e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON"}(tw||(tw={})),function(e){e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7"}(nw||(nw={})),function(e){e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel"}(rw||(rw={})),function(e){e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS"}(iw||(iw={}));const sw=[iw.AFRICA,iw.ASIA,iw.CHINA,iw.EUROPE,iw.GLOBAL,iw.INDIA,iw.JAPAN,iw.NORTH_AMERICA,iw.OCEANIA,iw.OVERSEA,iw.SOUTH_AMERICA];var aw;!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL"}(aw||(aw={}));const cw={CHINA:{},ASIA:{CODE:aw.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:aw.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:aw.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:aw.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:aw.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:aw.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:aw.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:aw.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:aw.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:aw.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:aw.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:aw.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:aw.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var lw,uw,dw,hw,pw,fw,mw,gw,_w,Ew,vw,yw,bw,Sw,Tw,ww,Cw,Rw,Iw,Ow,Aw,Nw;NS&&(cw.CHINA={CODE:aw.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(e){e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(lw||(lw={}));class kw extends nv{constructor(e,t){super(),rh(this,"onICEConnectionStateChange",void 0),rh(this,"onConnectionStateChange",void 0),rh(this,"onDTLSTransportStateChange",void 0),rh(this,"onDTLSTransportError",void 0),rh(this,"onICETransportStateChange",void 0),rh(this,"onFirstAudioReceived",void 0),rh(this,"onFirstVideoReceived",void 0),rh(this,"onFirstAudioDecoded",void 0),rh(this,"onFirstVideoDecoded",void 0),rh(this,"onFirstVideoDecodedTimeout",void 0),rh(this,"onSelectedLocalCandidateChanged",void 0),rh(this,"onSelectedRemoteCandidateChanged",void 0)}}class Pw extends kw{constructor(e,t){super(e,t)}}!function(e){e.SEND="sendonly",e.RECV="recvonly",e.SENDRECV="sendrecv",e.INACTIVE="inactive"}(uw||(uw={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(dw||(dw={})),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY"}(hw||(hw={})),function(e){e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(pw||(pw={})),function(e){e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack"}(fw||(fw={})),function(e){e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected"}(mw||(mw={})),function(e){e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PPublish="RequestP2PPublish",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE"}(gw||(gw={})),function(e){e.MUTE_LOCAL_VIDEO="mute_local_video",e.MUTE_LOCAL_AUDIO="mute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.MUTE_REMOTE_VIDEO="mute_remote_video",e.MUTE_REMOTE_AUDIO="mute_remote_audio",e.UNMUTE_REMOTE_VIDEO="unmute_remote_video",e.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(_w||(_w={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(Ew||(Ew={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(vw||(vw={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(yw||(yw={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(bw||(bw={})),function(e){e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback"}(Sw||(Sw={})),function(e){e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.SECURITY_POLICY_VIOLATION="security-policy-violation"}(Tw||(Tw={})),function(e){e[e.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",e[e.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",e[e.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",e[e.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",e[e.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",e[e.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",e[e.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",e[e.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",e[e.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",e[e.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",e[e.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",e[e.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",e[e.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",e[e.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",e[e.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",e[e.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",e[e.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",e[e.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",e[e.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",e[e.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(ww||(ww={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(Cw||(Cw={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Rw||(Rw={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(Iw||(Iw={})),function(e){e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.UNSUBSCRIBE="unsubscribe",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.JOIN="join",e.EXCHANGE_SDP="exchange_sdp",e.DO_SUBSCRIBE="do_subscribe",e.DO_UNSUBSCRIBE="do_unsubscribe"}(Ow||(Ow={})),function(e){e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(Aw||(Aw={})),function(e){e[e.SUCCESS=1]="SUCCESS",e[e.FAILED=0]="FAILED"}(Nw||(Nw={}));const Dw={[hT.ACCESS_POINT]:{[mT.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[mT.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[mT.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[mT.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[mT.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[mT.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[mT.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[mT.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[mT.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[mT.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[mT.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[mT.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[mT.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[mT.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[mT.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[mT.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[mT.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[mT.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[hT.UNILBS]:{[fT.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[fT.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[fT.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[fT.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[fT.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[fT.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[fT.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[fT.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[fT.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[fT.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[fT.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[fT.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[hT.STRING_UID_ALLOCATOR]:{[pT.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[pT.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[pT.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Lw(e){const t=Dw[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===hT.ACCESS_POINT){const t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}const xw={[gT.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[gT.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[gT.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[gT.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[gT.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[gT.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[gT.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[gT.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[gT.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[gT.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[gT.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[gT.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[gT.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[gT.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[gT.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[gT.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[gT.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[gT.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[gT.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[gT.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[gT.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[gT.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[gT.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[gT.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[gT.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[gT.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[gT.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[gT.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[gT.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[gT.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[gT.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[gT.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[gT.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[gT.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[gT.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[gT.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[gT.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[gT.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[gT.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[gT.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[gT.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[gT.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[gT.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[gT.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[gT.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[gT.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[gT.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[gT.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[gT.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[gT.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[gT.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[gT.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[gT.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[gT.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[gT.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[gT.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[gT.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[gT.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[gT.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[gT.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[gT.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[gT.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[gT.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Mw(e){return xw[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function Uw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Uw(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Uw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function jw(e){return e.every((e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING))}function Vw(e,t){if("string"==typeof e)return e;const{proxy:n,host:r,port:i}=e;if(t){const e=LS("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(e,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const Bw=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Gw=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,qw=/wss:\/\/(.+):([0-9]+)\/?/,Ww=/wss:\/\/(.[^\/]+)\/?/;let zw=0;class Hw{constructor(e,t){rh(this,"id",0),rh(this,"store",void 0),rh(this,"recordIndex",void 0),rh(this,"websockets",[]),rh(this,"try443PortDuration",2e3),rh(this,"forceCloseWSDuration",5e3),rh(this,"try443PortTimeout",null),rh(this,"forceCloseTimeout",null),rh(this,"isTry443PortFailed",!1),rh(this,"isNormalPortFailed",!1),rh(this,"useDoubleDomain",!1),rh(this,"useProxy",!1),rh(this,"startTime",Date.now()),this.id=++zw,this.try443PortDuration=LS("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach((e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;const t=Date.now()-this.startTime;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];zS.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...r)}createWebSocket(e,t,n){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});const r=LS("GATEWAY_DOMAINS"),i=Date.now(),o=[],s=r.find((t=>{var n;return Di(n=e.host).call(n,t)}));s||(this.useDoubleDomain=!1);const a=[];if(this.useDoubleDomain)r.forEach((n=>{a.push(Vw(Fw(Fw({},e),{},{host:e.host.replace(s,n)}),t))}));else{const n=Fw({},e);if(t&&s){const e=r.find((e=>e!==s));e&&(n.host=n.host.replace(s,e))}a.push(Vw(n,t))}try{a.forEach((e=>{const t=new WebSocket(e);t.binaryType="arraybuffer",o.push(t),this.logger("ws is connecting:",t.url)}))}catch(r){if(this.logger("ws create failed"),o.forEach((e=>e.close())),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new UT(UE.WS_ERR,"init websocket failed! Error: ".concat(r.toString()))}const c=rE();return this.store&&this.store.recordJoinChannelService({urls:o.map((e=>e.url)),service:"gateway"},this.recordIndex),o.forEach((e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-i,"ms")),this.websockets.forEach((t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))})),this.websockets.length=0,c.resolve(e)},e.onclose=n=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-i,"ms state: ").concat(e.readyState)),t?this.isTry443PortFailed=jw(o):this.isNormalPortFailed=jw(o),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(t&&this.isTry443PortFailed||!t&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(n.reason)),c.reject({code:n.code,reason:tw.A_ROUND_WS_FAILED}))},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))})),this.websockets.push(...o),n||(()=>{const n=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.websockets.forEach((e=>e.readyState!==WebSocket.OPEN&&e.close()))};if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(n,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{if(this.logger("2s timeout, isWebsocket created: ",c.isResolved),c.isResolved)return n();pE().os===aE.MAC_OS&&bE()&&n(),this.createWebSocket(e,!0,!0).then((e=>c.resolve(e))).catch((e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout(n,this.forceCloseWSDuration)}),this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,n,r){return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e){let t,n,r;return[,t,n,r]=e.match(Bw)||[],t||([,n,r]=e.match(Gw)||[]),n&&r||([,n,r]=e.match(qw)||[]),n&&r||([,n]=e.match(Ww)||[]),n||zS.warning("un-destructible url: ",e),{proxy:t,host:n,port:r||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,n&&this.useProxy&&(zS.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally((()=>this.clearTimeout()))}}function Kw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class Yw extends nv{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Di(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(wT.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(wT.CONNECTED):"closed"===this._state?this.emit(wT.CLOSED):"failed"===this._state&&this.emit(wT.FAILED))}resetReconnectCount(e){zS.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),rh(this,"connectionID",0),rh(this,"currentURLIndex",0),rh(this,"urls",[]),rh(this,"_reconnectMode","tryNext"),rh(this,"reconnectReason",void 0),rh(this,"_initMutex",new Hv("websocket")),rh(this,"name",void 0),rh(this,"_state","closed"),rh(this,"reconnectInterrupter",void 0),rh(this,"websocket",void 0),rh(this,"retryConfig",void 0),rh(this,"reconnectCount",0),rh(this,"forceCloseTimeout",5e3),rh(this,"onlineReconnectListener",void 0),rh(this,"useCompress",void 0),rh(this,"tryDoubleDomain",!1),rh(this,"use443PortOnly",!1),rh(this,"wsInflateLength",0),rh(this,"wsDeflateLength",0),rh(this,"closeEstablishingWs",(()=>{})),rh(this,"store",void 0),rh(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kw(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this.useCompress=n,this.tryDoubleDomain=r,this.use443PortOnly=i;const{timeout:s,timeoutFactor:a}=t,c=Math.max(300,Math.floor(3*s/5)),l=Math.max(1.2,Math.floor(8*a)/10);dv.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l),bv.on(hv.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===dv.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=s,this.retryConfig.timeoutFactor=a))}))}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=await this._initMutex.lock();this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{const e=rE(),t=this.urls[this.currentURLIndex];this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(wT.CLOSED,(()=>{e.reject(new FE(UE.WS_DISCONNECT))})),this.once(wT.CONNECTED,e.resolve),await e.promise}catch(e){}finally{n()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const e=this.websocket;t?setTimeout((()=>e.close()),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void zS.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),zS.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new FE(UE.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new FE(UE.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;const n=rE();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),zS.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},i=async e=>{var t;if(zS.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new FE(UE.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const t=vv(this,wT.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,r=await this.reconnectWithAction(t);if("closed"===this.state)return void zS.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!r)return n.reject(new FE(UE.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);n.resolve()}},o=e=>{this.emit(wT.ON_MESSAGE,e)},s=e=>{zS.warn("[".concat(this.connectionID,"] ws open error ").concat(e))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),LS("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=LS("GATEWAY_WSS_ADDRESS")),zS.debug("[".concat(this.name,"] start connect, url:"),e);const a=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;const t=await this.chooseBestWebsocketConnection(e);this.websocket=t,r&&r(this.websocket.url),this.websocket.onclose=i,this.websocket.onmessage=o,this.websocket.onerror=s,null===(c=this.store)||void 0===c||c.recordJoinChannelService({endTs:Date.now(),status:"success"},a),this.joinGatewayRecordIndex=a}catch(e){const t="closed"===this.state,r=e instanceof FE,o=r&&e.code===UE.WS_ABORT,s=r&&e.code===UE.WS_ERR,c=r?e.message:e&&(e.reason||e.toString());zS.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(c)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:o?"aborted":"error",errors:[e]},a),t||s?(n.reject(t?new FE(UE.WS_DISCONNECT,"websocket is closed: ".concat(c)):new FE(UE.WS_ERR,"init websocket failed: ".concat(c))),s&&zS.error("[".concat(this.name,"] init websocket failed: ").concat(c))):i&&i(e)}return n.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(0===this.urls.length)return!1;if("closed"===this.state)return!1;zS.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||bv.isOnline||!bv.onlineWaiter||(this.onlineReconnectListener=bv.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let n=!0;if(this.reconnectInterrupter=()=>n=!1,t){const t=Zv(this.reconnectCount,this.retryConfig);zS.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await tE.race([Mv(t),this.onlineReconnectListener||new tE((()=>{}))])}if("closed"===this._state||!n)return!1;this.reconnectCount+=1;const r=async(e,t)=>{this.emit(wT.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)this.emit(wT.RECONNECT_WAITTING_FINISH,e),await r(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);zS.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(wT.RECONNECT_WAITTING_FINISH,e),await r(this.urls[this.currentURLIndex],e)}else"recover"===e&&(zS.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(wT.RECONNECT_WAITTING_FINISH,e),this.urls=await _v(this,wT.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(n){var i;zS.error("[".concat(this.name,"] reconnect failed ").concat(n&&n.toString()));const r=null==n||null===(i=n.data)||void 0===i?void 0:i.desc;return Array.isArray(r)&&Di(r).call(r,"dynamic key expired")?(this.emit(wT.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class Zw extends Yw{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){const n=rE(),r=function(e,t){return new Hw(e,t)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{zS.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),n.reject(new FE(UE.WS_ABORT,"choose best websocket aborted"))};const i=LS("GATEWAY_DOMAINS");return zS.debug("[choose-best-ws] currentDomain: ",e,", domains: ",i,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(n.resolve).catch(n.reject),n.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class Jw extends Yw{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new tE(((n,r)=>{let i=!1;const o=[];this.closeEstablishingWs=()=>{zS.debug("[choose-best-ws] close establishing websockets"),o.forEach((e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()})),r(new FE(UE.WS_ABORT,"choose best websocket aborted"))};const s=LS("GATEWAY_DOMAINS");let a;const c=e.indexOf("?h="),l=s.find((t=>-1!==c?Di(e).call(e,t,c):Di(e).call(e,t)));zS.debug("[choose-best-ws] currentDomain: ",l,", domains: ",s);let u=!this.tryDoubleDomain||!l;if(!u&&l){var d;const h=Date.now();try{s.forEach((t=>{const n=-1===c?e.replace(l,t):e.substr(0,c)+e.substr(c).replace(l,t),r=new WebSocket(n);r.binaryType="arraybuffer",o.push(r),zS.debug("[choose-best-ws] ws is connecting:",r.url)}))}catch(e){for(zS.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach((e=>e.close()));o.length;)o.pop();u=!0}null===(d=this.store)||void 0===d||d.recordJoinChannelService({urls:o.map((e=>e.url)),service:"gateway"},t),o.forEach((e=>{e.onopen=()=>{if(i)return;const t=Date.now()-h;zS.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),o.filter((t=>t!==e)).forEach((e=>{zS.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()})),i=!0,n(e)},e.onclose=e=>{a=e,i||o.find((e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)))||(zS.debug("[choose-best-ws] all websocket is closed"),i=!0,r(a))},e.onmessage=t=>{zS.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}})),Mv(this.forceCloseTimeout).then((()=>{o.forEach((e=>{e.readyState!==WebSocket.OPEN&&e.close()}))}))}if(u){var h;let i;zS.debug("[choose-best-ws] use single url: ",e),null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:[e],service:"gateway"},t);try{i=new WebSocket(e),o.push(i),i.binaryType="arraybuffer"}catch(e){const n=new FE(UE.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return zS.error("[".concat(this.name,"]").concat(n)),void r(n)}i.onopen=()=>{n(i)},i.onclose=e=>{r(e)},i.onmessage=e=>{zS.debug("[choose-best-ws]".concat(i.url," onmessage: ").concat(e.data))},Mv(this.forceCloseTimeout).then((()=>{i&&i.readyState!==WebSocket.OPEN&&i.close()}))}})).then((e=>(this.closeEstablishingWs=void 0,e))).catch((e=>{throw this.closeEstablishingWs=void 0,e}))}}class Xw extends nv{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===_T.CONNECTED?this.emit(ET.WS_CONNECTED):e===_T.RECONNECTING?this.emit(ET.WS_RECONNECTING,this._websocketReconnectReason):e===_T.CLOSED&&this.emit(ET.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),rh(this,"_disconnectedReason",void 0),rh(this,"_websocketReconnectReason",void 0),rh(this,"_connectionState",_T.CLOSED),rh(this,"reconnectToken",void 0),rh(this,"websocket",void 0),rh(this,"openConnectionTime",void 0),rh(this,"clientId",void 0),rh(this,"lastMsgTime",Date.now()),rh(this,"uploadCache",[]),rh(this,"uploadCacheInterval",void 0),rh(this,"rttRolling",new ly(5)),rh(this,"pingpongTimer",void 0),rh(this,"wsInflateDataTimer",void 0),rh(this,"pingpongTimeoutCount",0),rh(this,"joinResponse",void 0),rh(this,"multiIpOption",void 0),rh(this,"initError",void 0),rh(this,"spec",void 0),rh(this,"store",void 0),rh(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(ET.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===bT.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===bT.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(cv.UID_BANNED);break;case 15:this.close(cv.IP_BANNED);break;case 16:this.close(cv.CHANNEL_BANNED)}if(t._type===bT.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case gT.ERR_LICENSE_MISSING:this.close(cv.LICENSE_MISSING);break;case gT.ERR_LICENSE_EXPIRED:this.close(cv.LICENSE_EXPIRED);break;case gT.ERR_LICENSE_MINUTES_EXCEEDED:this.close(cv.LICENSE_MINUTES_EXCEEDED);break;case gT.ERR_LICENSE_PERIOD_INVALID:this.close(cv.LICENSE_PERIOD_INVALID);break;case gT.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(cv.LICENSE_MULTIPLE_SDK_SERVICE);break;case gT.ERR_LICENSE_ILLEGAL:this.close(cv.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Zw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,LS("JOIN_GATEWAY_USE_DUAL_DOMAIN"),LS("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===_T.CONNECTED&&this.reconnect("retry",uv.OFFLINE)}))}async request(e,t,n,r){const i=Uv(6,""),o={_id:i,_type:e,_message:t},s=this.websocket.connectionID,a=()=>new tE(((t,n)=>{if(this.connectionState===_T.CONNECTED)return t();const r=()=>{this.off(ET.WS_CLOSED,i),t()},i=()=>{this.off(ET.WS_CONNECTED,r),n(new UT(UE.WS_ABORT))};this.once(ET.WS_CONNECTED,r),this.once(ET.WS_CLOSED,i),e!==vT.PUBLISH&&e!==vT.SUBSCRIBE&&e!==vT.UNSUBSCRIBE&&e!==vT.UNPUBLISH&&e!==vT.CONTROL&&e!==vT.RESTART_ICE||this.once(ET.DISCONNECT_P2P,(()=>{n(new UT(UE.DISCONNECT_P2P))})),e!==vT.PUBLISH&&e!==vT.RESTART_ICE||this.once(ET.ABORT_P2P_EXECUTION,(()=>{n(new UT(UE.DISCONNECT_P2P))}))}));if(this.connectionState!==_T.CONNECTING&&this.connectionState!==_T.RECONNECTING||e===vT.JOIN||e===vT.REJOIN||await a(),this.websocket.sendMessage(o,!0),r)return;const c=new tE(((n,r)=>{let o=!1;const a=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(ET.WS_CLOSED,c),this.off(ET.WS_RECONNECTING,c),this.emit(ET.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),a);const c=()=>{r(new UT(UE.WS_ABORT,"type: ".concat(e))),this.off(ET.WS_CLOSED,c),this.off(ET.WS_RECONNECTING,c),this.off("res-@".concat(i),a)};this.once(ET.WS_CLOSED,c),this.once(ET.WS_RECONNECTING,c),Mv(LS("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==s||o||(zS.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(ET.REQUEST_TIMEOUT,e,t))}))}));let l=null;try{l=await c}catch(r){if(this.connectionState===_T.CLOSED||e===vT.LEAVE)throw new UT(UE.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===vT.JOIN||e===vT.REJOIN?null:(await a(),await this.request(e,t))}if(l.isSuccess)return l.message;const u=Number(l.message.error_code||l.message.code),d=Mw(u),h=new UT(UE.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(l.message.error_str),{code:u,data:l.message});return"success"===d.action?l.message:(zS.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(u,", message: ").concat(d.desc,", action: ").concat(d.action)),u===gT.ERR_TOO_MANY_BROADCASTERS?e===vT.JOIN||e===vT.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(u===gT.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,zS.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",uv.MULTI_IP)):this.reconnect(d.action,uv.SERVER_ERROR),e===vT.JOIN||e===vT.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new tE((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=LS("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==_T.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),LS("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new tE(((t,n)=>{this.once(ET.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(ET.WS_CLOSED,(()=>n(this.initError||new UT(UE.WS_ABORT)))),this.connectionState=_T.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||cv.LEAVE,this.connectionState=_T.CLOSED,zS.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===cv.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Zw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,LS("JOIN_GATEWAY_USE_DUAL_DOMAIN"),LS("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(ET.ABORT_P2P_EXECUTION);const e=await _v(this,ET.REQUEST_JOIN_INFO),t=await this.request(vT.JOIN,e);if(!t)return this.emit(ET.REPORT_JOIN_GATEWAY,tw.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(ET.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=_T.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new UT(UE.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=yv(this,ET.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(vT.REJOIN,e);return!!t&&(this.connectionState=_T.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(bT.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(bT.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(bT.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(bT.MUTE_AUDIO,{uid:e.uid}):this.emit(bT.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(bT.MUTE_VIDEO,{uid:e.uid}):this.emit(bT.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(bT.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(bT.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(bT.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(bT.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(bT.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){zS.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Mw(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(cv.UID_BANNED),void this.close()):void this.reconnect(t.action,uv.SERVER_ERROR);zS.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=LS("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(zS.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>LS("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",uv.TIMEOUT):this.request(vT.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),LS("REPORT_STATS")&&this.send(vT.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(yT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(wT.RECONNECT_WAITTING_FINISH,(e=>{this.emit(ET.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(wT.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(ET.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(wT.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(wT.CLOSED,(()=>{this.connectionState=_T.CLOSED})),this.websocket.on(wT.FAILED,(()=>{this._disconnectedReason=cv.NETWORK_ERROR,this.connectionState=_T.CLOSED})),this.websocket.on(wT.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===_T.CONNECTED?this.connectionState=_T.RECONNECTING:this.connectionState=_T.CONNECTING})),this.websocket.on(wT.WILL_RECONNECT,((e,t,n)=>{const r=yv(this,ET.IS_P2P_DISCONNECTED),i=r||"retry"!==e;r&&"retry"===e&&(zS.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=tw.P2P_DISCONNECTED),i&&(zS.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(ET.REPORT_JOIN_GATEWAY,t||tw.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ET.NEED_RENEW_SESSION),this.emit(ET.DISCONNECT_P2P)),n(e)})),this.websocket.on(wT.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{zS.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",uv.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(ET.REPORT_JOIN_GATEWAY,e.message||e.code||tw.UNKNOWN_REASON,this.url||""),e instanceof UT&&e.code===UE.UNEXPECTED_RESPONSE&&e.data.code===gT.ERR_NO_AUTHORIZED)return zS.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",uv.SERVER_ERROR);zS.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",uv.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(wT.REQUEST_NEW_URLS,((e,t)=>{_v(this,ET.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(wT.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(bT.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}var Qw="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",$w=tt,eC=vi,tC=Qw,nC=me("".replace),rC=RegExp("^["+tC+"]+"),iC=RegExp("(^|[^"+tC+"])["+tC+"]+$"),oC=function(e){return function(t){var n=eC($w(t));return 1&e&&(n=nC(n,rC,"")),2&e&&(n=nC(n,iC,"$1")),n}},sC={start:oC(1),end:oC(2),trim:oC(3)},aC=Zl.PROPER,cC=le,lC=Qw,uC=sC.trim;xr({target:"String",proto:!0,forced:function(e){return cC((function(){return!!lC[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||aC&&lC[e].name!==e}))}("trim")},{trim:function(){return uC(this)}});var dC,hC,pC=ti("String").trim,fC=ge,mC=pC,gC=String.prototype,_C=Z((function(e){var t=e.trim;return"string"==typeof e||e===gC||fC(gC,e)&&t===gC.trim?mC:t}));function EC(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function vC(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function yC(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function bC(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}!function(e){e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"}(dC||(dC={})),function(e){e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change"}(hC||(hC={}));const SC={"90p":vC(160,90),"90p_1":vC(160,90),"120p":vC(160,120,15,30,65),"120p_1":vC(160,120,15,30,65),"120p_3":vC(120,120,15,30,50),"120p_4":vC(212,120),"180p":vC(320,180,15,30,140),"180p_1":vC(320,180,15,30,140),"180p_3":vC(180,180,15,30,100),"180p_4":vC(240,180,15,30,120),"240p":vC(320,240,15,40,200),"240p_1":vC(320,240,15,40,200),"240p_3":vC(240,240,15,40,140),"240p_4":vC(424,240,15,40,220),"360p":vC(640,360,15,80,400),"360p_1":vC(640,360,15,80,400),"360p_3":vC(360,360,15,80,260),"360p_4":vC(640,360,30,80,600),"360p_6":vC(360,360,30,80,400),"360p_7":vC(480,360,15,80,320),"360p_8":vC(480,360,30,80,490),"360p_9":vC(640,360,15,80,800),"360p_10":vC(640,360,24,80,800),"360p_11":vC(640,360,24,80,1e3),"480p":vC(640,480,15,100,500),"480p_1":vC(640,480,15,100,500),"480p_2":vC(640,480,30,100,1e3),"480p_3":vC(480,480,15,100,400),"480p_4":vC(640,480,30,100,750),"480p_6":vC(480,480,30,100,600),"480p_8":vC(848,480,15,100,610),"480p_9":vC(848,480,30,100,930),"480p_10":vC(640,480,10,100,400),"720p":vC(1280,720,15,120,1130),"720p_auto":vC(1280,720,30,900,3e3),"720p_1":vC(1280,720,15,120,1130),"720p_2":vC(1280,720,30,120,2e3),"720p_3":vC(1280,720,30,120,1710),"720p_5":vC(960,720,15,120,910),"720p_6":vC(960,720,30,120,1380),"1080p":vC(1920,1080,15,120,2080),"1080p_1":vC(1920,1080,15,120,2080),"1080p_2":vC(1920,1080,30,120,3e3),"1080p_3":vC(1920,1080,30,120,3150),"1080p_5":vC(1920,1080,60,120,4780),"1440p":vC(2560,1440,30,120,4850),"1440p_1":vC(2560,1440,30,120,4850),"1440p_2":vC(2560,1440,60,120,7350),"4k":vC(3840,2160,30,120,8910),"4k_1":vC(3840,2160,30,120,8910),"4k_3":vC(3840,2160,60,120,13500)},TC=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],wC={"480p":yC(640,480,5),"480p_1":yC(640,480,5),"480p_2":yC(640,480,30),"480p_3":yC(640,480,15),"720p":yC(1280,720,5),"720p_auto":vC(1280,720,30,900,3e3),"720p_1":yC(1280,720,5),"720p_2":yC(1280,720,30),"720p_3":yC(1280,720,15),"1080p":yC(1920,1080,5),"1080p_1":yC(1920,1080,5),"1080p_2":yC(1920,1080,30),"1080p_3":yC(1920,1080,15)},CC={"1SL1TL":bC(1,1),"3SL3TL":bC(3,3),"2SL3TL":bC(2,3)};function RC(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},SC[e]):e}function IC(e){return"string"==typeof e?Object.assign({},wC[e]):e}function OC(e){return"string"==typeof e?Object.assign({},CC[e]):e}const AC={speech_low_quality:EC(16e3,!1),speech_standard:EC(32e3,!1,18),music_standard:EC(48e3,!1),standard_stereo:EC(48e3,!0,56),high_quality:EC(48e3,!1,128),high_quality_stereo:EC(48e3,!0,192)};function NC(e){return"string"==typeof e?Object.assign({},AC[e]):e}const kC=[];function PC(e){return VE(e,"mediaSource",["screen","window","application"]),!0}var DC,LC,xC,MC,UC,FC,jC,VC,BC,GC;!function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track"}(DC||(DC={})),function(e){e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream"}(LC||(LC={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(xC||(xC={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(MC||(MC={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY"}(UC||(UC={})),function(e){e.TRANSCEIVER_UPDATED="transceiver-updated"}(FC||(FC={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed"}(jC||(jC={})),function(e){e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(VC||(VC={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source"}(BC||(BC={})),function(e){e.UPDATE_TRACK_SOURCE="update-track-source"}(GC||(GC={}));const qC={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},WC={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},zC={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},HC={uplinkNetworkQuality:0,downlinkNetworkQuality:0},KC={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var YC,ZC,JC,XC,QC;!function(e){e.ON_TRACK="on_track",e.ON_NODE="on_node"}(YC||(YC={})),function(e){e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints"}(ZC||(ZC={})),function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(JC||(JC={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(XC||(XC={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata"}(QC||(QC={}));const $C={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var eR;!function(e){e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error"}(eR||(eR={}));class tR extends nv{constructor(e,t){super(),rh(this,"_ID",void 0),rh(this,"_rtpTransceiver",void 0),rh(this,"_lowRtpTransceiver",void 0),rh(this,"_hints",[]),rh(this,"_isClosed",!1),rh(this,"_originMediaStreamTrack",void 0),rh(this,"_mediaStreamTrack",void 0),rh(this,"_external",{}),this._ID=t||Uv(8,"track-"),this._originMediaStreamTrack=e,this._mediaStreamTrack=e,function(e){Di(kC).call(kC,e)||kC.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){if(!e){const e=iT.reportApiInvoke(null,{name:ov.GET_MEDIA_STREAM_TRACK,options:[],tag:sv.TRACER});this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?e.onSuccess(this._mediaStreamTrack.label):e.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===xC.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=kC.indexOf(e);-1!==t&&kC.splice(t,1)}(this),this.emit(jC.CLOSED)}_updateRtpTransceiver(e,t){if(t===xC.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(FC.TRANSCEIVER_UPDATED,e,t)}}class nR extends tR{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}constructor(e,t){super(e,t),rh(this,"_enabled",!0),rh(this,"_muted",!1),rh(this,"_isExternalTrack",!1),rh(this,"_isClosed",!1),rh(this,"_enabledMutex",void 0),rh(this,"processor",void 0),rh(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new Hv("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,zS.debug("[".concat(this.getTrackId(),"] close")),this.emit(DC.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ev(this,DC.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){zS.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(jC.TRACK_ENDED)}stateCheck(e,t){if(zS.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),jE(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new FE(UE.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",zS);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new FE(UE.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",zS)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function rR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const iR=window.AudioContext||window.webkitAudioContext;let oR=null;const sR=new class extends nv{constructor(){super(...arguments),rh(this,"prevState",void 0),rh(this,"curState",void 0),rh(this,"currentTime",void 0),rh(this,"currentTimeStuckAt",void 0),rh(this,"interruptDetectorTrack",void 0),rh(this,"onLocalAudioTrackMute",(()=>{zS.info("ios15-interruption-start"),this.emit(hC.IOS_15_16_INTERRUPTION_START)})),rh(this,"onLocalAudioTrackUnmute",(async()=>{zS.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?zS.info("ios15-interruption-end-canceled"):(oR&&await oR.suspend(),this.emit(hC.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){zS.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){zS.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function aR(){if(!iR)return void zS.error("your browser is not support web audio");zS.info("create audio context");const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rR(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},LS("WEBAUDIO_INIT_OPTIONS"));zS.debug("audio context init option:",JSON.stringify(e)),oR=new iR(e),sR.curState=oR.state,oR.onstatechange=()=>{sR.prevState=sR.curState,sR.curState=oR?oR.state:void 0;const{prevState:e,curState:t}=sR,n="running"===t,r="interrupted"===t,i="running"===e,o="suspended"===e,s="interrupted"===e,a=pE().osVersion;(SE()||kE())&&i&&r&&(zS.info("ios".concat(a,"-interruption-start")),sR.emit(hC.IOS_INTERRUPTION_START)),(SE()||kE())&&(o||s)&&n&&(zS.info("ios".concat(a,"-interruption-end")),sR.emit(hC.IOS_INTERRUPTION_END)),e!==t&&(zS.debug("AudioContext State Change","".concat(e,"=>").concat(t)),sR.emit(hC.STATE_CHANGE))},setInterval((()=>{var e;const t=null===(e=oR)||void 0===e?void 0:e.currentTime;sR.currentTime!==t?(sR.currentTimeStuckAt&&(zS.debug("AudioContext current time resume at ".concat(t)),sR.currentTimeStuckAt=void 0),sR.currentTime=t):(t!==sR.currentTimeStuckAt&&(iT.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:sv.TRACER}).onSuccess(),zS.warning("AudioContext current time stuck at ".concat(t))),sR.currentTimeStuckAt=t)}),5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,r=!1,i=!1,o=!1;function s(t){"running"===e.state?a(!1):SE()||kE()?"suspended"===e.state&&(a(!0),t&&e.resume().then(l,l)):"closed"!==e.state&&(a(!0),t&&e.resume().then(l,l))}function a(e){if(r!==e){r=e;for(let n=0,r=t;n<r.length;n+=1){const t=r[n];e?window.addEventListener(t,u,{capture:!0,passive:!0}):window.removeEventListener(t,u,{capture:!0,passive:!0})}}}function c(){s(!0)}function l(){s(!1)}function u(){s(!0)}function d(e){if(!o)if(n.paused)if(e){let t;h(!1),o=!0;try{t=n.play(),t?t.then(p,p):(n.addEventListener("playing",p),n.addEventListener("abort",p),n.addEventListener("error",p))}catch(e){p()}}else h(!0);else h(!1)}function h(e){if(i!==e){i=e;for(let n=0,r=t;n<r.length;n++){const t=r[n];e?window.addEventListener(t,f,{capture:!0,passive:!0}):window.removeEventListener(t,f,{capture:!0,passive:!0})}}}function p(){n.removeEventListener("playing",p),n.removeEventListener("abort",p),n.removeEventListener("error",p),o=!1,d(!1)}function f(){d(!0)}if(SE()){const t=e.createMediaStreamDestination(),r=document.createElement("div");r.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=r.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=t.stream,d(!0)}sR.on(hC.STATE_CHANGE,c),s(!1)}(oR)}function cR(){if(!oR){if(aR(),!oR)throw new FE(UE.NOT_SUPPORTED,"can not create audio context");return oR}return oR}function lR(){return!!oR}function uR(e){if(function(){if(null!==dR)return dR;const e=cR(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);let i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),dR=i,i}())return;const t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>{var o;return e._inputNodes||(e._inputNodes=[]),Di(o=e._inputNodes).call(o,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=(r,i,o)=>{n.call(e),r?wv(e._inputNodes,r):e._inputNodes=[];for(const n of e._inputNodes)t.call(e,n)}}let dR=null;function hR(e,t){let n=!1;const r=1/t;if(LS("DISABLE_WEBAUDIO")){const t=window.setInterval((()=>{n?window.clearInterval(t):e(performance.now()/1e3)}),1e3*r)}else{const t=cR();let i=t.createGain();i.gain.value=0,i.connect(t.destination);const o=()=>{if(n)return void(i=null);const s=t.createOscillator();s.onended=o,s.connect(i),s.start(0),s.stop(t.currentTime+r),e(t.currentTime)};o()}return()=>{n=!0}}const pR={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function fR(){return pR}class mR{constructor(){rh(this,"context",void 0),rh(this,"analyserNode",void 0),rh(this,"sourceNode",void 0),this.context=cR(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||SE()||kE()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}const t=cy(e).call(e,((e,t)=>e+t*t),0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){zS.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class gR extends nv{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),rh(this,"outputNode",void 0),rh(this,"outputTrack",void 0),rh(this,"isPlayed",!1),rh(this,"context",void 0),rh(this,"audioBufferNode",void 0),rh(this,"destNode",void 0),rh(this,"audioOutputLevel",0),rh(this,"volumeLevelAnalyser",void 0),rh(this,"_processedNode",void 0),rh(this,"playNode",void 0),rh(this,"isDestroyed",!1),rh(this,"onNoAudioInput",void 0),rh(this,"isNoAudioInput",!1),rh(this,"_noAudioInputCount",0),this.context=cR(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),uR(this.outputNode),this.volumeLevelAnalyser=new mR}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(BC.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){const n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!fR().webAudioMediaStreamDest)throw new FE(UE.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&Rv((()=>{sR.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;SE()||kE()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let n;t.getFloatTimeDomainData?(n=new Float32Array(t.fftSize),t.getFloatTimeDomainData(n)):(n=new Uint8Array(t.fftSize),t.getByteTimeDomainData(n));let r=!1;for(let i=0;i<n.length;i++)0!==n[i]&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await Mv(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class _R extends gR{get isFreeze(){return!1}constructor(e,t,n){var r;if(super(),rh(this,"sourceNode",void 0),rh(this,"track",void 0),rh(this,"clonedTrack",void 0),rh(this,"audioElement",void 0),rh(this,"isCurrentTrackCloned",!1),rh(this,"isRemoteTrack",!1),rh(this,"originVolumeLevelAnalyser",void 0),rh(this,"rebuildWebAudio",(async()=>{if(zS.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void zS.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>zS.info("resume success"))),zS.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;const t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),uR(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),uR(this.outputNode),this.emit(BC.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),"audio"!==e.kind)throw new FE(UE.UNEXPECTED_ERROR);this.track=e;const i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),uR(this.sourceNode),n){const e=n.clone();e.enabled=!0,this.clonedTrack=e,zS.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));const t=this.context.createMediaStreamSource(new MediaStream([e]));uR(t),this.originVolumeLevelAnalyser=new mR,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;const o=pE();t&&o.os===aE.IOS&&Number(null===(r=o.osVersion)||void 0===r?void 0:r.split(".")[0])<15&&(sR.on(hC.STATE_CHANGE,(()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),uR(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(BC.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),sR.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),zS.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([t]));uR(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function ER(e,t,n){const r=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function vR(e,t){const n=await yR(e.mediaSource),{sourceId:r,audio:i}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new tE(((n,r)=>{const i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const o=document.createElement("div");o.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const s=document.createElement("div");s.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",s.setAttribute("style","height: 12%;");const a=document.createElement("div");a.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const l=document.createElement("button");l.innerHTML="cancel",l.setAttribute("style","width: 85px;"),l.onclick=()=>{document.body.removeChild(h);const e=new Error("NotAllowedError");e.name="NotAllowedError",r(e)};let u=t;const d=document.createElement("div");if(t){const e=document.createElement("input");e.setAttribute("type","checkbox");const t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=u,e.onchange=()=>{u=e.checked},d.appendChild(e),d.appendChild(t)}c.appendChild(d),c.appendChild(l),o.appendChild(s),o.appendChild(a),o.appendChild(c);const h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(i),h.appendChild(o),document.body.appendChild(h),e.map((e=>{if(e.id){const t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let r=e.thumbnail;try{const{width:e}=r.getSize();e>1920&&(r=r.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",t.onclick=()=>{document.body.removeChild(h),n({sourceId:e.id,audio:u})},a.appendChild(t)}}))}))}(n,t);return await ER(r,e,i)}async function yR(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const n=iv();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new FE(UE.ELECTRON_IS_NULL);let r=null;try{var i;r=(null===(i=n.desktopCapturer)||void 0===i?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){r=null}r&&r.then||(r=new tE(((e,r)=>{n.desktopCapturer.getSources({types:t},((t,n)=>{t?r(t):e(n)}))})));try{return await r}catch(e){throw new FE(UE.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}function bR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const SR=new Hv("safari");let TR=!1,wR=!1;async function CR(e,t){let n=0,r=null;for(;n<2;)try{r=await RR(e,t,n>0);break}catch(e){if(e instanceof FE)throw zS.error("[".concat(t,"] ").concat(e.toString())),e;const r=IR(e.name||e.code||e,e.message);if(r.code===UE.MEDIA_OPTION_INVALID){zS.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Mv(500);continue}throw zS.error("[".concat(t,"] ").concat(r.toString())),r}if(!r)throw new FE(UE.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function RR(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new FE(UE.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=fR(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return zS.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(iv())e.screen.sourceId?OR(i,await ER(e.screen.sourceId,e.screen,e.screenAudio)):OR(i,await vR(e.screen,e.screenAudio));else if(vE()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new FE(UE.NOT_SUPPORTED,"This browser does not support screen sharing");zS.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const n=await(s=e.screen.extensionId,a=t,new tE(((e,t)=>{try{chrome.runtime.sendMessage(s,{getStream:!0},(n=>{if(!n||!n.streamId)return zS.error("[".concat(a,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new FE(UE.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)}))}catch(e){zS.error("[".concat(a,"] AgoraRTC screensharing plugin is not accessible(").concat(s,")"),e.toString()),t(new FE(UE.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=n,OR(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var o;e.screen.mediaSource&&PC(e.screen.mediaSource);const n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(o=e.screen.displaySurface)&&void 0!==o?o:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:r,surfaceSwitching:s,systemAudio:a}=e.screen,c={selfBrowserSurface:r,surfaceSwitching:s,systemAudio:a};!r&&delete c.selfBrowserSurface,!s&&delete c.surfaceSwitching,!a&&delete c.systemAudio,zS.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:!!e.screenAudio,controls:c}));const l=await navigator.mediaDevices.getDisplayMedia(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bR(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({video:n,audio:!!e.screenAudio},c));OR(i,l)}else{if(!bE())throw zS.error("[".concat(t,"] This browser does not support screenSharing")),new FE(UE.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&PC(e.screen.mediaSource);const n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};zS.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),OR(i,await navigator.mediaDevices.getUserMedia(n))}}var s,a;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},l=LS("MEDIA_DEVICE_CONSTRAINTS");if(l)try{"string"==typeof l&&(l=JSON.parse(l)),c=qv(c,l)}catch(e){}zS.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),pE();let u,d=null;(yE()||SE()||gE())&&(d=await SR.lock());try{u=await navigator.mediaDevices.getUserMedia(c)}catch(e){throw d&&d(),e}return c.audio&&(TR=!0),c.video&&(wR=!0),OR(i,u),d&&d(),i}function IR(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new FE(UE.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new FE(UE.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new FE(UE.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new FE(UE.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new FE(UE.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new FE(UE.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return zS.error("getUserMedia unexpected error",e),new FE(UE.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function OR(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(r&&e.removeTrack(r),e.addTrack(o)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const AR=new class extends nv{get state(){return this._state}set state(e){e!==this._state&&(this.emit(XC.STATE_CHANGE,e),this._state=e)}constructor(){super(),rh(this,"_state",JC.IDLE),rh(this,"isAccessMicrophonePermission",!1),rh(this,"isAccessCameraPermission",!1),rh(this,"lastAccessMicrophonePermission",!1),rh(this,"lastAccessCameraPermission",!1),rh(this,"checkdeviceMatched",!1),rh(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(LS("ENUMERATE_DEVICES_INTERVAL")||(xE()||fE()===aE.HARMONY_OS)&&LE())&&this.updateDevicesInfo()}),LS("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>zS.error(e.toString())))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new FE(UE.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let o=!this.isAccessMicrophonePermission&&e,s=!this.isAccessCameraPermission&&t;i.audio&&(o=!1),i.video&&(s=!1);let a=null,c=null,l=null;if(!n&&(o||s)){if(SR.isLocked&&(zS.debug("[device manager] wait GUM lock"),(await SR.lock())(),zS.debug("[device manager] GUM unlock")),TR&&(o=!1,this.isAccessMicrophonePermission=!0),wR&&(s=!1,this.isAccessCameraPermission=!0),zS.debug("[device manager] check media device permissions",e,t,o,s),o&&s){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){const t=IR(e.name||e.code||e,e.message);if(t.code===UE.PERMISSION_DENIED)throw t;zS.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{a=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){const t=IR(e.name||e.code||e,e.message);if(t.code===UE.PERMISSION_DENIED)throw t;zS.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){const t=IR(e.name||e.code||e,e.message);if(t.code===UE.PERMISSION_DENIED)throw t;zS.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}zS.debug("[device manager] mic permission",e,"cam permission",t)}try{const e=await navigator.mediaDevices.enumerateDevices();return a&&a.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),l&&l.getTracks().forEach((e=>e.stop())),a=null,c=null,l=null,e}catch(e){return a&&a.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),l&&l.getTracks().forEach((e=>e.stop())),a=null,c=null,l=null,new FE(UE.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audioinput"===e.kind))}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((e=>"videoinput"===e.kind))}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audiooutput"===e.kind))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((n=>{n.device.label===e&&(t=n.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((t=>t.deviceId===e));if(!t)throw new FE(UE.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=JC.INITING;try{await this.updateDevicesInfo(),this.state=JC.INITEND}catch(e){throw zS.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=JC.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new FE(UE.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const t=e.find((e=>"audioinput"===e.kind&&"default"===e.deviceId)),n=e.find((e=>"audiooutput"===e.kind&&"default"===e.deviceId));t&&n?n.groupId===t.groupId?zS.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):zS.warning("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):zS.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((e=>{if(!e.deviceId)return;const r=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(r?r.state:"INACTIVE")){const r={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),r),n.push(r)}r&&(r.updateAt=t)})),this.deviceInfoMap.forEach(((e,r)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))})),this.state!==JC.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(XC.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(XC.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(XC.PLAYOUT_DEVICE_CHANGED,e)}})),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((e=>"audioinput"===e.kind)),n=e.filter((e=>"videoinput"===e.kind)),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let NR=!1;const kR=new class extends nv{constructor(){super(...arguments),rh(this,"onAutoplayFailed",void 0),rh(this,"onAudioAutoplayFailed",void 0)}};function PR(){if(pE(),!NR){const e=t=>{t.preventDefault(),NR=!1,ME()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};NR=!0,ME()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),zS.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),kR.onAutoplayFailed?kR.onAutoplayFailed():kR.onAudioAutoplayFailed?zS.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):zS.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),kR.emit("autoplay-failed")}}function DR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function LR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?DR(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xR(e,t,n,r){if(!e)return;const i=iT.getBaseInfoBySessionId(e);if(!i)return;const o=i.info,s=Date.now(),a=LR(LR({},o),{},{vid:void 0===o.vid?0:Number(o.vid),lts:s,elapse:s-i.startTime,cbRegistered:kR.onAutoplayFailed||kR.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});iT.send({type:XS.AUTOPLAY_FAILED,data:a},!0)}const MR=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],UR=new class{constructor(){rh(this,"onAutoplayFailed",void 0),rh(this,"elementMap",new Map),rh(this,"elementStateMap",new Map),rh(this,"elementsNeedToResume",[]),rh(this,"sinkIdMap",new Map),rh(this,"autoResumeAfterInterruption",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const r=this.elementStateMap.get(t),i=n.srcObject.getAudioTracks()[0];OE()?i&&"live"===i.readyState&&"running"===sR.curState&&(zS.debug("auto resume after interruption for iOS 15"),n.pause(),n.play()):r&&"paused"===r&&i&&"live"===i.readyState&&"running"===sR.curState&&(zS.debug("auto resume after interruption for iOS"),n.play())}))})),rh(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(zS.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),sR.on(hC.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),sR.on(hC.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),sR.on(hC.STATE_CHANGE,(()=>{SE()&&"suspended"===sR.prevState&&"running"===sR.curState&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(e){throw new FE(UE.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,QC.INIT),this.setVolume(t,n);const o=this.sinkIdMap.get(t);if(o)try{i.setSinkId(o).catch((e=>{zS.warning("[".concat(t,"] set sink id failed"),e.toString())}))}catch(e){zS.warning("[".concat(t,"] set sink id failed"),e.toString())}const s=i.play();s&&s.then&&s.catch((e=>{r&&xR(r,"audio",e.message,t),zS.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(zS.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),Rv((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),PR()})))}))}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){MR.forEach((n=>{t.addEventListener(n,(n=>{const r=this.elementStateMap.get(e),i="pause"===n.type?"paused":n.type;if(zS.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(i)),"error"===n.type){const n=null==t?void 0:t.error;n&&zS.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,i)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((e=>{e.play().then((e=>{zS.debug("Auto resume audio element success")})).catch((e=>{zS.warning("Auto resume audio element failed!",e)}))})),this.elementsNeedToResume=[]};new tE((e=>{document.body?e():window.addEventListener("load",(()=>e()))})).then((()=>{ME()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function FR(){return function(e,t,n){const r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new FE(UE.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",zS);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=r.apply(this,t);return i instanceof tE?new tE(((e,t)=>{i.then(e).catch(t)})):i}),n}}function jR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function VR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jR(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class BR extends nv{constructor(e){super(),rh(this,"name","VideoProcessorDestination"),rh(this,"ID","0"),rh(this,"_source",void 0),rh(this,"videoContext",void 0),rh(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new FE(UE.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new FE(UE.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(YC.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(YC.ON_TRACK,void 0)}}class GR extends nv{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),rh(this,"constraintsMap",new Map),rh(this,"statsRegistry",[]),rh(this,"usageRegistry",[]),rh(this,"trackId",void 0),rh(this,"direction",void 0),rh(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await _v(this,ZC.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return zS.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),Ev(this,ZC.REQUEST_UPDATE_CONSTRAINTS,Array.from(LT(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return zS.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Ev(this,ZC.REQUEST_UPDATE_CONSTRAINTS,Array.from(LT(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){zS.error(new FE(UE.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof tE&&(n=await n),e.push(VR(VR({},n),{},{direction:this.direction}))}catch(e){zS.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class qR extends nv{constructor(e){super(),rh(this,"name","AudioProcessorDestination"),rh(this,"ID","0"),rh(this,"inputTrack",void 0),rh(this,"inputNode",void 0),rh(this,"audioProcessorContext",void 0),rh(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new FE(UE.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new FE(UE.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(YC.ON_TRACK,void 0),this.emit(YC.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(YC.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(YC.ON_NODE,this.inputNode))}}class WR extends nv{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),rh(this,"constraintsMap",new Map),rh(this,"statsRegistry",[]),rh(this,"audioContext",void 0),rh(this,"trackId",void 0),rh(this,"direction",void 0),rh(this,"usageRegistry",[]),rh(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return _v(this,ZC.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return zS.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),Ev(this,ZC.REQUEST_UPDATE_CONSTRAINTS,Array.from(LT(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Ev(this,ZC.REQUEST_UPDATE_CONSTRAINTS,Array.from(LT(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){zS.error(new FE(UE.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof tE&&(n=await n),e.push(VR(VR({},n),{},{direction:this.direction}))}catch(e){zS.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class zR extends nv{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),rh(this,"context",void 0),rh(this,"processSourceNode",void 0),rh(this,"outputTrack",void 0),rh(this,"processedNode",void 0),rh(this,"clonedTrack",void 0),rh(this,"outputNode",void 0),this.outputNode=new HR}setVolume(){}createOutputTrack(){throw new FE(UE.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class HR{disconnect(){}connect(){}}let KR=null;class YR{constructor(){rh(this,"state","open"),rh(this,"trigger",void 0),rh(this,"tasks",[]),zS.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout((()=>{this.state="closed",zS.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map((e=>e.key)),"]")),this.trigger=void 0,this.tasks.forEach((e=>{let{func:t}=e;return t()})),this.tasks.length=0,zS.debug("[macro-task-queue] is closed.")}))}enqueue(e,t){"closed"!==this.state&&(this.tasks.push({key:e,func:t}),zS.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof e?e:"")))}runTask(e){if("closed"===this.state)return;const t=this.tasks.findIndex((t=>t.key===e));if(-1!==t){const n=this.tasks.splice(t,1);zS.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof e?e:"")),n[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,zS.debug("[macro-task-queue] is closed."))}}function ZR(e){return function(t,n,r){var i;const o=null!==(i=r.value)&&void 0!==i?i:r.get,s=function(){KR&&"open"===KR.state&&KR.runTask(e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return null==o?void 0:o.apply(this,...n)};return r.value?r.value=s:r.get=s,r}}function JR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function XR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JR(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class QR extends nR{get _source(){return this._trackSource}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get processorDestination(){return this._processorDestination}set processorDestination(e){this._processorDestination=e}get isPlaying(){return this._useAudioElement?UR.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r,i){super(e,n),rh(this,"trackMediaType","audio"),rh(this,"_encoderConfig",void 0),rh(this,"_trackSource",void 0),rh(this,"_enabled",!0),rh(this,"_volume",100),rh(this,"_useAudioElement",!1),rh(this,"_bypassWebAudio",!1),rh(this,"processor",void 0),rh(this,"_processorContext",void 0),rh(this,"_processorDestination",void 0),rh(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r;const o=()=>{this.processorContext=new WR(this._source.context,this.getTrackId(),"local"),this.processorDestination=new qR(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(BC.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))},s=i&&yE()&&!lR();LS("DISABLE_WEBAUDIO")?(this._source=new zR,this._useAudioElement=!0,this._bypassWebAudio=!0):s?this._source=new zR:(this._source=new _R(e,!1,this._getOriginVolumeLevel?e:void 0),LS("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),o(),!LS("DISABLE_WEBAUDIO")&&s&&(KR||(KR=new YR),KR).enqueue("INIT_WEBAUDIO",(()=>{this._source=new _R(e,!1,this._getOriginVolumeLevel?e:void 0),LS("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),o(),this.emit(GC.UPDATE_TRACK_SOURCE)}))}setVolume(e){BE(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&UR.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void zS.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Ev(this,DC.NEED_REPLACE_TRACK,this).then((()=>{zS.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((e=>{zS.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)})))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement)throw new FE(UE.NOT_SUPPORTED,"your browser does not support setting the audio output device");await UR.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(zS.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Ev(this,DC.NEED_ENABLE_TRACK,this),zS.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw n||(this._enabled=!1),zS.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Ev(this,DC.NEED_DISABLE_TRACK,this)}catch(e){throw n||(this._enabled=!0),zS.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,zS.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Ev(this,DC.NEED_MUTE_TRACK,this):await Ev(this,DC.NEED_UNMUTE_TRACK,this))}getStats(){return Nv((()=>{zS.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),vv(this,DC.GET_STATS)||XR({},qC)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(BC.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(BC.ON_AUDIO_BUFFER),this._source.on(BC.ON_AUDIO_BUFFER,(t=>e(t)))}play(){zS.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(zS.debug("[".concat(this.getTrackId(),"] start audio playback in element")),UR.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){zS.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?UR.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];zS.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&UR.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:e,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ev(this,DC.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return tE.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new FE(UE.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new FE(UE.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(YC.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Ev(this,DC.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ev(this,DC.NEED_REPLACE_TRACK,this))})),this.processorDestination.on(YC.ON_NODE,(e=>{this._source.processedNode=e}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(YC.ON_TRACK),this.processorDestination.removeAllListeners(YC.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ZC.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ZC.REQUEST_CONSTRAINTS)}}xT([ZR("INIT_WEBAUDIO"),MT("design:type",Object),MT("design:paramtypes",[Object])],QR.prototype,"_source",null),xT([ZR("INIT_WEBAUDIO"),MT("design:type",WR),MT("design:paramtypes",[WR])],QR.prototype,"processorContext",null),xT([ZR("INIT_WEBAUDIO"),MT("design:type",qR),MT("design:paramtypes",[qR])],QR.prototype,"processorDestination",null),xT([rT({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),MT("design:type",Function),MT("design:paramtypes",[Number]),MT("design:returntype",void 0)],QR.prototype,"setVolume",null),xT([rT({argsMap:(e,t)=>[e.getTrackId(),t]}),FR(),MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],QR.prototype,"setPlaybackDevice",null),xT([Kv("LocalAudioTrack","_enabledMutex"),rT({argsMap:(e,t)=>[e.getTrackId(),t]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Boolean,Object,Boolean]),MT("design:returntype",tE)],QR.prototype,"setEnabled",null),xT([Kv("LocalAudioTrack","_enabledMutex"),rT({argsMap:(e,t)=>[e.getTrackId(),t]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Boolean]),MT("design:returntype",tE)],QR.prototype,"setMuted",null),xT([FR(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",Object)],QR.prototype,"getStats",null),xT([FR(),MT("design:type",Function),MT("design:paramtypes",[Object,Number]),MT("design:returntype",void 0)],QR.prototype,"setAudioFrameCallback",null),xT([rT({argsMap:e=>[e.getTrackId()]}),FR(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],QR.prototype,"play",null),xT([rT({argsMap:e=>[e.getTrackId()]}),FR(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],QR.prototype,"stop",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],QR.prototype,"close",null),xT([rT({argsMap:(e,t)=>[e.getTrackId(),t.name]}),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",Object)],QR.prototype,"pipe",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],QR.prototype,"unpipe",null);class $R extends QR{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?NC(t.encoderConfig):{},r,LS("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),rh(this,"_config",void 0),rh(this,"_deviceName","default"),rh(this,"_constraints",void 0),rh(this,"_originalConstraints",void 0),rh(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(OE()||AE())&&sR.bindInterruptDetectorTrack(this),this.on(GC.UPDATE_TRACK_SOURCE,(()=>{this.bindProcessorContextEvents()})),lR()&&this.bindProcessorContextEvents()}async setDevice(e){if(zS.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await AR.getDeviceById(e),n={};n.audio=XR({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await CR(n,this.getTrackId())}catch(e){throw zS.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await CR({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw zS.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await AR.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw zS.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}zS.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return zS.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(zS.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(r=this._source.clonedTrack)||void 0===r||r.stop(),n||(this._enabled=!1);try{await Ev(this,DC.NEED_DISABLE_TRACK,this)}catch(e){throw zS.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}const i=XR({},this._constraints),o=AR.searchDeviceIdByName(this._deviceName);o&&!i.deviceId&&(i.deviceId=o);try{n||(this._enabled=!0);const e=await CR({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await Ev(this,DC.NEED_ENABLE_TRACK,this)}catch(e){throw n||(this._enabled=!1),zS.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}zS.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(OE()||AE())&&sR.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((SE()||kE())&&this._enabled&&!this._isClosed&&sR.duringInterruption){const e=async()=>{sR.off(hC.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(zS.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};sR.on(hC.IOS_INTERRUPTION_END,e)}else zS.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(jC.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=AR.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const e=await CR({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(ZC.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})),this.processorContext.on(ZC.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}}xT([rT({argsMap:(e,t)=>[e.getTrackId(),t]}),FR(),MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],$R.prototype,"setDevice",null),xT([Kv("MicrophoneAudioTrack","_enabledMutex"),rT({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Boolean,Boolean,Boolean]),MT("design:returntype",tE)],$R.prototype,"setEnabled",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],$R.prototype,"close",null);class eI extends QR{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),rh(this,"source",void 0),rh(this,"_bufferSource",void 0),this.source=e,this._bufferSource=t,this._bufferSource.on(BC.AUDIO_SOURCE_STATE_CHANGE,(e=>{this.safeEmit(jC.SOURCE_STATE_CHANGE,e)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){BE(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}xT([rT({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",void 0)],eI.prototype,"startProcessAudioBuffer",null),xT([rT({argsMap:e=>[e.getTrackId()]}),FR(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],eI.prototype,"pauseProcessAudioBuffer",null),xT([rT({argsMap:e=>[e.getTrackId()]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Number]),MT("design:returntype",void 0)],eI.prototype,"seekAudioBuffer",null),xT([rT({argsMap:e=>[e.getTrackId()]}),FR(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],eI.prototype,"resumeProcessAudioBuffer",null),xT([rT({argsMap:e=>[e.getTrackId()]}),FR(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],eI.prototype,"stopProcessAudioBuffer",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],eI.prototype,"close",null),xT([rT({argsMap:e=>[e.getTrackId()]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Number]),MT("design:returntype",void 0)],eI.prototype,"setAudioBufferPlaybackSpeed",null);class tI extends QR{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=cR().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,Uv(8,"track-mix-")),rh(this,"trackList",void 0),rh(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(zS.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):zS.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){zS.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}wv(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach((t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))})),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach((t=>{t instanceof tI?t.emit(FC.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)})))}}function nI(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=RC(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!DE()&&n.frameRate&&(t.frameRate=n.frameRate),pE().name===cE.EDGE&&"object"==typeof t.frameRate&&(t.frameRate.max=60),bE()&&(t.frameRate={ideal:30,max:30}),t}function rI(e){const t={};if(DE()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,vE()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=NC(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),xE()&&(t.sampleRate=void 0),t}class iI extends gR{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(BC.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),rh(this,"audioBuffer",void 0),rh(this,"sourceNode",void 0),rh(this,"startPlayTime",0),rh(this,"startPlayOffset",0),rh(this,"pausePlayTime",0),rh(this,"options",void 0),rh(this,"currentLoopCount",0),rh(this,"currentPlaybackSpeed",100),rh(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):zS.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const oI=new Map;async function sI(e,t){let n=null;if("string"==typeof e){const t=oI.get(e);if(t)return zS.debug("use cached audio resource: ",e),t;try{n=(await Jv((()=>mS.get(e,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new FE(UE.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{const t=new tE(((t,n)=>{const r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new FE(UE.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new FE(UE.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)}));n=await t}const r=await function(e){const t=cR();return new tE(((n,r)=>{t.decodeAudioData(e,(e=>{n(e)}),(e=>{r(new FE(UE.DECODE_AUDIO_FILE_FAILED,e.toString()))}))}))}(n);return"string"==typeof e&&t&&oI.set(e,r),r}const aI=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new tE(((n,r)=>{t.toBlob((async e=>{if(t.remove(),e){const r=await cI(e);n({buffer:r,width:t.width,height:t.height})}else r(new FE(UE.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},cI=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)},lI=new class extends nv{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),rh(this,"_lastHiddenTime",0),rh(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),zS.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};function uI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uI(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class hI{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(zS.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}constructor(e){rh(this,"trackId",void 0),rh(this,"config",void 0),rh(this,"onFirstVideoFrameDecoded",void 0),rh(this,"freezeTimeCounterList",[]),rh(this,"renderFreezeAccTime",0),rh(this,"isKeepLastFrame",!1),rh(this,"timeUpdatedCount",0),rh(this,"freezeTime",0),rh(this,"playbackTime",0),rh(this,"lastTimeUpdatedTime",0),rh(this,"autoplayFailed",!1),rh(this,"videoTrack",void 0),rh(this,"videoElement",void 0),rh(this,"cacheVideoElement",void 0),rh(this,"videoElementCheckInterval",void 0),rh(this,"_videoElementStatus",QC.NONE),rh(this,"isGettingVideoDimensions",!1),rh(this,"startGetVideoDimensions",(()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return zS.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()})),rh(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===sR.curState&&(zS.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(mE())),NE()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),rh(this,"handleVideoEvents",(e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=QC.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=QC.CANPLAY;break;case"stalled":this.videoElementStatus=QC.STALLED;break;case"suspend":this.videoElementStatus=QC.SUSPEND;break;case"pause":this.videoElementStatus=QC.PAUSED,SE()||kE()||yE()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(zS.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=QC.WAITING;break;case"abort":this.videoElementStatus=QC.ABORT;break;case"ended":this.videoElementStatus=QC.ENDED;break;case"emptied":this.videoElementStatus=QC.EMPTIED;break;case"error":{this.videoElementStatus=QC.ERROR;const e=this.videoElement.error;e&&zS.error("[".concat(this.trackId,"] media error, code: ").concat(e.code,", message: ").concat(e.message));break}case"timeupdate":{const e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);const t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,lI.lastVisibleTime<lI.lastHiddenTime||n<lI.lastHiddenTime||n<lI.lastVisibleTime)return;for(t>LS("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;const e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),rh(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(zS.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(mE())),NE()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),sR.on(hC.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),sR.on(hC.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch((t=>{e&&xR(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(zS.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):zS.warning("[".concat(this.trackId,"] play warning: "),t)}));const n=pE();if(("Safari"===n.name&&15===Number(n.version)||OE())&&t&&t.then){const e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return zS.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const r=n.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,n.width,n.height),new tE(((r,i)=>{n.toBlob((async e=>{if(n.remove(),e){const t=await cI(e);r({buffer:t,width:n.width,height:n.height})}else i(new FE(UE.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,t<0?.1:t>1?1:t)}))):await aI(e)}destroy(){sR.off(hC.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),sR.off(hC.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=QC.INIT,!this.videoElementCheckInterval&&(pI.forEach((e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{(function(e){return e!==document.body&&document.body.contains(e)})(this.videoElement)||(this.videoElementStatus=QC.DESTROYED)}),1e3),LS("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n;const r=(e,t)=>{if(this.videoElementStatus===QC.PLAYING){if(n){const e=t.presentationTime-n.presentationTime;e>LS("VIDEO_FREEZE_DURATION")&&lI.lastVisibleTime>=lI.lastHiddenTime&&n.timestamp>lI.lastVisibleTime&&n.timestamp>lI.lastHiddenTime&&(this.renderFreezeAccTime+=e)}n=dI(dI({},t),{},{timestamp:e})}var i,o;LS("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(i=(o=this.videoElement).requestVideoFrameCallback)||void 0===i||i.call(o,r))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,r)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),xE()&&(this.videoElement.poster="noposter");const n=pE();"Safari"===n.name&&15===Number(n.version)||OE()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,bE()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,bE()&&this.videoElement.load());const r=this.videoElement.play();void 0!==r&&r.catch((e=>{zS.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())}))}resetVideoElement(){pI.forEach((e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=QC.NONE}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then((()=>{zS.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((e=>{zS.error(e)})),this.autoplayFailed=!1,ME()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};ME()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),PR()}}const pI=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class fI extends hI{constructor(e){super(e),rh(this,"container",void 0),rh(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await aI(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",LS("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function mI(e){return new tE(((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const o=SE()?"canplay":"playing";i.addEventListener(o,(()=>{const e=i.videoWidth,n=i.videoHeight;!e&&bE()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))})),i.srcObject=new MediaStream([e]),i.play().catch(jv),setTimeout((()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}const gI=async(e,t,n)=>{const r=function(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(function(e){const t="0123456789abcdef";function n(e){let n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,o,s){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,s)),o),n)}function o(e,t,n,r,o,s,a){return i(t&n|~t&r,e,t,o,s,a)}function s(e,t,n,r,o,s,a){return i(t&r|n&~r,e,t,o,s,a)}function a(e,t,n,r,o,s,a){return i(t^n^r,e,t,o,s,a)}function c(e,t,n,r,o,s,a){return i(n^(t|~r),e,t,o,s,a)}const l=function(e){let t;const n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e);let u,d,h,p,f,m=1732584193,g=-271733879,_=-1732584194,E=271733878;for(u=0;u<l.length;u+=16)d=m,h=g,p=_,f=E,m=o(m,g,_,E,l[u+0],7,-680876936),E=o(E,m,g,_,l[u+1],12,-389564586),_=o(_,E,m,g,l[u+2],17,606105819),g=o(g,_,E,m,l[u+3],22,-1044525330),m=o(m,g,_,E,l[u+4],7,-176418897),E=o(E,m,g,_,l[u+5],12,1200080426),_=o(_,E,m,g,l[u+6],17,-1473231341),g=o(g,_,E,m,l[u+7],22,-45705983),m=o(m,g,_,E,l[u+8],7,1770035416),E=o(E,m,g,_,l[u+9],12,-1958414417),_=o(_,E,m,g,l[u+10],17,-42063),g=o(g,_,E,m,l[u+11],22,-1990404162),m=o(m,g,_,E,l[u+12],7,1804603682),E=o(E,m,g,_,l[u+13],12,-40341101),_=o(_,E,m,g,l[u+14],17,-1502002290),g=o(g,_,E,m,l[u+15],22,1236535329),m=s(m,g,_,E,l[u+1],5,-165796510),E=s(E,m,g,_,l[u+6],9,-1069501632),_=s(_,E,m,g,l[u+11],14,643717713),g=s(g,_,E,m,l[u+0],20,-373897302),m=s(m,g,_,E,l[u+5],5,-701558691),E=s(E,m,g,_,l[u+10],9,38016083),_=s(_,E,m,g,l[u+15],14,-660478335),g=s(g,_,E,m,l[u+4],20,-405537848),m=s(m,g,_,E,l[u+9],5,568446438),E=s(E,m,g,_,l[u+14],9,-1019803690),_=s(_,E,m,g,l[u+3],14,-187363961),g=s(g,_,E,m,l[u+8],20,1163531501),m=s(m,g,_,E,l[u+13],5,-1444681467),E=s(E,m,g,_,l[u+2],9,-51403784),_=s(_,E,m,g,l[u+7],14,1735328473),g=s(g,_,E,m,l[u+12],20,-1926607734),m=a(m,g,_,E,l[u+5],4,-378558),E=a(E,m,g,_,l[u+8],11,-2022574463),_=a(_,E,m,g,l[u+11],16,1839030562),g=a(g,_,E,m,l[u+14],23,-35309556),m=a(m,g,_,E,l[u+1],4,-1530992060),E=a(E,m,g,_,l[u+4],11,1272893353),_=a(_,E,m,g,l[u+7],16,-155497632),g=a(g,_,E,m,l[u+10],23,-1094730640),m=a(m,g,_,E,l[u+13],4,681279174),E=a(E,m,g,_,l[u+0],11,-358537222),_=a(_,E,m,g,l[u+3],16,-722521979),g=a(g,_,E,m,l[u+6],23,76029189),m=a(m,g,_,E,l[u+9],4,-640364487),E=a(E,m,g,_,l[u+12],11,-421815835),_=a(_,E,m,g,l[u+15],16,530742520),g=a(g,_,E,m,l[u+2],23,-995338651),m=c(m,g,_,E,l[u+0],6,-198630844),E=c(E,m,g,_,l[u+7],10,1126891415),_=c(_,E,m,g,l[u+14],15,-1416354905),g=c(g,_,E,m,l[u+5],21,-57434055),m=c(m,g,_,E,l[u+12],6,1700485571),E=c(E,m,g,_,l[u+3],10,-1894986606),_=c(_,E,m,g,l[u+10],15,-1051523),g=c(g,_,E,m,l[u+1],21,-2054922799),m=c(m,g,_,E,l[u+8],6,1873313359),E=c(E,m,g,_,l[u+15],10,-30611744),_=c(_,E,m,g,l[u+6],15,-1560198380),g=c(g,_,E,m,l[u+13],21,1309151649),m=c(m,g,_,E,l[u+4],6,-145523070),E=c(E,m,g,_,l[u+11],10,-1120210379),_=c(_,E,m,g,l[u+2],15,718787259),g=c(g,_,E,m,l[u+9],21,-343485551),m=r(m,d),g=r(g,h),_=r(_,p),E=r(E,f);return n(m)+n(g)+n(_)+n(E)}(""+t+n)).slice(0,16),i=r.slice(0,12),o=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,e))},_I=async(e,t,n)=>await gI(e.buffer,t,n);function EI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?EI(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class yI extends nR{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==QC.PLAYING)}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,r,i,o){if(super(e,i),rh(this,"trackMediaType","video"),rh(this,"_player",void 0),rh(this,"isUseScaleResolutionDownBy",!1),rh(this,"_videoVisibleTimer",null),rh(this,"_statsTimer",null),rh(this,"_previousVideoVisibleStatus",void 0),rh(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),rh(this,"_encoderConfig",void 0),rh(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),rh(this,"_optimizationMode",void 0),rh(this,"_videoHeight",void 0),rh(this,"_videoWidth",void 0),rh(this,"_forceBitrateLimit",void 0),rh(this,"_enabled",!0),rh(this,"processorDestination",void 0),rh(this,"_processorContext",void 0),yE()){const{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=t,this._scalabilityMode=n,this._optimizationMode=r,this._hints=o||[],-1===this._hints.indexOf(LC.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(e,t,n){const r=pE();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}(cE.CHROME,115)&&-1!==fE().indexOf("Windows")){const t=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&fR().supportWebRTCInsertableStream){const n=new MediaStreamTrackProcessor(e),r=new MediaStreamTrackGenerator({kind:"video"});let i,o,s=Date.now();const a=()=>{c&&(clearInterval(c),c=void 0),i&&(i.close(),i=void 0),e.stop(),o=void 0,r.removeEventListener("ended",a)};let c=window.setInterval((()=>{if(o&&i&&Date.now()-s>(null!=t?t:1e3))try{"live"===r.readyState?o.enqueue(i.clone()):a()}catch(e){a()}}),null!=t?t:1e3);const l=new TransformStream({transform:(e,t)=>{"live"===r.readyState?(o=t,s=Date.now(),void 0===i?(i=e,t.enqueue(e.clone())):(t.enqueue(i),i=e)):e.close()}});return r.addEventListener("ended",a),n.readable.pipeThrough(l).pipeTo(r.writable),r}}(e);t&&(zS.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(LC.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this.processorContext=new GR(this.getTrackId(),"local"),this.processorDestination=new BR(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(zS.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}zS.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=vI(vI(vI({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new hI(n):this._player=new fI(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(jC.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),LS("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,zS.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(zS.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Ev(this,DC.NEED_DISABLE_TRACK,this)}catch(e){throw zS.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void zS.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Ev(this,DC.NEED_ENABLE_TRACK,this)}catch(e){throw zS.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}zS.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,zS.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Ev(this,DC.NEED_MUTE_TRACK,this):await Ev(this,DC.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,t){if(!this._enabled)throw new FE(UE.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if("720p_auto"===e?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),e=RC(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const t=nI({encoderConfig:e});(yE()||SE()||kE())&&(t.deviceId=void 0),zS.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(e){const t=new FE(UE.UNEXPECTED_ERROR,e.toString());throw zS.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}}this._encoderConfig=e,-1===this._hints.indexOf(LC.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await Ev(this,DC.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(zS)}}getStats(){return Nv((()=>{zS.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),vv(this,DC.GET_STATS)||vI({},WC)}async setBeautyEffect(e){zS.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await aI(e)}async setBitrateLimit(e){if(zS.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate);try{await Ev(this,DC.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(zS)}}}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void zS.error(UE.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await Ev(this,DC.SET_OPTIMIZATION_MODE,this)}catch(e){throw this._optimizationMode=t,zS.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}zS.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return zS.error(UE.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,zS.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){mI(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(jv)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new FE(UE.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");zS.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=RC(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(LC.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await Ev(this,DC.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(zS)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;const[r,i]=function(e,t,n,r){let i;const o=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75),s=o;if("STANDARD_BITRATE"===r)i=4*o;else{if("COMPATIABLE_BITRATE"!==r)return;i=2*o}return[Math.floor(i),Math.floor(s)]}(e,t,n,LS("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=i,this._encoderConfig.bitrateMax=r,zS.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(r,", brMin: ").concat(i,"]")))}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=XE.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=iT.reportApiInvoke(null,{tag:sv.TRACER,name:ov.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new FE(UE.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new FE(UE.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._encoderConfig;e&&(n=vI(vI({},n),RC(e))),n=Ov(n);const r=Uv(8,"track-video-cloned-"),i=new yI(t?this._mediaStreamTrack.clone():this._mediaStreamTrack,n,Ov(this._scalabilityMode),this._optimizationMode,r,Ov(this._hints));return e&&n&&i.setEncoderConfiguration(n),zS.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(t)),i}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new FE(UE.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new FE(UE.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!yE()&&!SE())return;this._statsTimer&&window.clearInterval(this._statsTimer);let e=2,t=TC[e],n=-1,r=Date.now();const i=e=>{e>2||e<0||(r=Date.now(),t=TC[e],this.setSenderConfiguration(t))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval((()=>{const o=this.getStats(),s=vv(this,DC.GET_RTC_STATS);if(o.sendPackets>0&&s){-1===n&&(n=Date.now());const a=Date.now();if(a-n<1e3||a-r<LS("PROFILE_SWITCH_INTERVAL"))return;const c=o.sendFrameRate,l=.6*t.frameRate,u=.9*t.frameRate;"number"==typeof c&&c>0&&c<l?e>0&&(e--,i(e),zS.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(c,", switchProfile to ").concat(e))):s.OutgoingAvailableBandwidth<t.bitrateMin?e>0&&(e--,i(e),zS.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(s.OutgoingAvailableBandwidth,", bitrateMin ").concat(t.bitrateMin,", switchProfile to ").concat(e))):"number"==typeof c&&c>u&&e<TC.length-1&&s.OutgoingAvailableBandwidth>1.2*TC[e+1].bitrateMin&&(e++,i(e),zS.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(c,", OutgoingAvailableBandwidth ").concat(s.OutgoingAvailableBandwidth,", switchProfile to ").concat(e)))}}),LS("CHECK_LOCAL_STATS_INTERVAL"))}bindProcessorDestinationEvents(){this.processorDestination.on(YC.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Ev(this,DC.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ev(this,DC.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(YC.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ZC.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ZC.REQUEST_CONSTRAINTS)}}xT([rT({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Object,Object]),MT("design:returntype",void 0)],yI.prototype,"play",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],yI.prototype,"stop",null),xT([Kv("LocalVideoTrack","_enabledMutex"),rT({argsMap:(e,t)=>[e.getTrackId(),t]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Boolean,Boolean]),MT("design:returntype",tE)],yI.prototype,"setEnabled",null),xT([Kv("LocalVideoTrack","_enabledMutex"),rT({argsMap:(e,t)=>[e.getTrackId(),t]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Boolean]),MT("design:returntype",tE)],yI.prototype,"setMuted",null),xT([rT({argsMap:(e,t)=>[e.getTrackId(),t]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Object,Boolean]),MT("design:returntype",tE)],yI.prototype,"setEncoderConfiguration",null),xT([FR(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",Object)],yI.prototype,"getStats",null),xT([rT({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Boolean,Object]),MT("design:returntype",tE)],yI.prototype,"setBeautyEffect",null),xT([FR(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",ImageData)],yI.prototype,"getCurrentFrameData",null),xT([FR(),MT("design:type",Function),MT("design:paramtypes",[String,Number]),MT("design:returntype",tE)],yI.prototype,"getCurrentFrameImage",null),xT([FR(),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",tE)],yI.prototype,"setBitrateLimit",null),xT([FR(),MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],yI.prototype,"setOptimizationMode",null),xT([FR(),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",void 0)],yI.prototype,"setScalabiltyMode",null),xT([FR(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],yI.prototype,"updateMediaStreamTrackResolution",null),xT([rT({argsMap:(e,t)=>[e.getTrackId(),t.name]}),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",Object)],yI.prototype,"pipe",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],yI.prototype,"unpipe",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],yI.prototype,"close",null),xT([rT({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),MT("design:type",Function),MT("design:paramtypes",[MediaStreamTrack,Boolean]),MT("design:returntype",tE)],yI.prototype,"replaceTrack",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],yI.prototype,"startMonitorStats",null);class bI extends yI{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,i,o){super(e,RC(t.encoderConfig),r,i,o),rh(this,"_config",void 0),rh(this,"_originalConstraints",void 0),rh(this,"_constraints",void 0),rh(this,"_enabled",!0),rh(this,"_deviceName","default"),rh(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(OE()||AE())&&!function(){const e=pE();if(e.os!==aE.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&PE()&&this._enabled&&!this._isClosed&&(zS.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=RC(this._config.encoderConfig),sR.on(hC.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),sR.on(hC.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(zS.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await AR.getDeviceById(e),n={};n.video=vI({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await CR(n,this.getTrackId())}catch(e){throw zS.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await CR({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw zS.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await AR.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw zS.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}zS.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){zS.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const t={video:vI(vI({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await CR(t,this.getTrackId())}catch(t){throw zS.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),t.toString()),e=await CR({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=vI({},t.video),zS.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(zS.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const e=await CR({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await Ev(this,DC.NEED_ENABLE_TRACK,this)}catch(e){throw zS.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),zS.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await Ev(this,DC.NEED_DISABLE_TRACK,this)}catch(e){throw zS.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}zS.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new FE(UE.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");"720p_auto"===e?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),e=RC(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin);const n=Iv(this._config);n.encoderConfig=e;const r=nI(n);(yE()||SE()||kE())&&(r.deviceId=void 0),zS.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(e){const t=new FE(UE.UNEXPECTED_ERROR,e.toString());throw zS.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,-1===this._hints.indexOf(LC.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await Ev(this,DC.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(zS)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((SE()||kE())&&this._enabled&&!this._isClosed&&sR.duringInterruption){const e=async()=>{sR.off(hC.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(zS.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};sR.on(hC.IOS_INTERRUPTION_END,e)}else zS.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(jC.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=AR.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const e=await CR({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),sR.off(hC.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),sR.off(hC.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._encoderConfig;e&&(n=vI(vI({},n),RC(e))),n=Ov(n);const r=Uv(8,"track-cam-cloned-"),i=new bI(t?this._mediaStreamTrack.clone():this._mediaStreamTrack,Ov(vI(vI({},this._config),{},{encoderConfig:n})),Ov(this._constraints),Ov(this._scalabilityMode),this._optimizationMode,r);return e&&n&&i.setEncoderConfiguration(n),zS.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(t)),i}bindProcessorContextEvents(){this.processorContext.on(ZC.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})),this.processorContext.on(ZC.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}}function SI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function TI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SI(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wI(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=TI(TI({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?zS.debug("[".concat(e,"] set content hint to"),n.optimizationMode):zS.debug("[".concat(e,"] set content hint failed")))):zS.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}function CI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function RI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CI(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}xT([rT({argsMap:(e,t)=>[e.getTrackId(),t]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",tE)],bI.prototype,"setDevice",null),xT([Kv("CameraVideoTrack","_enabledMutex"),rT({argsMap:(e,t)=>[e.getTrackId(),t]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Boolean,Boolean]),MT("design:returntype",tE)],bI.prototype,"setEnabled",null),xT([rT({argsMap:(e,t)=>[e.getTrackId(),t]}),FR(),MT("design:type",Function),MT("design:paramtypes",[Object,Boolean]),MT("design:returntype",tE)],bI.prototype,"setEncoderConfiguration",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],bI.prototype,"close",null);class II extends tR{getUserId(){return this._userId}constructor(e,t,n,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat(Uv(5,""))),rh(this,"_userId",void 0),rh(this,"_uintId",void 0),rh(this,"_isDestroyed",!1),rh(this,"store",void 0),rh(this,"processor",void 0),this._userId=t,this._uintId=n,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,zS.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class OI extends II{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==QC.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),rh(this,"_videoVisibleTimer",null),rh(this,"_previousVideoVisibleStatus",void 0),rh(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),rh(this,"trackMediaType","video"),rh(this,"_videoWidth",void 0),rh(this,"_videoHeight",void 0),rh(this,"_player",void 0),rh(this,"processorDestination",void 0),rh(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new GR(this.getTrackId(),"remote"),this.processorDestination=new BR(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Nv((()=>{zS.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),vv(this,DC.GET_STATS)||RI({},KC)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(zS.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}zS.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=RI(RI({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new hI(n):this._player=new fI(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(VC.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(VC.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),LS("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,zS.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){mI(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(jv)}_updatePlayerSource(){zS.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=XE.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=iT.reportApiInvoke(null,{tag:sv.TRACER,name:ov.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new FE(UE.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new FE(UE.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(YC.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(YC.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}xT([rT({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),MT("design:type",Function),MT("design:paramtypes",[Object,Object]),MT("design:returntype",void 0)],OI.prototype,"play",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],OI.prototype,"stop",null),xT([rT({argsMap:(e,t)=>[e.getTrackId(),t.name]}),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",Object)],OI.prototype,"pipe",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],OI.prototype,"unpipe",null);class AI extends II{get isPlaying(){return this._useAudioElement?UR.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),rh(this,"trackMediaType","audio"),rh(this,"_source",void 0),rh(this,"_useAudioElement",!0),rh(this,"_volume",100),rh(this,"processorContext",void 0),rh(this,"processorDestination",void 0),rh(this,"_played",!1),rh(this,"_bypassWebAudio",!1),LS("DISABLE_WEBAUDIO")?(this._source=new zR,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new _R(e,!0),LS("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(BC.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(VC.FIRST_FRAME_DECODED)})),this.processorContext=new WR(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new qR(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(BC.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(BC.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(BC.ON_AUDIO_BUFFER),this._source.on(BC.ON_AUDIO_BUFFER,(t=>e(t)))}setVolume(e){this._volume=e,this._useAudioElement?UR.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement)throw new FE(UE.NOT_SUPPORTED,"your browser does not support setting the audio output device");await UR.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Nv((()=>{zS.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),vv(this,DC.GET_STATS)||RI({},zC)}play(){zS.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(zS.debug("[".concat(this.getTrackId(),"] use audio element to play")),UR.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){zS.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?UR.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];zS.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&UR.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new FE(UE.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new FE(UE.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new FE(UE.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(YC.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(YC.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(YC.ON_TRACK),this.processorDestination.removeAllListeners(YC.ON_NODE)}}function NI(e){let t=e.length;for(;--t>=0;)e[t]=0}xT([rT({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),MT("design:type",Function),MT("design:paramtypes",[Number]),MT("design:returntype",void 0)],AI.prototype,"setVolume",null),xT([rT({argsMap:(e,t)=>[e.getTrackId(),t]}),MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],AI.prototype,"setPlaybackDevice",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],AI.prototype,"play",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],AI.prototype,"stop",null),xT([rT({argsMap:(e,t)=>[e.getTrackId(),t.name]}),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",Object)],AI.prototype,"pipe",null),xT([rT({argsMap:e=>[e.getTrackId()]}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],AI.prototype,"unpipe",null);const kI=256,PI=286,DI=30,LI=15,xI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),MI=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),UI=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),FI=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),jI=new Array(576);NI(jI);const VI=new Array(60);NI(VI);const BI=new Array(512);NI(BI);const GI=new Array(256);NI(GI);const qI=new Array(29);NI(qI);const WI=new Array(DI);function zI(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let HI,KI,YI;function ZI(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}NI(WI);const JI=e=>e<256?BI[e]:BI[256+(e>>>7)],XI=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},QI=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,XI(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},$I=(e,t,n)=>{QI(e,n[2*t],n[2*t+1])},eO=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},tO=(e,t,n)=>{const r=new Array(16);let i,o,s=0;for(i=1;i<=LI;i++)s=s+n[i-1]<<1,r[i]=s;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=eO(r[t]++,t))}},nO=e=>{let t;for(t=0;t<PI;t++)e.dyn_ltree[2*t]=0;for(t=0;t<DI;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},rO=e=>{e.bi_valid>8?XI(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},iO=(e,t,n,r)=>{const i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]},oO=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&iO(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!iO(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},sO=(e,t,n)=>{let r,i,o,s,a=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+a++],r+=(255&e.pending_buf[e.sym_buf+a++])<<8,i=e.pending_buf[e.sym_buf+a++],0===r?$I(e,i,t):(o=GI[i],$I(e,o+kI+1,t),s=xI[o],0!==s&&(i-=qI[o],QI(e,i,s)),r--,o=JI(r),$I(e,o,n),s=MI[o],0!==s&&(r-=WI[o],QI(e,r,s)))}while(a<e.sym_next);$I(e,256,t)},aO=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let s,a,c,l=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<o;s++)0!==n[2*s]?(e.heap[++e.heap_len]=l=s,e.depth[s]=0):n[2*s+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=r[2*c+1]);for(t.max_code=l,s=e.heap_len>>1;s>=1;s--)oO(e,n,s);c=o;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],oO(e,n,1),a=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=a,n[2*c]=n[2*s]+n[2*a],e.depth[c]=(e.depth[s]>=e.depth[a]?e.depth[s]:e.depth[a])+1,n[2*s+1]=n[2*a+1]=c,e.heap[1]=c++,oO(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,u,d,h,p,f,m=0;for(h=0;h<=LI;h++)e.bl_count[h]=0;for(n[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)u=e.heap[l],h=n[2*n[2*u+1]+1]+1,h>c&&(h=c,m++),n[2*u+1]=h,u>r||(e.bl_count[h]++,p=0,u>=a&&(p=s[u-a]),f=n[2*u],e.opt_len+=f*(h+p),o&&(e.static_len+=f*(i[2*u+1]+p)));if(0!==m){do{for(h=c-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,m-=2}while(m>0);for(h=c;0!==h;h--)for(u=e.bl_count[h];0!==u;)d=e.heap[--l],d>r||(n[2*d+1]!==h&&(e.opt_len+=(h-n[2*d+1])*n[2*d],n[2*d+1]=h),u--)}})(e,t),tO(n,l,e.bl_count)},cO=(e,t,n)=>{let r,i,o=-1,s=t[1],a=0,c=7,l=4;for(0===s&&(c=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++a<c&&i===s||(a<l?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,o=i,0===s?(c=138,l=3):i===s?(c=6,l=3):(c=7,l=4))},lO=(e,t,n)=>{let r,i,o=-1,s=t[1],a=0,c=7,l=4;for(0===s&&(c=138,l=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++a<c&&i===s)){if(a<l)do{$I(e,i,e.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&($I(e,i,e.bl_tree),a--),$I(e,16,e.bl_tree),QI(e,a-3,2)):a<=10?($I(e,17,e.bl_tree),QI(e,a-3,3)):($I(e,18,e.bl_tree),QI(e,a-11,7));a=0,o=i,0===s?(c=138,l=3):i===s?(c=6,l=3):(c=7,l=4)}};let uO=!1;const dO=(e,t,n,r)=>{QI(e,0+(r?1:0),3),rO(e),XI(e,n),XI(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var hO=e=>{uO||((()=>{let e,t,n,r,i;const o=new Array(16);for(n=0,r=0;r<28;r++)for(qI[r]=n,e=0;e<1<<xI[r];e++)GI[n++]=r;for(GI[n-1]=r,i=0,r=0;r<16;r++)for(WI[r]=i,e=0;e<1<<MI[r];e++)BI[i++]=r;for(i>>=7;r<DI;r++)for(WI[r]=i<<7,e=0;e<1<<MI[r]-7;e++)BI[256+i++]=r;for(t=0;t<=LI;t++)o[t]=0;for(e=0;e<=143;)jI[2*e+1]=8,e++,o[8]++;for(;e<=255;)jI[2*e+1]=9,e++,o[9]++;for(;e<=279;)jI[2*e+1]=7,e++,o[7]++;for(;e<=287;)jI[2*e+1]=8,e++,o[8]++;for(tO(jI,287,o),e=0;e<DI;e++)VI[2*e+1]=5,VI[2*e]=eO(e,5);HI=new zI(jI,xI,257,PI,LI),KI=new zI(VI,MI,0,DI,LI),YI=new zI(new Array(0),UI,0,19,7)})(),uO=!0),e.l_desc=new ZI(e.dyn_ltree,HI),e.d_desc=new ZI(e.dyn_dtree,KI),e.bl_desc=new ZI(e.bl_tree,YI),e.bi_buf=0,e.bi_valid=0,nO(e)},pO=(e,t,n,r)=>{let i,o,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<kI;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),aO(e,e.l_desc),aO(e,e.d_desc),s=(e=>{let t;for(cO(e,e.dyn_ltree,e.l_desc.max_code),cO(e,e.dyn_dtree,e.d_desc.max_code),aO(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*FI[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?dO(e,t,n,r):4===e.strategy||o===i?(QI(e,2+(r?1:0),3),sO(e,jI,VI)):(QI(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(QI(e,t-257,5),QI(e,n-1,5),QI(e,r-4,4),i=0;i<r;i++)QI(e,e.bl_tree[2*FI[i]+1],3);lO(e,e.dyn_ltree,t-1),lO(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),sO(e,e.dyn_ltree,e.dyn_dtree)),nO(e),r&&rO(e)},fO=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(GI[n]+kI+1)]++,e.dyn_dtree[2*JI(t)]++),e.sym_next===e.sym_end),mO={_tr_init:hO,_tr_stored_block:dO,_tr_flush_block:pO,_tr_tally:fO,_tr_align:e=>{QI(e,2,3),$I(e,256,jI),(e=>{16===e.bi_valid?(XI(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},gO=(e,t,n,r)=>{let i=65535&e|0,o=e>>>16&65535|0,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{i=i+t[r++]|0,o=o+i|0}while(--s);i%=65521,o%=65521}return i|o<<16|0};const _O=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var EO=(e,t,n,r)=>{const i=_O,o=r+n;e^=-1;for(let s=r;s<o;s++)e=e>>>8^i[255&(e^t[s])];return-1^e},vO={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},yO={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:bO,_tr_stored_block:SO,_tr_flush_block:TO,_tr_tally:wO,_tr_align:CO}=mO,{Z_NO_FLUSH:RO,Z_PARTIAL_FLUSH:IO,Z_FULL_FLUSH:OO,Z_FINISH:AO,Z_BLOCK:NO,Z_OK:kO,Z_STREAM_END:PO,Z_STREAM_ERROR:DO,Z_DATA_ERROR:LO,Z_BUF_ERROR:xO,Z_DEFAULT_COMPRESSION:MO,Z_FILTERED:UO,Z_HUFFMAN_ONLY:FO,Z_RLE:jO,Z_FIXED:VO,Z_DEFAULT_STRATEGY:BO,Z_UNKNOWN:GO,Z_DEFLATED:qO}=yO,WO=286,zO=30,HO=19,KO=2*WO+1,YO=15,ZO=258,JO=262,XO=42,QO=113,$O=666,eA=(e,t)=>(e.msg=vO[t],t),tA=e=>2*e-(e>4?9:0),nA=e=>{let t=e.length;for(;--t>=0;)e[t]=0},rA=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)};let iA=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const oA=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},sA=(e,t)=>{TO(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,oA(e.strm)},aA=(e,t)=>{e.pending_buf[e.pending++]=t},cA=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},lA=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=gO(e.adler,t,i,n):2===e.state.wrap&&(e.adler=EO(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},uA=(e,t)=>{let n,r,i=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match;const c=e.strstart>e.w_size-JO?e.strstart-(e.w_size-JO):0,l=e.window,u=e.w_mask,d=e.prev,h=e.strstart+ZO;let p=l[o+s-1],f=l[o+s];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(n=t,l[n+s]===f&&l[n+s-1]===p&&l[n]===l[o]&&l[++n]===l[o+1]){o+=2,n++;do{}while(l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&o<h);if(r=ZO-(h-o),o=h-ZO,r>s){if(e.match_start=t,s=r,r>=a)break;p=l[o+s-1],f=l[o+s]}}}while((t=d[t&u])>c&&0!=--i);return s<=e.lookahead?s:e.lookahead},dA=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-JO)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),rA(e),r+=t),0===e.strm.avail_in)break;if(n=lA(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=iA(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=iA(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<JO&&0!==e.strm.avail_in)},hA=(e,t)=>{let n,r,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,a=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<o&&(0===n&&t!==AO||t===RO||n!==r+e.strm.avail_in))break;s=t===AO&&n===r+e.strm.avail_in?1:0,SO(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,oA(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(lA(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===s);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==RO&&t!==AO&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(lA(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,o=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=o||(r||t===AO)&&t!==RO&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,s=t===AO&&0===e.strm.avail_in&&n===r?1:0,SO(e,e.block_start,n,s),e.block_start+=n,oA(e.strm)),s?3:1)},pA=(e,t)=>{let n,r;for(;;){if(e.lookahead<JO){if(dA(e),e.lookahead<JO&&t===RO)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=iA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-JO&&(e.match_length=uA(e,n)),e.match_length>=3)if(r=wO(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=iA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=iA(e,e.ins_h,e.window[e.strstart+1]);else r=wO(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(sA(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===AO?(sA(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(sA(e,!1),0===e.strm.avail_out)?1:2},fA=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<JO){if(dA(e),e.lookahead<JO&&t===RO)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=iA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-JO&&(e.match_length=uA(e,n),e.match_length<=5&&(e.strategy===UO||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=wO(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=iA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(sA(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=wO(e,0,e.window[e.strstart-1]),r&&sA(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=wO(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===AO?(sA(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(sA(e,!1),0===e.strm.avail_out)?1:2};function mA(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const gA=[new mA(0,0,0,0,hA),new mA(4,4,8,4,pA),new mA(4,5,16,8,pA),new mA(4,6,32,32,pA),new mA(4,4,16,16,fA),new mA(8,16,32,32,fA),new mA(8,16,128,128,fA),new mA(8,32,128,256,fA),new mA(32,128,258,1024,fA),new mA(32,258,258,4096,fA)];function _A(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=qO,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*KO),this.dyn_dtree=new Uint16Array(2*(2*zO+1)),this.bl_tree=new Uint16Array(2*(2*HO+1)),nA(this.dyn_ltree),nA(this.dyn_dtree),nA(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(YO+1),this.heap=new Uint16Array(2*WO+1),nA(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*WO+1),nA(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const EA=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==XO&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==QO&&t.status!==$O?1:0},vA=e=>{if(EA(e))return eA(e,DO);e.total_in=e.total_out=0,e.data_type=GO;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?XO:QO,e.adler=2===t.wrap?0:1,t.last_flush=-2,bO(t),kO},yA=e=>{const t=vA(e);var n;return t===kO&&((n=e.state).window_size=2*n.w_size,nA(n.head),n.max_lazy_match=gA[n.level].max_lazy,n.good_match=gA[n.level].good_length,n.nice_match=gA[n.level].nice_length,n.max_chain_length=gA[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},bA=(e,t,n,r,i,o)=>{if(!e)return DO;let s=1;if(t===MO&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>9||n!==qO||r<8||r>15||t<0||t>9||o<0||o>VO||8===r&&1!==s)return eA(e,DO);8===r&&(r=9);const a=new _A;return e.state=a,a.strm=e,a.status=XO,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=o,a.method=n,yA(e)};var SA=(e,t)=>{if(EA(e)||t>NO||t<0)return e?eA(e,DO):DO;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===$O&&t!==AO)return eA(e,0===e.avail_out?xO:DO);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(oA(e),0===e.avail_out)return n.last_flush=-1,kO}else if(0===e.avail_in&&tA(t)<=tA(r)&&t!==AO)return eA(e,xO);if(n.status===$O&&0!==e.avail_in)return eA(e,xO);if(n.status===XO&&0===n.wrap&&(n.status=QO),n.status===XO){let t=qO+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=FO||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,cA(n,t),0!==n.strstart&&(cA(n,e.adler>>>16),cA(n,65535&e.adler)),e.adler=1,n.status=QO,oA(e),0!==n.pending)return n.last_flush=-1,kO}if(57===n.status)if(e.adler=0,aA(n,31),aA(n,139),aA(n,8),n.gzhead)aA(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),aA(n,255&n.gzhead.time),aA(n,n.gzhead.time>>8&255),aA(n,n.gzhead.time>>16&255),aA(n,n.gzhead.time>>24&255),aA(n,9===n.level?2:n.strategy>=FO||n.level<2?4:0),aA(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(aA(n,255&n.gzhead.extra.length),aA(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=EO(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(aA(n,0),aA(n,0),aA(n,0),aA(n,0),aA(n,0),aA(n,9===n.level?2:n.strategy>=FO||n.level<2?4:0),aA(n,3),n.status=QO,oA(e),0!==n.pending)return n.last_flush=-1,kO;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=EO(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,oA(e),0!==n.pending)return n.last_flush=-1,kO;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=EO(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=EO(e.adler,n.pending_buf,n.pending-r,r)),oA(e),0!==n.pending)return n.last_flush=-1,kO;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,aA(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=EO(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=EO(e.adler,n.pending_buf,n.pending-r,r)),oA(e),0!==n.pending)return n.last_flush=-1,kO;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,aA(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=EO(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(oA(e),0!==n.pending))return n.last_flush=-1,kO;aA(n,255&e.adler),aA(n,e.adler>>8&255),e.adler=0}if(n.status=QO,oA(e),0!==n.pending)return n.last_flush=-1,kO}if(0!==e.avail_in||0!==n.lookahead||t!==RO&&n.status!==$O){let r=0===n.level?hA(n,t):n.strategy===FO?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(dA(e),0===e.lookahead)){if(t===RO)return 1;break}if(e.match_length=0,n=wO(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(sA(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===AO?(sA(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(sA(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===jO?((e,t)=>{let n,r,i,o;const s=e.window;for(;;){if(e.lookahead<=ZO){if(dA(e),e.lookahead<=ZO&&t===RO)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=s[i],r===s[++i]&&r===s[++i]&&r===s[++i])){o=e.strstart+ZO;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<o);e.match_length=ZO-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=wO(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=wO(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(sA(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===AO?(sA(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(sA(e,!1),0===e.strm.avail_out)?1:2})(n,t):gA[n.level].func(n,t);if(3!==r&&4!==r||(n.status=$O),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),kO;if(2===r&&(t===IO?CO(n):t!==NO&&(SO(n,0,0,!1),t===OO&&(nA(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),oA(e),0===e.avail_out))return n.last_flush=-1,kO}return t!==AO?kO:n.wrap<=0?PO:(2===n.wrap?(aA(n,255&e.adler),aA(n,e.adler>>8&255),aA(n,e.adler>>16&255),aA(n,e.adler>>24&255),aA(n,255&e.total_in),aA(n,e.total_in>>8&255),aA(n,e.total_in>>16&255),aA(n,e.total_in>>24&255)):(cA(n,e.adler>>>16),cA(n,65535&e.adler)),oA(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?kO:PO)},TA=(e,t)=>{let n=t.length;if(EA(e))return DO;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==XO||r.lookahead)return DO;if(1===i&&(e.adler=gO(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(nA(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const o=e.avail_in,s=e.next_in,a=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,dA(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=iA(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,dA(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=a,e.avail_in=o,r.wrap=i,kO},wA={deflateInit:(e,t)=>bA(e,t,qO,15,8,BO),deflateInit2:bA,deflateReset:yA,deflateResetKeep:vA,deflateSetHeader:(e,t)=>EA(e)||2!==e.state.wrap?DO:(e.state.gzhead=t,kO),deflate:SA,deflateEnd:e=>{if(EA(e))return DO;const t=e.state.status;return e.state=null,t===QO?eA(e,LO):kO},deflateSetDictionary:TA,deflateInfo:"pako deflate (from Nodeca project)"};const CA=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var RA={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)CA(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,o=e.length;r<o;r++){let t=e[r];n.set(t,i),i+=t.length}return n}};let IA=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){IA=!1}const OA=new Uint8Array(256);for(let n=0;n<256;n++)OA[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;OA[254]=OA[254]=1;var AA={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,o,s=e.length,a=0;for(i=0;i<s;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<s&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),o=0,i=0;o<a;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<s&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i;const o=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){o[i++]=t;continue}let s=OA[t];if(s>4)o[i++]=65533,r+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&r<n;)t=t<<6|63&e[r++],s--;s>1?o[i++]=65533:t<65536?o[i++]=t:(t-=65536,o[i++]=55296|t>>10&1023,o[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&IA)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(o,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+OA[e[n]]>t?n:t}},NA=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const kA=Object.prototype.toString,{Z_NO_FLUSH:PA,Z_SYNC_FLUSH:DA,Z_FULL_FLUSH:LA,Z_FINISH:xA,Z_OK:MA,Z_STREAM_END:UA,Z_DEFAULT_COMPRESSION:FA,Z_DEFAULT_STRATEGY:jA,Z_DEFLATED:VA}=yO;function BA(e){this.options=RA.assign({level:FA,method:VA,chunkSize:16384,windowBits:15,memLevel:8,strategy:jA},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new NA,this.strm.avail_out=0;let n=wA.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==MA)throw new Error(vO[n]);if(t.header&&wA.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?AA.string2buf(t.dictionary):"[object ArrayBuffer]"===kA.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=wA.deflateSetDictionary(this.strm,e),n!==MA)throw new Error(vO[n]);this._dict_set=!0}}function GA(e,t){const n=new BA(t);if(n.push(e,!0),n.err)throw n.msg||vO[n.err];return n.result}BA.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?xA:PA,"string"==typeof e?n.input=AA.string2buf(e):"[object ArrayBuffer]"===kA.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(o===DA||o===LA)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=wA.deflate(n,o),i===UA)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=wA.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===MA;if(0!==n.avail_out){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},BA.prototype.onData=function(e){this.chunks.push(e)},BA.prototype.onEnd=function(e){e===MA&&(this.result=RA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var qA={Deflate:BA,deflate:GA,deflateRaw:function(e,t){return(t=t||{}).raw=!0,GA(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,GA(e,t)},constants:yO};const WA=16209;var zA=function(e,t){let n,r,i,o,s,a,c,l,u,d,h,p,f,m,g,_,E,v,y,b,S,T,w,C;const R=e.state;n=e.next_in,w=e.input,r=n+(e.avail_in-5),i=e.next_out,C=e.output,o=i-(t-e.avail_out),s=i+(e.avail_out-257),a=R.dmax,c=R.wsize,l=R.whave,u=R.wnext,d=R.window,h=R.hold,p=R.bits,f=R.lencode,m=R.distcode,g=(1<<R.lenbits)-1,_=(1<<R.distbits)-1;e:do{p<15&&(h+=w[n++]<<p,p+=8,h+=w[n++]<<p,p+=8),E=f[h&g];t:for(;;){if(v=E>>>24,h>>>=v,p-=v,v=E>>>16&255,0===v)C[i++]=65535&E;else{if(!(16&v)){if(0==(64&v)){E=f[(65535&E)+(h&(1<<v)-1)];continue t}if(32&v){R.mode=16191;break e}e.msg="invalid literal/length code",R.mode=WA;break e}y=65535&E,v&=15,v&&(p<v&&(h+=w[n++]<<p,p+=8),y+=h&(1<<v)-1,h>>>=v,p-=v),p<15&&(h+=w[n++]<<p,p+=8,h+=w[n++]<<p,p+=8),E=m[h&_];n:for(;;){if(v=E>>>24,h>>>=v,p-=v,v=E>>>16&255,!(16&v)){if(0==(64&v)){E=m[(65535&E)+(h&(1<<v)-1)];continue n}e.msg="invalid distance code",R.mode=WA;break e}if(b=65535&E,v&=15,p<v&&(h+=w[n++]<<p,p+=8,p<v&&(h+=w[n++]<<p,p+=8)),b+=h&(1<<v)-1,b>a){e.msg="invalid distance too far back",R.mode=WA;break e}if(h>>>=v,p-=v,v=i-o,b>v){if(v=b-v,v>l&&R.sane){e.msg="invalid distance too far back",R.mode=WA;break e}if(S=0,T=d,0===u){if(S+=c-v,v<y){y-=v;do{C[i++]=d[S++]}while(--v);S=i-b,T=C}}else if(u<v){if(S+=c+u-v,v-=u,v<y){y-=v;do{C[i++]=d[S++]}while(--v);if(S=0,u<y){v=u,y-=v;do{C[i++]=d[S++]}while(--v);S=i-b,T=C}}}else if(S+=u-v,v<y){y-=v;do{C[i++]=d[S++]}while(--v);S=i-b,T=C}for(;y>2;)C[i++]=T[S++],C[i++]=T[S++],C[i++]=T[S++],y-=3;y&&(C[i++]=T[S++],y>1&&(C[i++]=T[S++]))}else{S=i-b;do{C[i++]=C[S++],C[i++]=C[S++],C[i++]=C[S++],y-=3}while(y>2);y&&(C[i++]=C[S++],y>1&&(C[i++]=C[S++]))}break}}break}}while(n<r&&i<s);y=p>>3,n-=y,p-=y<<3,h&=(1<<p)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<s?s-i+257:257-(i-s),R.hold=h,R.bits=p};const HA=15,KA=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),YA=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ZA=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),JA=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var XA=(e,t,n,r,i,o,s,a)=>{const c=a.bits;let l,u,d,h,p,f,m=0,g=0,_=0,E=0,v=0,y=0,b=0,S=0,T=0,w=0,C=null;const R=new Uint16Array(16),I=new Uint16Array(16);let O,A,N,k=null;for(m=0;m<=HA;m++)R[m]=0;for(g=0;g<r;g++)R[t[n+g]]++;for(v=c,E=HA;E>=1&&0===R[E];E--);if(v>E&&(v=E),0===E)return i[o++]=20971520,i[o++]=20971520,a.bits=1,0;for(_=1;_<E&&0===R[_];_++);for(v<_&&(v=_),S=1,m=1;m<=HA;m++)if(S<<=1,S-=R[m],S<0)return-1;if(S>0&&(0===e||1!==E))return-1;for(I[1]=0,m=1;m<HA;m++)I[m+1]=I[m]+R[m];for(g=0;g<r;g++)0!==t[n+g]&&(s[I[t[n+g]]++]=g);if(0===e?(C=k=s,f=20):1===e?(C=KA,k=YA,f=257):(C=ZA,k=JA,f=0),w=0,g=0,m=_,p=o,y=v,b=0,d=-1,T=1<<v,h=T-1,1===e&&T>852||2===e&&T>592)return 1;for(;;){O=m-b,s[g]+1<f?(A=0,N=s[g]):s[g]>=f?(A=k[s[g]-f],N=C[s[g]-f]):(A=96,N=0),l=1<<m-b,u=1<<y,_=u;do{u-=l,i[p+(w>>b)+u]=O<<24|A<<16|N|0}while(0!==u);for(l=1<<m-1;w&l;)l>>=1;if(0!==l?(w&=l-1,w+=l):w=0,g++,0==--R[m]){if(m===E)break;m=t[n+s[g]]}if(m>v&&(w&h)!==d){for(0===b&&(b=v),p+=_,y=m-b,S=1<<y;y+b<E&&(S-=R[y+b],!(S<=0));)y++,S<<=1;if(T+=1<<y,1===e&&T>852||2===e&&T>592)return 1;d=w&h,i[d]=v<<24|y<<16|p-o|0}}return 0!==w&&(i[p+w]=m-b<<24|64<<16|0),a.bits=v,0};const{Z_FINISH:QA,Z_BLOCK:$A,Z_TREES:eN,Z_OK:tN,Z_STREAM_END:nN,Z_NEED_DICT:rN,Z_STREAM_ERROR:iN,Z_DATA_ERROR:oN,Z_MEM_ERROR:sN,Z_BUF_ERROR:aN,Z_DEFLATED:cN}=yO,lN=16180,uN=16190,dN=16191,hN=16192,pN=16194,fN=16199,mN=16200,gN=16206,_N=16209,EN=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function vN(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const yN=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<lN||t.mode>16211?1:0},bN=e=>{if(yN(e))return iN;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=lN,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,tN},SN=e=>{if(yN(e))return iN;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,bN(e)},TN=(e,t)=>{let n;if(yN(e))return iN;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?iN:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,SN(e))},wN=(e,t)=>{if(!e)return iN;const n=new vN;e.state=n,n.strm=e,n.window=null,n.mode=lN;const r=TN(e,t);return r!==tN&&(e.state=null),r};let CN,RN,IN=!0;const ON=e=>{if(IN){CN=new Int32Array(512),RN=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(XA(1,e.lens,0,288,CN,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;XA(2,e.lens,0,32,RN,0,e.work,{bits:5}),IN=!1}e.lencode=CN,e.lenbits=9,e.distcode=RN,e.distbits=5},AN=(e,t,n,r)=>{let i;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>r&&(i=r),o.window.set(t.subarray(n-r,n-r+i),o.wnext),(r-=i)?(o.window.set(t.subarray(n-r,n),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var NN=(e,t)=>{let n,r,i,o,s,a,c,l,u,d,h,p,f,m,g,_,E,v,y,b,S,T,w=0;const C=new Uint8Array(4);let R,I;const O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(yN(e)||!e.output||!e.input&&0!==e.avail_in)return iN;n=e.state,n.mode===dN&&(n.mode=hN),s=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,l=n.hold,u=n.bits,d=a,h=c,T=tN;e:for(;;)switch(n.mode){case lN:if(0===n.wrap){n.mode=hN;break}for(;u<16;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,C[0]=255&l,C[1]=l>>>8&255,n.check=EO(n.check,C,2,0),l=0,u=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=_N;break}if((15&l)!==cN){e.msg="unknown compression method",n.mode=_N;break}if(l>>>=4,u-=4,S=8+(15&l),0===n.wbits&&(n.wbits=S),S>15||S>n.wbits){e.msg="invalid window size",n.mode=_N;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&l?16189:dN,l=0,u=0;break;case 16181:for(;u<16;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(n.flags=l,(255&n.flags)!==cN){e.msg="unknown compression method",n.mode=_N;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=_N;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=EO(n.check,C,2,0)),l=0,u=0,n.mode=16182;case 16182:for(;u<32;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}n.head&&(n.head.time=l),512&n.flags&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,C[2]=l>>>16&255,C[3]=l>>>24&255,n.check=EO(n.check,C,4,0)),l=0,u=0,n.mode=16183;case 16183:for(;u<16;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=EO(n.check,C,2,0)),l=0,u=0,n.mode=16184;case 16184:if(1024&n.flags){for(;u<16;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=EO(n.check,C,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(p=n.length,p>a&&(p=a),p&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(o,o+p),S)),512&n.flags&&4&n.wrap&&(n.check=EO(n.check,r,p,o)),a-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===a)break e;p=0;do{S=r[o+p++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S))}while(S&&p<a);if(512&n.flags&&4&n.wrap&&(n.check=EO(n.check,r,p,o)),a-=p,o+=p,S)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===a)break e;p=0;do{S=r[o+p++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S))}while(S&&p<a);if(512&n.flags&&4&n.wrap&&(n.check=EO(n.check,r,p,o)),a-=p,o+=p,S)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;u<16;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(4&n.wrap&&l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=_N;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=dN;break;case 16189:for(;u<32;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}e.adler=n.check=EN(l),l=0,u=0,n.mode=uN;case uN:if(0===n.havedict)return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=l,n.bits=u,rN;e.adler=n.check=1,n.mode=dN;case dN:if(t===$A||t===eN)break e;case hN:if(n.last){l>>>=7&u,u-=7&u,n.mode=gN;break}for(;u<3;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}switch(n.last=1&l,l>>>=1,u-=1,3&l){case 0:n.mode=16193;break;case 1:if(ON(n),n.mode=fN,t===eN){l>>>=2,u-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=_N}l>>>=2,u-=2;break;case 16193:for(l>>>=7&u,u-=7&u;u<32;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=_N;break}if(n.length=65535&l,l=0,u=0,n.mode=pN,t===eN)break e;case pN:n.mode=16195;case 16195:if(p=n.length,p){if(p>a&&(p=a),p>c&&(p=c),0===p)break e;i.set(r.subarray(o,o+p),s),a-=p,o+=p,c-=p,s+=p,n.length-=p;break}n.mode=dN;break;case 16196:for(;u<14;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(n.nlen=257+(31&l),l>>>=5,u-=5,n.ndist=1+(31&l),l>>>=5,u-=5,n.ncode=4+(15&l),l>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=_N;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;u<3;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}n.lens[O[n.have++]]=7&l,l>>>=3,u-=3}for(;n.have<19;)n.lens[O[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,R={bits:n.lenbits},T=XA(0,n.lens,0,19,n.lencode,0,n.work,R),n.lenbits=R.bits,T){e.msg="invalid code lengths set",n.mode=_N;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;w=n.lencode[l&(1<<n.lenbits)-1],g=w>>>24,_=w>>>16&255,E=65535&w,!(g<=u);){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(E<16)l>>>=g,u-=g,n.lens[n.have++]=E;else{if(16===E){for(I=g+2;u<I;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(l>>>=g,u-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=_N;break}S=n.lens[n.have-1],p=3+(3&l),l>>>=2,u-=2}else if(17===E){for(I=g+3;u<I;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}l>>>=g,u-=g,S=0,p=3+(7&l),l>>>=3,u-=3}else{for(I=g+7;u<I;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}l>>>=g,u-=g,S=0,p=11+(127&l),l>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=_N;break}for(;p--;)n.lens[n.have++]=S}}if(n.mode===_N)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=_N;break}if(n.lenbits=9,R={bits:n.lenbits},T=XA(1,n.lens,0,n.nlen,n.lencode,0,n.work,R),n.lenbits=R.bits,T){e.msg="invalid literal/lengths set",n.mode=_N;break}if(n.distbits=6,n.distcode=n.distdyn,R={bits:n.distbits},T=XA(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,R),n.distbits=R.bits,T){e.msg="invalid distances set",n.mode=_N;break}if(n.mode=fN,t===eN)break e;case fN:n.mode=mN;case mN:if(a>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=l,n.bits=u,zA(e,h),s=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,l=n.hold,u=n.bits,n.mode===dN&&(n.back=-1);break}for(n.back=0;w=n.lencode[l&(1<<n.lenbits)-1],g=w>>>24,_=w>>>16&255,E=65535&w,!(g<=u);){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(_&&0==(240&_)){for(v=g,y=_,b=E;w=n.lencode[b+((l&(1<<v+y)-1)>>v)],g=w>>>24,_=w>>>16&255,E=65535&w,!(v+g<=u);){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}l>>>=v,u-=v,n.back+=v}if(l>>>=g,u-=g,n.back+=g,n.length=E,0===_){n.mode=16205;break}if(32&_){n.back=-1,n.mode=dN;break}if(64&_){e.msg="invalid literal/length code",n.mode=_N;break}n.extra=15&_,n.mode=16201;case 16201:if(n.extra){for(I=n.extra;u<I;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;w=n.distcode[l&(1<<n.distbits)-1],g=w>>>24,_=w>>>16&255,E=65535&w,!(g<=u);){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(0==(240&_)){for(v=g,y=_,b=E;w=n.distcode[b+((l&(1<<v+y)-1)>>v)],g=w>>>24,_=w>>>16&255,E=65535&w,!(v+g<=u);){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}l>>>=v,u-=v,n.back+=v}if(l>>>=g,u-=g,n.back+=g,64&_){e.msg="invalid distance code",n.mode=_N;break}n.offset=E,n.extra=15&_,n.mode=16203;case 16203:if(n.extra){for(I=n.extra;u<I;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=_N;break}n.mode=16204;case 16204:if(0===c)break e;if(p=h-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=_N;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=i,f=s-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{i[s++]=m[f++]}while(--p);0===n.length&&(n.mode=mN);break;case 16205:if(0===c)break e;i[s++]=n.length,c--,n.mode=mN;break;case gN:if(n.wrap){for(;u<32;){if(0===a)break e;a--,l|=r[o++]<<u,u+=8}if(h-=c,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=n.flags?EO(n.check,i,h,s-h):gO(n.check,i,h,s-h)),h=c,4&n.wrap&&(n.flags?l:EN(l))!==n.check){e.msg="incorrect data check",n.mode=_N;break}l=0,u=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;u<32;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(4&n.wrap&&l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=_N;break}l=0,u=0}n.mode=16208;case 16208:T=nN;break e;case _N:T=oN;break e;case 16210:return sN;default:return iN}return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=l,n.bits=u,(n.wsize||h!==e.avail_out&&n.mode<_N&&(n.mode<gN||t!==QA))&&AN(e,e.output,e.next_out,h-e.avail_out),d-=e.avail_in,h-=e.avail_out,e.total_in+=d,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=n.flags?EO(n.check,i,h,e.next_out-h):gO(n.check,i,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===dN?128:0)+(n.mode===fN||n.mode===pN?256:0),(0===d&&0===h||t===QA)&&T===tN&&(T=aN),T},kN={inflateReset:SN,inflateReset2:TN,inflateResetKeep:bN,inflateInit:e=>wN(e,15),inflateInit2:wN,inflate:NN,inflateEnd:e=>{if(yN(e))return iN;let t=e.state;return t.window&&(t.window=null),e.state=null,tN},inflateGetHeader:(e,t)=>{if(yN(e))return iN;const n=e.state;return 0==(2&n.wrap)?iN:(n.head=t,t.done=!1,tN)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,o;return yN(e)?iN:(r=e.state,0!==r.wrap&&r.mode!==uN?iN:r.mode===uN&&(i=1,i=gO(i,t,n,0),i!==r.check)?oN:(o=AN(e,t,n,n),o?(r.mode=16210,sN):(r.havedict=1,tN)))},inflateInfo:"pako inflate (from Nodeca project)"},PN=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const DN=Object.prototype.toString,{Z_NO_FLUSH:LN,Z_FINISH:xN,Z_OK:MN,Z_STREAM_END:UN,Z_NEED_DICT:FN,Z_STREAM_ERROR:jN,Z_DATA_ERROR:VN,Z_MEM_ERROR:BN}=yO;function GN(e){this.options=RA.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new NA,this.strm.avail_out=0;let n=kN.inflateInit2(this.strm,t.windowBits);if(n!==MN)throw new Error(vO[n]);if(this.header=new PN,kN.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=AA.string2buf(t.dictionary):"[object ArrayBuffer]"===DN.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=kN.inflateSetDictionary(this.strm,t.dictionary),n!==MN)))throw new Error(vO[n])}function qN(e,t){const n=new GN(t);if(n.push(e),n.err)throw n.msg||vO[n.err];return n.result}GN.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let o,s,a;if(this.ended)return!1;for(s=t===~~t?t:!0===t?xN:LN,"[object ArrayBuffer]"===DN.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),o=kN.inflate(n,s),o===FN&&i&&(o=kN.inflateSetDictionary(n,i),o===MN?o=kN.inflate(n,s):o===VN&&(o=FN));n.avail_in>0&&o===UN&&n.state.wrap>0&&0!==e[n.next_in];)kN.inflateReset(n),o=kN.inflate(n,s);switch(o){case jN:case VN:case FN:case BN:return this.onEnd(o),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||o===UN))if("string"===this.options.to){let e=AA.utf8border(n.output,n.next_out),t=n.next_out-e,i=AA.buf2string(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==MN||0!==a){if(o===UN)return o=kN.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},GN.prototype.onData=function(e){this.chunks.push(e)},GN.prototype.onEnd=function(e){e===MN&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=RA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var WN={Inflate:GN,inflate:qN,inflateRaw:function(e,t){return(t=t||{}).raw=!0,qN(e,t)},ungzip:qN,constants:yO};const{Deflate:zN,deflate:HN,deflateRaw:KN,gzip:YN}=qA,{Inflate:ZN,inflate:JN,inflateRaw:XN,ungzip:QN}=WN;var $N,ek=HN,tk=JN;!function(e){e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE"}($N||($N={}));class nk{constructor(){rh(this,"_sequence",0),rh(this,"_startTime",Date.now()),rh(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const n=new Uint8Array(4);n.set([1,0,0,0]);const r={id:0,length:4,data:n.buffer},i={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[r]};t.commonPacketHeader.extension=1,t.extension=i,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;const n=new ArrayBuffer(t.commonPacketHeader.length),r=new Uint8Array(n),i=new DataView(n);let o=0;if(i.setUint16(o,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),o+=2,i.setUint32(o,t.commonPacketHeader.sequence,!0),o+=4,i.setUint16(o,t.commonStreamHeader,!0),o+=2,t.extension){const e=this.serializeExtension(t.extension);r.set(new Uint8Array(e),o),o+=e.byteLength}if(r.set(new Uint8Array(t.payload),o),o+=t.payload.byteLength,o!==t.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const t=new DataView(e);let n=0;const r=t.getUint16(n,!0);n+=2;const i=(32768&r)>>15;let o,s;if(t.getUint16(n+2,!0),t.getUint16(n,!0),n+=4,t.getUint16(n,!0),n+=2,i){s=this.deserializeExtension(e.slice(n)),n+=2+s.length,o=e.slice(n);let t=!1;if(s.datas.length>0){const e=s.datas.find((e=>0===e.id));e&&(t=1==(1&new DataView(e.data).getUint32(0,!0)))}o=t?this.decompress(o):o}else o=e.slice(8);return o}serializeExtension(e){const{profile:t,length:n,datas:r}=e,i=new ArrayBuffer(n+2),o=new Uint8Array(i),s=new DataView(i);let a=0;if(s.setUint8(a++,t),s.setUint8(a++,n),r.forEach((e=>{t?(s.setUint8(a++,e.id),s.setUint8(a++,e.length),o.set(new Uint8Array(e.data),a),a+=e.data.byteLength):(s.setUint8(a++,e.id|e.length<<4),o.set(new Uint8Array(e.data),a),a+=e.data.byteLength)})),a!==n+2)throw Error("serialize extension error, is ".concat(a,"!==").concat(n+2));return i}deserializeExtension(e){const t=new DataView(e);let n=0;const r=t.getUint8(n);n++;const i=t.getUint8(n);n++;const o=r===$N.TWO_BYTE,s=[],a=new DataView(e,2);let c=0;for(;c<i;){let e=0,t=0,n=new ArrayBuffer(0);o?(e=a.getUint8(c),c++,t=a.getUint8(c),c++):(e=15&a.getUint8(c),t=a.getUint8(c)>>4,c++),t>0&&(n=a.buffer.slice(c+2,c+2+t),c+=n.byteLength),s.push({id:e,length:t,data:n})}if(c!==i)throw Error("parse error");return{profile:r,length:i,datas:s}}decompress(e){return tk(new Uint8Array(e))}compress(e){return ek(new Uint8Array(e))}}class rk extends nv{constructor(e,t){super(),rh(this,"_version",1),rh(this,"_type",3),rh(this,"_config",void 0),rh(this,"_originDataChannel",void 0),rh(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),rh(this,"_dataStreamPacketHandler",void 0),rh(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader(),this._dataStreamPacketHandler=new nk}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return LS("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new tE(((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();const n=setTimeout((()=>{var e;t(new FE(UE.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new FE(UE.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new FE(UE.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[eR.OPEN,eR.CLOSE,eR.ERROR].forEach((t=>{const n=()=>{this.emit(t)};this._datachannelEventMap.set(t,n),e.addEventListener(t,n)}))}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach((t=>{let[n,r]=t;e.removeEventListener(n,r)})),this._datachannelEventMap.clear()}}class ik extends rk{constructor(e){super(e),rh(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const t=e.data.slice(0,this._dataStreamPacketHeader.byteLength);if(new DataView(t).getUint8(3)!==this.id)return;let n=e.data.slice(this._dataStreamPacketHeader.byteLength);n=this._dataStreamPacketHandler.deserialize(n),this.emit(eR.MESSAGE,n)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class ok extends rk{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);const n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}class sk extends nv{constructor(){super(...arguments),rh(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}setRemoteAudioStats(e,t){const n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(LS("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(n),r.result.length>=5)){var i;const n=Di(i=r.result).call(i,!0);r.isPrevNormal&&!n&&this.emit("exception",ak[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",ak[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof tI&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=gk(t._encoderConfig.frameRate));const r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof tI&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}const ak={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},ck=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function lk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function uk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lk(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lk(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class dk{constructor(e){rh(this,"store",void 0),rh(this,"onStatsException",void 0),rh(this,"onUploadPublishDuration",void 0),rh(this,"onStatsChanged",void 0),rh(this,"localStats",new Map),rh(this,"remoteStats",new Map),rh(this,"updateStatsInterval",void 0),rh(this,"trafficStats",void 0),rh(this,"trafficStatsPeerList",[]),rh(this,"uplinkStats",void 0),rh(this,"exceptionMonitor",void 0),rh(this,"p2pChannel",void 0),rh(this,"scalabilityMode",uT.L1T1),rh(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=e,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new sk,this.exceptionMonitor.on("exception",((e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)}))}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(fw.LocalAudioTrack)||uk({},qC)}getLocalVideoTrackStats(){return this.localStats.get(fw.LocalVideoTrack)||uk({},WC)}getRemoteAudioTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.audioStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{audioStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRemoteNetworkQualityStats(e){const t={};if(e){var n;const r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach((e=>{let[n,{networkStats:r}]=e;r&&(t[n]=r)}));return t}getRemoteVideoTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.videoStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{videoStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRTCStats(){let e=0,t=0,n=0,r=0;const i=this.localStats.get(fw.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);const o=this.localStats.get(fw.LocalVideoTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate);const s=this.localStats.get(fw.LocalVideoLowTrack);s&&(e+=s.sendBytes,t+=s.sendBitrate),this.remoteStats.forEach((e=>{let{audioStats:t,videoStats:i}=e;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)}));let a=1;return this.trafficStats&&(a+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:a,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter((e=>void 0!==e.B_ppad||void 0!==e.B_ppvd)),e.peer_delay.filter((e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid))).forEach((e=>{var t;const n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),r=null!=n&&n.videoSSRC?ck.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,i=null!=n&&n.audioSSRC?ck.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>i?r:i),this.trafficStatsPeerList.push(e.peer_uid))})),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&zS.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;const r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach((t=>{let[n,r]=t;switch(n){case fw.LocalVideoTrack:case fw.LocalVideoLowTrack:{const t=r,o=uk({},WC),s=e.getStats(),a=e.getLocalMedia(n);if(s){const n=s.videoSend.find((e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId)));if(n){const r=e.getLocalVideoSize(),i=e.getEncoderConfig(fw.LocalVideoTrack);"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(o.codecType=n.codec),o.sendBytes=n.bytes,o.sendBitrate=t?8*Math.max(0,o.sendBytes-t.sendBytes):0,n.inputFrame?(o.captureFrameRate=n.inputFrame.frameRate,o.captureResolutionHeight=n.inputFrame.height,o.captureResolutionWidth=n.inputFrame.width):r&&(o.captureResolutionWidth=r.width,o.captureResolutionHeight=r.height),n.sentFrame?(o.sendFrameRate=n.sentFrame.frameRate,o.sendResolutionHeight=n.sentFrame.height,o.sendResolutionWidth=n.sentFrame.width):r&&(o.sendResolutionWidth=r.width,o.sendResolutionHeight=r.height),n.avgEncodeMs&&(o.encodeDelay=n.avgEncodeMs),i&&i.bitrateMax&&(o.targetSendBitrate=1e3*i.bitrateMax),o.sendPackets=n.packets,o.sendPacketsLost=n.packetsLost,o.sendJitterMs=n.jitterMs,o.sendRttMs=n.rttMs,o.totalDuration=t?t.totalDuration+1:1,o.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(o.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(zS.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(o.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var i;this.localStats.set(n,o),((null==t?void 0:t.sendResolutionWidth)!==o.sendResolutionWidth||(null==t?void 0:t.sendResolutionHeight)!==o.sendResolutionHeight)&&(null===(i=this.onStatsChanged)||void 0===i||i.call(this,"resolution",{width:o.sendResolutionWidth,height:o.sendResolutionHeight})),o&&a&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,a.track,o);break}case fw.LocalAudioTrack:{const t=r,i=uk({},qC),o=e.getStats(),s=e.getLocalMedia(n);if(o){const n=o.audioSend.find((e=>e.ssrc===(null==s?void 0:s.ssrcs[0].ssrcId)));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(i.codecType=n.codec),n.inputLevel)i.sendVolumeLevel=Math.round(32767*n.inputLevel);else{const t=e.getLocalAudioVolume();t&&(i.sendVolumeLevel=Math.round(32767*t))}i.sendBytes=n.bytes,i.sendPackets=n.packets,i.sendPacketsLost=n.packetsLost,i.sendJitterMs=n.jitterMs,i.sendRttMs=n.rttMs,i.sendBitrate=t?8*Math.max(0,i.sendBytes-t.sendBytes):0}}this.trafficStats&&(i.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(fw.LocalAudioTrack,i),i&&s&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,s.track,i);break}}}))}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach((t=>{let[n,{videoStats:r,audioStats:i,videoPcStats:o}]=t;const s=i,a=r,c=o,l=uk({},zC),u=uk({},KC),d=uk({},HC),{audioTrack:h,videoTrack:p,audioSSRC:f,videoSSRC:m}=e.getRemoteMedia(n),g=e.getStats(),_=null==g?void 0:g.audioRecv.find((e=>e.ssrc===f)),E=null==g?void 0:g.videoRecv.find((e=>e.ssrc===m)),v=this.trafficStats&&this.trafficStats.peer_delay.find((e=>e.peer_uid===n));if(_&&("opus"!==_.codec&&"aac"!==_.codec&&"PCMU"!==_.codec&&"PCMA"!==_.codec&&"G722"!==_.codec||(l.codecType=_.codec),_.outputLevel?l.receiveLevel=Math.round(32767*_.outputLevel):h&&(l.receiveLevel=Math.round(32767*h.getVolumeLevel())),l.receiveBytes=_.bytes,l.receivePackets=_.packets,l.receivePacketsLost=_.packetsLost,l.packetLossRate=l.receivePacketsLost/(l.receivePackets+l.receivePacketsLost),l.receiveBitrate=s?8*Math.max(0,l.receiveBytes-s.receiveBytes):0,l.totalDuration=s?s.totalDuration+1:1,l.totalFreezeTime=s?s.totalFreezeTime:0,l.freezeRate=l.totalFreezeTime/l.totalDuration,l.receiveDelay=_.jitterBufferMs,l.totalDuration>10&&dk.isRemoteAudioFreeze(h)&&(l.totalFreezeTime+=1)),E){"H264"!==E.codec&&"H265"!==E.codec&&"VP8"!==E.codec&&"VP9"!==E.codec&&"AV1X"!==E.codec&&"AV1"!==E.codec||(u.codecType=E.codec),u.receiveBytes=E.bytes,u.receiveBitrate=a?8*Math.max(0,u.receiveBytes-a.receiveBytes):0,u.decodeFrameRate=E.decodeFrameRate<0?0:E.decodeFrameRate,u.renderFrameRate=E.decodeFrameRate<0?0:E.decodeFrameRate,E.outputFrame&&(u.renderFrameRate=E.outputFrame.frameRate),E.receivedFrame?(u.receiveFrameRate=E.receivedFrame.frameRate,u.receiveResolutionHeight=E.receivedFrame.height,u.receiveResolutionWidth=E.receivedFrame.width):p&&(u.receiveResolutionHeight=p._videoHeight||0,u.receiveResolutionWidth=p._videoWidth||0),void 0!==E.framesRateFirefox&&(u.receiveFrameRate=Math.round(E.framesRateFirefox)),u.receivePackets=E.packets,u.receivePacketsLost=E.packetsLost,u.packetLossRate=u.receivePacketsLost/(u.receivePackets+u.receivePacketsLost),u.totalDuration=a?a.totalDuration+1:1,u.totalFreezeTime=a?a.totalFreezeTime:0,u.receiveDelay=E.jitterBufferMs||0;const t=!!m&&e.getRemoteVideoIsReady(m);p&&t&&dk.isRemoteVideoFreeze(p,E,c)&&(u.totalFreezeTime+=1),u.freezeRate=u.totalFreezeTime/u.totalDuration}v&&(l.end2EndDelay=v.B_ad,u.end2EndDelay=v.B_vd,l.transportDelay=v.B_ed,u.transportDelay=v.B_ed,l.currentPacketLossRate=v.B_ealr4/100,u.currentPacketLossRate=v.B_evlr4/100,d.uplinkNetworkQuality=v.B_punq?v.B_punq:0,d.downlinkNetworkQuality=v.B_pdnq?v.B_pdnq:0),this.remoteStats.set(n,{audioStats:l,videoStats:u,videoPcStats:E,networkStats:d}),h&&this.exceptionMonitor.setRemoteAudioStats(h,l),p&&this.exceptionMonitor.setRemoteVideoStats(p,u)}))}}function hk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hk(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hk(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fk(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(LS("TURN_DOMAIN")):(zS.info("Cannot recognized as IP address ".concat(e,". Used As Host instead")),e)}function mk(e,t){var n,r;const i=LS("GATEWAY_DOMAINS");let o=i[1]&&-1!==t.indexOf(i[1])?1:0;e.addresses=e.addresses||[];const s=e.addresses.map((e=>e.domain_prefix?{address:"".concat(e.domain_prefix,".").concat(i[o++%i.length],":").concat(e.port)}:e.ip.match(/^[\.\:\d]+$/)?{ip:e.ip,port:e.port,address:"".concat(e.ip.replace(/[^\d]/g,"-"),".").concat(i[o++%i.length],":").concat(e.port)}:(zS.info("Cannot recognized as IP address ".concat(e.ip,". Used As Host instead")),{ip:e.ip,port:e.port,address:"".concat(e.ip,":").concat(e.port)})));if(null!==(n=e.detail)&&void 0!==n&&n[18]&&"string"==typeof(null===(r=e.detail)||void 0===r?void 0:r[18])){const t=e.detail[18],n=null==t?void 0:t.split(";");for(let e=0;e<n.length;e++){var a;const t=_C(a=n[e]).call(a);s[e]&&t&&(s[e].ip6=t)}}return{gatewayAddrs:s,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function gk(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function _k(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(gk(t.width),"x").concat(gk(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function Ek(e){const t={connectionType:0,googRtt:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t.connectionType=1),"tcp"===n&&(t.connectionType=3),"tls"===n&&(t.connectionType=4);break}case"srflx":t.connectionType=2}return t}function vk(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function yk(e,t){let n,r,i;switch(t){case dC.CHOOSE_SERVER:r=4096,i="choose server";break;case dC.CLOUD_PROXY:r=1048576,i="proxy";break;case dC.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case dC.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new UT(UE.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((t=>{t.buffer&&t.buffer.flag===r&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map((e=>pk(pk({},e),{},{ticket:t.buffer.cert}))),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:pk(pk({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})})),!n)throw new UT(UE.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function bk(e,t){return await tE.all(e.addresses.map((async e=>({address:fk(e.ip),tcpport:e.port,udpport:e.port,username:t&&LS("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():sT.username,password:t&&LS("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await tv(t.toString()):sT.password}))))}function Sk(e,t){const n=t._videoHeight||t.getMediaStreamTrack(!0).getSettings().height;return n?Math.max(n/gk(e.height),1):(zS.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Tk(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:o,protocol:s}=e;return"local-candidate"===r?{candidateType:t,relayProtocol:n,protocol:s}:{candidateType:t,relayProtocol:n,address:i,port:o,protocol:s}}function wk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class Ck extends nv{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Di(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(Sw.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Sw.CONNECTED):"closed"===this._state?this.emit(Sw.CLOSED):"failed"===this._state&&this.emit(Sw.FAILED))}constructor(e,t,n,r){super(),rh(this,"connectionID",0),rh(this,"currentURLIndex",0),rh(this,"reconnectReason",void 0),rh(this,"_reconnectMode","tryNext"),rh(this,"_name",void 0),rh(this,"_state","closed"),rh(this,"_retryConfig",void 0),rh(this,"_reconnectCount",0),rh(this,"_forceCloseTimeout",5e3),rh(this,"_onlineReconnectListener",void 0),rh(this,"_closeEstablishingTransmitter",(()=>{})),rh(this,"_store",void 0),rh(this,"_joinChannelServiceRecordIndex",void 0),rh(this,"_useCompress",void 0),rh(this,"_inflateLength",0),rh(this,"_deflateLength",0),this._store=r,this._name=e,this._retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wk(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wk(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this._useCompress=n}resetReconnectCount(e){zS.debug("".concat(this._name," reset reconnect count, reason: ").concat(e)),this._reconnectCount=0}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const e=this._transmitter;t?setTimeout((()=>e.close()),500):e.close(),this._transmitter=void 0}this.state=e?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(e,t){if(!this._transmitter)return void zS.warning("[".concat(this._name,"] can not reconnect, no websocket"));var n;void 0!==e&&(this.reconnectMode=e),zS.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(n=this._store)||void 0===n||n.recordJoinChannelService({status:"error",errors:[new Error(t)]},this._joinChannelServiceRecordIndex));const r=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),r&&r.bind(this._transmitter)({code:9999,reason:t})}getInflateData(){const e=this._inflateLength,t=this._deflateLength;return this.clearInflateData(),{inflateLength:e,deflateLength:t}}setInflateData(e){this._deflateLength=this._deflateLength+e.originLength,this._inflateLength=this._inflateLength+e.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}var Rk;!function(e){e[e.Default=0]="Default",e[e.Ack=1]="Ack"}(Rk||(Rk={}));class Ik{constructor(e,t,n){rh(this,"version",1),rh(this,"initialRTO",void 0),rh(this,"maxBatchAckCount",void 0),rh(this,"maxRTO",void 0),rh(this,"initialRTT",void 0),rh(this,"ID",void 0),rh(this,"rtt",void 0),rh(this,"packetNumber",1),rh(this,"rtoRatioMap",new Map),rh(this,"timeoutMap",new Map),rh(this,"unorderedPacketQueue",[]),rh(this,"batchAckPacketQueue",[]),rh(this,"lastOrderedPacketNumber",0),rh(this,"batchAckTimer",void 0),rh(this,"sendImpl",void 0),rh(this,"receiveImpl",void 0),this.sendImpl=e,this.receiveImpl=t,this.ID=Uv(7,"transmitter-"),this.initialRTO=void 0!==(null==n?void 0:n.initialRTO)?n.initialRTO:LS("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==(null==n?void 0:n.initialRTT)?n.initialRTT:LS("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==(null==n?void 0:n.initialRTT)?n.initialRTT:LS("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==(null==n?void 0:n.maxBatchAckCount)?n.maxBatchAckCount:LS("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==(null==n?void 0:n.maxRTO)?n.maxRTO:LS("TRANSMITTER_MAX_RTO")}packetize(e,t){return{type:Rk.Default,version:this.version,packetNumber:t,payload:e}}serialize(e){switch(e.type){case Rk.Default:{let t;t="string"==typeof e.payload?(new TextEncoder).encode(e.payload):e.payload;const n=new ArrayBuffer(t.length+15),r=new DataView(n);return r.setUint16(0,e.version),r.setUint8(2,e.type),r.setUint32(3,e.packetNumber),YE(r,7,BigInt(e.sendTs)),new Uint8Array(r.buffer).set(t,15),n}case Rk.Ack:{const t=new ArrayBuffer(16),n=new DataView(t);return n.setUint16(0,e.version),n.setUint8(2,e.type),n.setUint32(3,e.maxAckPacketNumber),n.setUint8(7,e.shift),YE(n,8,BigInt(e.ackSendTs)),t}}}deserialize(e){const t=new DataView(e),n=t.getUint16(0),r=t.getUint8(2);switch(r){case Rk.Default:{const i=t.getUint32(3),o=KE(t,7),s=e.slice(15),a=(new TextDecoder).decode(s);return{version:n,type:r,packetNumber:i,sendTs:Number(o),payload:a}}case Rk.Ack:{const e=t.getUint32(3),i=t.getUint8(7),o=KE(t,8);return{version:n,type:r,maxAckPacketNumber:e,shift:i,ackSendTs:Number(o)}}default:throw zS.error("[".concat(this.ID,"] Unrecognized packet type ").concat(r)),new Error("Unrecognized packet type ".concat(r))}}sendMessage(e){const t=this.packetize(e,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const n=this.calculateRTO(t),r=window.setTimeout((()=>{this.resendMessage(t)}),n);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}onData(e){const t=this.deserialize(e);t.type===Rk.Default?this.ack(t):t.type===Rk.Ack&&(this.updateRTT(t,Math.round(performance.now())),this.clearRTO(t))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach((e=>{let[t,n]=e;window.clearTimeout(n)})),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(e){const t=this.calculateRTO(e),n=window.setTimeout((()=>{this.resendMessage(e)}),t);this.timeoutMap.set(e.packetNumber,n),this.sendPacket(e)}calculateRTO(e){const t=this.rtoRatioMap.get(e.packetNumber);if(void 0===t)return this.rtoRatioMap.set(e.packetNumber,1),this.initialRTO;{const n=9*this.rtt/8*t;return this.rtoRatioMap.set(e.packetNumber,t+1),n>this.maxRTO?this.maxRTO:n}}updateRTT(e,t){const n=e.ackSendTs;this.rtt=this.rtt*(7/8)+(t-n-this.rtt)/8}ack(e){if(e.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(e):(this.batchAckPacketQueue.push(e),this.batchAckTimer=window.setTimeout((()=>{this.batchAck()}),this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(e.payload);;){const e=this.unorderedPacketQueue[0];if(!e){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(e.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(e.packetNumber<=this.lastOrderedPacketNumber){const t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:Rk.Ack,version:this.version};this.sendPacket(t)}else if(e.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[e.packetNumber-this.lastOrderedPacketNumber-2]=e;const t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:Rk.Ack,version:this.version};this.sendPacket(t)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const e={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Rk.Ack,version:this.version};this.sendPacket(e),this.batchAckPacketQueue=[]}sendPacket(e){e.type===Rk.Default&&(e.sendTs=Math.round(performance.now()));const t=this.serialize(e);this.sendImpl(t)}clearRTO(e){for(let t=e.maxAckPacketNumber-e.shift;t<=e.maxAckPacketNumber;t++){const e=this.timeoutMap.get(t);void 0!==e&&window.clearTimeout(e),this.timeoutMap.delete(t),this.rtoRatioMap.delete(t)}}}class Ok extends Ck{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),rh(this,"_initMutex",void 0),rh(this,"_reconnectInterrupter",void 0),rh(this,"_url",void 0),rh(this,"_transmitter",void 0),rh(this,"_addresses",void 0),rh(this,"_reliableTransmission",void 0),this._initMutex=new Hv("datachannel");const{timeout:n,timeoutFactor:r}=t,i=Math.max(300,Math.floor(3*n/5)),o=Math.max(1.2,Math.floor(8*r)/10);dv.ONLINE&&(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o),bv.on(hv.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===dv.ONLINE?(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o):(this._retryConfig.timeout=n,this._retryConfig.timeoutFactor=r))}))}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this._forceCloseTimeout=t;const n=(t,n)=>{this._addresses=e,this.currentURLIndex=this._addresses.findIndex((e=>e.fingerprint||LS("FINGERPRINT")));const r=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(r).then(t).catch(n),this.once(Sw.CLOSED,(()=>n(new UT(UE.WS_DISCONNECT)))),this.once(Sw.CONNECTED,(()=>t()))};return this._initMutex.lock().then((e=>new tE(((e,t)=>{n(e,t)})).then((()=>{e()})).catch((()=>{e()}))))}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new UT(UE.WS_ABORT,"datachannel is not ready");try{t||(e=JSON.stringify(e)),this._reliableTransmission.sendMessage(e)}catch(e){throw new UT(UE.WS_ERR,"send datachannel signal message error"+e.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(e){const t=JSON.stringify(e);return{compressed:t,compressedLength:t.length,origin:e}}sendMessageWithUint8Array(e){return{compressed:e,compressedLength:e.byteLength,origin:e}}createTransmitterConnection(e){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(e.ip,":").concat(e.port),new tE(((t,n)=>{var r;const i=()=>{zS.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),t()},o=async e=>{var r;if(null===(r=this._closeEstablishingTransmitter)||void 0===r||r.call(this),zS.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const r=vv(this,Sw.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,i=await this.reconnectWithAction(r);if("closed"===this.state)return void zS.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!i)return n(new UT(UE.WS_DISCONNECT,"datachannel reconnect failed: ".concat(e.code))),void this.close(!0);t()}else n(new UT(UE.WS_DISCONNECT,"datachannel close: ".concat(e.code))),this.close()},s=e=>{var t;null===(t=this._reliableTransmission)||void 0===t||t.onData(e.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),zS.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(e)));const a=null===(r=this._store)||void 0===r?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),c=Date.now();_v(this,Sw.TO_CONNECT_DATACHANNEL,e).then((e=>{var t,n;if(!e)throw new Error("transmissonInfo not exist yet");const{transmitter:r,close:l}=e;this._transmitter=r,null===(t=this._store)||void 0===t||t.signalChannelOpen();const u=Date.now()-c;zS.debug("[choose dc] dc open cost ".concat(u,"ms")),this._reliableTransmission=new Ik((e=>{var t;this._transmitter&&"open"===this._transmitter.readyState&&(null===(t=this._transmitter)||void 0===t||t.send(e))}),(e=>{"string"==typeof e&&this.emit(Sw.ON_MESSAGE,e)})),this._closeEstablishingTransmitter=()=>{var e;null===(e=this._reliableTransmission)||void 0===e||e.close(),this._reliableTransmission=void 0,l()},i&&i(),r.onclose=o,r.onmessage=s,null===(n=this._store)||void 0===n||n.recordJoinChannelService({endTs:Date.now(),status:"success"},a),this._joinChannelServiceRecordIndex=a})).catch((e=>{var t;if(null===(t=this._store)||void 0===t||t.recordJoinChannelService({endTs:Date.now(),status:e instanceof UT&&e.code===UE.WS_ABORT?"aborted":"error",errors:[e]},a),"closed"!==this.state){if(e instanceof UT&&e.code===UE.WS_ERR){const t=new UT(UE.WS_ERR,"init datachannel failed! Error: ".concat(e.toString()));return zS.error("[".concat(this._name,"]").concat(t)),void n(t)}o&&o(e)}else n(new UT(UE.WS_DISCONNECT,"datachannel is closed: ".concat(e.toString())))}))}))}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount)return!1;if(!this._addresses)return!1;if("closed"===this.state)return!1;this._onlineReconnectListener||bv.networkState!==dv.OFFLINE||(this._onlineReconnectListener=bv.onlineWaiter&&bv.onlineWaiter.then((()=>{this._onlineReconnectListener=void 0})));let n=!0;if(this._reconnectInterrupter=()=>{n=!1},t){const t=Zv(this._reconnectCount,this._retryConfig);zS.debug("[".concat(this._name,"] wait ").concat(t,"ms to reconnect datachannel, mode: ").concat(e)),await tE.race([Mv(t),this._onlineReconnectListener||new tE((()=>{}))])}if("closed"===this.state||!n)return!1;this._reconnectCount+=1;const r=async(e,t)=>{this.emit(Sw.RECONNECT_CREATE_CONNECTION,t),await this.createTransmitterConnection(e)};try{if("retry"===e){const t=this._addresses[this.currentURLIndex];this.emit(Sw.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else if("tryNext"===e){this.currentURLIndex+=1;for(let e=this.currentURLIndex;e<this._addresses.length;e++){if(this._addresses[e].fingerprint||LS("FINGERPRINT")){this.currentURLIndex=e;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return zS.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);zS.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const t=this._addresses[this.currentURLIndex];this.emit(Sw.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else"recover"===e&&(zS.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(Sw.RECONNECT_WAITTING_FINISH,e),this.emit(Sw.FAILBACK));return!0}catch(n){var i,o;return zS.error("[".concat(this._name,"] reconnect failed"),n.toString()),null!=n&&null!==(i=n.data)&&void 0!==i&&i.desc&&Array.isArray(n.data.desc)&&n.data.desc.length&&Di(o=n.data.desc).call(o,"dynamic key expired")?(this.emit(Sw.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(e,t)}}}class Ak extends nv{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===_T.CONNECTED?this.emit(ET.WS_CONNECTED):e===_T.RECONNECTING?this.emit(ET.WS_RECONNECTING,this._websocketReconnectReason):e===_T.CLOSED&&this.emit(ET.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),rh(this,"_disconnectedReason",void 0),rh(this,"_websocketReconnectReason",void 0),rh(this,"_connectionState",_T.CLOSED),rh(this,"reconnectToken",void 0),rh(this,"websocket",void 0),rh(this,"openConnectionTime",void 0),rh(this,"clientId",void 0),rh(this,"lastMsgTime",Date.now()),rh(this,"uploadCache",[]),rh(this,"uploadCacheInterval",void 0),rh(this,"rttRolling",new ly(5)),rh(this,"pingpongTimer",void 0),rh(this,"inflateDataTimer",void 0),rh(this,"pingpongTimeoutCount",0),rh(this,"joinResponse",void 0),rh(this,"multiIpOption",void 0),rh(this,"initError",void 0),rh(this,"spec",void 0),rh(this,"store",void 0),rh(this,"onWebsocketMessage",(e=>{if(e instanceof ArrayBuffer)return void this.emit(ET.ON_BINARY_DATA,e);const t=JSON.parse(e);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")&&(this.emit(t._type,t._message),t._type===bT.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===bT.ON_USER_BANNED))switch(t._message.error_code){case 14:this.close(cv.UID_BANNED);break;case 15:this.close(cv.IP_BANNED);break;case 16:this.close(cv.CHANNEL_BANNED)}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Ok("gateway-".concat(this.clientId),this.spec.retryConfig,!0,t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===_T.CONNECTED&&this.reconnect("retry",bw.OFFLINE)}))}async request(e,t,n,r){const i=Uv(6,""),o={_id:i,_type:e,_message:t},s=this.websocket.connectionID,a=()=>new tE(((t,n)=>{if(this.connectionState===_T.CONNECTED)return t();const r=()=>{this.off(ET.WS_CLOSED,i),t()},i=()=>{this.off(ET.WS_CONNECTED,r),n(new UT(UE.WS_ABORT))};this.once(ET.WS_CONNECTED,r),this.once(ET.WS_CLOSED,i),e!==vT.PUBLISH&&e!==vT.SUBSCRIBE&&e!==vT.UNSUBSCRIBE&&e!==vT.UNPUBLISH&&e!==vT.CONTROL&&e!==vT.RESTART_ICE||this.once(ET.DISCONNECT_P2P,(()=>{n(new UT(UE.DISCONNECT_P2P))})),e!==vT.PUBLISH&&e!==vT.RESTART_ICE||this.once(ET.ABORT_P2P_EXECUTION,(()=>{n(new UT(UE.DISCONNECT_P2P))}))}));if(this.connectionState!==_T.CONNECTING&&this.connectionState!==_T.RECONNECTING||e===vT.JOIN||e===vT.REJOIN||await a(),e===vT.LEAVE&&(this.websocket.unbindDcCloseEventListener(),r=!0),this.websocket.sendMessage(o,!0,!1),r)return;const c=new tE(((n,r)=>{let o=!1;const a=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(ET.WS_CLOSED,c),this.off(ET.WS_RECONNECTING,c),this.emit(ET.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),a);const c=()=>{r(new UT(UE.WS_ABORT,"type: ".concat(e))),this.off(ET.WS_CLOSED,c),this.off(ET.WS_RECONNECTING,c),this.off("res-@".concat(i),a)};this.once(ET.WS_CLOSED,c),this.once(ET.WS_RECONNECTING,c),Mv(LS("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==s||o||(zS.warning("dc request timeout, type: ".concat(e)),this.emit(ET.REQUEST_TIMEOUT,e,t))}))}));let l=null;try{l=await c}catch(r){if(this.connectionState===_T.CLOSED||e===vT.LEAVE)throw new UT(UE.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===vT.JOIN||e===vT.REJOIN?null:(await a(),await this.request(e,t))}if(l.isSuccess)return l.message;const u=Number(l.message.error_code||l.message.code),d=Mw(u),h=new UT(UE.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(l.message.error_str),{code:u,data:l.message});return"success"===d.action?l.message:(zS.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(u,", message: ").concat(d.desc,", action: ").concat(d.action)),u===gT.ERR_TOO_MANY_BROADCASTERS?e===vT.JOIN||e===vT.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(u===gT.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,zS.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",bw.MULTI_IP)):this.reconnect(d.action,bw.SERVER_ERROR),e===vT.JOIN||e===vT.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new tE((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=LS("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==_T.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),LS("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new tE(((n,r)=>{this.once(ET.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(ET.WS_CLOSED,(()=>r(this.initError||new UT(UE.WS_ABORT)))),this.connectionState=_T.CONNECTING,this.websocket.init(e).catch(r),this.websocket.once(Sw.FAILBACK,(()=>{void 0===this.openConnectionTime&&r(new UT(UE.INIT_DATACHANNEL_TIMEOUT))})),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval((()=>{this.handleInflateData()}),2e4),setTimeout((()=>{t&&void 0===this.openConnectionTime&&(zS.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),r(new UT(UE.INIT_DATACHANNEL_TIMEOUT)))}),LS("DC_JOIN_WITH_FAILBACK"))}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||cv.LEAVE,this.connectionState=_T.CLOSED,zS.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),e===cv.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Ok("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(ET.ABORT_P2P_EXECUTION);const e=await _v(this,ET.DATACHANNEL_CONNECTING),t=await this.request(vT.JOIN,e);if(!t)return this.emit(ET.REPORT_JOIN_GATEWAY,UE.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(ET.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=_T.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new UT(UE.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=yv(this,ET.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(vT.REJOIN,e);return!!t&&(this.connectionState=_T.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(bT.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(bT.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(bT.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(bT.MUTE_AUDIO,{uid:e.uid}):this.emit(bT.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(bT.MUTE_VIDEO,{uid:e.uid}):this.emit(bT.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(bT.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(bT.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(bT.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(bT.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(bT.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){zS.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Mw(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(cv.UID_BANNED),void this.close()):void this.reconnect(t.action,bw.SERVER_ERROR);zS.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=LS("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(zS.warning("PINGPONG Timeout. Last Socket Message: ".concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>LS("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",bw.TIMEOUT):this.request(vT.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),LS("REPORT_STATS")&&this.send(vT.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleInflateData(){const{inflateLength:e,deflateLength:t}=this.websocket.getInflateData();0!==e&&0!==t&&this.upload(yT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Sw.RECONNECT_WAITTING_FINISH,(e=>{this.emit(ET.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(Sw.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(ET.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(Sw.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Sw.CLOSED,(()=>{this.connectionState=_T.CLOSED})),this.websocket.on(Sw.FAILED,(()=>{this._disconnectedReason=cv.NETWORK_ERROR,this.connectionState=_T.CLOSED})),this.websocket.on(Sw.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===_T.CONNECTED?this.connectionState=_T.RECONNECTING:this.connectionState=_T.CONNECTING})),this.websocket.on(Sw.WILL_RECONNECT,((e,t)=>{if(yv(this,ET.IS_P2P_DISCONNECTED)&&"retry"===e)return zS.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ET.NEED_RENEW_SESSION),this.emit(ET.DISCONNECT_P2P),t("tryNext");"retry"!==e&&(zS.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(ET.NEED_RENEW_SESSION),this.emit(ET.DISCONNECT_P2P)),t(e)})),this.websocket.on(Sw.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{zS.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",bw.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(ET.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof UT&&e.code===UE.UNEXPECTED_RESPONSE&&e.data.code===gT.ERR_NO_AUTHORIZED)return zS.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",bw.SERVER_ERROR);zS.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",bw.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(Sw.REQUEST_NEW_URLS,((e,t)=>{_v(this,ET.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(Sw.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(bT.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(Sw.TO_CONNECT_DATACHANNEL,(async(e,t,n)=>_v(this,ET.DATACHANNEL_PRECONNECT,e).then(t).catch(n))),this.websocket.on(Sw.FAILBACK,(()=>{void 0!==this.openConnectionTime&&this.emit(ET.DATACHANNEL_FAILBACK)}))}}class Nk extends nv{constructor(e){super(),rh(this,"_signal",void 0),rh(this,"_sequence",0),rh(this,"_userMap",new Map),rh(this,"_encoder",new TextEncoder),this._signal=e}async send(e,t,n,r,i){var o,s,a;"string"!=typeof t&&(t=JSON.stringify(t)),r=null!==(o=r)&&void 0!==o?o:Uv(6,""),i=null!==(s=i)&&void 0!==s?s:this._sequence++;const c={_id:r,_type:e,_seq:null!==(a=i)&&void 0!==a?a:this._sequence++,_message:t};if(LS("SHOW_P2P_LOG")&&zS.debug("send message",c),this.sendStreamMessage(JSON.stringify(c)),n)return;const l=new tE(((t,n)=>{const i=window.setTimeout((()=>{this.off("res-@".concat(r),o),zS.warning("[external-signal] request timeout, type: ".concat(e)),0===this._userMap.size?n(new FE(UE.INVALID_REMOTE_USER)):n(new FE(UE.TIMEOUT))}),LS("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),o=(e,r)=>{i&&window.clearTimeout(i),"success"===e?t({isSuccess:!0,message:r}):n(new FE(UE.UNEXPECTED_ERROR,r))};this.once("res-@".concat(r),o)}));let u;try{u=await l}catch(n){if(n.code===UE.TIMEOUT)return await this.send(e,t,!1,r,i);throw n}return u.isSuccess?u.message:void 0}sendStreamMessage(e){this._splitMessage(e).forEach((e=>{this._signal.request(vT.DATA_STREAM,{payload:Pv(this._encoder.encode(e))})}))}onMessage(e){const{_uid:t}=e;let n;const r=this._userMap.get(t);if(r?n=r.splitMessageMap:(n=new Map,this._userMap.set(t,{isStart:!1,splitMessageMap:n,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in e&&"total"in e){var i;const{id:r,total:o}=e,s=null!==(i=n.get(r))&&void 0!==i?i:[];if(s.push(e),n.has(r)||n.set(r,s),s.length!==o)return;{const i=Qh(s).call(s,((e,t)=>e.index-t.index)).map((e=>e.payload)).join("");n.delete(r),(e=JSON.parse(i))._uid=t}}this.handleReceivedMessage(e)}setStart(e){this._userMap.has(e)?this._userMap.get(e).isStart=!0:this._userMap.set(e,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}setEnd(e){return this._userMap.delete(e),0===this._userMap.size}ack(e,t,n){this.send(Ow.ACK,JSON.stringify({success:!n,message:t}),!0,e)}handleReceivedMessage(e){const t=()=>{this._userMap.forEach((e=>{const{receivedMessagesMap:t,nextExpectedSequenceNumber:n}=e;for(;t.has(n);){const r=t.get(n);t.delete(n),this.receiveMessage(r),e.nextExpectedSequenceNumber++}}))};if(!e)return void t();const{_uid:n,_seq:r}=e,i=this._userMap.get(n),{receivedMessagesMap:o,isStart:s,nextExpectedSequenceNumber:a}=i;r<a?zS.debug("[external-signal] receive old message, seq: ".concat(r)):(o.set(r,e),s&&r===a&&(this.receiveMessage(e),o.delete(a),i.nextExpectedSequenceNumber++,t()))}receiveMessage(e){const{_id:t,_type:n,_message:r,_uid:i}=e;if(LS("SHOW_P2P_LOG")&&zS.debug("\u6536\u5230\u6d88\u606f",e),t)switch(e._type){case Ow.PUBLISH:const o=JSON.parse(r);this._signal.emit(n,o,i),this.ack(e._id);break;case Ow.CONTROL:case Ow.UNPUBLISH:case Ow.DO_SUBSCRIBE:case Ow.DO_UNSUBSCRIBE:{const t=JSON.parse(r);t.uid=i,_v(this._signal,n,t).then((t=>{this.ack(e._id,t)})).catch((t=>{this.ack(e._id,void 0,!0)}));break}case Ow.ACK:{const{success:e,message:n}=JSON.parse(r);this.emit("res-@".concat(t),e?"success":"failed",n);break}case Ow.CALL:_v(this,n,r).then((e=>{this.ack(t,e)}));break;case Ow.RESTART_ICE:case Ow.EXCHANGE_SDP:case Ow.SUBSCRIBE:case Ow.UNSUBSCRIBE:_v(this._signal,n,r).then((e=>{this.ack(t,e)})).catch((t=>{this.ack(e._id,void 0,!0)}));break;case Ow.CANDIDATE:this._signal.emit(n,r),this.ack(t);break;case Ow.JOIN:this.emit(n,JSON.parse(r));break;default:this.emit(n,r),this.ack(t)}}_splitMessage(e){if(e.length<Nk.MAX_MESSAGE_SIZE)return[e];const t=[],n=Uv(6,"");let r=0;const i=Math.ceil(e.length/800);for(;e.length>0;){r++;const o=e.slice(0,800);t.push({id:n,index:r,total:i,payload:o}),e=e.slice(800)}return t.map((e=>JSON.stringify(e)))}clear(){this._sequence=0,this._userMap.clear()}}rh(Nk,"MAX_MESSAGE_SIZE",1024);class kk extends nv{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===_T.CONNECTED?this.emit(ET.WS_CONNECTED):e===_T.RECONNECTING?this.emit(ET.WS_RECONNECTING,this._websocketReconnectReason):e===_T.CLOSED&&this.emit(ET.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),rh(this,"_disconnectedReason",void 0),rh(this,"_websocketReconnectReason",void 0),rh(this,"_connectionState",_T.CLOSED),rh(this,"reconnectToken",void 0),rh(this,"_userInRoom",!1),rh(this,"_userOnlineTime",void 0),rh(this,"websocket",void 0),rh(this,"openConnectionTime",void 0),rh(this,"clientId",void 0),rh(this,"lastMsgTime",Date.now()),rh(this,"uploadCache",[]),rh(this,"uploadCacheInterval",void 0),rh(this,"rttRolling",new ly(5)),rh(this,"pingpongTimer",void 0),rh(this,"wsInflateDataTimer",void 0),rh(this,"pingpongTimeoutCount",0),rh(this,"joinResponse",void 0),rh(this,"multiIpOption",void 0),rh(this,"initError",void 0),rh(this,"spec",void 0),rh(this,"store",void 0),rh(this,"_external_signal",void 0),rh(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(ET.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case bT.ON_DATA_STREAM:return void this.handleDataStream(t._message);case bT.MUTE_AUDIO:case bT.MUTE_VIDEO:case bT.ON_P2P_LOST:return;case bT.ON_USER_ONLINE:this.emit(t._type,t._message);const{uid:e}=t._message;return this._external_signal.setStart(e),void this._external_signal.send(Ow.JOIN,{onlineTime:this._userOnlineTime},!0)}if(this.emit(t._type,t._message),t._type===bT.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===bT.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(cv.UID_BANNED);break;case 15:this.close(cv.IP_BANNED);break;case 16:this.close(cv.CHANNEL_BANNED)}if(t._type===bT.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case gT.ERR_LICENSE_MISSING:this.close(cv.LICENSE_MISSING);break;case gT.ERR_LICENSE_EXPIRED:this.close(cv.LICENSE_EXPIRED);break;case gT.ERR_LICENSE_MINUTES_EXCEEDED:this.close(cv.LICENSE_MINUTES_EXCEEDED);break;case gT.ERR_LICENSE_PERIOD_INVALID:this.close(cv.LICENSE_PERIOD_INVALID);break;case gT.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(cv.LICENSE_MULTIPLE_SDK_SERVICE);break;case gT.ERR_LICENSE_ILLEGAL:this.close(cv.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Zw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,LS("JOIN_GATEWAY_USE_DUAL_DOMAIN"),LS("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===_T.CONNECTED&&this.reconnect("retry",uv.OFFLINE)})),this._external_signal=new Nk(this),this._handleSignalP2PEvents()}async request(e,t,n,r){const i=Uv(6,""),o={_id:i,_type:e,_message:t},s=this.websocket.connectionID,a=()=>new tE(((t,n)=>{if(this.connectionState===_T.CONNECTED)return t();const r=()=>{this.off(ET.WS_CLOSED,i),t()},i=()=>{this.off(ET.WS_CONNECTED,r),n(new FE(UE.WS_ABORT))};this.once(ET.WS_CONNECTED,r),this.once(ET.WS_CLOSED,i),e!==vT.PUBLISH&&e!==vT.SUBSCRIBE&&e!==vT.UNSUBSCRIBE&&e!==vT.UNPUBLISH&&e!==vT.CONTROL&&e!==vT.RESTART_ICE||this.once(ET.DISCONNECT_P2P,(()=>{n(new FE(UE.DISCONNECT_P2P))})),e!==vT.PUBLISH&&e!==vT.RESTART_ICE||this.once(ET.ABORT_P2P_EXECUTION,(()=>{n(new FE(UE.DISCONNECT_P2P))}))}));if(this.connectionState!==_T.CONNECTING&&this.connectionState!==_T.RECONNECTING||e===vT.JOIN||e===vT.REJOIN||await a(),this.websocket.sendMessage(o,!0),r)return;const c=new tE(((n,r)=>{let o=!1;const a=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(ET.WS_CLOSED,c),this.off(ET.WS_RECONNECTING,c),this.emit(ET.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),a);const c=()=>{r(new FE(UE.WS_ABORT,"type: ".concat(e))),this.off(ET.WS_CLOSED,c),this.off(ET.WS_RECONNECTING,c),this.off("res-@".concat(i),a)};this.once(ET.WS_CLOSED,c),this.once(ET.WS_RECONNECTING,c),Mv(LS("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==s||o||(zS.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(ET.REQUEST_TIMEOUT,e,t))}))}));let l=null;try{l=await c}catch(r){if(this.connectionState===_T.CLOSED||e===vT.LEAVE)throw new FE(UE.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===vT.JOIN||e===vT.REJOIN?null:(await a(),await this.request(e,t))}if(l.isSuccess)return l.message;const u=Number(l.message.error_code||l.message.code),d=Mw(u),h=new FE(UE.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(l.message.error_str),{code:u,data:l.message});return"success"===d.action?l.message:(zS.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(u,", message: ").concat(d.desc,", action: ").concat(d.action)),u===gT.ERR_TOO_MANY_BROADCASTERS?e===vT.JOIN||e===vT.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(u===gT.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,zS.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",uv.MULTI_IP)):this.reconnect(d.action,uv.SERVER_ERROR),e===vT.JOIN||e===vT.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new tE((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=LS("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==_T.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),LS("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}async sendExtensionMessage(e,t,n){return await this.waitTillUserOnline(),await this._external_signal.send(e,t,n)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new tE(((t,n)=>{this.once(ET.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(ET.WS_CLOSED,(()=>n(this.initError||new FE(UE.WS_ABORT)))),this.connectionState=_T.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||cv.LEAVE,this.connectionState=_T.CLOSED,zS.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===cv.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Zw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,LS("JOIN_GATEWAY_USE_DUAL_DOMAIN"),LS("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(ET.ABORT_P2P_EXECUTION);const e=await _v(this,ET.REQUEST_JOIN_INFO),t=await this.request(vT.JOIN,e);if(!t)return this.emit(ET.REPORT_JOIN_GATEWAY,UE.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(ET.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=_T.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),this._userOnlineTime=(new Date).getTime(),this._external_signal.clear(),!0}async rejoin(){if(!this.reconnectToken)throw new FE(UE.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=yv(this,ET.REQUEST_REJOIN_INFO);return e.token=this.reconnectToken,!!await this.request(vT.REJOIN,e)&&(this.connectionState=_T.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;const n=kv(e.payload),r=(new TextDecoder).decode(n),i=JSON.parse(r);"total"in i&&"id"in i||Di(t=Object.values(Ow)).call(t,i._type)?(e.seq&&delete e.seq,i._uid=e.uid,this._external_signal.onMessage(i)):this.emit(bT.ON_DATA_STREAM,e)}catch(e){}}handleNotification(e){zS.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Mw(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(cv.UID_BANNED),void this.close()):void this.reconnect(t.action,uv.SERVER_ERROR);zS.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=LS("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(zS.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>LS("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",uv.TIMEOUT):this.request(vT.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),LS("REPORT_STATS")&&this.send(vT.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(yT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(wT.RECONNECT_WAITTING_FINISH,(e=>{this.emit(ET.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(wT.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(ET.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(wT.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(wT.CLOSED,(()=>{this.connectionState=_T.CLOSED})),this.websocket.on(wT.FAILED,(()=>{this._disconnectedReason=cv.NETWORK_ERROR,this.connectionState=_T.CLOSED})),this.websocket.on(wT.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===_T.CONNECTED?this.connectionState=_T.RECONNECTING:this.connectionState=_T.CONNECTING})),this.websocket.on(wT.WILL_RECONNECT,((e,t,n)=>{if(yv(this,ET.IS_P2P_DISCONNECTED)&&"retry"===e)return zS.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ET.NEED_RENEW_SESSION),this.emit(ET.DISCONNECT_P2P),n("tryNext");"retry"!==e&&(zS.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(ET.NEED_RENEW_SESSION),this.emit(ET.DISCONNECT_P2P)),n(e)})),this.websocket.on(wT.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{zS.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",uv.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(ET.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof FE&&e.code===UE.UNEXPECTED_RESPONSE&&e.data.code===gT.ERR_NO_AUTHORIZED)return zS.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",uv.SERVER_ERROR);zS.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",uv.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(wT.REQUEST_NEW_URLS,((e,t)=>{_v(this,ET.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(wT.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(bT.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}_handleSignalP2PEvents(){this._external_signal.on(Ow.JOIN,(async e=>{if(this._userOnlineTime&&this._userOnlineTime<e.onlineTime){const e=await _v(this,ET.P2P_START,void 0),t=await this._external_signal.send(Ow.CALL,e);this.emit(ET.P2P_CONNECTION,t,!0)}this._userInRoom=!0,this.emit("user-online")})),this.on(bT.ON_USER_OFFLINE,(async e=>{this._external_signal.clear(),this._userInRoom=!1})),this._external_signal.on(Ow.CALL,(async(e,t,n)=>{this._userInRoom=!0,this.emit("user-online");try{t(await _v(this,ET.P2P_START,e))}catch(e){n(e)}}))}async waitTillUserOnline(){return new tE((e=>{if(this._userInRoom)e();else{const t=()=>{this.off("user-online",t),e()};this.on("user-online",t)}}))}}function Pk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pk(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pk(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Lk=new Map;class xk extends nv{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(ew.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(ew.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){zS.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){super(),rh(this,"store",void 0),rh(this,"joinInfo",void 0),rh(this,"key",void 0),rh(this,"ntpOffset",0),rh(this,"signal",void 0),rh(this,"role",void 0),rh(this,"inChannelInfo",{joinAt:null,duration:0}),rh(this,"spec",void 0),rh(this,"_state","DISCONNECTED"),rh(this,"_statsCollector",void 0),rh(this,"_disconnectedReason",void 0),rh(this,"isSignalRecover",!1),rh(this,"hasChangeBGPAddress",!1),rh(this,"trafficStatsInterval",void 0),rh(this,"networkQualityInterval",void 0),rh(this,"_joinGatewayStartTime",0),rh(this,"_signalTimeout",!1),rh(this,"_clientRoleOptions",void 0),rh(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?new kk(Dk(Dk({},t),{},{retryConfig:t.websocketRetryConfig}),e):this.store.useDataChannel?new Ak(Dk(Dk({},t),{},{retryConfig:t.websocketRetryConfig}),e):new Xw(Dk(Dk({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){if(this.signal instanceof Ak){let t=!1;"disabled"!==e.cloudProxyServer?(zS.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(e.cloudProxyServer,")")),t=!0):"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length>255||"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length<22?(zS.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),t=!0):e.apResponse.addresses.some((e=>e.fingerprint))||LS("FINGERPRINT")||(zS.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),t=!0),t&&this.resetSignal()}this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const r=Date.now();let i=Lk.get(e.cname);if(i||(i=new Map,Lk.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){const t=new UT(UE.UID_CONFLICT);throw iT.joinGateway(e.sid,{lts:r,succ:!1,ec:t.message,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:this.signal instanceof Ak?"1":"0"}),this._isProactiveJoin=!1,t}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=r;const s=e.proxyServer;try{let t;if(zS.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof Ak?"datachannel":"websocket"," join uid ").concat(o)),this.signal instanceof Ak)t=await this.signal.init(e.apResponse.addresses,n);else{const r=e.gatewayAddrs.map((t=>{let{address:n}=t;const[r,i]=n.split(":"),o={host:r,port:i};return e.proxyServer&&(o.proxy=e.proxyServer),o}));t=await this.signal.init(r,n)}o=t.uid,zS.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof Ak?"datachannel":"websocket"," join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){if(t&&t.code===UE.INIT_WEBSOCKET_TIMEOUT)throw zS.warning("[".concat(this.store.clientId,"] User join failed"),t.toString()),t;if(t&&t.code===UE.INIT_DATACHANNEL_TIMEOUT)throw zS.warning("[".concat(this.store.clientId,"] User join datachannel failed"),t.toString()),this.resetSignal(),t;throw zS.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),iT.joinGateway(e.sid,{lts:r,succ:!1,ec:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!s,signalChannel:this.signal instanceof Ak?"1":"0"}),this._isProactiveJoin=!1,i.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),zS.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((e=>{zS.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(ew.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ew.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(ew.NETWORK_QUALITY,{uplinkNetworkQuality:vk(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:vk(this._statsCollector.trafficStats.B_dnq)}):this.emit(ew.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==cv.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==_T.CONNECTED||await function(e,t){return t===1/0?e:tE.race([e,xv(t)])}(this.signal.request(vT.LEAVE,void 0,!0),3e3)}catch(e){zS.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==cv.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new UT(UE.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:LS("PUB_EXTEND"),twcc:!!LS("PUBLISH_TWCC"),rtx:!!LS("USE_PUB_RTX")};try{return(await this.signal.request(vT.PUBLISH,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===gT.ERR_PUBLISH_REQUEST_INVALID)return zS.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),r.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw r}}async publishDataChannel(e,t,n){var r;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new UT(UE.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(r=t.maxRetransmits)&&void 0!==r?r:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(vT.PUBLISH_DATASTREAM,i,!0)}catch(r){if(n&&r.data&&r.data.code===gT.ERR_PUBLISH_REQUEST_INVALID)return zS.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),r.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw r}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new UT(UE.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(vT.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){zS.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new UT(UE.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await tE.all(e.map((e=>this.signal.request(vT.UNPUBLISH_DATASTREAM,{channel_id:e},!0))))}catch(e){zS.warning("unpublish datachannels warning: ",e)}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new UT(UE.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!LS("SUBSCRIBE_TWCC"),rtx:!!LS("USE_SUB_RTX"),extend:LS("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(LS("SVC"))&&0!==LS("SVC").length?LS("SVC"):void 0};try{return(await this.signal.request(vT.SUBSCRIBE,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===gT.ERR_SUBSCRIBE_REQUEST_INVALID)return zS.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),r.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw r}}async subscribeDataChannel(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new UT(UE.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(vT.SUBSCRIBE_DATASTREAM,r,!0)}catch(r){if(n&&r.data&&r.data.code===gT.ERR_SUBSCRIBE_REQUEST_INVALID)return zS.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),r.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw r}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new UT(UE.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!LS("USE_SUB_RTX")};try{return await this.signal.request(vT.SUBSCRIBE_STREAMS,n,!0)}catch(n){if(t&&n.data&&n.data.code===gT.ERR_SUBSCRIBE_REQUEST_INVALID)return zS.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw n}}async setVideoProfile(e){const t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(i=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(vT.SET_VIDEO_PROFILE,t);zS.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(vT.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){zS.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new UT(UE.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await tE.all(e.map((e=>this.signal.request(vT.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0))))}catch(e){zS.warning("unsubscribeDataChannel warning: ",e)}}async massUnsubscribe(e){try{await this.signal.request(vT.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){zS.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(vT.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(vT.GATEWAY_INFO)}async renewToken(e){await this.signal.request(vT.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),"CONNECTED"!==this.state)return void(this.role=e);let n,r=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(vT.SET_CLIENT_ROLE,{role:e,level:r,delay:n,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(vT.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(vT.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(vT.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(vT.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(vT.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,n){if(this.signal instanceof kk)return this.signal.sendExtensionMessage(e,t,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Dk({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(vT.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=Lk.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:sT.username,password:sT.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(Dk(Dk({},sT),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const e=await this.signal.request(vT.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach((e=>{const t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((t=>t.peer_uid===e.peer_uid));t&&t.B_st!==e.B_st&&Rv((()=>{this.emit(ew.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)}))})),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new UT(UE.UNEXPECTED_ERROR,"can not generate join message, no join info");const t=Object.assign({},this.joinInfo.apResponse);let n=LS("REPORT_APP_SCENARIO");if("string"!=typeof n)try{n=JSON.stringify(n)}catch(e){n=void 0}n&&n.length>128&&(n=void 0);const r=Dk({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:AS,browser:navigator.userAgent,process_id:LS("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:LS("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:{enablePublishedUserList:LS("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:LS("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof LS("SUBSCRIBE_AUDIO_FILTER_TOPN")?LS("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof LS("ENABLE_PUBLISH_AUDIO_FILTER")?LS("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof LS("ENABLE_USER_LICENSE_CHECK")?LS("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===LS("USE_PUB_RTX")||!0===LS("USE_SUB_RTX")||void 0,disableFEC:LS("DISABLE_FEC"),enableNTPReport:!!LS("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!LS("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof LS("ENABLE_DATASTREAM_2")?LS("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof LS("RTM2_FLAG")?LS("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!LS("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof LS("USE_XR")?LS("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(r.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(r.aes_mode=this.joinInfo.aesmode,LS("ENCRYPT_AES")?(r.aes_secret=this.joinInfo.aespassword,r.aes_encrypt=!0):r.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(r.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(r.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),void 0!==this.joinInfo.defaultVideoStream&&(r.default_video_stream=this.joinInfo.defaultVideoStream),r}getRejoinMessage(){if(!this.joinInfo)throw new UT(UE.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ET.WS_RECONNECT_WAITTING_FINISH,(e=>{var t;Di(t=["tryNext","recover"]).call(t,e)&&this.joinInfo&&iT.adjustSessionStartTime(this.joinInfo.sid)})),this.signal.on(ET.WS_RECONNECT_CREATE_CONNECTION,(e=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(ET.WS_RECONNECTING,(e=>{this.joinInfo&&iT.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||uv.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",iT.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(ET.WS_CLOSED,(e=>{let t;switch(e){case cv.LEAVE:t=uv.LEAVE;break;case cv.UID_BANNED:case cv.IP_BANNED:case cv.CHANNEL_BANNED:case cv.SERVER_ERROR:t=uv.SERVER_ERROR;break;case cv.FALLBACK:t=uv.FALLBACK;break;case cv.LICENSE_MISSING:case cv.LICENSE_EXPIRED:case cv.LICENSE_MINUTES_EXCEEDED:case cv.LICENSE_PERIOD_INVALID:case cv.LICENSE_MULTIPLE_SDK_SERVICE:case cv.LICENSE_ILLEGAL:case cv.TOKEN_EXPIRE:t=e;break;default:t=uv.NETWORK_ERROR}zS.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+uv.NETWORK_ERROR)),this.joinInfo&&iT.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===cv.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==cv.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(ET.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(zS.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),iT.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Ak?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void zS.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));DS("EVENT_REPORT_DOMAIN",e[1]),DS("EVENT_REPORT_BACKUP_DOMAIN",e[1]),DS("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}})),this.signal.on(bT.ON_UPLINK_STATS,(e=>{this._statsCollector.updateUplinkStats(e)})),this.signal.on(ET.REQUEST_RECOVER,((e,t,n)=>{if(!this.joinInfo)return n(new UT(UE.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,_v(this,ew.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)})),this.signal.on(ET.REQUEST_JOIN_INFO,(async e=>{var t;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=await _v(this,ew.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(t=this.joinInfo)||void 0===t?void 0:t.turnServer});e(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i,version:"2"}}))})),this.signal.on(ET.REQUEST_REJOIN_INFO,(e=>{e(this.getRejoinMessage())})),this.signal.on(ET.REPORT_JOIN_GATEWAY,((e,t)=>{this.joinInfo&&(iT.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:e,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Ak?"1":"0"}),this._isProactiveJoin=!1)})),this.signal.on(ET.IS_P2P_DISCONNECTED,(e=>{e(yv(this,ew.IS_P2P_DISCONNECTED))})),this.signal.on(ET.DISCONNECT_P2P,(()=>{this.emit(ew.DISCONNECT_P2P)})),this.signal.on(ET.NEED_RENEW_SESSION,(()=>{this.emit(ew.NEED_RENEW_SESSION)})),this.signal.on(ET.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(ET.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(ET.JOIN_RESPONSE,(e=>{const t=this.getCurrentGatewayAddress();this.emit(ew.JOIN_RESPONSE,e,t)})),this.signal.on(ET.DATACHANNEL_PRECONNECT,(async(e,t,n)=>{this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress();return _v(this,ew.DATACHANNEL_PRECONNECT,e,r).then(t).catch(n)})),this.signal.on(ET.DATACHANNEL_CONNECTING,(async e=>{const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await _v(this,ew.REQUEST_DC_CONNECTION_PARAMS);e(this.getJoinMessage({ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r,version:"2"}}))})),this.signal.on(ET.DATACHANNEL_FAILBACK,(()=>{zS.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(ew.DATACHANNEL_FAILBACK)}))}async tryUnsubBeforeResub(e,t){try{await this.signal.request(vT.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw zS.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(vT.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(e){throw zS.warning("unsubscribe datachannel warning",e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(vT.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw zS.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(vT.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(e){throw zS.warning("unpublish datastream warning: ",e),e}}async tryMassUnsubBeforeResub(e){const t={users:e.map((e=>({stream_id:e.stream_id,stream_type:e.stream_type})))};try{await this.signal.request(vT.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw zS.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){const n={action:e.find((e=>e.stream_type===$T.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(vT.CONTROL,n,!0,!0)}catch(e){throw zS.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){const n={action:e.find((e=>e.stream_type===$T.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(vT.CONTROL,n,!0,!0)}catch(e){throw zS.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}async muteRemote(e,t){const n={action:e===dw.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(vT.CONTROL,n,!0,!0)}catch(e){throw zS.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e),e}}async unmuteRemote(e,t){const n={action:e===dw.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(vT.CONTROL,n,!0,!0)}catch(e){throw zS.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e),e}}uploadStats(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(vT.RESTART_ICE,t,!0)}catch(e){throw zS.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,uv.P2P_FAILED)}getCurrentGatewayAddress(){var e;if(!LS("GATEWAY_WSS_ADDRESS"))return null!==(e=this.joinInfo)&&void 0!==e&&e.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(vT.SET_PARAMETER,{enablePublishAudioFilter:e})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(cv.FALLBACK)),this.store.useDataChannel=!1,this.signal=new Xw(Dk(Dk({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(ew.RESET_SIGNAL,rw.websocket)}}let Mk=0,Uk=0;function Fk(e,t,n,r){return new tE(((i,o)=>{t.timeout=t.timeout||LS("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Mk+=Dv(t.data)):n&&(t.data.size?Mk+=t.data.size:t.data instanceof FormData?Mk+=Lv(t.data):Mk+=Dv(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,mS.request(t).then((e=>{"string"==typeof e.data?Uk+=Dv(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?Uk+=e.data.byteLength:Uk+=Dv(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{mS.isCancel(e)?o(new UT(UE.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new UT(UE.NETWORK_TIMEOUT,e.message)):e.response?o(new UT(UE.NETWORK_RESPONSE_ERROR,e.response.status)):o(new UT(UE.NETWORK_ERROR,e.message))}))}))}!function(){var e;function t(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Y&&Y];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function o(e,t){if(t)e:{var n=i;e=e.split(".");for(var o=0;o<e.length-1;o++){var s=e[o];if(!(s in n))break e;n=n[s]}(t=t(o=n[e=e[e.length-1]]))!=o&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}function s(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function a(e){var n="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:t(e)}}if(o("Symbol",(function(e){function t(e,t){this.A=e,r(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function e(r){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(r||"")+"_"+i++,r)}})),o("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),o=0;o<n.length;o++){var a=i[n[o]];"function"==typeof a&&"function"!=typeof a.prototype[e]&&r(a.prototype,e,{configurable:!0,writable:!0,value:function(){return s(t(this))}})}return e})),"function"==typeof Object.setPrototypeOf)n=Object.setPrototypeOf;else{var c;e:{var l={};try{l.__proto__={a:!0},c=l.a;break e}catch(e){}c=!1}n=c?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var u=n;function d(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function p(e,t){return e.h=3,{value:t}}function f(e){this.g=new d,this.G=e}function m(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var o=i.value}catch(t){return e.g.j=null,e.g.s(t),g(e)}return e.g.j=null,r.call(e.g,o),g(e)}function g(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function _(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){h(e.g);var n=e.g.j;return n?m(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),g(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function E(e,t){return t=new _(new f(t)),u&&e.prototype&&u(t,e.prototype),t}if(d.prototype.o=function(e){this.v=e},d.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},d.prototype.return=function(e){this.l={return:e},this.h=this.u},f.prototype.o=function(e){return h(this.g),this.g.j?m(this,this.g.j.next,e,this.g.o):(this.g.o(e),g(this))},f.prototype.s=function(e){return h(this.g),this.g.j?m(this,this.g.j.throw,e,this.g.o):(this.g.s(e),g(this))},o("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var v=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},y=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},b=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},S=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},T="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,w=T.FormData,C=T.XMLHttpRequest&&T.XMLHttpRequest.prototype.send,R=T.Request&&T.fetch,I=T.navigator&&T.navigator.sendBeacon,O=T.Element&&T.Element.prototype,A=T.Symbol&&Symbol.toStringTag;A&&(Blob.prototype[A]||(Blob.prototype[A]="Blob"),"File"in T&&!File.prototype[A]&&(File.prototype[A]="File"));try{new File([],"")}catch(e){T.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),A&&Object.defineProperty(e,A,{value:"File"}),e}}var N=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},k=function(e){this.i=[];var t=this;e&&v(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];v(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?v(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?y(e.value):e.value,t.append(e.name,n))}))};if((e=k.prototype).append=function(e,t,n){S(arguments,2),this.i.push(b(e,t,n))},e.delete=function(e){S(arguments,1);var t=[];e=String(e),v(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},e.entries=function e(){var t,n=this;return E(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=p(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},e.forEach=function(e,t){S(arguments,1);for(var n=a(this),r=n.next();!r.done;r=n.next()){var i=a(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},e.get=function(e){S(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){S(arguments,1);var t=[];return e=String(e),v(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},e.has=function(e){S(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,r,i=this;return E(e,(function(e){if(1==e.h&&(t=a(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,p(e,a(r).next().value));n=t.next(),e.h=2}))},e.set=function(e,t,n){S(arguments,2),e=String(e);var r=[],i=b(e,t,n),o=!0;v(this.i,(function(t){t[0]===e?o&&(o=!r.push(i)):r.push(t)})),o&&r.push(i),this.i=r},e.values=function e(){var t,n,r,i,o=this;return E(e,(function(e){if(1==e.h&&(t=a(o),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=a(r)).next(),p(e,i.next().value));n=t.next(),e.h=2}))},k.prototype._asNative=function(){for(var e=new w,t=a(this),n=t.next();!n.done;n=t.next()){var r=a(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},k.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,r){return"string"==typeof e?t.push(n+N(y(r))+'"\r\n\r\n'+y(e)+"\r\n"):t.push(n+N(y(r))+'"; filename="'+N(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},k.prototype[Symbol.iterator]=function(){return this.entries()},k.prototype.toString=function(){return"[object FormData]"},O&&!O.matches&&(O.matches=O.matchesSelector||O.mozMatchesSelector||O.msMatchesSelector||O.oMatchesSelector||O.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),A&&(k.prototype[A]="FormData"),C){var P=T.XMLHttpRequest.prototype.setRequestHeader;T.XMLHttpRequest.prototype.setRequestHeader=function(e,t){P.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},T.XMLHttpRequest.prototype.send=function(e){e instanceof k?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),C.call(this,e)):C.call(this,e)}}R&&(T.fetch=function(e,t){return t&&t.body&&t.body instanceof k&&(t.body=t.body._blob()),R.call(this,e,t)}),I&&(T.navigator.sendBeacon=function(e,t){return t instanceof k&&(t=t._asNative()),I.call(this,e,t)}),T.FormData=k}}();const jk=()=>{const e=LS("AREAS");return 0===e.length&&e.push(iw.GLOBAL),cy(e).call(e,((e,t,n)=>{const r=Vk(t);return r?0===n?r:"".concat(e,",").concat(r):e}),"")},Vk=e=>e===iw.OVERSEA?"".concat(aw.ASIA,",").concat(aw.EUROPE,",").concat(aw.AFRICA,",").concat(aw.NORTH_AMERICA,",").concat(aw.SOUTH_AMERICA,",").concat(aw.OCEANIA):aw[e],Bk=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((e=>{const n=cw[e],r=Object.keys(n);r&&r.map((e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))}))})),t},Gk={GLOBAL:{ASIA:[iw.CHINA,iw.JAPAN,iw.INDIA,iw.KOREA,iw.HKMC],EUROPE:[],NORTH_AMERICA:[iw.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},qk=Object.keys(Gk[iw.GLOBAL]),Wk=[iw.CHINA,iw.NORTH_AMERICA,iw.EUROPE,iw.ASIA,iw.JAPAN,iw.INDIA,iw.OCEANIA,iw.SOUTH_AMERICA,iw.AFRICA,iw.KOREA,iw.HKMC,iw.US],zk=function(e,t){let n=[];if(Di(e).call(e,iw.GLOBAL)){const o=[iw.GLOBAL,iw.OVERSEA],s=Object.keys(cw);if(t===iw.GLOBAL)throw new UT(UE.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===iw.CHINA)n=[iw.OVERSEA];else if(i=t,Di(qk).call(qk,i)){const e=(r=t,Gk[iw.GLOBAL][r]||[]),i=[...o,t,...e];n=s.filter((e=>!Di(i).call(i,e)))}else if(function(e){let t=!1;return qk.forEach((n=>{var r;Di(r=Gk[iw.GLOBAL][n]).call(r,e)&&(t=!0)})),t}(t)){const e=function(e){let t;return qk.forEach((n=>{var r;Di(r=Gk[iw.GLOBAL][n]).call(r,e)&&(t=n)})),t}(t),r=[...o,e,t];n=s.filter((e=>!Di(r).call(r,e)))}else n=e;n=function(e){const t=[];return Wk.forEach((n=>{Di(e).call(e,n)&&t.push(n)})),t.concat(e.filter((e=>!Di(Wk).call(Wk,e))))}(n)}else n=e;var r,i;return n};function Hk(e){var t,n;if(!e&&Di(t=LS("AREAS")).call(t,iw.EXTENSIONS))return zS.debug("update area from ap : reset"),void Kk(oT,!0);if(!Di(n=LS("AREAS")).call(n,iw.GLOBAL)||!e)return;let r=cw.EXTENSIONS;r&&(r={CODE:Vk(iw.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},zS.debug("update area from ap success: ".concat(e,",config is "),r),DS("AREAS",[iw.EXTENSIONS],!0),Object.keys(r).map((e=>{DS(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])})))}function Kk(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=iT.reportApiInvoke(null,{name:ov.SET_AREA,options:e,tag:sv.TRACER});try{let r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach((e=>{if(!Di(sw).call(sw,e))throw new UT(UE.INVALID_PARAMS,"invalid area code")})),r=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:t,excludedArea:n}=e;if(!t)throw new UT(UE.INVALID_PARAMS,"area code is needed");let i=t;"string"==typeof t&&(i=[t]),r=n?zk(i,n):i}if(!t){if(xS.AREAS){const e=new UT(UE.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void zS.warning("setArea is prohibited because of config-distribute")}if(Di(r).call(r,iw.GLOBAL)&&LS("AREAS")===iw.EXTENSIONS){const e=new UT(UE.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void zS.warning("setArea is prohibited because of ap extensions")}}DS("AREAS",r,t);const i=Bk(r);Object.keys(i).map((e=>{DS(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])})),zS.debug("set area success:",r.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function Yk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yk(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yk(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let Jk=1;function Xk(e,t,n,r,i){Jk+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:Jk,requestId:Jk,version:AS,cname:n.cname},s={service_name:t,json_body:JSON.stringify(o)};let a,c,l=e[0];return Jv((async()=>{a=Date.now();const e=await Fk(l,{data:s,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-a,0!==e.code){const t=new UT(UE.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw zS.error(t.toString()),t}const n=JSON.parse(e.json_body);if(200!==n.code){const e=new UT(UE.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:c});throw zS.error(e.toString()),e}if(!n.servers||0===n.servers.length){const e=new UT(UE.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:c});throw zS.error(e.toString()),e}const i=function(e,t){return{addressList:e.servers.map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(LS("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t)))),workerToken:e.workerToken,vid:e.vid}}(n,t);return LS("LIVE_STREAMING_ADDRESS")&&(i.addressList=LS("LIVE_STREAMING_ADDRESS")instanceof Array?LS("LIVE_STREAMING_ADDRESS"):[LS("LIVE_STREAMING_ADDRESS")]),Zk(Zk({},i),{},{responseTime:c})}),((r,i)=>(iT.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:c,serverIp:e[i%e.length]}),!1)),((r,i)=>(iT.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:c,serverIp:e[i%e.length]}),!!(r.code!==UE.OPERATION_ABORTED&&r.code!==UE.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(l=e[(i+1)%e.length],!0))),i)}let Qk=1;function $k(e,t,n,r){let{url:i,areaCode:o}=e;const s=Date.now();let a;const[c,l]=iP(t,o,[dC.CHOOSE_SERVER]);let u=bv.networkState;return Jv((async()=>{u&&bv.networkState===dv.OFFLINE&&bv.onlineWaiter&&await tE.race([bv.onlineWaiter,Mv(r&&r.maxRetryTimeout||Yv.maxRetryTimeout)]),u=bv.networkState;const{data:e,headers:o}=await Fk(i,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);a="1"===o.http3?1:-1,iT.reportResourceTiming(i,t.sid),tP(e,i,t,s,[dC.CHOOSE_SERVER],a);const l=yk(e,dC.CHOOSE_SERVER);return nP(l),mk(l,i)}),(e=>(e&&iT.joinChooseServer(t.sid,{lts:s,succ:!0,csAddr:i,opid:l,serverList:e.gatewayAddrs.map((e=>e.address)),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[dC.CHOOSE_SERVER].toString(),isHttp3:a}),!1)),(e=>e.code!==UE.OPERATION_ABORTED&&(e.code===UE.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(iT.joinChooseServer(t.sid,{lts:s,succ:!1,csAddr:i,serverList:null,opid:l,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[dC.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:u}),isHttp3:a}),zS.warning("[".concat(t.clientId,"] Choose server network error, retry"),e),!0))),r)}function eP(e,t,n,r){let i,{url:o,areaCode:s,serviceIds:a}=e;const c=Date.now(),[l,u]=iP(t,s,a);let d;return Jv((async()=>{d&&bv.networkState===dv.OFFLINE&&bv.onlineWaiter&&await tE.race([bv.onlineWaiter,Mv(r&&r.maxRetryTimeout||Yv.maxRetryTimeout)]),d=bv.networkState;const{data:e,headers:s}=await Fk(o,{data:l,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===s.http3?1:-1,iT.reportResourceTiming(o,t.sid),tP(e,o,t,c,a,i);const u=yk(e,dC.CHOOSE_SERVER),h=yk(e,"proxy5"===t.cloudProxyServer?dC.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?dC.CLOUD_PROXY:dC.CLOUD_PROXY_FALLBACK);return nP(u),{gatewayInfo:mk(u,o),proxyInfo:h,url:o}}),(e=>(e.gatewayInfo&&iT.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:o,serverList:e.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,opid:u,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:a.toString(),isHttp3:i}),e.proxyInfo&&iT.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:o,turnServerAddrList:e.proxyInfo.addresses.map((e=>e.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:a.toString()}),!1)),(e=>e.code!==UE.OPERATION_ABORTED&&(e.code===UE.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(iT.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:a.toString(),extend:JSON.stringify({networkState:d})}),zS.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0))),r)}const tP=(e,t,n,r,i,o)=>{const s=[],a=s=>{4096===s.flag?iT.joinChooseServer(n.sid,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:s.error.message,csIp:s.error.data&&s.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o}):1048576!==s.flag&&4194304!==s.flag&&4194310!==s.flag||iT.joinWebProxyAP(n.sid,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:s.error.code,eventType:n.cloudProxyServer,unilbsServerIds:i.toString()})};if(e.response_body.forEach((t=>{const n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)zS.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{const n={error:new UT(UE.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};s.push(n),a(n)}if(0!==n){const r=Lw(n),i={error:new UT(UE.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{desc:r.desc,retry:r.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?zS.warning(i.error.toString()):s.push(i),a(i)}})),s.length)throw zS.warning("[".concat(n.clientId,"] multi unilbs ").concat(t," failed, ").concat(s.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry))).join(" | "))),new UT(UE.CAN_NOT_GET_GATEWAY_SERVER,s.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!s.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(s.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})},nP=e=>{var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new UT(UE.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(LS("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?Hk(e.detail[23].toLowerCase()):Hk()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){const t=e.detail[19],n=null==t?void 0:t.split(";");for(let r=0;r<n.length;r++){var o;const t=_C(o=n[r]).call(o);e.addresses[r]&&n&&(e.addresses[r].fingerprint=t)}}if(LS("GATEWAY_ADDRESS")&&LS("GATEWAY_ADDRESS").length>0){zS.debug("assign gateway address to",LS("GATEWAY_ADDRESS"));const t=LS("GATEWAY_ADDRESS").map((t=>{var n,r;const i=null!==(n=null===(r=e.addresses.find((e=>e.ip===t.ip&&e.port===t.port)))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}}));e.addresses=t}},rP=(e,t)=>{if(e.response_body&&e.response_body.length){const t=e.response_body[0];if(0!==t.buffer.code){const e=Lw(t.buffer.code);throw new UT(UE.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw zS.debug("update ticket request received ap response without response body:",t),new UT(UE.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},iP=(e,t,n)=>{const r=Math.floor(Math.random()*10**12),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Zk({6:e.stringUid,11:t,12:LS("USE_NEW_TOKEN")?"1":void 0,22:t},LS("AP_RTM")?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};i.request_bodies.forEach((t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const o=new FormData;return o.append("request",JSON.stringify(i)),[o,r]},oP=(e,t)=>{const n=Math.floor(Math.random()*10**12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((e=>({ip:e.ip,port:e.port})))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let sP=0;function aP(e){return tE.all(e.map((e=>e.then((e=>{throw e}),(e=>e))))).then((e=>{throw e}),(e=>e))}const cP=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:o}=e,s=0;const a=t;let c,l=0;const u=async()=>{const e=(()=>{const e=s*a,t=e+a;return n.slice(e,t).map(r)})();o&&o.push(...e);try{c=await aP(e)}catch(e){if(l+=a,s++,!(l>=n.length))return void await u();i(e)}e.forEach((e=>e.cancel()))};return await u(),c};async function lP(e,t,n,r){const i=async function(e,t,n,r){let i=null;const o=[],s=async()=>{const i=LS("WEBCS_DOMAIN").slice(0,LS("AJAX_REQUEST_CONCURRENT")).map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:jk()}))),s=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),a=await cP({fragementLength:LS("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(zS.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),$k(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),a},a=async()=>{if(await Mv(1e3),null!==i)return i;const s=LS("WEBCS_DOMAIN_BACKUP_LIST").map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:jk()}))),a=r.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:s.map((e=>e.url))}),c=await cP({fragementLength:LS("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:r=>(zS.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),$k(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),c};try{return i=await aP([s(),a()]),o.length&&o.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),i}catch(e){throw e[0]}}(e,t,n,r);return{gatewayInfo:await i}}async function uP(e,t,n,r,i){const o=e.cloudProxyServer;if("disabled"===o){if(!r)return;if(e.useLocalAccessPoint)return await lP(e,t,n,i);if(LS("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:r,proxyInfo:o}=await pP(e,t,n,i);return e.turnServer&&"auto"!==e.turnServer.mode||(e.turnServer={mode:"manual",servers:o.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||sT.tcpport,udpport:e.udpport||sT.udpport,username:e.username||sT.username,password:e.password||sT.password,forceturn:!1,security:!0})))}),{gatewayInfo:r}}return await lP(e,t,n,i)}const{proxyInfo:s,gatewayInfo:a}=await pP(e,t,n,i),c={gatewayInfo:a};return e.turnServer={mode:"manual",servers:s.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport?e.tcpport:sT.tcpport,udpport:"proxy4"===o?void 0:e.udpport?e.udpport:sT.udpport,username:e.username||sT.username,password:e.password||sT.password,forceturn:"proxy4"!==o,security:"proxy5"===o})))},zS.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),c}async function dP(e,t,n,r,i){const o=LS("ACCOUNT_REGISTER").slice(0,LS("AJAX_REQUEST_CONCURRENT"));let s=[];s=t.proxyServer?o.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):o.map((e=>"https://".concat(e,"/api/v1")));const a=null==i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s});try{const o=await async function(e,t,n,r,i){const o=Date.now(),s={sid:n.sid,opid:10,appid:n.appId,string_uid:t};let a=e[0];const c=await Jv((()=>Fk(a+"".concat(-1===a.indexOf("?")?"?":"&","action=stringuid"),{data:s,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((n,r)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw zS.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),iT.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:UE.INVALID_UINT_UID_FROM_STRING_UID,extend:s}),new UT(UE.INVALID_UINT_UID_FROM_STRING_UID);return iT.reqUserAccount(s.sid,{lts:o,success:!0,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:null,extend:s}),!1}const i=Lw(n.code);return i.retry&&(a=e[(r+1)%e.length]),iT.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:i.desc,extend:s}),i.retry}),((t,n)=>t.code!==UE.OPERATION_ABORTED&&(iT.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:null,errorCode:t.code,extend:s}),a=e[(n+1)%e.length],!0)),i);if(0!==c.code){const e=Lw(c.code);throw new UT(UE.UNEXPECTED_RESPONSE,e.desc)}return c}(s,e,t,n,r);return null==i||i.recordJoinChannelService({status:"success",endTs:Date.now()},a),o.uid}catch(e){throw null==i||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},a),e}}async function hP(e,t,n){const r=LS("CDS_AP").slice(0,LS("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config"))).map((r=>function(e,t,n,r){const i=pE(),o={flag:64,cipher_method:0,features:{device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:AS,cname:t.cname,sid:t.sid,session_id:t.sid,detail:"",proxyServer:t.proxyServer}};return Jv((()=>Fk(e,{data:o,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(e=>e.code!==UE.OPERATION_ABORTED),r)}(r,e,t,n)));let i=null,o=null,s={};try{i=await aP(r)}catch(e){if(e.code===UE.OPERATION_ABORTED)throw e;o=e}if(r.forEach((e=>e.cancel())),iT.reportApiInvoke(e.sid,{name:ov.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:i}}).onSuccess(),i&&i.test_tags)try{s=function(e){if(!e.test_tags)return{};const t=e.test_tags,n=Object.keys(t),r={};return n.forEach((e=>{var n;const i=_C(n=e.slice(4)).call(n),o=JSON.parse(t[e])[1];r[i]=o})),r}(i)}catch(e){}return s}async function pP(e,t,n,r){const i=LS("PROXY_SERVER_TYPE3"),o=(e,t,n)=>{let r=n||i;return Array.isArray(r)&&(r=t%2==0?i[1]:i[0]),"https://".concat(r,"/ap/?url=").concat(e)};let s=null;const a=[],c=async()=>{const i=LS("WEBCS_DOMAIN").slice(0,LS("AJAX_REQUEST_CONCURRENT")).map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:jk(),serviceIds:[dC.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?dC.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?dC.CLOUD_PROXY:dC.CLOUD_PROXY_FALLBACK]}})),s=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),c=await cP({fragementLength:LS("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(zS.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),eP(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),c},l=async()=>{if(await Mv(1e3),null!==s)return s;const i=LS("WEBCS_DOMAIN_BACKUP_LIST").map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:jk(),serviceIds:[dC.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?dC.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?dC.CLOUD_PROXY:dC.CLOUD_PROXY_FALLBACK]}})),c=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),l=await cP({fragementLength:LS("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(zS.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),eP(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},c),l};let u,d,h;try{({gatewayInfo:u,proxyInfo:d,url:h}=await aP([c(),l()]))}catch(e){throw e[0]}if(a.length&&a.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),!u||!d)throw new UT(UE.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,"disabled"!==e.cloudProxyServer&&Array.isArray(i)&&h){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];Di(i).call(i,t)&&(e.proxyServer=t,zS.setProxyServer(t),iT.setProxyServer(t))}return s={gatewayInfo:u,proxyInfo:await bk(d,u.uid)},s}async function fP(e,t,n,r){const i=LS("UAP_AP").slice(0,LS("AJAX_REQUEST_CONCURRENT")).map((e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")));return await Xk(i,e,t,n,r)}async function mP(e,t,n){const r=LS("UAP_AP").slice(0,LS("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap"))).map((r=>function(e,t,n,r){const i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:AS,cname:t.cname,uid:t.uid.toString(),requestId:Qk,seq:Qk};Qk+=1;const o={service_name:"tele_channel",json_body:JSON.stringify(i)};return Jv((async()=>{const t=await Fk(e,{data:o,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){const e=new UT(UE.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw zS.error(e.toString()),e}const r=JSON.parse(t.json_body);if(200!==r.code){const e=new UT(UE.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(r.code,", reason: ").concat(r.reason));throw zS.error(e.toString()),e}if(!r.servers||0===r.servers.length){const e=new UT(UE.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw zS.error(e.toString()),e}return{vid:r.vid,workerToken:r.workerToken,addressList:(LS("CHANNEL_MEDIA_RELAY_SERVERS")||r.servers).map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(LS("WORKER_DOMAIN"),":").concat(e.wss)))}}),void 0,(e=>!!(e.code!==UE.OPERATION_ABORTED&&e.code!==UE.UNEXPECTED_RESPONSE||e.data&&e.data.retry)),r)}(r,e,t,n)));try{const e=await aP(r);return r.forEach((e=>e.cancel())),e}catch(e){throw e[0]}}async function gP(e,t,n){let r=null;const i=[],o=async o=>{const s=LS(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2")));return o&&(await Mv(1e3),null!==r)?r:await cP({fragementLength:LS("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:r=>(zS.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),r),function(e,t,n,r){const[i]=oP(t,[dC.CHOOSE_SERVER]);let o=bv.networkState;return Jv((async()=>{o&&bv.networkState===dv.OFFLINE&&bv.onlineWaiter&&await tE.race([bv.onlineWaiter,Mv(r&&r.maxRetryTimeout||Yv.maxRetryTimeout)]),o=bv.networkState;const t=await Fk(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);return rP(t,e)}),(()=>!1),(e=>e.code!==UE.OPERATION_ABORTED&&(e.code===UE.UPDATE_TICKET_FAILED?e.data.retry:(zS.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0))),r)}(r,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:i})};try{return r=await aP([o(!1),o(!0)]),i.length&&i.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),r}catch(e){throw e[0]}}function _P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function EP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_P(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class vP extends nv{constructor(){super(),rh(this,"configs",void 0),rh(this,"joinInfo",void 0),rh(this,"cancelToken",void 0),rh(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),rh(this,"interval",void 0),rh(this,"mutex",new Hv("config-distribute")),rh(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),LS("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),LS("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,iT.reportApiInvoke(null,{options:void 0,name:ov.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:sv.TRACER}).onSuccess(JSON.stringify(xS))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void zS.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await hP(this.joinInfo,this.cancelToken,this.retryConfig),zS.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(e){const t=new UT(UE.NETWORK_RESPONSE_ERROR,e);zS.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var t;(t=e)&&t.uplink&&t.id&&void 0!==t.uplink.max_bitrate&&void 0!==t.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(lw.UPDATE_BITRATE_LIMIT,e):this.emit(lw.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&EP({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var t;const n=Qh(t=Object.keys(e).filter((e=>/^webrtc_ng_global_parameter/.test(e)))).call(t);for(let i=0;i<n.length;i++)for(let t=n.length-1;t>i;t--){const r=n[t];if("number"==typeof e[r].__priority){const i=e[r].__priority,o=n[t-1];if("number"==typeof e[o].__priority){if(!(i>e[o].__priority))continue;{const e=r;n[t]=n[t-1],n[t-1]=e}}else{const e=r;n[t]=n[t-1],n[t-1]=e}}}const r={};n.forEach((t=>{const n=e[t],i=n.__expires;Object.keys(n).forEach((e=>{"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(r,e)||(r[e]=EP({value:n[e]},i&&{expires:i}))}))}));try{!function(e){try{const t=Date.now();Object.keys(e).forEach((n=>{switch(n){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(PS,n)){const{value:r,expires:i}=e[n];if(i&&i<=t)return;xS[n]=r,PS[n]=r,zS.debug("Update global parameters from config distribute",n,r)}}}))}catch(t){zS.error("Error update config immediately: ".concat(e),t.message)}}(r);const e=JSON.stringify(r),t=window.btoa(e);window.localStorage.setItem("websdk_ng_global_parameter",t),zS.debug("Caching global parameters ".concat(e))}catch(e){zS.error("Error caching global parameters:",e.message)}}}function yP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yP(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class SP extends nv{constructor(e,t,n,r){super(),rh(this,"spec",void 0),rh(this,"token",void 0),rh(this,"websocket",void 0),rh(this,"pingpongTimer",void 0),rh(this,"reconnectMode","retry"),rh(this,"serviceMode",void 0),rh(this,"reqId",0),rh(this,"commandReqId",0),rh(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),rh(this,"handleWebSocketMessage",(e=>{if(!e.data)return;const t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):this.serviceMode===CT.INJECT?this.emit(zT.INJECT_STREAM_STATUS,t):(iT.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===CT.TRANSCODE?1:2}),this.emit(zT.PUBLISH_STREAM_STATUS,t))})),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new Jw("live-streaming",n),this.websocket.on(wT.CONNECTED,this.handleWebSocketOpen),this.websocket.on(wT.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(wT.REQUEST_NEW_URLS,((e,t)=>{_v(this,zT.REQUEST_NEW_ADDRESS).then(e).catch(t)})),this.websocket.on(wT.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(e){return this.websocket.init(e)}async request(e,t,n,r){this.reqId+=1,"request"===e&&(this.commandReqId+=1);const i=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new UT(UE.UNEXPECTED_ERROR);const s=bP({command:e,sdkVersion:"4.19.3"===AS?"0.0.1":AS,seq:o,requestId:o,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new UT(UE.WS_DISCONNECT);const a=()=>new tE(((e,t)=>{this.websocket.once(wT.CLOSED,(()=>t(new UT(UE.WS_ABORT)))),this.websocket.once(wT.CONNECTED,e)}));"connected"!==this.websocket.state&&await a(),s.clientRequest&&(s.clientRequest.workerToken=this.token);const c=new tE(((e,t)=>{const n=()=>{t(new UT(UE.WS_ABORT))};this.websocket.once(wT.RECONNECTING,n),this.websocket.once(wT.CLOSED,n),this.once("@".concat(o,"-").concat(this.spec.sid),(t=>{e(t)}))}));r&&iT.workerEvent(this.spec.sid,bP(bP({},r),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const l=Date.now();this.websocket.sendMessage(s);let u=null;try{u=await c}catch(r){if("closed"===this.websocket.state)throw r;return await a(),await this.request(e,t,n)}return r&&iT.workerEvent(this.spec.sid,bP(bP({},r),{},{requestId:i,actionType:"response",payload:JSON.stringify(u.serverResponse),serverCode:u.code,success:200===u.code,responseTime:Date.now()-l})),200!==u.code&&this.handleResponseError(u),u}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e="4.19.3"===AS?"0.0.1":AS;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case KT.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void zS.warning("live stream response already exists stream");case KT.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case KT.LIVE_STREAM_RESPONSE_BAD_STREAM:case KT.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new UT(UE.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case KT.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new UT(UE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case KT.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new UT(UE.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case KT.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new UT(UE.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(zT.WARNING,t,e.serverResponse.url)}case KT.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new UT(UE.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(zT.WARNING,t,e.serverResponse.url)}case KT.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new UT(UE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case KT.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new UT(UE.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case KT.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new UT(UE.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(zT.WARNING,t,e.serverResponse.url)}case KT.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new UT(UE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case KT.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new UT(UE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case KT.LIVE_STREAM_RESPONSE_WORKER_LOST:case KT.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new UT(UE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case KT.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new UT(UE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new UT(UE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case KT.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case KT.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case KT.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case KT.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new UT(UE.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(jv)}),6e3)}}function TP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TP(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class CP extends nv{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yv,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Yv;super(),rh(this,"onLiveStreamWarning",void 0),rh(this,"onLiveStreamError",void 0),rh(this,"onInjectStatusChange",void 0),rh(this,"spec",void 0),rh(this,"retryTimeout",1e4),rh(this,"connection",void 0),rh(this,"httpRetryConfig",void 0),rh(this,"wsRetryConfig",void 0),rh(this,"streamingTasks",new Map),rh(this,"isStartingStreamingTask",!1),rh(this,"taskMutex",new Hv("live-streaming")),rh(this,"cancelToken",mS.CancelToken.source()),rh(this,"transcodingConfig",void 0),rh(this,"injectConfig",wP({},WT)),rh(this,"injectLoopTimes",0),rh(this,"uapResponse",void 0),rh(this,"lastTaskId",1),rh(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=wP(wP({},qT),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(zS.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map((e=>wP(wP(wP({},VT),e),{},{zOrder:e.zOrder?e.zOrder+1:1})))),function(e){zE(e.width)||BE(e.width,"config.width",0,1e4),zE(e.height)||BE(e.height,"config.height",0,1e4),zE(e.videoBitrate)||BE(e.videoBitrate,"config.videoBitrate",1,1e6),zE(e.videoFrameRate)||BE(e.videoFrameRate,"config.videoFrameRate"),zE(e.lowLatency)||jE(e.lowLatency,"config.lowLatency"),zE(e.audioSampleRate)||VE(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),zE(e.audioBitrate)||BE(e.audioBitrate,"config.audioBitrate",1,128),zE(e.audioChannels)||VE(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),zE(e.videoGop)||BE(e.videoGop,"config.videoGop"),zE(e.videoCodecProfile)||VE(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),zE(e.userCount)||BE(e.userCount,"config.userCount",0,17),zE(e.backgroundColor)||BE(e.backgroundColor,"config.backgroundColor",0,16777215),zE(e.userConfigExtraInfo)||qE(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!zE(e.transcodingUsers)&&(WE(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach(((e,t)=>{jT(e.uid),zE(e.x)||BE(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),zE(e.y)||BE(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),zE(e.width)||BE(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),zE(e.height)||BE(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),zE(e.zOrder)||BE(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),zE(e.alpha)||BE(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)}))),zE(e.watermark)||GT(e.watermark,"watermark"),zE(e.backgroundImage)||GT(e.backgroundImage,"backgroundImage"),e.images&&!zE(e.images)&&(WE(e.images,"config.images"),e.images.forEach(((e,t)=>{GT(e,"images[".concat(t,"]"))})))}(t);const n=[];t.images&&n.push(...t.images.map((e=>wP(wP(wP({},BT),e),{},{zOrder:255})))),t.backgroundImage&&(n.push(wP(wP(wP({},BT),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(wP(wP(wP({},BT),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map((e=>wP({},e))),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const r=(t.userConfigs||[]).map((e=>"number"==typeof e.uid?tE.resolve(e.uid):dP(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await tE.all(r)).forEach(((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)})),this.transcodingConfig=t,this.connection)try{var i;const e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(LT(i=this.streamingTasks).call(i)).map((e=>e.taskId)).join("#")});zS.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((t=>{zS.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then((()=>{zS.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))})).catch((e=>{zS.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)}))}))}}setInjectStreamConfig(e,t){this.injectConfig=Object.assign({},this.injectConfig,e),this.injectLoopTimes=t}async startLiveStreamingTask(e,t,n){var r;if(Array.from(LT(r=this.streamingTasks).call(r)).find((e=>e.mode===CT.INJECT))&&t===CT.INJECT)return new UT(UE.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&t===CT.TRANSCODE)throw new UT(UE.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};zS.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const o=await this.taskMutex.lock();if(!this.connection&&n)return void o();if(this.streamingTasks.get(e)&&!n)return o(),new UT(UE.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw o(),e}switch(t){case CT.TRANSCODE:i.transcodingConfig=wP({},this.transcodingConfig);break;case CT.RAW:break;case CT.INJECT:i={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:e,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const s=this.lastTaskId++;try{const r=new tE(((t,r)=>{Mv(this.retryTimeout).then((()=>{if(n)return r(n);const t=this.statusError.get(e);return t?(this.statusError.delete(e),r(t)):void 0}))})),a=await tE.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:t===CT.TRANSCODE?1:2,requestByUser:!n,tid:s.toString()}),r]);this.isStartingStreamingTask=!1,zS.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(a.code)),this.streamingTasks.set(e,{clientRequest:i,mode:t,url:e,taskId:s}),o()}catch(r){if(o(),this.isStartingStreamingTask=!1,!r.data||!r.data.retry||n)throw r;return r.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,r)):await this.startLiveStreamingTask(e,t,r)}}stopLiveStreamingTask(e){return new tE(((t,n)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new UT(UE.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const i=r.mode;r.abortTask=()=>{zS.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:i===CT.INJECT?"UninjectStream":"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===CT.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((n=>{zS.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&i!==CT.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),t(),i===CT.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(RT.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,e)})).catch(n)}))}async controlInjectStream(e,t,n,r){const i=this.streamingTasks.get(e);if(!i||!this.connection||i.mode!==CT.INJECT)throw new UT(UE.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:t,audioVolume:n,position:r}})).serverResponse}resetAllTask(){var e;const t=Array.from(LT(e=this.streamingTasks).call(e));this.terminate();for(const n of t)this.startLiveStreamingTask(n.url,n.mode).catch((e=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=mS.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new UT(UE.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await _v(this,HT.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new SP(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(zT.WARNING,((e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e))),this.connection.on(zT.PUBLISH_STREAM_STATUS,(e=>this.handlePublishStreamServer(e))),this.connection.on(zT.INJECT_STREAM_STATUS,(e=>this.handleInjectStreamServerStatus(e))),this.connection.on(zT.REQUEST_NEW_ADDRESS,((t,n)=>{if(!this.connection)return n(new UT(UE.UNEXPECTED_ERROR,"can not get new live streaming address list"));_v(this,HT.REQUEST_WORKER_MANAGER_LIST,e).then((e=>{this.uapResponse=e,t(e.addressList)})).catch(n)})),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case KT.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case KT.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case KT.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case KT.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const r=new UT(UE.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return zS.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,r);if(!this.isStartingStreamingTask)return;this.statusError.set(t,r)}case KT.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new UT(UE.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case KT.LIVE_STREAM_RESPONSE_WORKER_LOST:case KT.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();const t=Array.from(LT(i=this.streamingTasks).call(i));for(const n of t)n.abortTask?n.abortTask():(zS.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new UT(UE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((()=>{zS.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)})).catch((e=>{zS.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})));return}}}handleInjectStreamServerStatus(e){const t=Number(e.uid),n=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(RT.INJECT_STREAM_STATUS_START_SUCCESS,t,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(RT.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,t,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(RT.INJECT_STREAM_STATUS_START_UNAUTHORIZED,t,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(RT.INJECT_STREAM_STATUS_BROKEN,t,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(RT.INJECT_STREAM_STATUS_START_TIMEOUT,t,n),void this.streamingTasks.delete(n);default:return void zS.debug("inject stream server status",e)}}hasUrl(e){return this.streamingTasks.has(e)}}class RP{constructor(){rh(this,"destChannelMediaInfos",new Map),rh(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){ow(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){ow(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){FT(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function IP(e){if(!(e instanceof RP))return new UT(UE.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new UT(UE.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new UT(UE.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class OP extends nv{constructor(e,t,n){super(),rh(this,"ws",void 0),rh(this,"requestId",1),rh(this,"heartBeatTimer",void 0),rh(this,"joinInfo",void 0),rh(this,"clientId",void 0),rh(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),rh(this,"onClose",(e=>{this.emit("close"),this.dispose()})),rh(this,"onMessage",(e=>{const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)})),this.joinInfo=e,this.clientId=t,this.ws=new Jw("cross-channel-".concat(this.clientId),n),this.ws.on(wT.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(wT.CONNECTED,this.onOpen),this.ws.on(wT.ON_MESSAGE,this.onMessage),this.ws.on(wT.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new tE(((t,n)=>{const r=window.setTimeout((()=>{n(new UT(UE.TIMEOUT,"wait status timeout, status: ".concat(e)))}),5e3);this.once(e,(i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new UT(UE.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)})),this.once("dispose",(()=>{window.clearTimeout(r),n(new UT(UE.WS_ABORT))}))}))}async request(e){if("closed"===this.ws.state)throw new UT(UE.WS_DISCONNECT);const t=()=>new tE(((e,t)=>{this.ws.once(wT.CLOSED,(()=>t(new UT(UE.WS_ABORT)))),this.ws.once(wT.CONNECTED,e)}));"connected"!==this.ws.state&&await t();const n=this.sendMessage(e),r=new tE(((e,t)=>{const r=()=>{t(new UT(UE.WS_ABORT))};this.ws.once(wT.RECONNECTING,r),this.ws.once(wT.CLOSED,r),this.once("req_".concat(n),e),Mv(3e3).then((()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(wT.RECONNECTING,r),this.ws.off(wT.CLOSED,r),t(new UT(UE.TIMEOUT,"cross channel ws request timeout"))}))})),i=await r;if(!i||200!==i.code)throw new UT(UE.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(i)));return i}async connect(e){this.ws.removeAllListeners(wT.REQUEST_NEW_URLS),this.ws.on(wT.REQUEST_NEW_URLS,(t=>{t(e)})),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class AP extends nv{set state(e){e!==this._state&&(e!==XT.RELAY_STATE_FAILURE&&(this.errorCode=QT.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,r,i){super(),rh(this,"joinInfo",void 0),rh(this,"sid",void 0),rh(this,"clientId",void 0),rh(this,"cancelToken",mS.CancelToken.source()),rh(this,"workerToken",void 0),rh(this,"requestId",0),rh(this,"signal",void 0),rh(this,"prevChannelMediaConfig",void 0),rh(this,"httpRetryConfig",void 0),rh(this,"_resolution",void 0),rh(this,"_state",XT.RELAY_STATE_IDLE),rh(this,"errorCode",QT.RELAY_OK),rh(this,"onStatus",(e=>{zS.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",JT.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",JT.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=QT.SRC_TOKEN_EXPIRED,this.state=XT.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=QT.DEST_TOKEN_EXPIRED,this.state=XT.RELAY_STATE_FAILURE))})),rh(this,"onReconnect",(async()=>{zS.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",JT.NETWORK_DISCONNECTED),this.state=XT.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((e=>{this.state!==XT.RELAY_STATE_IDLE&&(zS.error("auto restart channel media relay failed",e.toString()),this.errorCode=QT.SERVER_CONNECTION_LOST,this.state=XT.RELAY_STATE_FAILURE)}))})),this.joinInfo=e,this.clientId=t,this.sid=Fv(),this.signal=new OP(this.joinInfo,this.clientId,n),this.httpRetryConfig=r,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==XT.RELAY_STATE_IDLE)throw new UT(UE.INVALID_OPERATION);this.state=XT.RELAY_STATE_CONNECTING,await this.connect(),zS.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new UT(UE.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new UT(UE.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new UT(UE.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==XT.RELAY_STATE_RUNNING)throw new UT(UE.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==XT.RELAY_STATE_RUNNING)throw new UT(UE.INVALID_OPERATION);const t=this.genMessage(ZT.SetVideoProfile);await this.signal.request(t),zS.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),zS.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=XT.RELAY_STATE_IDLE,this.dispose()}dispose(){zS.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=mS.CancelToken.source(),this.state=XT.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await mP(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",JT.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage(ZT.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),zS.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage(ZT.SetSdkProfile,e);await this.signal.request(n),zS.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(ZT.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",JT.PACKET_JOINED_SRC_CHANNEL),zS.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage(ZT.SetSourceUserId,e);await this.signal.request(i),zS.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(ZT.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",JT.PACKET_JOINED_DEST_CHANNEL),zS.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const s=this.genMessage(ZT.StartPacketTransfer,e);await this.signal.request(s),this.emit("event",JT.PACKET_SENT_TO_DEST_CHANNEL),this.state=XT.RELAY_STATE_RUNNING,zS.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage(ZT.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",JT.PACKET_UPDATE_DEST_CHANNEL),zS.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(ZT.StopPacketTransfer);await this.signal.request(e),zS.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const n=[],r=[],i=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:AS,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.19.3"===o.sdkVersion&&(o.sdkVersion="0.0.1");let s=null,a=null;switch(e){case ZT.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case ZT.SetSourceChannel:if(a=t&&t.getSrcChannelMediaInfo(),!a)throw new UT(UE.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:a.channelName,token:a.token||this.joinInfo.appId},o;case ZT.SetSourceUserId:if(a=t&&t.getSrcChannelMediaInfo(),!a)throw new UT(UE.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:a.uid+""},o;case ZT.SetDestChannel:if(s=t&&t.getDestChannelMediaInfo(),!s)throw new UT(UE.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},o;case ZT.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case ZT.Reconnect:return o.clientRequest={command:"Reconnect"},o;case ZT.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case ZT.UpdateDestChannel:if(s=t&&t.getDestChannelMediaInfo(),!s)throw new UT(UE.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},o;case ZT.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}class NP{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){rh(this,"uid",void 0),rh(this,"_uintid",void 0),rh(this,"_trust_in_room_",!0),rh(this,"_trust_audio_enabled_state_",!0),rh(this,"_trust_video_enabled_state_",!0),rh(this,"_trust_audio_mute_state_",!0),rh(this,"_trust_video_mute_state_",!0),rh(this,"_audio_muted_",!1),rh(this,"_video_muted_",!1),rh(this,"_audio_enabled_",!0),rh(this,"_video_enabled_",!0),rh(this,"_audio_added_",!1),rh(this,"_video_added_",!1),rh(this,"_trust_video_stream_added_state_",!0),rh(this,"_trust_audio_stream_added_state_",!0),rh(this,"_audioTrack",void 0),rh(this,"_videoTrack",void 0),rh(this,"_dataChannels",[]),rh(this,"_audioSSRC",void 0),rh(this,"_videoSSRC",void 0),rh(this,"_audioOrtc",void 0),rh(this,"_videoOrtc",void 0),rh(this,"_cname",void 0),rh(this,"_rtxSsrcId",void 0),this.uid=e,this._uintid=t}}var kP=eE,PP=og;xr({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=PP.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var DP=og,LP=Vm;xr({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=DP.f(this),n=LP(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var xP=Z(kP),MP=Vs.f("asyncIterator"),UP=Z(MP);function FP(e,t){this.v=e,this.k=t}function jP(e){var t,n;function r(t,n){try{var o=e[t](n),s=o.value,a=s instanceof FP;xP.resolve(a?s.v:s).then((function(n){if(a){var c="return"===t?"return":"next";if(!s.k||n.done)return r(c,n);n=e[c](n).value}i(o.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new xP((function(o,s){var a={key:e,arg:i,resolve:o,reject:s,next:null};n?n=n.next=a:(t=n=a,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function VP(e){return function(){return new jP(e.apply(this,arguments))}}function BP(e){return new FP(e,0)}function GP(e){var t={},n=!1;function r(t,r){return n=!0,{done:!1,value:new FP(r=new xP((function(n){n(e[t](r))})),1)}}return t[void 0!==Md&&$d||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}jP.prototype["function"==typeof Md&&UP||"@@asyncIterator"]=function(){return this},jP.prototype.next=function(e){return this._invoke("next",e)},jP.prototype.throw=function(e){return this._invoke("throw",e)},jP.prototype.return=function(e){return this._invoke("return",e)};var qP=Z(MP),WP={exports:{}};!function(e,t){e.exports=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>S,Printer:()=>I,parse:()=>k,print:()=>P});const r="\n",i="".concat("\r").concat(r),o=" ";let s;function a(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function l(e){return c(e)||e>="\x80"&&e<="\xff"}function u(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function d(e){return e>="1"&&e<="9"}function h(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function p(e){return"d"===e||"h"===e||"m"===e||"s"===e}function f(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function m(e){return h(e)||a(e)||"+"===e||"/"===e}function g(e){return a(e)||h(e)||"+"===e||"/"===e||"-"===e||"_"===e}function _(e){return h(e)||a(e)||"+"===e||"/"===e}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(s||(s={}));class b{consumeText(e,t){let n=t;for(;n<e.length;){const t=e[n];if("\0"===t||"\r"===t||t===r)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,o)}consumeOneOrMore(e,t,n){let r=t;for(;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}consumeSpace(e,t){if(e[t]===o)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let r=0;r<4;r++)if(n=this.consumeDecimalUChar(e,n),3!==r){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let i=0;i<3&&a(e[n]);i++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");const r=parseInt(e.slice(t,n));if(r>=0&&r<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n),n):n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((r=e[t+n])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===n)throw new Error("Invalid hex 4");break}var r;return t+n}consumeFQDN(e,t){let n=t;for(;a(e[n])||h(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,l)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3;const r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let o=0;o<3;o++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!d(e[t]))throw new Error("Invalid integer.");for(t+=1;a(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!d(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&a(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,u)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(d(e[n])&&(n+=1);a(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,o)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,a),p(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!d(e[t]))throw new Error("Invalid repeat interval");for(t+=1;a(e[t]);)t+=1;return p(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,a)}consume(e,t,n){for(let r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}consumeTill(e,t,n){let r=t;for(;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}class S extends b{constructor(){super(),y(this,"records",[]),y(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter((e=>!!e.trim())).map(this.parseLine),this.currentLine=0;const n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),o=this.parseInformation(),s=this.parseUri(),a=this.parseEmail(),c=this.parsePhone(),l=this.parseConnection(),u=this.parseBandWidth(),d=this.parseTimeFields(),h=this.parseKey(),p=this.parseSessionAttribute(),f=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:o,uri:s,emails:a,phones:c,connection:l,bandwidths:u,timeFields:d,key:h,attributes:p,mediaDescriptions:f}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===r)return"\r"===e[t-1]?i:r;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new w;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==s.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(t,(e=>u(e)&&":"!==e)),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,f)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new C(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==s.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(e,(e=>u(e)&&":"!==e)),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,f)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===s.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===s.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=!1;"-"===e.value[e.cur]&&(r=!0,e.cur+=1);const i=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:i,back:r})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==s.REPEAT)break;{const n=this.extract(t,this.consumeRepeatInterval),r=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:r}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==s.BANDWIDTH)break;{const n=this.extractOneOrMore(t,u);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const r=this.extractOneOrMore(t,a);e.push({bwtype:n,bandwidth:r}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==s.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,a));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==s.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const o=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:r,nettype:i,addrtype:o,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===s.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==s.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===s.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==s.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==s.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===s.CONNECTION){const t=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const r=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:r}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");const i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===s.TIME;){const t=this.parseTime(),n=this.parseRepeat(),r=this.parseZone();e.push({time:t,repeats:n,zones:r})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===s.MEDIA;){const t=this.parseMedia(),n=this.parseInformation(),r=this.parseConnections(),i=this.parseBandWidth(),o=this.parseKey(),s=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:r,bandwidths:i,key:o,attributes:s})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===s.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const o=t.call(this,e.value,e.cur,...r),s=e.value.slice(e.cur,o);return e.cur=o,s}extractOneOrMore(e,t){const n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}consumeSpaceForRecord(e){if(e.value[e.cur]!==o)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class T extends b{constructor(){super(...arguments),y(this,"attributes",void 0),y(this,"digested",!1)}extractOneOrMore(e,t,n){const r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),[o,s]=n||[];if("number"==typeof o&&i.length<o)throw new Error("error in length, should be more or equal than ".concat(o," characters."));if("number"==typeof s&&i.length>s)throw new Error("error in length, should be less or equal than ".concat(s," characters."));return e._cur=r,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==o)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const o=t.call(this,e.attValue,e._cur,...r),s=e.attValue.slice(e._cur,o);return e._cur=o,s}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,m,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,m,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,m));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){const t=this.extractOneOrMore(e,a);let n;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),n=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill,o),i=v(v({entry:parseInt(t,10)},n&&{direction:n}),{},{extensionName:r});this.peekChar(e)===o&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class w extends T{constructor(){super(...arguments),y(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,g)}parseIdentity(e){const t=this.extractOneOrMore(e,_),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const r=this.extractOneOrMore(e,(e=>e!==o&&f(e)));n.push({name:t,value:r})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===o&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const n=this.extract(e,this.consumeTill,o);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class C extends T{constructor(e){super(),y(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,m,[1,32]);this.consumeAttributeSpace(e);const n=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const i=this.extractOneOrMore(e,a,[1,10]);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const l=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const u={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:s,port:l,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),u.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),u.relPort=this.extract(e,this.consumePort));this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),u.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(u)}parseRemoteCandidate(e){const t=[];for(;;){const n=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const r={encodingName:n,clockRate:this.extractOneOrMore(e,a)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,a);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,":");let r;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),r=this.extract(e,this.consumeTill));const i=this.attributes.ssrcs.find((e=>e.ssrcId===parseInt(t,10)));i?i.attributes[n]=r:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[n]:r}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,o);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill),r={};n.split(";").forEach((e=>{let[t,n]=e.split("=");t=t.trim();const i="string"==typeof n?n.trim():null;"string"==typeof t&&t.length>0&&(r[t]=i)}));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}parseFmtParameters(e){const t={},n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){const n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");t[n]=r}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,o),this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,o);let r;if("trr-int"===n)r={type:n,interval:this.extract(e,this.consumeTill)};else{const t={type:n};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===o&&(t.additional=this.extract(e,this.consumeTill))),r=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(r);else{const e=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));e?e.rtcpFeedbacks.push(r):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[r]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,u),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,u),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,u,[1,64])};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,u,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,(e=>h(e)||a(e)||"_"===e||"-"===e));this.consumeAttributeSpace(e);const n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===o){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=t,this.peekChar(e)===o&&this.extract(e,this.consume,o)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const r={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(r);break}default:{const r={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),r.val=this.extract(e,this.consumeTill,";")),n.params.push(r)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,a,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,a,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class I{constructor(){R(this,"eol",i)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(const e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map((e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime))).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(const n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new A(this.eol).print(e)}printMediaAttributes(e){return new N(this.eol).print(e)}}class O{constructor(e){R(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(o)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map((e=>"a=fingerprint:".concat(e.hashFunction).concat(o).concat(e.fingerprint))).join(this.eol)+this.eol:""}printExtmap(e){return e.map((e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(o).concat(e.extensionName).concat(e.extensionAttributes?"".concat(o).concat(e.extensionAttributes):"").concat(this.eol))).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map((e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol))).join("")}}class A extends O{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map((e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map((e=>"".concat(o).concat(e))).join("")).concat(this.eol))).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map((e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map((e=>"".concat(o).concat(e.name).concat(e.value?"=".concat(e.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(o,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((e=>"".concat(o).concat(e)))),t+this.eol}}class N extends O{print(e){const t=e.attributes;let n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map((e=>"a=candidate:".concat(e.foundation).concat(o).concat(e.componentId).concat(o).concat(e.transport).concat(o).concat(e.priority).concat(o).concat(e.connectionAddress).concat(o).concat(e.port).concat(o,"typ").concat(o).concat(e.type).concat(e.relAddr?"".concat(o,"raddr").concat(o).concat(e.relAddr):"").concat(e.relPort?"".concat(o,"rport").concat(o).concat(e.relPort):"").concat(Object.keys(e.extension).map((t=>"".concat(o).concat(t).concat(o).concat(e.extension[t]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(e){return e.map((e=>"a=remote-candidates:".concat(e.join(o)).concat(this.eol))).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let n="";n+=e.rtcpFeedbackWildcards.map((e=>this.printRTCPFeedback("*",e))).join("");for(const r of t)n+=this.printRtpMap(r.payloadType,r.rtpMap),n+=this.printFmtp(r.payloadType,r.fmtp),n+=r.rtcpFeedbacks.map((e=>this.printRTCPFeedback(r.payloadType,e))).join("");return n}printFmtp(e,t){if(!t)return"";const n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(o).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(o).concat(Object.keys(t.parameters).map((e=>"".concat(e,"=").concat(t.parameters[e]))).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(o).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(o),r=t;return"trr-int"===r.type?n+="ttr-int".concat(o).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(o).concat(r.parameter),r.additional&&(n+="".concat(o).concat(r.additional)))),n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map((e=>Object.keys(e.attributes).map((t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(o).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(o).concat(e.netType)),e.addressType&&(t+="".concat(o).concat(e.addressType)),e.address&&(t+="".concat(o).concat(e.address)),t+this.eol}printMSId(e){return e.map((e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(o).concat(e.appdata):"").concat(this.eol))).join("")}printImageattr(e){return e.map((e=>"a=imageattr:".concat(e).concat(this.eol))).join("")}printRid(e){return e.map((e=>{let t="a=rid:".concat(e.id).concat(o).concat(e.direction);return e.payloads&&(t+="".concat(o,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(o).concat(e.params.map((e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val))).join(";"))),t+this.eol})).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map((e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((e=>"".concat(o).concat(e.toString(10)))).join("")).concat(this.eol))).join("")}}function k(e){return(new S).parse(e)}function P(e,t){return(new I).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})()}(WP);var zP=WP.exports;function HP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function KP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?HP(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function YP(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:o,filterAudioFec:s,filterAudioCodec:a,filterVideoCodec:c}=t,{useXR:l}=n;let u=[],d=[],h=[],p=[],f=!1,m=!1;if(zP.parse(e).mediaDescriptions.forEach((e=>{r&&r!==e.attributes.direction||("video"!==e.media.mediaType||f||(d=e.attributes.payloads,p=e.attributes.extmaps,f=!0),"audio"!==e.media.mediaType||m||(u=e.attributes.payloads,h=e.attributes.extmaps,m=!0))})),!p||0===d.length)throw new Error("Cannot get video capabilities from SDP.");if(!h||0===u.length)throw new Error("Cannot get audio capabilities from SDP.");d.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),l&&e.rtcpFeedbacks.push({type:"rrtr"})})),u.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),l&&e.rtcpFeedbacks.push({type:"rrtr"})})),i&&(u=u.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),d=d.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}))),o&&(d=d.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),s&&(u=u.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),a&&(null==a?void 0:a.length)>0&&(u=u.filter((e=>{var t;return Di(a).call(a,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),c&&(null==c?void 0:c.length)>0&&(d=d.filter((e=>{var t;return Di(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")})));const g=LS("UNSUPPORTED_VIDEO_CODEC");return g&&g.length>0&&(d=d.filter((e=>!(e.rtpMap&&Di(g).call(g,e.rtpMap.encodingName.toLowerCase()))))),{audioCodecs:u,videoCodecs:d,audioExtensions:h,videoExtensions:p}}function ZP(e){const t=zP.parse(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const e=i.attributes.iceUfrag,t=i.attributes.icePwd;if(!e||!t)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:e,icePwd:t}}if(!r){const e=i.attributes.fingerprints;e.length>0&&(r={fingerprints:e})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function JP(e,t){const n=[],r=e.attributes.ssrcGroups.filter((e=>"FID"===e.semantic)),i=e.attributes.ssrcGroups.find((e=>"SIM"===e.semantic)),o=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((e=>{var i;const o=null===(i=r.find((t=>t.ssrcIds[0]===e)))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?o:void 0})}));else if(r.length>0){const e=r[0].ssrcIds[0],i=r[0].ssrcIds[1];n.push({ssrcId:e,rtx:t?i:void 0})}else{if(0===o.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function XP(e,t){const{cname:n}=e;let r;t&&t.ip&&"number"==typeof t.port?(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],zS.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),zS.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):r=e.iceParameters.candidates.map((e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}})));const i={fingerprints:e.dtlsParameters.fingerprints.map((e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint})))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let s;switch(e.dtlsParameters.role){case"server":s="passive";break;case"client":s="active";break;case"auto":s="actpass"}return{dtlsParameters:i,iceParameters:o,candidates:r,rtpCapabilities:aD(e.rtpCapabilities),setup:s,cname:n}}function QP(e,t,n){const r=[],i=[];return e.forEach((e=>{let{ssrcId:o,rtx:s}=e;const a=Uv(8,"track-"),c={ssrcId:o,attributes:KP({label:a,mslabel:n=n||Uv(10,""),msid:"".concat(n," ").concat(a)},t&&{cname:t})};if(r.push(c),void 0!==s){const e={ssrcId:s,attributes:KP({label:a,mslabel:n,msid:"".concat(n," ").concat(a)},t&&{cname:t})};r.push(e),i.push({semantic:"FID",ssrcIds:[o,s]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((e=>{let{ssrcId:t}=e;return t}))}),{ssrcs:r,ssrcGroups:i}}function $P(e,t){t instanceof QR&&e.attributes.payloads.forEach((e=>{var n;const r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!r||-1===["opus","pcmu","pcma","g722"].indexOf(r))return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const i=t._encoderConfig;i&&"pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!bE()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))}))}function eD(e){const t=e.attributes.unrecognized.findIndex((e=>"x-google-flag"===e.attField&&"conference"===e.attValue));-1!==t&&e.attributes.unrecognized.splice(t,1)}function tD(e,t){var n;if(!(t instanceof yI&&t._encoderConfig&&-1===t._hints.indexOf(LC.SCREEN_TRACK)))return;const r=t._encoderConfig;fR().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach((e=>{var t,n;Di(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))})),fR().supportMinBitrate&&!Di(n=t._hints).call(n,LC.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach((e=>{var t,n;Di(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(LS("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))}))}function nD(e){if("video"!==e.media.mediaType)return;const t=pE();if(t.name!==cE.SAFARI&&t.os!==aE.IOS)return;const n=e.attributes.extmaps.findIndex((e=>/video-orientation/g.test(e.extensionName)));-1!==n&&e.attributes.extmaps.splice(n,1)}function rD(e,t,n){if(!t)return;let r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){const t=r.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));if(t){e.attributes.extmaps.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"});const n=function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))))))}(i,e.attributes.payloads);n.forEach((e=>{e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))||e.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(!1===t.twcc){const t=e.attributes.extmaps.findIndex((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}if(!0===t.remb){const t=r.find((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName));if(t){e.attributes.extmaps.find((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"});const n=function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))))))}(i,e.attributes.payloads);n.forEach((e=>{e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))||e.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(!1===t.remb){const t=e.attributes.extmaps.findIndex((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"goog-remb"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}}function iD(e,t,n){if(bE())return;if("video"!==e.media.mediaType)return;if(!(t instanceof yI))return;if("vp9"!==n&&"vp8"!==n)return;if("vp8"===n&&!LS("SIMULCAST"))return;if(void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;const r="vp8"===n?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find((e=>"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId)),s={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let a=1;a<r;a++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+a,attributes:Iv(i.attributes)}),s.ssrcIds.push(i.ssrcId+a),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+a,attributes:Iv(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+a,o.ssrcIds[1]+a]}));e.attributes.ssrcGroups.unshift(s)}async function oD(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{filterRTX:n,filterVideoFec:r,filterAudioFec:i,filterAudioCodec:o,filterVideoCodec:s}=e,{useXR:a}=t,c=new RTCPeerConnection;c.addTransceiver("video",{direction:"sendonly"}),c.addTransceiver("audio",{direction:"sendonly"}),c.addTransceiver("video",{direction:"recvonly"}),c.addTransceiver("audio",{direction:"recvonly"});const l=(await c.createOffer()).sdp,u=YP(l,{filterRTX:n,filterVideoFec:r,filterAudioFec:i,filterAudioCodec:o,filterVideoCodec:s},{useXR:a},"sendonly"),d=YP(l,{filterRTX:n,filterVideoFec:r,filterAudioFec:i,filterAudioCodec:o,filterVideoCodec:s},{useXR:a},"recvonly"),h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(sD(u,d,"videoExtensions",h,p,f),sD(u,d,"videoCodecs",h,p,f),sD(u,d,"audioExtensions",h,p,f),sD(u,d,"audioCodecs",h,p,f),LS("RAISE_H264_BASELINE_PRIORITY")){const e=f.videoCodecs.findIndex((e=>{var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"===(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])}));if(-1!==e){const t=f.videoCodecs.findIndex((e=>{var t;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())}));if(t<e){zS.debug("raising H264 baseline profile priority");const n=f.videoCodecs[e];f.videoCodecs.splice(e,1),f.videoCodecs.splice(t,0,n)}-1!==t&&(p.videoCodecs=p.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))}))),-1!==t&&LS("FILTER_SEND_H264_BASELINE")&&(h.videoCodecs=h.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))})))}}try{c.close()}catch(e){}return{send:h,recv:p,sendrecv:f}}function sD(e,t,n,r,i,o){if("videoExtensions"===n||"audioExtensions"===n){const s=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return s.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===s.indexOf(t)&&i[n].push(e)}))}if("videoCodecs"===n||"audioCodecs"===n){const s=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return s.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===s.indexOf(t)&&i[n].push(e)}))}}function aD(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,o;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...r.audioCodecs],o.videoCodecs=[...n.videoCodecs,...r.videoCodecs],o.audioExtensions=[...n.audioExtensions,...r.audioExtensions],o.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):o=r,{send:i,recv:o}}function cD(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter((e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})).forEach((e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"}))}function lD(e){e.mediaDescriptions.forEach((e=>{"video"!==e.media.mediaType&&"audio"!==e.media.mediaType||e.attributes.payloads.forEach((e=>{-1===e.rtcpFeedbacks.findIndex((e=>"rrtr"===e.type))&&e.rtcpFeedbacks.push({type:"rrtr"})}))}))}function uD(e,t,n,r){let i=[];if(e===dw.VIDEO){if(LS("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(i=t.videoCodecs.filter((e=>{var t;return Di(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===LS("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(i)||0===i.length){const e=n.videoCodecs.filter((e=>{var t;return Di(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)}));0!==e.length&&(i=t.videoCodecs.filter((t=>e.some((e=>e.payloadType===t.payloadType)))))}if(LS("USE_PUB_RTX")){const e=i.map((e=>e.payloadType.toString())),n=t.videoCodecs.filter((t=>t.rtpMap&&"rtx"===t.rtpMap.encodingName&&Di(e).call(e,t.fmtp&&t.fmtp.parameters.apt||"")));i=[...i,...n]}0===i.length&&(zS.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs)}else i=t.audioCodecs.filter((e=>{var t;return Di(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)})),0===i.length&&(zS.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter((e=>{var t;return Di(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")})));return i}function dD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dD(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pD(e){if(Array.isArray(e))return e.map((e=>e));if(!fD(e))return e;const t={};for(const n in e){const r=e[n];fD(r)||Array.isArray(r)?t[n]=pD(r):t[n]=r}return t}function fD(e){return!("object"!=typeof e||Array.isArray(e)||!e)}class mD{constructor(e){rh(this,"input",[]),rh(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const gD={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},_D={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:gD,remoteCandidate:gD}},ED={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},vD={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},yD={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},bD={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function SD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function TD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SD(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class wD{constructor(e,t){rh(this,"onFirstVideoReceived",void 0),rh(this,"onFirstVideoDecoded",void 0),rh(this,"onFirstAudioReceived",void 0),rh(this,"onFirstVideoDecodedTimeout",void 0),rh(this,"onFirstAudioDecoded",void 0),rh(this,"onSelectedLocalCandidateChanged",void 0),rh(this,"onSelectedRemoteCandidateChanged",void 0),rh(this,"videoIsReady",!1),rh(this,"videoIsReady2",{}),rh(this,"pc",void 0),rh(this,"options",void 0),rh(this,"intervalTimer",void 0),rh(this,"stats",pD(_D)),rh(this,"isFirstVideoReceived",{}),rh(this,"isFirstVideoDecoded",{}),rh(this,"isFirstAudioReceived",{}),rh(this,"isFirstAudioDecoded",{}),rh(this,"isFirstVideoDecodedTimeout",{}),rh(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new tE((e=>{e({local:TD({},gD),remote:TD({},gD)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,o=0,s=0;for(const a of n)e[a].forEach(((e,n)=>{if(!this.lossRateWindowStats[t-1][a][n]||!this.lossRateWindowStats[0][a][n])return;const c=this.lossRateWindowStats[t-1][a][n].packets-this.lossRateWindowStats[0][a][n].packets,l=this.lossRateWindowStats[t-1][a][n].packetsLost-this.lossRateWindowStats[0][a][n].packetsLost;"videoSend"===a||"audioSend"===a?(r+=c,o+=l):(i+=c,s+=l),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||l<=0?0:l/(c+l)}));e.sendPacketLossRate=r<=0||o<=0?0:o/(r+o),e.recvPacketLossRate=i<=0||s<=0?0:s/(i+s)}}function CD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function RD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CD(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class ID extends wD{constructor(){super(...arguments),rh(this,"_stats",_D),rh(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=pD(_D);const n=t.filter((e=>"ssrc"===e.type));this.processSSRCStats(n);const r=t.find((e=>"VideoBwe"===e.type));r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((e=>{var t;const n=Di(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{const t=pD(vD);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=pD(ED),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){const r=n.stats,i=Date.now()-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:RD({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=pD(bD);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=pD(yD);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}}))}_getStats(){return new tE(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t.push(n)})),t}}function OD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function AD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?OD(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class ND extends wD{constructor(){super(...arguments),rh(this,"_stats",_D),rh(this,"report",void 0),rh(this,"lastDecodeVideoReceiverStats",new Map),rh(this,"lastVideoFramesRecv",new Map),rh(this,"lastVideoFramesSent",new Map),rh(this,"lastVideoFramesDecode",new Map),rh(this,"lastVideoJBDelay",new Map),rh(this,"lastAudioJBDelay",new Map),rh(this,"mediaBytesSent",new Map),rh(this,"mediaBytesRetransmit",new Map),rh(this,"mediaBytesTargetEncode",new Map),rh(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=pD(_D),this.report.forEach((e=>{switch(e.type){case dT.OUTBOUND:case dT.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===dT.OUTBOUND?"audio"===t||r?this.processAudioOutboundStats(e):("video"===t||n)&&this.processVideoOutboundStats(e):e.type===dT.INBOUND&&("audio"===t||r?this.processAudioInboundStats(e):("video"===t||n)&&this.processVideoInboundStats(e));break}case dT.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case dT.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:AD({},gD),remote:AD({},gD)};return e.forEach((n=>{let r;if(n.type===dT.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===dT.CANDIDATE_PAIR&&n.selected&&(r=n),r){const n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){const i=e.get(r.localCandidateId);i&&n(t.local,i)}if(r.remoteCandidateId){const i=e.get(r.remoteCandidateId);i&&n(t.remote,i)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===dT.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===dT.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===dT.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(AD({},t),AD({},this.stats.selectedCandidatePair.localCandidate)),e.type===dT.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(AD({},t),AD({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((t=>t.ssrc===e.ssrc));t||(t=pD(bD),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let t=this._stats.videoRecv.find((t=>t.ssrc===e.ssrc));t||(t=pD(ED),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const e=t.decodedFrame?t.decodedFrame.width:0,n=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,n),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const r=n.stats,o=i-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&o>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=o,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}r&&i-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((i-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:0}),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:AD({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((t=>t.ssrc===e.ssrc));t||(t=pD(vD),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const t=new mD(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new mD(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new mD(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){const n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const r=e.framesEncoded-n.lastFrameCount,i=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*i/r}}if(e.framesEncoded&&e.qpSum){const n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,dT.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((t=>t.ssrc===e.ssrc));if(t||(t=pD(yD),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,dT.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(LT(n=this.report).call(n)).find((n=>n.type===t&&n.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,o,s;const a=t?this.report.get(t):void 0,c=null!==(r=null==a?void 0:a.framesSent)&&void 0!==r?r:e.framesSent;if("number"!=typeof c)return;let l=null!==(i=null==a?void 0:a.frameWidth)&&void 0!==i?i:e.frameWidth,u=null!==(o=null==a?void 0:a.frameHeight)&&void 0!==o?o:e.frameHeight,d=null!==(s=null==a?void 0:a.framesPerSecond)&&void 0!==s?s:e.framesPerSecond;if("number"==typeof l&&"number"==typeof u||(l=0,u=0),null==d){const e=Date.now(),t=this.lastVideoFramesSent.get(n.ssrc);t&&e-t.lts>=800?(d=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:d})):t?d=t.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:0})}n.sentFrame={width:l,height:u,frameRate:Math.max(0,d)}}processVideoTrackReceiverStats(e,t,n){var r,i,o,s,a;const c=t?this.report.get(t):void 0,l=null!==(r=null==c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,u=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,d=null!==(o=null==c?void 0:c.frameHeight)&&void 0!==o?o:e.frameHeight,h=null!==(s=null==c?void 0:c.jitterBufferDelay)&&void 0!==s?s:e.jitterBufferDelay,p=null!==(a=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount;if("number"==typeof l){const e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=l;let r=0;e&&t-e.lts>=800?(r=Math.round((l-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:r})):e?r=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:0}),n.receivedFrame={width:u||0,height:d||0,frameRate:r||0},n.decodedFrame={width:u||0,height:d||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:u||0,height:d||0,frameRate:n.decodeFrameRate||0}}if(h&&p){const e=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=p-e.jitterBufferEmittedCount;r>0&&(t=1e3*(h-e.jitterBufferDelay)/r),n.jitterBufferMs=t,n.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,o,s;const a=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null==a?void 0:a.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,l=null!==(o=null!==(s=null==a?void 0:a.echoReturnLossEnhancement)&&void 0!==s?s:e.echoReturnLossEnhancement)&&void 0!==o?o:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,t,n){var r,i,o,s,a,c,l;const u=t?this.report.get(t):void 0,d=null!==(r=null==u?void 0:u.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,h=null!==(i=null==u?void 0:u.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,p=null!==(o=null==u?void 0:u.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,f=null!==(s=null==u?void 0:u.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount,m=null!==(a=null==u?void 0:u.audioLevel)&&void 0!==a?a:null==e?void 0:e.audioLevel,g=null!==(c=null==u?void 0:u.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,_=null!==(l=null==u?void 0:u.concealedSamples)&&void 0!==l?l:e.concealedSamples;if(d&&h&&(n.accelerateRate=d/h),p&&f){const e=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=f-e.jitterBufferEmittedCount;r>0&&(t=1e3*(p-e.jitterBufferDelay)/r),n.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:f,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=m;let E=1920;g&&h&&(E=h/g/50,n.receivedFrames=Math.round(h/E)),_&&(n.droppedFrames=Math.round(_/E))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach((t=>{e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((e=>{t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((e=>{n=null===n?e.diffMean():n+e.diffMean()}));const r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}}class kD extends wD{updateStats(){return tE.resolve()}}function PD(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const o=function(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return o?o<76?new ID(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new ND(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(e){return!!window.RTCStatsReport&&e.getStats()instanceof tE}(e)?new ND(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new kD(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}function DD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function LD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?DD(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class xD extends Pw{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(e,t){super(e,t),rh(this,"store",void 0),rh(this,"peerConnection",void 0),rh(this,"remoteSDP",void 0),rh(this,"initialOffer",void 0),rh(this,"statsFilter",void 0),rh(this,"useRTX",!1),rh(this,"localCapabilities",void 0),rh(this,"localCandidateCount",0),rh(this,"allCandidatesReceived",!1),rh(this,"establishPromise",void 0),rh(this,"mutex",new Hv("P2PConnection-mutex")),this.store=t,this.peerConnection=new RTCPeerConnection(xD.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=PD(this.peerConnection,LS("STATS_UPDATE_INTERVAL"),void 0,bE()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=ZP(e.sdp),n=YP(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:LS("FILTER_VIDEO_FEC"),filterAudioFec:LS("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,LD(LD({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new FE(UE.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(e){rh(this,"sessionDesc",void 0),rh(this,"localCapabilities",void 0),rh(this,"rtpCapabilities",void 0),rh(this,"candidates",void 0),rh(this,"iceParameters",void 0),rh(this,"dtlsParameters",void 0),rh(this,"setup",void 0),rh(this,"currentMidIndex",void 0),rh(this,"cname",void 0),e=Iv(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:s,sdkCodec:a,cname:c}=e,l=zP.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=i,this.candidates=r,this.iceParameters=t,this.dtlsParameters=n,this.setup=o,this.localCapabilities=s,this.cname=c;for(let u=0;u<l.mediaDescriptions.length;u++){const e=l.mediaDescriptions[u];if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=o,"video"===e.media.mediaType){e.media.fmts=i.videoCodecs.map((e=>e.payloadType.toString(10)));let t=i.videoCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Di(n=t.encodingName.toLowerCase()).call(n,a)}));0===t.length&&(t=i.videoCodecs),e.attributes.payloads=t,e.attributes.extmaps=i.videoExtensions}"audio"===e.media.mediaType&&(e.media.fmts=i.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=i.audioCodecs,e.attributes.extmaps=i.audioExtensions),l.mediaDescriptions[u]=this.mungMediaDesc(e)}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return zP.print(this.sessionDesc)}send(e,t,n){const{ssrcs:r,ssrcGroups:i}=QP(t,this.cname),o=this.sessionDesc.mediaDescriptions.find((t=>e===dw.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType)),s=r[0].attributes.label,a=r[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(r),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(i),{id:s,mslabel:a}}batchSend(e){return e.map((e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)}))}stopSending(e){this.sessionDesc.mediaDescriptions.forEach((t=>{const n=[],r=[],i=[];t.attributes.ssrcs.forEach((t=>{Di(e).call(e,t.attributes.label||"")?i.push(t):n.push(t)})),t.attributes.ssrcGroups.forEach((e=>{var t;Di(t=i.map((e=>e.ssrcId))).call(t,e.ssrcIds[0])||r.push(e)})),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r}))}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach(((e,t)=>{const n=e._mediaStreamTrack,r=this.sessionDesc.mediaDescriptions.findIndex((e=>e.attributes.mid===n.kind)),i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],e);this.sessionDesc.mediaDescriptions[r]=i}))}stopReceiving(e){}updateCandidates(e){e===hw.TCP?this.candidates.forEach((e=>{-1===this.candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this.candidates.push(hD(hD({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this.candidates=this.candidates.filter((e=>"tcp"!==e.transport));for(const t of this.sessionDesc.mediaDescriptions)t.attributes.candidates=this.candidates}restartICE(e){e=Iv(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){const n=Iv(e);return $P(n,t),tD(n,t),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){const r=this.sessionDesc.mediaDescriptions.find((t=>e===dw.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid));if(r){const e=r.attributes.ssrcs.find((e=>e.attributes.label===t));var i;e&&(e.attributes.label=n,null===(i=e.attributes.msid)||void 0===i||i.replace(t,n))}}mungMediaDesc(e){const t=Iv(e);return eD(t),function(e){const t=e.attributes.extmaps.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}(t),t}getSSRC(e){for(const t of this.sessionDesc.mediaDescriptions)for(const n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r.send,remoteSetup:i,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:o});const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new FE(UE.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(e,t){var n=this;return VP((function*(){const r=yield BP(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=e.map((e=>n.peerConnection.addTrack(e._mediaStreamTrack))),i=yield BP(n.peerConnection.createOffer()),o=zP.parse(i.sdp),s=e.map((e=>{const t=e._mediaStreamTrack,r=o.mediaDescriptions.find((e=>e.attributes.mid===t.kind));if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){const r=e.attributes.ssrcs.filter((e=>e.attributes.label===t)),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){const e=i.find((e=>-1!==e.ssrcIds.indexOf(r[0].ssrcId)));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)}));let a;try{a=yield s}catch(e){throw r.forEach((e=>{yE()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)})),e}const c=n.mungSendOfferSDP(i.sdp,e);n.remoteSDP.receive(e,t,a);const l=n.remoteSDP.toString();return yield BP(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield BP(n.applySendEncodings(r,e)),yield BP(n.peerConnection.setRemoteDescription({type:"answer",sdp:l})),e.map(((e,t)=>{const n=e._mediaStreamTrack.id;return{localSSRC:s[t],id:n}}))}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{r()}}))()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{yE()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:n,mslabel:i}=this.remoteSDP.send(e,t,r),o=new tE(((t,r)=>{const o=setTimeout((()=>{r(new Error("Cannot receive track, id: ".concat(n)))}),1e4),s=r=>{const a=pE();if(("Safari"===a.name&&11===Number(a.version)||SE())&&r.track.id!==n&&r.streams[0].id===i){var c;const i=r.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,n,r.track.id),this.peerConnection.removeEventListener("track",s),clearTimeout(o),void t(i)}if(r.track.id===n)return this.peerConnection.removeEventListener("track",s),clearTimeout(o),void t(r.track)};this.peerConnection.addEventListener("track",s)})),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(a),{track:await o,id:n}}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map((e=>{if(yE()&&e.track)e.track.enabled=!1;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!1)),e.setParameters(t)}}))}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map((async e=>{if(yE()&&e.track)e.track.enabled=!0;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!0)),await e.setParameters(t)}}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return VP((function*(){const n=yield BP(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(fR().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===hw.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(zS.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===hw.RELAY)return;e!==hw.RELAY&&t.remoteSDP.updateCandidates(e);const n=yield BP(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=ZP(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);const o=t.remoteSDP.toString();yield BP(t.peerConnection.setLocalDescription(n)),yield BP(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){zS.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getSenders().filter((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e}));1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getSenders().find((e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t}));n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new FE(UE.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new FE(UE.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,zS.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,zS.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),LS("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const t={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(fv(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...xD.turnServerConfigToIceServers(e.turnServer.servers)),LS("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...xD.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(t.iceTransportPolicy="relay")})))),t}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e._mediaStreamTrack.id}))),!t)return zS.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!fR().supportSetRtpSenderParameters)return zS.warn("Browser not support set rtp-sender parameters");const r={},i={};if(e instanceof yI)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(LS("DSCP_TYPE")&&LE()){var o;const e=LS("DSCP_TYPE");Di(o=["very-low","low","medium","high"]).call(o,e)&&(i.networkPriority=e)}const s=t.getParameters(),a=null===(n=s.encodings)||void 0===n?void 0:n[0];a&&Object.assign(a,i),Object.assign(s,r),zS.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(s.encodings))),await t.setParameters(s)}async applySendEncodings(e,t){try{if(!fR().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];r&&i&&await this.updateRtpSenderEncodings(i,r)}}catch(e){zS.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const n=zP.parse(e);return t.forEach(((e,t)=>{const r=e._mediaStreamTrack,i=n.mediaDescriptions.find((e=>e.attributes.mid===r.kind));i&&$P(i,e)})),zP.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map(((t,n)=>{let{id:r,mslabel:i}=t;const{kind:o}=e[n];return new tE(((e,t)=>{const n=setTimeout((()=>{t(new Error("Cannot receive track, id: ".concat(r)))}),1e4),s=t=>{const a=pE();if("Safari"===a.name&&11===Number(a.version)&&t.track.id!==r&&t.streams[0].id===i){var c;const i=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(o,r,t.track.id),this.peerConnection.removeEventListener("track",s),clearTimeout(n),void e({track:i,id:r})}if(t.track.id===r)return this.peerConnection.removeEventListener("track",s),clearTimeout(n),void e({track:t.track,id:r})};this.peerConnection.addEventListener("track",s)}))})),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await tE.all(t)}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(e){if(fR().supportPCSetConfiguration){const t=xD.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}function MD(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function UD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function FD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UD(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}xT([MD,MT("design:type",Function),MT("design:paramtypes",[Object,Object,Array,Object,String,String]),MT("design:returntype",tE)],xD.prototype,"connect",null),xT([MD,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],xD.prototype,"stopSending",null),xT([MD,MT("design:type",Function),MT("design:paramtypes",[String,Array,String,Object]),MT("design:returntype",tE)],xD.prototype,"receive",null),xT([MD,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],xD.prototype,"stopReceiving",null),xT([MD,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],xD.prototype,"muteRemote",null),xT([MD,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],xD.prototype,"unmuteRemote",null),xT([MD,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],xD.prototype,"muteLocal",null),xT([MD,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],xD.prototype,"unmuteLocal",null),xT([MD,MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],xD.prototype,"close",null),xT([MD,MT("design:type",Function),MT("design:paramtypes",[String,nR]),MT("design:returntype",tE)],xD.prototype,"updateEncoderConfig",null),xT([MD,MT("design:type",Function),MT("design:paramtypes",[String,nR]),MT("design:returntype",tE)],xD.prototype,"updateSendParameters",null),xT([MD,MT("design:type",Function),MT("design:paramtypes",[nR,String]),MT("design:returntype",tE)],xD.prototype,"replaceTrack",null),xT([MD,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],xD.prototype,"getRemoteSSRC",null);const jD="9",VD=4e4;function BD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function GD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?BD(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let qD=class e extends Pw{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}constructor(t,n){super(t,n),rh(this,"store",void 0),rh(this,"peerConnection",void 0),rh(this,"remoteSDP",void 0),rh(this,"initialOffer",void 0),rh(this,"transportEventReceiver",void 0),rh(this,"statsFilter",void 0),rh(this,"useXR",LS("USE_XR")),rh(this,"localCapabilities",void 0),rh(this,"remoteCodecs",void 0),rh(this,"localCandidateCount",0),rh(this,"allCandidatesReceived",!1),rh(this,"dataStreamChannelMap",new Map),rh(this,"establishPromise",void 0),rh(this,"mutex",new Hv("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=PD(this.peerConnection,LS("STATS_UPDATE_INTERVAL"),void 0,bE()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(e,t){this.remoteCodecs=t;const n=[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Di(t=Object.keys(MS)).call(t,e)})))];if(iT.updateRemoteRTPCapabilities(this.store.sessionId,{mids:e,localCodecs:n,remoteCodecs:this.remoteCodecs}),this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);const n=this.remoteSDP.toString();null==t||t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else zS.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else zS.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(n,", codecs: ").concat(t))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=ZP(e.sdp),n=await oD({filterRTX:!LS("USE_PUB_RTX")&&!LS("USE_SUB_RTX"),filterVideoFec:LS("FILTER_VIDEO_FEC"),filterAudioFec:LS("FILTER_AUDIO_FEC"),filterVideoCodec:LS("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=aD(n),this.initialOffer=e,GD(GD({},t),{},{rtpCapabilities:n,offerSDP:e.sdp})}catch(e){throw new FE(UE.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return Iv(this._localCapabilities)}get rtpCapabilities(){return Iv(this._rtpCapabilities)}get candidates(){return Iv(this._candidates)}get iceParameters(){return Iv(this._iceParameters)}get dtlsParameters(){return Iv(this._dtlsParameters)}constructor(e){rh(this,"sessionDesc",void 0),rh(this,"_localCapabilities",void 0),rh(this,"_rtpCapabilities",void 0),rh(this,"_candidates",void 0),rh(this,"_iceParameters",void 0),rh(this,"_dtlsParameters",void 0),rh(this,"setup",void 0),rh(this,"currentMidIndex",void 0),rh(this,"cname",void 0),rh(this,"firefoxSsrcMidMap",new Map),e=Iv(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:s,cname:a}=e,c=zP.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s,this.setup=o,this.cname=a;const l=this.rtpCapabilities.send;for(const u of c.mediaDescriptions){if(u.attributes.iceUfrag=t.iceUfrag,u.attributes.icePwd=t.icePwd,u.attributes.fingerprints=n.fingerprints,u.attributes.candidates=r,u.attributes.setup=o,"video"===u.media.mediaType&&(u.media.fmts=l.videoCodecs.map((e=>e.payloadType.toString(10))),u.attributes.payloads=l.videoCodecs,u.attributes.extmaps=l.videoExtensions,LS("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:t}=QP([{ssrcId:VD,rtx:LS("USE_SUB_RTX")?40001:void 0}],this.cname);u.attributes.ssrcs=e,u.attributes.ssrcGroups=t}if("audio"===u.media.mediaType&&(u.media.fmts=l.audioCodecs.map((e=>e.payloadType.toString(10))),u.attributes.payloads=l.audioCodecs,u.attributes.extmaps=l.audioExtensions,cD(u),LS("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:t}=QP([{ssrcId:2e4}],this.cname);u.attributes.ssrcs=e,u.attributes.ssrcGroups=t}}this.sessionDesc=c,this.currentMidIndex=c.mediaDescriptions.length-1}preloadRemoteMedia(){const e=LS("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;for(let o=1;o<e;o++){const e=2*o+2e4,s=2*o+VD,{ssrcs:a,ssrcGroups:c}=QP([{ssrcId:e}],this.cname),{ssrcs:l,ssrcGroups:u}=QP([{ssrcId:s,rtx:LS("USE_SUB_RTX")?s+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:jD,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:jD,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:a,ssrcGroups:c,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return zP.print(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:o}=QP(t,this.cname,LS("SYNC_GROUP")?n:void 0),s=this.findPreloadMediaDesc(i);if(s){if(bE()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,s.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,r),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||1===t&&(yE()||RE())||0===t&&LS("USE_SUB_RTX")||IE()?(n=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(n=Iv(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),bE()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[];let r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||bE()||IE()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Di(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Di(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateCandidates(e){const t=this._candidates.filter((e=>"udp"===e.transport));if(e===hw.TCP){if(0===t.length)return;if(LS("TCP_CANDIDATE_ONLY")){const e=this._candidates.filter((e=>"tcp"===e.transport));t.forEach((t=>{-1===e.findIndex((e=>e.connectionAddress===t.connectionAddress))&&e.push(FD(FD({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))})),this._candidates=e}else{const e=[];t.forEach((t=>{e.push(FD(FD({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))})),this._candidates=[...t,...e]}}else if(e===hw.RELAY){if(0!==t.length)return;{const e=this._candidates.filter((e=>"tcp"===e.transport));e.forEach((e=>{t.push(FD(FD({},e),{},{foundation:"udpcandidate",priority:Number(e.priority)+1+"",transport:"udp",port:Number(e.port)-90+""}))})),this._candidates=[...t,...e]}}else 0===t.length?(this._candidates.filter((e=>"tcp"===e.transport)).forEach((e=>{t.push(FD(FD({},e),{},{foundation:"udpcandidate",priority:Number(e.priority)+1+"",transport:"udp",port:Number(e.port)-90+""}))})),this._candidates=t):this._candidates=this._candidates.filter((e=>"tcp"!==e.transport));for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(e){e=Iv(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(bE()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if("application"===n.media.mediaType)return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:jD,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,r,i,o){const s=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,c=uD(s,a,this.localCapabilities.send,s===dw.VIDEO?r:i),l=s===dw.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const u="".concat(this.currentMidIndex);let d={media:{mediaType:s,port:jD,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};d=this.mungRecvMediaDsec(d,e,o);const h=this.findFirstClosedMedia(s);if(h){const e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateRemoteCodec(e,t,n){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Di(t=Object.keys(MS)).call(t,e)})))],i=new Set(t);if(r.every((e=>i.has(e))))return zS.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter((e=>t.some((t=>{var n;return Di(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}))));if(0===o.length)return zS.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;const s=[...new Set(o.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")))];let a;if(zS.debug("updateRemoteCodec, from ".concat(r," to ").concat(s)),0===e.length)a=this.sessionDesc.mediaDescriptions.filter((e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction));else if(a=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&Di(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction)),a.length!==e.length)return zS.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;this._rtpCapabilities.recv.videoCodecs=o;const c=this.localCapabilities.send,l=this.rtpCapabilities.recv,u=uD(dw.VIDEO,l,c,n);return a.forEach((e=>{const t=u.map((e=>e.payloadType.toString(10)));zS.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from ").concat(e.attributes.payloads," to ").concat(u)),e.attributes.payloads=u,e.media.fmts=t})),!0}createOrRecycleSendMedia(e,t,n,r,i){const o=this.rtpCapabilities.send,s=e===dw.VIDEO?o.videoCodecs:o.audioCodecs,a=e===dw.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let l={media:{mediaType:e,port:jD,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:a,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};l=this.mungSendMediaDesc(l,i);const u=this.findFirstClosedMedia(e);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){const r=Iv(e);return eD(r),$P(r,t),tD(r,t),nD(r),rD(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Iv(e);return rD(n,t,this.localCapabilities.recv),cD(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>bE()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r,remoteSetup:i,localCapabilities:this.localCapabilities,cname:o}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),a=zP.parse(this.initialOffer.sdp),c=a.mediaDescriptions.find((e=>"audio"===e.media.mediaType));c&&cD(c),this.useXR&&lD(a);const l=zP.print(a),u=this.logSDPExchange(l||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),null==u||u(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const d=this.peerConnection.getTransceivers()[0];if(null!=d&&d.receiver&&this.tryBindTransportEvents(d.receiver),LS("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t)}}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return VP((function*(){const i=yield BP(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[];e.forEach((e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});o.push(t),e._updateRtpTransceiver(t)})),bE()&&!0===LS("SIMULCAST")&&(yield BP(r.applySimulcastForFirefox(o,e)));const s=yield BP(r.peerConnection.createOffer()),a=r.remoteSDP.predictReceivingMids(e.length),c=r.mungSendOfferSDP(s.sdp,e,a),l=zP.parse(c),u=a.map((e=>{const t=l.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return JP(t,LS("USE_PUB_RTX"))}));let d;try{d=yield u}catch(i){d=[],r.remoteSDP.receive(e,t,n,d);const o=r.remoteSDP.toString();throw yield BP(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield BP(r.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield BP(r.stopSending(a,!0)),i}r.remoteSDP.receive(e,t,n,d);const h=r.remoteSDP.toString(),p=r.logSDPExchange(c,"offer","local","send");return yield BP(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield BP(r.applySimulcastEncodings(o,e)),yield BP(r.applySendEncodings(o,e)),null==p||p(h),yield BP(r.peerConnection.setRemoteDescription({type:"answer",sdp:h})),o.map(((e,t)=>{const n=a[t];return{localSSRC:u[t],id:n,transceiver:e}}))}catch(e){throw e instanceof FE?e:new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);n&&"open"===n.readyState?zS.debug("[P2PConnection] Channels are already available and can be reused directly."):(n=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:LS("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)),t.forEach((e=>{e._updateOriginDataChannel(n)}));const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),zS.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else zS.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(e){throw e instanceof FE?e:new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return null==t||t.close(),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof FE?e:new FE(UE.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),zS.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else zS.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const s=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);if(n){const e=this.remoteSDP.toString(),t=this.logSDPExchange(e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const n=await this.peerConnection.createAnswer();null==t||t(n.sdp||""),await this.peerConnection.setLocalDescription(n),zS.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else zS.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return t.map((e=>{const t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}}))}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return VP((function*(){const n=yield BP(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(fR().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===hw.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(zS.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===hw.RELAY)return;t.remoteSDP.updateCandidates(e);const n=yield BP(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=ZP(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);const o=t.remoteSDP.toString(),s=t.logSDPExchange(n.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield BP(t.peerConnection.setLocalDescription(n)),null==s||s(o),yield BP(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){zS.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?bE()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:GD(GD({},gD),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:GD(GD({},gD),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,zS.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,zS.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),LS("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(fv(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),LS("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),LS("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),LS("ENABLE_ENCODED_TRANSFORM")&&fR().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(fk(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!LS("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:e,remote:t}=n.getSelectedCandidatePair();zS.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>t.track===e._mediaStreamTrack))),!t)return zS.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return zS.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!fR().supportSetRtpSenderParameters)return zS.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},i={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var o;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(i.maxBitrate=1e3*t),(Di(o=e._hints).call(o,LC.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(n&&(i.maxFramerate=gk(n)),r&&r>=1&&(i.scaleResolutionDownBy=r))}if(LS("DSCP_TYPE")&&LE()){var s;const e=LS("DSCP_TYPE");Di(s=["very-low","low","medium","high"]).call(s,e)&&(i.networkPriority=e)}const a=t.getParameters(),c=null===(n=a.encodings)||void 0===n?void 0:n[0];bE()&&!c&&(r.encodings=[i]),c&&Object.assign(c,i),Object.assign(a,r),zS.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await t.setParameters(a)}async applySendEncodings(e,t){try{if(!fR().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof yI&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){zS.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=zP.parse(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&($P(o,e),iD(o,e,this.store.codec))})),zP.print(r)}mungReceiveAnswerSDP(e,t,n){const r=zP.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&(n===dw.AUDIO&&"audio"===i.media.mediaType&&cD(i),this.useXR&&lD(r)),zP.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let a=0;a<e.length;a++){var n,r,i,o,s;const c=e[a],l=t[a];if(l instanceof yI&&!Di(n=l._hints).call(n,LC.LOW_STREAM)&&null!==(r=l._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=l._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(s=l._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!bE()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof yI&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const s=t.sender.getParameters();await t.sender.setParameters(Object.assign(s,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof yI&&LS("SIMULCAST")&&"vp8"===this.store.codec&&!Di(t=e._hints).call(t,LC.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(LS("SDP_LOGGING"))return zS.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(fR().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}};function WD(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function zD(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=gk(t.width),r.height=gk(t.height);const i=gk(t.framerate||15);document.body.append(n),document.body.append(r);let o=e._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const s=r.getContext("2d");if(!s)throw new UT(UE.UNEXPECTED_ERROR,"can not get canvas context");const a=fR(),c=r.captureStream(a.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const e=n.videoWidth,t=n.videoHeight/e,i=r.width*t;Math.abs(i-r.height)>=2&&(zS.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(i)),r.height=i)}s.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,n.srcObject=new MediaStream([o]))},r.stopCapture=hR((()=>r.startCapture&&r.startCapture()),i);const l=c.stop;return c.stop=()=>{l.call(c),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),zS.debug("clean low stream renderer")},c}function HD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function KD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?HD(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}xT([WD,MT("design:type",Function),MT("design:paramtypes",[Array,Array]),MT("design:returntype",tE)],qD.prototype,"updateRemoteRTPCapabilities",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[Object,Object,Array,Object,String,String]),MT("design:returntype",tE)],qD.prototype,"connect",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[Object,Array]),MT("design:returntype",tE)],qD.prototype,"createDataChannels",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[String,Array,String,Object]),MT("design:returntype",tE)],qD.prototype,"receive",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],qD.prototype,"batchReceive",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],qD.prototype,"stopReceiving",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],qD.prototype,"muteRemote",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],qD.prototype,"unmuteRemote",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],qD.prototype,"muteLocal",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],qD.prototype,"unmuteLocal",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],qD.prototype,"close",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[String,nR]),MT("design:returntype",tE)],qD.prototype,"updateEncoderConfig",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[String,nR]),MT("design:returntype",tE)],qD.prototype,"updateSendParameters",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[nR,String]),MT("design:returntype",tE)],qD.prototype,"replaceTrack",null),xT([WD,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],qD.prototype,"getRemoteSSRC",null);const YD="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n",ZD="9",JD=2e4,XD=4e4;class QD{get localCapabilities(){return Iv(this._localCapabilities)}get rtpCapabilities(){return Iv(this._rtpCapabilities)}get candidates(){return Iv(this._candidates)}get iceParameters(){return Iv(this._iceParameters)}get dtlsParameters(){return Iv(this._dtlsParameters)}constructor(e){rh(this,"sessionDesc",void 0),rh(this,"_localCapabilities",void 0),rh(this,"_rtpCapabilities",void 0),rh(this,"_candidates",void 0),rh(this,"_iceParameters",void 0),rh(this,"_dtlsParameters",void 0),rh(this,"setup",void 0),rh(this,"currentMidIndex",void 0),rh(this,"cname",void 0),rh(this,"firefoxSsrcMidMap",new Map),e=Iv(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:s,cname:a}=e,c=zP.parse(YD);this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s,this.setup=o,this.cname=a;const l=this.rtpCapabilities.send;for(const u of c.mediaDescriptions){if(u.attributes.iceUfrag=t.iceUfrag,u.attributes.icePwd=t.icePwd,u.attributes.fingerprints=n.fingerprints,u.attributes.candidates=r,u.attributes.setup=o,"application"===u.media.mediaType&&(u.attributes.sctpPort="5000"),"video"===u.media.mediaType&&(u.media.fmts=l.videoCodecs.map((e=>e.payloadType.toString(10))),u.attributes.payloads=l.videoCodecs,u.attributes.extmaps=l.videoExtensions,LS("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:t}=QP([{ssrcId:XD,rtx:LS("USE_SUB_RTX")?40001:void 0}],this.cname);u.attributes.ssrcs=e,u.attributes.ssrcGroups=t}if("audio"===u.media.mediaType&&(u.media.fmts=l.audioCodecs.map((e=>e.payloadType.toString(10))),u.attributes.payloads=l.audioCodecs,u.attributes.extmaps=l.audioExtensions,cD(u),LS("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:t}=QP([{ssrcId:JD}],this.cname);u.attributes.ssrcs=e,u.attributes.ssrcGroups=t}}this.sessionDesc=c,this.currentMidIndex=c.mediaDescriptions.length-1}updateRemoteRTPCapabilities(e){const t=zP.parse(YD);this._rtpCapabilities=e;const n=this.rtpCapabilities.send;for(const r of t.mediaDescriptions){if(r.attributes.iceUfrag=this._iceParameters.iceUfrag,r.attributes.icePwd=this._iceParameters.icePwd,r.attributes.fingerprints=this._dtlsParameters.fingerprints,r.attributes.candidates=this._candidates,r.attributes.setup=this.setup,"application"===r.media.mediaType&&(r.attributes.sctpPort="5000"),"video"===r.media.mediaType&&(r.media.fmts=n.videoCodecs.map((e=>e.payloadType.toString(10))),r.attributes.payloads=n.videoCodecs,r.attributes.extmaps=n.videoExtensions,LS("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:t}=QP([{ssrcId:XD,rtx:LS("USE_SUB_RTX")?40001:void 0}],this.cname);r.attributes.ssrcs=e,r.attributes.ssrcGroups=t}if("audio"===r.media.mediaType&&(r.media.fmts=n.audioCodecs.map((e=>e.payloadType.toString(10))),r.attributes.payloads=n.audioCodecs,r.attributes.extmaps=n.audioExtensions,LS("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:t}=QP([{ssrcId:JD}],this.cname);r.attributes.ssrcs=e,r.attributes.ssrcGroups=t}}this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}preloadRemoteMedia(e){this.rtpCapabilities;const t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;for(let o=1;o<e;o++){const e=2*o+JD,s=2*o+XD,{ssrcs:a,ssrcGroups:c}=QP([{ssrcId:e}],this.cname),{ssrcs:l,ssrcGroups:u}=QP([{ssrcId:s,rtx:LS("USE_SUB_RTX")?s+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:ZD,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:ZD,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:a,ssrcGroups:c,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return zP.print(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:o}=QP(t,this.cname,LS("SYNC_GROUP")?n:void 0),s=this.findPreloadMediaDesc(i);if(s){if(bE()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,s.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,r),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||yE()||SE()||RE()||0===t&&LS("USE_SUB_RTX")?(n=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(n=Iv(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),bE()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}batchSend(e){const t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[];let r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||bE()||yE()||SE()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Di(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Di(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateCandidates(e){e===hw.TCP?this._candidates.forEach((e=>{-1===this._candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this._candidates.push(KD(KD({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this._candidates=this._candidates.filter((e=>"tcp"!==e.transport));for(const t of this.sessionDesc.mediaDescriptions)t.attributes.candidates=this.candidates}restartICE(e){e=Iv(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(bE()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleRecvMedia(e,t,n,r,i,o){const s=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,c=uD(s,a,this.localCapabilities.send,s===dw.VIDEO?r:i),l=s===dw.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const u="".concat(this.currentMidIndex);let d={media:{mediaType:s,port:ZD,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};d=this.mungRecvMediaDsec(d,e,o);const h=this.findFirstClosedMedia(s);if(h){const e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateRemoteCodec(e,t,n){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Di(t=Object.keys(MS)).call(t,e)})))],i=new Set(t);if(r.every((e=>i.has(e))))return zS.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter((e=>t.some((t=>{var n;return Di(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}))));if(0===o.length)return zS.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;const s=[...new Set(o.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")))];let a;if(zS.debug("updateRemoteCodec, from ".concat(r," to ").concat(s)),0===e.length)a=this.sessionDesc.mediaDescriptions.filter((e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction));else if(a=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&Di(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction)),a.length!==e.length)return zS.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;this._rtpCapabilities.recv.videoCodecs=o;const c=this.localCapabilities.send,l=this.rtpCapabilities.recv,u=uD(dw.VIDEO,l,c,n);return a.forEach((e=>{const t=u.map((e=>e.payloadType.toString(10)));zS.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from ").concat(e.attributes.payloads," to ").concat(u)),e.attributes.payloads=u,e.media.fmts=t})),!0}createOrRecycleSendMedia(e,t,n,r,i){const o=this.rtpCapabilities.send,s=e===dw.VIDEO?o.videoCodecs:o.audioCodecs,a=e===dw.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let l={media:{mediaType:e,port:ZD,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:a,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};l=this.mungSendMediaDesc(l,i);const u=this.findFirstClosedMedia(e);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){const r=Iv(e);return eD(r),$P(r,t),tD(r,t),nD(r),rD(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Iv(e);return rD(n,t,this.localCapabilities.recv),cD(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>bE()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}function $D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function eL(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$D(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class tL extends Pw{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(e,t,n){super(e,t),rh(this,"store",void 0),rh(this,"peerConnection",void 0),rh(this,"remoteSDP",void 0),rh(this,"initialOffer",void 0),rh(this,"transportEventReceiver",void 0),rh(this,"statsFilter",void 0),rh(this,"useXR",LS("USE_XR")),rh(this,"localCapabilities",void 0),rh(this,"localCandidateCount",0),rh(this,"allCandidatesReceived",!1),rh(this,"remoteCodecs",void 0),rh(this,"dataStreamChannelMap",new Map),rh(this,"establishPromise",void 0),rh(this,"mutex",new Hv("NVExtentionsConnection-mutex")),rh(this,"rtcMedia",void 0),this.store=t,this.peerConnection=n,this.statsFilter=PD(this.peerConnection,LS("STATS_UPDATE_INTERVAL"),void 0,bE()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(e){try{const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=ZP(e.sdp),n=await oD({filterRTX:!LS("USE_PUB_RTX")&&!LS("USE_SUB_RTX"),filterVideoFec:LS("FILTER_VIDEO_FEC"),filterAudioFec:LS("FILTER_AUDIO_FEC"),filterVideoCodec:LS("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=n,this.initialOffer=e,eL(eL({},t),{},{rtpCapabilities:n,offerSDP:e.sdp})}catch(e){throw new UT(UE.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new QD({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r,remoteSetup:i,localCapabilities:aD(this.localCapabilities),cname:o});const s=this.remoteSDP.toString(),a=zP.parse(this.initialOffer.sdp),c=a.mediaDescriptions.find((e=>"audio"===e.media.mediaType));c&&cD(c),this.useXR&&lD(a);const l=zP.print(a),u=this.logSDPExchange(l||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),null==u||u(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new UT(UE.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){let n;this.remoteCodecs=t,this.localCapabilities&&(n=aD(this.localCapabilities));const r=[...new Set(n&&n.send.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Di(t=Object.keys(MS)).call(t,e)})))];if(iT.updateRemoteRTPCapabilities(this.store.sessionId,{mids:e,localCodecs:r,remoteCodecs:this.remoteCodecs}),this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);const n=this.remoteSDP.toString();null==t||t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else zS.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else zS.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(r,", codecs: ").concat(t))}async updateRemoteConnect(e){var t,n,r,i;null===(t=this.remoteSDP)||void 0===t||t.updateRemoteRTPCapabilities(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&(null===(i=this.remoteSDP)||void 0===i||i.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),null===(n=this.remoteSDP)||void 0===n||n.preloadRemoteMedia(2);const o=null===(r=this.remoteSDP)||void 0===r?void 0:r.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s),zS.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(e,t,n){var r=this;return VP((function*(){const i=yield BP(r.mutex.lock("From NVExtentionsConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const o=[];e.forEach((e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});o.push(t)})),bE()&&!0===LS("SIMULCAST")&&(yield BP(r.applySimulcastForFirefox(o,e)));const s=yield BP(r.peerConnection.createOffer()),a=r.remoteSDP.predictReceivingMids(e.length),c=r.mungSendOfferSDP(s.sdp,e,a),l=zP.parse(c),u=a.map((e=>{const t=l.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return JP(t,LS("USE_PUB_RTX"))}));let d;try{d=yield u}catch(i){d=[],r.remoteSDP.receive(e,t,n,d);const o=r.remoteSDP.toString();throw yield BP(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield BP(r.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield BP(r.stopSending(a,!0)),i}r.remoteSDP.receive(e,t,n,d);const h=r.remoteSDP.toString(),p=r.logSDPExchange(c,"offer","local","send");return yield BP(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield BP(r.applySimulcastEncodings(o,e)),yield BP(r.applySendEncodings(o,e)),null==p||p(h),yield BP(r.peerConnection.setRemoteDescription({type:"answer",sdp:h})),o.map(((e,t)=>{const n=a[t];return{localSSRC:u[t],id:n,transceiver:e}}))}catch(e){throw e instanceof UT?e:new UT(UE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new UT(UE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);return n&&"open"===n.readyState?zS.debug("[P2PConnection] Channels are already available and can be reused directly."):(n=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:LS("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)),void t.forEach((e=>{e._updateOriginDataChannel(n)}))}catch(e){throw e instanceof UT?e:new UT(UE.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return null==t||t.close(),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof UT?e:new UT(UE.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(e.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),zS.debug("[NVExtentionsConnection] receive ".concat(e," by exchanging SDP."))}else zS.debug("[NVExtentionsConnection] receive ".concat(e," no need to exchange SDP."));const s=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i}}catch(e){throw new UT(UE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);if(n){const e=this.remoteSDP.toString(),t=this.logSDPExchange(e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const n=await this.peerConnection.createAnswer();null==t||t(n.sdp||""),await this.peerConnection.setLocalDescription(n),zS.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else zS.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return t.map((e=>{const t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e}}))}catch(e){throw new UT(UE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new UT(UE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new UT(UE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new UT(UE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new UT(UE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new UT(UE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return VP((function*(){const n=yield BP(t.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(fR().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===hw.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(zS.debug("restartICE change iceTransportPolicy from [".concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===hw.RELAY)return;e!==hw.RELAY&&t.remoteSDP.updateCandidates(e);const n=yield BP(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=ZP(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);const o=t.remoteSDP.toString(),s=t.logSDPExchange(n.sdp||"","offer","local","restartICE");yield BP(t.peerConnection.setLocalDescription(n)),null==s||s(o),yield BP(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){zS.warning("restart ICE failed, abort operation",e)}finally{n()}}))()}close(){var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new UT(UE.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?bE()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}getP2PConnectionParams(){var e;if(null===(e=this.peerConnection.currentLocalDescription)||void 0===e||!e.sdp||!this.localCapabilities)throw new Error;return eL(eL({},ZP(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,zS.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,zS.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),LS("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const t={iceServers:[]};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(fv(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...tL.turnServerConfigToIceServers(e.turnServer.servers)),LS("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...tL.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),LS("FORCE_TURN_TCP")?t.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(t.iceTransportPolicy="relay")})))),t}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(fk(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!LS("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async applySendEncodings(e,t){try{if(!fR().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let u=0;u<e.length;u++){const d=e[u],h=t[u];if(h&&h instanceof yI){var n,r,i;if(this.isVP8Simulcast(h))continue;const e={},t={};switch(h._optimizationMode){case"motion":e.degradationPreference="maintain-framerate";break;case"detail":e.degradationPreference="maintain-resolution";break;default:e.degradationPreference="balanced"}var o,s,a,c;if(null!==(n=h._encoderConfig)&&void 0!==n&&n.bitrateMax&&(t.maxBitrate=1e3*(null===(o=h._encoderConfig)||void 0===o?void 0:o.bitrateMax)),Di(r=h._hints).call(r,LC.LOW_STREAM)&&(null!==(s=h._encoderConfig)&&void 0!==s&&s.frameRate&&(t.maxFramerate=gk(h._encoderConfig.frameRate)),null!==(a=h._encoderConfig)&&void 0!==a&&a.scaleResolutionDownBy&&(null===(c=h._encoderConfig)||void 0===c?void 0:c.scaleResolutionDownBy)>1&&(t.scaleResolutionDownBy=h._encoderConfig.scaleResolutionDownBy)),LS("DSCP_TYPE")&&LE()){var l;const e=LS("DSCP_TYPE");Di(l=["very-low","low","medium","high"]).call(l,e)&&(t.networkPriority=e)}const u=d.sender.getParameters(),p=null===(i=u.encodings)||void 0===i?void 0:i[0];bE()&&!p&&(e.encodings=[t]),p&&Object.assign(p,t),Object.assign(u,e),await d.sender.setParameters(u)}}}catch(e){zS.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(e,t,n){const r=zP.parse(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&($P(o,e),iD(o,e,this.store.codec))})),zP.print(r)}mungReceiveAnswerSDP(e,t,n){const r=zP.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===dw.AUDIO&&"audio"===i.media.mediaType&&cD(i),this.useXR&&lD(r),zP.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let a=0;a<e.length;a++){var n,r,i,o,s;const c=e[a],l=t[a];if(l instanceof yI&&!Di(n=l._hints).call(n,LC.LOW_STREAM)&&null!==(r=l._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=l._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(s=l._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!bE()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof yI&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const s=t.sender.getParameters();await t.sender.setParameters(Object.assign(s,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof yI&&LS("SIMULCAST")&&"vp8"===this.store.codec&&!Di(t=e._hints).call(t,LC.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(LS("SDP_LOGGING"))return zS.upload("exchanging ".concat(n," ").concat(t," SDP during NVExtentionsConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(e){if(fR().supportPCSetConfiguration){const t=tL.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}function nL(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From NVExtentionsConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function rL(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=qP,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new iL(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function iL(e){function t(e){if(Object(e)!==e)return tE.reject(new TypeError(e+" is not an object."));var t=e.done;return tE.resolve(e.value).then((function(e){return{value:e,done:t}}))}return iL=function(e){this.s=e,this.n=e.next},iL.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?tE.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?tE.reject(e):t(n.apply(this.s,arguments))}},new iL(e)}xT([nL,MT("design:type",Function),MT("design:paramtypes",[Object,Object,Array,Object,String,String]),MT("design:returntype",tE)],tL.prototype,"connect",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[Array,Array]),MT("design:returntype",tE)],tL.prototype,"updateRemoteRTPCapabilities",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",tE)],tL.prototype,"updateRemoteConnect",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[Object,Array]),MT("design:returntype",tE)],tL.prototype,"createDataChannels",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[String,Array,String,Object]),MT("design:returntype",tE)],tL.prototype,"receive",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],tL.prototype,"batchReceive",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],tL.prototype,"stopReceiving",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],tL.prototype,"muteRemote",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],tL.prototype,"unmuteRemote",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],tL.prototype,"muteLocal",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],tL.prototype,"unmuteLocal",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],tL.prototype,"close",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[String,nR]),MT("design:returntype",tE)],tL.prototype,"updateEncoderConfig",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[String,nR]),MT("design:returntype",tE)],tL.prototype,"updateSendParameters",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[nR,String]),MT("design:returntype",tE)],tL.prototype,"replaceTrack",null),xT([nL,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],tL.prototype,"getRemoteSSRC",null);class oL extends Pw{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(e,t){super(e,t),rh(this,"store",void 0),rh(this,"peerConnection",void 0),rh(this,"cname",void 0),rh(this,"mutex",new Hv("DataChannelConnection-mutex")),rh(this,"dataChannel",void 0),rh(this,"_p2pConnection",void 0),rh(this,"establishPromise",void 0),rh(this,"_nvMedia",void 0),this.store=t,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(oL.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new tL(e,t,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var e;const t=null===(e=this._nvMedia)||void 0===e?void 0:e.getLocalRtpCapabilities();return await this._p2pConnection.establish(t)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(e,t,n,r,i,o){return this.cname=o,await this._p2pConnection.connect(e,t,n,r,i,o),await new tE(((e,t)=>{const r=setTimeout((()=>{this.closeSignal(),t(new UT(UE.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(n))))}),2e3);this.dataChannel.onopen=()=>{if("open"===this.dataChannel.readyState)return clearTimeout(r),void e()},this.dataChannel.onerror=e=>{this.closeSignal(),t(e)}})),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(e,t){return this._p2pConnection.updateRemoteRTPCapabilities(e,t)}send(e,t,n){var r=this;return VP((function*(){const i=yield BP(r.mutex.lock("From DataChannelConnection.send"));try{return yield*GP(rL(r._p2pConnection.send(e,t,n)))}finally{i()}}))()}async stopSending(e,t){return this._p2pConnection.stopSending(e,t)}async createDataChannels(e,t){return this._p2pConnection.createDataChannels(e,t)}async stopDataChannels(e){return this._p2pConnection.stopDataChannels(e)}async receive(e,t,n,r){return this._nvMedia?(zS.debug("[DataChannelConnection] receive ".concat(e," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(e,t,this.cname)):(zS.debug("[DataChannelConnection] receive ".concat(e," by WebRTC.")),await this._p2pConnection.receive(e,t,n,r))}async batchReceive(e){return[...await this._p2pConnection.batchReceive(e)]}async stopReceiving(e){return await this._p2pConnection.stopReceiving(e)}async muteRemote(e){return await this._p2pConnection.muteRemote(e)}async unmuteRemote(e){return await this._p2pConnection.unmuteRemote(e)}async muteLocal(e){return await this._p2pConnection.muteLocal(e)}async unmuteLocal(e){return await this._p2pConnection.unmuteLocal(e)}restartICE(e){var t=this;return VP((function*(){return yield*GP(rL(t._p2pConnection.restartICE(e)))}))()}close(){var e;null===(e=this._nvMedia)||void 0===e||e.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(e){return this._p2pConnection.getRemoteVideoIsReady(e)}updateRemoteConnect(e){var t;null===(t=this._nvMedia)||void 0===t||t.setRemoteRtpCapabilities(e),this._p2pConnection.updateRemoteConnect(e)}async updateEncoderConfig(e,t){return await this._p2pConnection.updateEncoderConfig(e,t)}async updateSendParameters(e,t){return await this._p2pConnection.updateSendParameters(e,t)}setStatsRemoteVideoIsReady(e,t){this._p2pConnection.setStatsRemoteVideoIsReady(e,t)}async replaceTrack(e,t){return await this._p2pConnection.replaceTrack(e,t)}async getRemoteSSRC(e){return this._p2pConnection.getRemoteSSRC(e)}logSDPExchange(e,t,n,r){if(LS("SDP_LOGGING"))return zS.upload("exchanging ".concat(n," ").concat(t," SDP during DataChannelConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}static resolvePCConfiguration(e){const t={iceServers:[]};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(fv(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...oL.turnServerConfigToIceServers(e.turnServer.servers)),LS("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...oL.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),LS("FORCE_TURN_TCP")?t.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(t.iceTransportPolicy="relay")})))),t}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(fk(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!LS("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=e=>{var t;return null===(t=this.onICEConnectionStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onConnectionStateChange=e=>{var t;return null===(t=this.onConnectionStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportStateChange=e=>{var t;return null===(t=this.onDTLSTransportStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportError=e=>{var t;return null===(t=this.onDTLSTransportError)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onICETransportStateChange=e=>{var t;return null===(t=this.onICETransportStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioReceived=e=>{var t;return null===(t=this.onFirstAudioReceived)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoReceived=e=>{var t;return null===(t=this.onFirstVideoReceived)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioDecoded=e=>{var t;return null===(t=this.onFirstAudioDecoded)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoDecoded=(e,t,n)=>{var r;return null===(r=this.onFirstVideoDecoded)||void 0===r?void 0:r.call(this,e,t,n)},this._p2pConnection.onFirstVideoDecodedTimeout=e=>{var t;return null===(t=this.onFirstVideoDecodedTimeout)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onSelectedLocalCandidateChanged=(e,t)=>{var n;return null===(n=this.onSelectedLocalCandidateChanged)||void 0===n?void 0:n.call(this,e,t)},this._p2pConnection.onSelectedRemoteCandidateChanged=(e,t)=>{var n;return null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n?void 0:n.call(this,e,t)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}setConfiguration(e){this._p2pConnection.setConfiguration(e)}}function sL(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From DataChannelConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function aL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cL(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aL(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}xT([sL,MT("design:type",Function),MT("design:paramtypes",[Object,Object,Array,Object,String,String]),MT("design:returntype",tE)],oL.prototype,"connect",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[Array,Array]),MT("design:returntype",tE)],oL.prototype,"updateRemoteRTPCapabilities",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[Object,Array]),MT("design:returntype",tE)],oL.prototype,"createDataChannels",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[String,Array,String,Object]),MT("design:returntype",tE)],oL.prototype,"receive",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],oL.prototype,"stopReceiving",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],oL.prototype,"muteRemote",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],oL.prototype,"unmuteRemote",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],oL.prototype,"muteLocal",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],oL.prototype,"unmuteLocal",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],oL.prototype,"close",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[String,nR]),MT("design:returntype",tE)],oL.prototype,"updateEncoderConfig",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[String,nR]),MT("design:returntype",tE)],oL.prototype,"updateSendParameters",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[nR,String]),MT("design:returntype",tE)],oL.prototype,"replaceTrack",null),xT([sL,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],oL.prototype,"getRemoteSSRC",null);class lL extends nv{constructor(){super(),rh(this,"uplinkStatsUploadInterval",void 0),rh(this,"uplinkRelatedStatsUploadInterval",void 0),rh(this,"uplinkDenoiserStatsUploadInterval",void 0),rh(this,"transportStatsUploadInterval",void 0),rh(this,"uplinkExtensionStatsUploadInterval",void 0),rh(this,"downlinkExtensionStatsUploadInterval",void 0),rh(this,"extensionUsageStatsUploadInterval",void 0),rh(this,"downlinkStatsUploadInterval",void 0),rh(this,"downlinkRelatedStatsUploadInterval",void 0),rh(this,"lastStats",void 0),rh(this,"uploadUnplinkStarted",!1),rh(this,"uploadDownlinkStarted",!1),rh(this,"uploadTransportStarted",!1),rh(this,"uploadExtensionUsageStarted",!1),rh(this,"requestStats",void 0),rh(this,"requestTransportStats",void 0),rh(this,"requestLocalMedia",void 0),rh(this,"requestRemoteMedia",void 0),rh(this,"requestAllTracks",void 0),rh(this,"requestVideoIsReady",void 0),rh(this,"requestUpload",void 0)}startUploadTransportStats(e){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval((()=>{var t;const n=null===(t=this.requestStats)||void 0===t?void 0:t.call(this);if(n){const t=Ek(n);if(e){var r;const e=null===(r=this.requestStats)||void 0===r?void 0:r.call(this,!0);if(e){const n=Ek(e);t.connectionType+=n.connectionType<<3}t.connectionType+=110}else t.connectionType+=100;Rv((()=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,yT.TRANSPORT_STATS,t)}))}}),1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const e=new Map;this.extensionUsageStatsUploadInterval=window.setInterval((async()=>{var t,n,r;const i=Date.now(),o={connectionInterval:LS("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let s=[];const a=(null===(t=this.requestAllTracks)||void 0===t?void 0:t.call(this))||[];for(const e of a)!e.muted&&e.enabled&&(s=s.concat(await e.getProcessorUsage()));const c=(null===(n=this.requestRemoteMedia)||void 0===n?void 0:n.call(this))||[];for(const[e,d]of c)d.has(dw.VIDEO)&&e.videoTrack&&(s=s.concat(await e.videoTrack.getProcessorUsage())),d.has(dw.AUDIO)&&e.audioTrack&&(s=s.concat(await e.audioTrack.getProcessorUsage()));if(0===s.length)return;o.details=function(e,t){const n={};for(const{id:s,value:a,level:c,direction:l}of e){var r;const e=null!==(r=t.get(s))&&void 0!==r?r:0,u=2===a?e+LS("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var i,o;t.set(s,u),n[s]?(2===a&&(n[s].value=a),c>n[s].level&&(n[s].level=c),"remote"===l&&(n[s].remoteUidCount+=1),n[s].totalTs=null!==(i=t.get(s))&&void 0!==i?i:0):n[s]={value:a,level:c,remoteUidCount:"local"===l?0:1,totalTs:null!==(o=t.get(s))&&void 0!==o?o:0}}return Object.keys(n).map((e=>{const{level:t,value:r,totalTs:i}=n[e];return{id:e,level:t,value:r,totalTs:i}}))}(s,e);const l=Date.now(),u=l>i?l:i+1;null===(r=this.requestUpload)||void 0===r||r.call(this,yT.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:u})}),LS("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestStats)||void 0===e?void 0:e.call(this);t&&(this.uploadUplinkStats(t),this.lastStats=t)}),3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestStats)||void 0===e?void 0:e.call(this);t&&this.uploadRelatedUplinkStats(t,this.lastStats),this.lastStats=t}),1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestAllTracks)||void 0===e?void 0:e.call(this);t&&this.uploadDenoiserStats(t)}),2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestAllTracks)||void 0===e?void 0:e.call(this);t&&this.uploadExtensionStats(t)}),2e3))}uploadUplinkStats(e){var t;((null===(t=this.requestLocalMedia)||void 0===t?void 0:t.call(this))||[]).forEach((t=>{let[n,{track:r,ssrcs:i}]=t;switch(n){case fw.LocalVideoLowTrack:case fw.LocalVideoTrack:{const t=function(e,t,n){var r;const i=t.videoSend.find((t=>t.ssrc===e));if(!i)return null;const o={id:Uv(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:i.ssrc.toString()};switch(o.A_vstd=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?"1":"0",i.sentFrame&&(o.A_fhs=i.sentFrame.height.toString(),o.A_frs=i.sentFrame.frameRate.toString(),o.A_fws=i.sentFrame.width.toString()),i.adaptionChangeReason){case"none":o.A_ac="0";break;case"cpu":o.A_ac="1";break;case"bandwidth":o.A_ac="2";break;case"other":o.A_ac="3"}return o.A_lvps=$C[n._player?n._player.videoElementStatus:"uninit"].toString(),o.A_nr=null===(r=i.nacksCount)||void 0===r?void 0:r.toString(),i.avgEncodeMs&&(o.A_aem=i.avgEncodeMs.toFixed(0).toString()),LS("P2P")&&(i.bytes&&(o.bytesSent=i.bytes.toString()),"number"==typeof i.packetsLost&&(o.packetsLost=i.packetsLost.toString()),i.packets&&(o.packetsSent=i.packets.toString())),o}(i[0].ssrcId,e,r),o=n===fw.LocalVideoTrack?function(e,t,n){var r,i,o,s,a,c,l,u;const d=t.videoSend.find((t=>t.ssrc===e));if(!d)return null;const h={id:Uv(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:d.ssrc.toString()},p=null!==(r=null!==(i=null===(o=d.inputFrame)||void 0===o?void 0:o.height)&&void 0!==i?i:null==n?void 0:n._videoHeight)&&void 0!==r?r:0,f=null!==(s=null!==(a=null===(c=d.inputFrame)||void 0===c?void 0:c.width)&&void 0!==a?a:null==n?void 0:n._videoWidth)&&void 0!==s?s:0,m=null!==(l=null===(u=d.inputFrame)||void 0===u?void 0:u.frameRate)&&void 0!==l?l:0;return p&&(h.A_fhi=p+""),f&&(h.A_fwi=f+""),m&&(h.A_fri=m+""),h}(i[0].ssrcId,e,r):null;t&&Rv((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,yT.PUBLISH_STATS,{stream_type:n===fw.LocalVideoLowTrack?"low":"high",stats:cL(cL({},t),o)})}));const s=function(e){const t={id:"bweforvideo",timestamp:new Date(e.timestamp).toISOString(),type:"VideoBwe"};return e.bitrate.retransmit&&(t.A_rb=e.bitrate.retransmit.toString()),e.bitrate.targetEncoded&&(t.A_teb=e.bitrate.targetEncoded.toString()),t.A_aeb=e.bitrate.actualEncoded.toString(),t.A_tb=e.bitrate.transmit.toString(),void 0!==e.sendBandwidth&&(t.A_asb=e.sendBandwidth.toString()),t}(e);s&&setTimeout((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,yT.PUBLISH_STATS,{stream_type:n===fw.LocalVideoLowTrack?"low":"high",stats:s})}),1e3);break}case fw.LocalAudioTrack:{const t=function(e,t,n){const r=t.audioSend.find((t=>t.ssrc===e));if(!r)return null;const i={id:Uv(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:r.ssrc.toString()};return i.A_astd=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?"1":"0",r.inputLevel?i.A_ail=Math.round(100*r.inputLevel).toString():i.A_ail=Math.round(100*n._source.getAccurateVolumeLevel()).toString(),i.A_apil=Math.round(100*n._source.getAccurateVolumeLevel()).toString(),r.aecReturnLoss&&(i.A_ecrl=Math.round(r.aecReturnLoss).toString()),r.aecReturnLossEnhancement&&(i.A_ecrle=Math.round(r.aecReturnLossEnhancement).toString()),LS("P2P")&&(r.bytes&&(i.bytesSent=r.bytes.toString()),"number"==typeof r.packetsLost&&(i.packetsLost=r.packetsLost.toString()),r.packets&&(i.packetsSent=r.packets.toString())),i}(i[0].ssrcId,e,r);t&&Rv((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,yT.PUBLISH_STATS,{stream_type:"high",stats:t})}));break}}}))}uploadRelatedUplinkStats(e,t){var n;((null===(n=this.requestLocalMedia)||void 0===n?void 0:n.call(this))||[]).filter((e=>{let[t]=e;return t===fw.LocalVideoLowTrack||t===fw.LocalVideoTrack})).forEach((t=>{let[n,{ssrcs:r}]=t;const i=function(e,t){const n=t.videoSend.find((t=>t.ssrc===e));return n?{mediaType:"video",isVideoMute:!1,frameRateInput:n.inputFrame&&n.inputFrame.frameRate.toString(),frameRateSent:n.sentFrame&&n.sentFrame.frameRate.toString(),googRtt:n.rttMs.toString(),qpSumPerFrame:Math.floor(n.qpSumPerFrame).toString()}:null}(r[0].ssrcId,e);i&&Rv((()=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,yT.PUBLISH_RELATED_STATS,{stream_type:n===fw.LocalVideoLowTrack?"low":"high",stats:i})}))}))}uploadDenoiserStats(e){for(let i=0;i<e.length;i++){const o=e[i];if(o instanceof $R){var t,n,r;const e=null===(t=(n=o._external).getDenoiserStats)||void 0===t?void 0:t.call(n);return void(e&&(null===(r=this.requestUpload)||void 0===r||r.call(this,yT.DENOISER_STATS,e)))}}}uploadExtensionStats(e){for(let t=0;t<e.length;t++)e[t].getProcessorStats().forEach((e=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,e.type,e.stats)}))}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let e;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let t=!1;this.downlinkStatsUploadInterval=window.setInterval((()=>{var n;const r=null===(n=this.requestStats)||void 0===n?void 0:n.call(this,!0);r&&(this.uploadDownlinkStats(r,t,e),e=r),t=!t}),3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestStats)||void 0===e?void 0:e.call(this,!0);t&&(this.uploadRelatedDownlinkStats(t,this.lastStats),this.lastStats=t)}),1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestRemoteMedia)||void 0===e?void 0:e.call(this);t&&this.uploadDownlinkExtensionStats(t)}),2e3)}uploadDownlinkStats(e,t,n){var r;((null===(r=this.requestRemoteMedia)||void 0===r?void 0:r.call(this))||[]).forEach((r=>{let[i,o]=r;if(o.has(dw.VIDEO)&&i.videoTrack){const r=i.videoTrack?function(e,t,n,r,i){const o=t.videoRecv.find((t=>t.ssrc===e));if(!o)return null;const s={id:Uv(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:o.ssrc.toString()};var a,c;if(s.bytesReceived=o.bytes.toString(),s.packetsLost=o.packetsLost.toString(),s.packetsReceived=o.packets.toString(),o.framesRateFirefox&&(s.A_frr=o.framesRateFirefox.toString()),o.receivedFrame?(s.A_frr=o.receivedFrame.frameRate.toString(),s.A_fhr=o.receivedFrame.height.toString(),s.A_fwr=o.receivedFrame.width.toString()):(s.A_fhr=null===(a=r._videoHeight)||void 0===a?void 0:a.toString(),s.A_fwr=null===(c=r._videoWidth)||void 0===c?void 0:c.toString()),s.A_frd=o.decodeFrameRate.toString(),o.outputFrame&&(s.A_fro=o.outputFrame.frameRate.toString()),void 0!==o.jitterBufferMs&&(s.A_jbm=Math.floor(o.jitterBufferMs).toString()),void 0!==o.currentDelayMs&&(s.A_cdm=Math.floor(o.currentDelayMs).toString()),s.A_fs=o.firsCount.toString(),s.A_ns=o.nacksCount.toString(),s.A_ps=o.plisCount.toString(),r&&(s.A_vrtd=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?"0":"1"),r._player&&r._player.freezeTimeCounterList.length>0&&(s.A_vrft=Math.round(r._player.freezeTimeCounterList.splice(0,1)[0]).toString()),i&&r._player&&"visible"===lI.visibility){const e=Math.min(6e3,r._player.renderFreezeAccTime);s.A_vrrft=Math.round(e).toString(),r._player.renderFreezeAccTime=Math.max(0,r._player.renderFreezeAccTime-e)}if(s.A_rvps=$C[r._player?r._player.videoElementStatus:"uninit"].toString(),n){const t=n.videoRecv.find((t=>t.ssrc===e));if(t&&void 0!==o.totalInterFrameDelay&&void 0!==o.totalSquaredInterFrameDelay&&void 0!==t.totalInterFrameDelay&&void 0!==t.totalSquaredInterFrameDelay){const e=o.totalInterFrameDelay-t.totalInterFrameDelay,n=o.totalSquaredInterFrameDelay-t.totalSquaredInterFrameDelay,r=o.framesDecodeCount-t.framesDecodeCount,i=e/r*1e3,a=Math.round(1e3*Math.sqrt((n-Math.pow(e,2)/r)/r));!isNaN(a)&&i+a>Math.max(3*i,i+150)&&(s.A_ifdsd=a.toString())}}return s}(i._videoSSRC,e,n,i.videoTrack,t):void 0;r&&Rv((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,yT.SUBSCRIBE_STATS,{stream_id:i.uid,stats:r})}))}if(o.has(dw.AUDIO)&&i.audioTrack){const t=i.audioTrack?function(e,t,n,r){const i=t.audioRecv.find((t=>t.ssrc===e));if(!i)return null;const o={id:Uv(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:i.ssrc.toString()};if(o.bytesReceived=i.bytes.toString(),o.packetsLost=i.packetsLost.toString(),o.packetsReceived=i.packets.toString(),i.outputLevel?o.A_aol=Math.round(100*i.outputLevel).toString():o.A_aol=Math.round(100*r._source.getAccurateVolumeLevel()).toString(),o.A_apol=Math.round(100*r._source.getAccurateVolumeLevel()).toString(),r&&(o.A_artd=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?"0":"1"),o.A_jr=i.jitterMs.toString(),o.A_jbm=Math.floor(i.jitterBufferMs).toString(),o.A_cdm=Math.floor(i.jitterBufferMs).toString(),o.A_raps=$C[UR.getPlayerState(r.getTrackId())].toString(),n){const t=n.audioRecv.find((t=>t.ssrc===e));if(t){const e=i.concealedSamples-t.concealedSamples;e>0&&(o.A_cs=Math.round(e).toString())}}return o}(i._audioSSRC,e,n,i.audioTrack):void 0;t&&Rv((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,yT.SUBSCRIBE_STATS,{stream_id:i.uid,stats:t})}))}}))}uploadRelatedDownlinkStats(e,t){var n;((null===(n=this.requestRemoteMedia)||void 0===n?void 0:n.call(this))||[]).forEach((n=>{let[r,i]=n;if(i.has(dw.VIDEO)&&r.videoTrack){var o;const n=!0===(r._videoSSRC&&(null===(o=this.requestVideoIsReady)||void 0===o?void 0:o.call(this,r._videoSSRC))||!1),i=function(e,t,n,r,i,o){const s=n.videoRecv.find((t=>t.ssrc===e)),a=i?i.videoRecv.find((t=>t.ssrc===e)):void 0;if(!s)return null;const c=dk.isRemoteVideoFreeze(o,s,a)&&t,l={mediaType:"video",isVideoMute:!1,peerId:r,frameRateReceived:s.receivedFrame&&s.receivedFrame.frameRate.toString(),frameRateDecoded:s.decodedFrame&&s.decodedFrame.frameRate.toString(),isFreeze:c,bytesReceived:s.bytes.toString(),packetsReceived:s.packets.toString(),packetsLost:s.packetsLost.toString(),qpSumPerFrame:Math.floor(s.qpSumPerFrame).toString()};return s.framesRateFirefox&&(l.frameRateDecoded=s.framesRateFirefox.toString(),l.frameRateReceived=s.framesRateFirefox.toString()),l}(r._videoSSRC,n,e,r.uid,t,r.videoTrack);i&&Rv((()=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,yT.SUBSCRIBE_RELATED_STATS,{stream_id:r.uid,stats:i})}))}if(i.has(dw.AUDIO)&&r.audioTrack){const t=function(e,t,n,r){const i=t.audioRecv.find((t=>t.ssrc===e));if(!i)return null;const o=dk.isRemoteAudioFreeze(r);return{mediaType:"audio",isAudioMute:!1,peerId:n,googJitterReceived:i.jitterMs.toString(),isFreeze:o,bytesReceived:i.bytes.toString(),packetsReceived:i.packets.toString(),packetsLost:i.packetsLost.toString(),frameReceived:i.receivedFrames.toString(),frameDropped:i.droppedFrames.toString()}}(r._audioSSRC,e,r.uid,r.audioTrack);t&&Rv((()=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,yT.SUBSCRIBE_RELATED_STATS,{stream_id:r.uid,stats:t})}))}}))}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(e){e.forEach((e=>{let[t,n]=e;n.has(dw.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach((e=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,e.type,e.stats)})),n.has(dw.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach((e=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,e.type,e.stats)}))}))}}function uL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dL(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uL(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function hL(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=qP,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new pL(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function pL(e){function t(e){if(Object(e)!==e)return tE.reject(new TypeError(e+" is not an object."));var t=e.done;return tE.resolve(e.value).then((function(e){return{value:e,done:t}}))}return pL=function(e){this.s=e,this.n=e.next},pL.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?tE.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?tE.reject(e):t(n.apply(this.s,arguments))}},new pL(e)}class fL extends nv{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(gw.StateChange,t,this._state)}constructor(e,t){super(),rh(this,"store",void 0),rh(this,"statsUploader",void 0),rh(this,"connection",void 0),rh(this,"localTrackMap",new Map),rh(this,"remoteUserMap",new Map),rh(this,"localDataChannels",[]),rh(this,"remoteDataChannelMap",new Map),rh(this,"pendingLocalTracks",[]),rh(this,"pendingRemoteTracks",[]),rh(this,"pendingLocalDataChannels",[]),rh(this,"pendingRemoteDataChannels",[]),rh(this,"statsCollector",void 0),rh(this,"isPlanB",!1),rh(this,"shouldForwardP2PCreation",void 0),rh(this,"iceFailedCount",0),rh(this,"dtlsFailedCount",0),rh(this,"mutex",new Hv("P2PChannel-mutex")),rh(this,"_state",mw.Disconnected),rh(this,"_pcStatsUploadType",LS("NEW_ICE_RESTART")?pw.FIRST_CONNECTION:pw.OLD_FIRST_CONNECTION),rh(this,"_isInRestartIce",!1),rh(this,"_isStartRestartIce",!1),rh(this,"_restartStates",["disconnected","failed"]),rh(this,"_restartTimer",void 0),rh(this,"_isFirstConnected",!0),rh(this,"handleMuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==mw.Connected)return void n(new FE(UE.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const i=r.find((e=>"videoLowTrack"===e[0]));i&&i[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const o=this.createMuteMessage(r);await Ev(this,gw.RequestMuteLocal,o),t()}catch(e){n(e)}finally{r()}})),rh(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==mw.Connected)return void n(new FE(UE.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();const i=r.find((e=>"videoLowTrack"===e[0]));if(i){const t=i[1];if(t.track._originMediaStreamTrack.stop(),!LS("DISABLE_DUAL_STREAM_USE_ENCODING")&&fR().supportDualStreamEncoding){const n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{const n=zD(e,yv(this,gw.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new tE(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}await this.connection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const o=this.createUnmuteMessage(r);await Ev(this,gw.RequestUnmuteLocal,o),t()}catch(e){n(e)}finally{r()}})),rh(this,"handleUpdateVideoEncoder",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const n=this.localTrackMap.get(fw.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==mw.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),await this.connection.updateEncoderConfig(r,i),this.emit(gw.UpdateVideoEncoder,i),t()}catch(e){n(e)}finally{r()}})),rh(this,"handleSetOptimizationMode",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const n=this.localTrackMap.get(fw.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==mw.Connected)return;const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}})),rh(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;zS.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var o;const n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.connection||!n||this.state!==mw.Connected)return void t();if(await(null===(o=this.connection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),this.isPlanB){const t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===fw.LocalVideoTrack&&!LS("DISABLE_DUAL_STREAM_USE_ENCODING")&&fR().supportDualStreamEncoding){const t=this.localTrackMap.get(fw.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new tE(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(e){n(e)}finally{var s;null===(s=i)||void 0===s||s()}})),rh(this,"handleGetRTCStats",(e=>{e(this.statsCollector.getRTCStats())})),rh(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),rh(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),rh(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),rh(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new lL,this.bindStatsUploaderEvents(),this.isPlanB=!fR().supportUnifiedPlan||LS("CHROME_FORCE_PLAN_B")&&LE(),this.shouldForwardP2PCreation=LS("FORWARD_P2P_CREATION")&&fR().supportPCSetConfiguration&&function(){const e=fE();return e===aE.ANDROID||e===aE.IOS||e===aE.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new oL({},this.store):this.isPlanB?new xD({},this.store):new qD({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=mw.New;const r=this.shouldForwardP2PCreation&&"closed"===(null===(n=this.connection)||void 0===n?void 0:n.peerConnectionState);if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(zS.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new oL(e,this.store):this.isPlanB?new xD(e,this.store):new qD(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new FE(UE.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=LS("NEW_ICE_RESTART")?pw.FIRST_CONNECTION:pw.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,n,r,i,o){if(!this.connection)throw new FE(UE.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof oL?this.connection.updateRemoteConnect(r):(this.store.peerConnectionStart(),await this.connection.connect(e,t,n,r,i,o),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=mw.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter((e=>{var t;let[n]=e;return Di(t=[fw.LocalVideoLowTrack,fw.LocalVideoTrack]).call(t,n)})).map((e=>{let[,{id:t}]=e;return t}));if(this.connection instanceof qD){if(!Di(e).call(e,this.store.codec)){const t=["vp8","h264"].find((t=>Di(e).call(e,t)));t&&(this.store.codec=t,zS.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(t,e)}}async preConnect(e,t,n,r,i,o){if(!this.connection)throw new FE(UE.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const s=await this.connection.connect(e,t,n,r,i,o);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=mw.Connected,s}getEstablishParams(){if(this.connection instanceof oL)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(e){if(!this.connection){if(this.state===mw.Disconnected)throw new FE(UE.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const t=e.filter((e=>-1!==this.pendingLocalDataChannels.findIndex((t=>t.id===e.id))));return void(this.pendingLocalDataChannels=this.pendingLocalDataChannels.concat(t))}const t=this.filterTobePublishedDataChannels(e);0!==t.length&&(t.forEach((e=>{const t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((e=>{this.localDataChannels.push(e);const t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)})))}publish(e,t,n){var r=this;return VP((function*(){const i=yield BP(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==mw.Connected){if(r.state===mw.Disconnected)throw new FE(UE.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,ck.markPublishStart(r.store.clientId,r.store.pubId);const i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield BP(r.tryToUnmuteAudio(e)));yield*GP(hL(r.doPublish(r.connection,i)))}finally{i()}}))()}doPublish(e,t){var n=this;return VP((function*(){t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===fw.LocalAudioTrack?"audio":"video",i)})),n.bindLocalTrackEvents(t);const r=yield BP(e.send(t.map((e=>{let{track:t}=e;return t})),n.store.codec,n.store.audioCodec)),i=(yield BP(r.next())).value,o=n.createGatewayPublishMessage(t,i);let s;try{s=yield o}catch(e){throw r.throw(e),(null==e?void 0:e.code)===UE.WS_ABORT&&t.forEach((e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)})),n.unbindLocalTrackEvents(t),e}const a=n.mapPubResToRemoteConfig(o,s),c=(yield BP(r.next(a))).value;t.forEach((e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)})),n.assignLocalTracks(t,c),n.statsUploader.startUploadUplinkStats(),t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===fw.LocalAudioTrack?"audio":"video",void 0,i)}))}))()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n)return;if(!(n.track instanceof yI))return zS.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof qD||this.connection instanceof xD))return zS.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:r}=n,i=function(e,t){const n={};return e.height&&e.width&&(n.scaleResolutionDownBy=Sk(e,t)),n.maxFramerate=e.framerate?gk(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==fw.LocalVideoLowTrack||!LS("DISABLE_DUAL_STREAM_USE_ENCODING")&&fR().supportDualStreamEncoding)null!=i.scaleResolutionDownBy&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const t=r._originMediaStreamTrack;if(!t.canvas)return zS.warn("[".concat(r.getTrackId(),"] no canvas on track"));!function(e,t){const n=e.canvas;t.width&&(n.width=gk(t.width)),t.height&&(n.height=gk(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=hR((()=>{!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()}),gk(t.framerate)))}(t,e)}null!=i.maxBitrate&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),null!=i.maxFramerate&&(r._encoderConfig.frameRate&&"object"==typeof r._encoderConfig.frameRate?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),zS.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return VP((function*(){if(!t.connection||t.state!==mw.Connected)return;const n=yield BP(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const n=t.localTrackMap.get(fw.LocalVideoTrack);if(!n)throw new FE(UE.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(fw.LocalVideoLowTrack))throw new FE(UE.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const i=[{track:t.getLowVideoTrack(n.track,e),type:fw.LocalVideoLowTrack}];if(yield*GP(hL(t.doPublish(t.connection,i))),n.track.muted||!n.track.enabled){var r;const e=null===(r=t.localTrackMap.get(fw.LocalVideoLowTrack))||void 0===r?void 0:r.id;void 0!==e&&(yield BP(t.connection.muteLocal([e])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(zS.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await _v(this,gw.RequestRePublish,this.pendingLocalTracks),this.emit(gw.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(zS.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await _v(this,gw.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:e,kind:n}=this.pendingRemoteTracks[t];(n!==dw.AUDIO||e._audio_added_&&e._audioSSRC)&&(n!==dw.VIDEO||e._video_added_&&e._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await _v(this,gw.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===dw.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((e=>{let{user:t}=e;this.emit(gw.MediaReconnectEnd,t.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==mw.Connected)return void e.forEach((e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find((e=>"videoLowTrack"===e[0]));return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==mw.Connected)return void e.forEach((e=>{const t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)}));const t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach((e=>{const t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)})),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map((e=>e.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==mw.Connected)return;const e=this.localTrackMap.get(fw.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[fw.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadUplinkStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==mw.Connected)throw new FE(UE.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter((t=>{var n;return!(null!==(n=this.remoteDataChannelMap.get(e))&&void 0!==n&&n.get(t.id))}));if(0!==n.length)return await this.connection.createDataChannels(e.uid,n),n.forEach((t=>{var n;this.remoteDataChannelMap.has(e)?null===(n=this.remoteDataChannelMap.get(e))||void 0===n||n.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));const r=this.pendingRemoteDataChannels.findIndex((n=>{let{user:r,id:i}=n;return r.uid===e.uid&&i===t.id}));-1!==r&&this.pendingRemoteDataChannels.splice(r,1)})),n.map((e=>e.id))}async subscribe(e,t,n,r,i){var o;if(!this.connection||this.state!==mw.Connected)throw new FE(UE.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(o=this.remoteUserMap.get(e))&&void 0!==o&&o.has(t))return;let s,a,c;if(i){const n=i.find((e=>{let{stream_type:n}=e;return n===t}));if(!n)throw new FE(UE.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const r=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof qD&&(c=r.transceiver),s=r.track,a=r.id}else{const i=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof qD&&(c=i.transceiver),s=i.track,a=i.id}t===dw.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new AI(s,e.uid,e._uintid,this.store),zS.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new OI(s,e.uid,e._uintid,this.store),zS.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack));const l=this.remoteUserMap.get(e);l?l.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadDownlinkStats();const u=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==u&&(this.pendingRemoteTracks.splice(u,1),this.emit(gw.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==mw.Connected)throw new FE(UE.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((e=>{var t;let{user:n,mediaType:r}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(r))}));const t=await this.connection.batchReceive(e.map((e=>{let{user:t,mediaType:n,ssrcId:r,rtxSsrcId:i}=e;return{kind:n,ssrcMsg:[{ssrcId:r,rtx:i}],mslabel:String(t._uintid)}})));e.forEach(((e,n)=>{let{user:r,mediaType:i}=e;const{track:o,id:s,transceiver:a}=t[n];i===dw.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(o):(r._audioTrack=new AI(o,r.uid,r._uintid,this.store),zS.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),a&&r._audioTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(o):(r._videoTrack=new OI(o,r.uid,r._uintid,this.store),zS.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),a&&r._videoTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(r,r._videoTrack));const c=this.remoteUserMap.get(r);c?c.set(i,s):this.remoteUserMap.set(r,new Map([[i,s]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadDownlinkStats();const l=this.pendingRemoteTracks.findIndex((e=>{let{user:t,kind:n}=e;return t.uid===r.uid&&i===n}));-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(gw.MediaReconnectEnd,r.uid))}))}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.connection&&this.state===mw.Connected||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===dw.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===dw.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==mw.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(0===i.length)return;await this.connection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t})));const o=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),i.forEach((e=>{let[t,{kind:r}]=e;var i,o;if(r===dw.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===dw.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===dw.AUDIO){var s;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(s=t._audioTrack)||void 0===s||s._destroy(),t._audioTrack=void 0)}})),o}async unsubscribeDataChannel(e,t){if(t.forEach((e=>{const t=this.pendingRemoteDataChannels.findIndex((t=>t.id===e.id));-1!==t&&this.pendingRemoteDataChannels.splice(t,1)})),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(0===n.length)return;t.forEach((e=>{e._close()}));const r=this.remoteDataChannelMap.get(e);return n.forEach((e=>{r&&r.delete(e.id)})),r&&0===r.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map((e=>e.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:o}of e){const e=this.pendingRemoteTracks.filter((e=>{let{user:t,kind:n}=e;return void 0!==o?t.uid===i.uid&&o===n:t.uid===i.uid}));e.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),t=t.concat(e)}if(!this.connection||this.state!==mw.Connected)return void t.forEach((e=>{let{user:t,kind:n}=e;var r;if(n===dw.AUDIO)null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0;else if(n===dw.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}}));const n=cy(e).call(e,((e,t)=>{let{user:n,mediaType:r}=t;const i=this.filterTobeUnSubscribedTracks(n,r);return e.concat(i)}),[]);if(0===n.length)return;await this.connection.stopReceiving(n.map((e=>{let[,{id:t}]=e;return t})));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),n.forEach((e=>{let[t,{kind:n}]=e;var r,i;if(n===dw.VIDEO&&t._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===dw.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0;else if(n===dw.AUDIO){var o;this.unbindRemoteTrackEvents(t._audioTrack),null===(o=t._audioTrack)||void 0===o||o._destroy(),t._audioTrack=void 0}})),r}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void zS.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void zS.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===dw.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||zS.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):zS.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(fw.LocalAudioTrack);if((null==t?void 0:t.track)instanceof tI){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==fw.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===fw.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===fw.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(fw.LocalAudioTrack),o=r?this.localTrackMap.get(fw.LocalVideoLowTrack):this.localTrackMap.get(fw.LocalVideoTrack);iT.publish(this.store.sessionId,{eventElapse:ck.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(LC.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const s=n.find((e=>e instanceof QR)),a=r?null===(o=this.localTrackMap.get(fw.LocalVideoTrack))||void 0===o?void 0:o.track:n.find((e=>e instanceof yI));iT.publish(this.store.sessionId,{eventElapse:ck.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==s?void 0:s.getTrackLabel(),videoName:null==a?void 0:a.getTrackLabel(),screenshare:-1!==(null==a?void 0:a._hints.indexOf(LC.SCREEN_TRACK)),audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===dw.VIDEO?n._videoSSRC:n._audioSSRC;i&&iT.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===dw.VIDEO,audio:r===dw.AUDIO,peerid:n.uid,subscribeRequestid:r===dw.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:ck.measureFromSubscribeStart(this.store.clientId,i)})}reset(){zS.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Hv("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new oL({},this.store):this.isPlanB?new xD({},this.store):new qD({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(fw.LocalAudioTrack);if((null==e?void 0:e.track)instanceof tI){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=mw.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(fw.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(fw.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof yI||t&&t.track instanceof QR?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(dh(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(fw.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Qh(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.connection&&(zS.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=mw.Reconnecting,LS("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new oL({},this.store):this.isPlanB?new xD({},this.store):new qD({},this.store),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case fw.LocalVideoTrack:Di(t=r._hints).call(t,LC.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case fw.LocalAudioTrack:r instanceof tI?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case fw.LocalVideoLowTrack:}})),this.emit(gw.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(dh(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(gw.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,n]=e;Array.from(dh(n).call(n)).forEach((e=>{this.setPendingRemoteDataChannel(t,e)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),zS.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof NP?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof NP?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return VP((function*(){if(!t.connection||t.state!==mw.Connected||t.connection instanceof oL)return;const n=yield BP(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield BP(t.connection.restartICE(e));const n=yield BP(r.next());if(n.done)return;const i=n.value,o=yield i;switch(t.reportPCDisconnectedOrFailed(e),e){case hw.TCP:t._pcStatsUploadType=pw.TCP_RESTART;break;case hw.RELAY:t._pcStatsUploadType=pw.RELAY_RESTART;break;default:t._pcStatsUploadType=pw.OLD_RESTART}t._isInRestartIce=!0,r.next(o)}catch(e){var i;null===(i=r)||void 0===i||i.throw(e)}finally{n()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(fw.LocalVideoTrack),n=this.localTrackMap.get(fw.LocalAudioTrack),r=e.videoSend.find((e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId))),i=e.audioSend.find((e=>e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId)));if(!r||!i)return 1;const o=vv(this,gw.NeedSignalRTT),s=r?r.rttMs:void 0,a=i?i.rttMs:void 0,c=s&&a?(s+a)/2:s||a,l=(c&&o?(c+o)/2:c||o)||0,u=100*e.sendPacketLossRate*.7/50+.3*l/1500,d=u<.17?1:u<.36?2:u<.59?3:u<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(LC.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return aT[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,s=e.audioRecv.find((e=>e.ssrc===i)),a=e.videoRecv.find((e=>e.ssrc===o));if(!s&&!a)return void(t+=1);const c=vv(this,gw.NeedSignalRTT),l=e.rtt,u=(l&&c?(l+c)/2:l||c)||0,d=s?s.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*u/1500;d&&(p=.6*h*100/50+.2*u/1500+.2*d/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new tE(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){const r=[],i=fR(),o=this.getAllTracks();e=Cv(e=e.filter((e=>-1===o.indexOf(e))));let s=!1,a=!1;for(const c of e){if(c instanceof yI&&(this.localTrackMap.has(fw.LocalVideoTrack)||s?new FE(UE.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:fw.LocalVideoTrack}),s=!0),t)){const e=this.getLowVideoTrack(c,n);r.push({track:e,type:fw.LocalVideoLowTrack})}if(c instanceof QR){const e=this.localTrackMap.get(fw.LocalAudioTrack);if(e){if(!(e.track instanceof tI))throw new FE(UE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new FE(UE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(a){const e=r.find((e=>{let{type:t}=e;return t===fw.LocalAudioTrack}));if(!(e.track instanceof tI))throw new FE(UE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new FE(UE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c)}else{if(!i.webAudioMediaStreamDest||c instanceof tI||c._bypassWebAudio)r.push({track:c,type:fw.LocalAudioTrack});else{const e=new tI;e.addAudioTrack(c),r.push({track:e,type:fw.LocalAudioTrack})}a=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Cv(e=e.filter((e=>-1!==n.indexOf(e))));for(const r of e){if(r instanceof QR){const e=this.localTrackMap.get(fw.LocalAudioTrack);if(!e)continue;e.track instanceof tI?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([fw.LocalAudioTrack,e]),e.track.close())):t.push([fw.LocalAudioTrack,e])}if(r instanceof yI){const e=this.localTrackMap.get(fw.LocalVideoTrack);if(!e)continue;t.push([fw.LocalVideoTrack,e]);const n=this.localTrackMap.get(fw.LocalVideoLowTrack);n&&t.push([fw.LocalVideoLowTrack,n])}}return t}filterTobePublishedDataChannels(e){return(e=Cv(e)).filter((e=>-1===this.localDataChannels.findIndex((t=>t.id===e.id))))}filterTobeUnpublishedDataChannels(e){return(e=(e=Cv(e)).filter((e=>-1!==this.localDataChannels.indexOf(e)))).filter((e=>e._originDataChannel))}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case fw.LocalVideoTrack:t.addListener(DC.GET_STATS,this.handleGetLocalVideoStats),t.addListener(DC.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(DC.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(DC.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(DC.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(DC.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),t.addListener(DC.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(DC.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(DC.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case fw.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case fw.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof tI?e.trackList.forEach((e=>{e.addListener(DC.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(DC.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(DC.GET_STATS,this.handleGetLocalAudioStats),e.addListener(DC.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(DC.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(DC.GET_STATS,this.handleGetLocalAudioStats),e.addListener(DC.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(DC.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(DC.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(DC.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(DC.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case fw.LocalVideoTrack:t.off(DC.GET_STATS,this.handleGetLocalVideoStats),t.off(DC.GET_RTC_STATS,this.handleGetRTCStats),t.off(DC.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(DC.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(DC.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(DC.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),t.off(DC.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(DC.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(DC.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case fw.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case fw.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof tI?e.trackList.forEach((e=>{e.off(DC.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(DC.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(DC.GET_STATS,this.handleGetLocalAudioStats),e.off(DC.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(DC.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(DC.GET_STATS,this.handleGetLocalAudioStats),e.off(DC.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(DC.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(DC.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(DC.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(DC.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof OI&&t.addListener(DC.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof AI&&t.addListener(DC.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(DC.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(dw.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(dw.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,o,{track:s,type:a}=e;switch(a){case fw.LocalAudioTrack:i=$T.Audio,o={dtx:s instanceof $R&&s._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case fw.LocalVideoTrack:i=Di(r=s._hints).call(r,LC.SCREEN_TRACK)?$T.Screen:$T.High,o=dL(dL({},_k(s)),{},{codec:this.store.codec});break;case fw.LocalVideoLowTrack:i=$T.Low,o=dL(dL({},_k(s)),{},{codec:this.store.codec})}return{stream_type:i,attributes:o,ssrcs:t[n]}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case fw.LocalVideoTrack:n=Di(t=i._hints).call(t,LC.SCREEN_TRACK)?$T.Screen:$T.High;break;case fw.LocalAudioTrack:n=$T.Audio;break;case fw.LocalVideoLowTrack:n=$T.Low}return{stream_type:n,ssrcs:o,mid:s}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(gw.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),LS("NEW_ICE_RESTART")){var n;if(Di(n=this._restartStates).call(n,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const t=t=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(zS.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(t)),"CONNECTED"===vv(this,gw.QueryClientConnectionState)&&this.emit(gw.RequestRestartICE,t))},n=()=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),zS.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(gw.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())},r=LS("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout((()=>{if(LS("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&fR().supportPCSetConfiguration)t(hw.RELAY),this._restartTimer=window.setTimeout(n,r);else if(bE())t(hw.UDP),this._restartTimer=window.setTimeout(n,4e3);else{if(t(hw.TCP),fR().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout((()=>{t(hw.RELAY),this._restartTimer=window.setTimeout(n,r)}),r));this._restartTimer=window.setTimeout(n,r)}}),800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout((()=>{"disconnected"===e.iceConnectionState&&LS("ICE_RESTART")&&"CONNECTED"===vv(this,gw.QueryClientConnectionState)&&this.emit(gw.RequestRestartICE)}),800),void setTimeout((()=>{"disconnected"===e.peerConnectionState&&(zS.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout((()=>this.emit(gw.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);"failed"===t&&(zS.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout((()=>this.emit(gw.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),iT.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:sv.TRACER}).onSuccess(),this.emit(gw.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(dh(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(VC.FIRST_FRAME_DECODED),iT.firstRemoteFrame(this.store.sessionId,JS.FIRST_AUDIO_DECODE,XS.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:ck.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(dh(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&iT.firstRemoteFrame(this.store.sessionId,JS.FIRST_AUDIO_RECEIVED,XS.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:ck.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(dh(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&iT.firstRemoteFrame(this.store.sessionId,JS.FIRST_VIDEO_RECEIVED,XS.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:ck.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(gw.ConnectionTypeChange,n),zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Tk(t))," -> ").concat(JSON.stringify(Tk(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Tk(t))," -> ").concat(JSON.stringify(Tk(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(fw.LocalAudioTrack);if(e instanceof QR&&(null==n?void 0:n.track)instanceof tI)return n.track.isActive||t.push([fw.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===fw.LocalVideoTrack)){const e=this.localTrackMap.get(fw.LocalVideoLowTrack);e&&t.push([fw.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(fw.LocalAudioTrack);if(e instanceof QR&&(null==n?void 0:n.track)instanceof tI)return n.track.isActive&&t.push([fw.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===fw.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(fw.LocalVideoLowTrack);e&&t.push([fw.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case fw.LocalAudioTrack:n=$T.Audio;break;case fw.LocalVideoTrack:n=Di(t=i._hints).call(t,LC.SCREEN_TRACK)?$T.Screen:$T.High;break;case fw.LocalVideoLowTrack:n=$T.Low}return{stream_type:n,ssrcs:o,mid:s}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case fw.LocalAudioTrack:n=$T.Audio;break;case fw.LocalVideoTrack:n=Di(t=i._hints).call(t,LC.SCREEN_TRACK)?$T.Screen:$T.High;break;case fw.LocalVideoLowTrack:n=$T.Low}return{stream_type:n,ssrcs:o,mid:s}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach((t=>{var r;null!==(r=this.remoteDataChannelMap.get(e))&&void 0!==r&&r.has(t.id)&&n.push(t)})),n}createUnsubscribeMessage(e){const t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case dw.VIDEO:return void(n._videoSSRC&&t.push({stream_type:dw.VIDEO,ssrcId:n._videoSSRC}));case dw.AUDIO:return void(n._audioSSRC&&t.push({stream_type:dw.AUDIO,ssrcId:n._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((e=>{let[n,{kind:r}]=e;if(t.has(n)){let e=t.get(n);r===dw.VIDEO?e|=nw.Video:e|=nw.Audio,t.set(n,e)}else r===dw.VIDEO?t.set(n,nw.Video):t.set(n,nw.Audio)})),{users:Array.from(t.entries()).map((e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}}))}}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(fw.LocalVideoTrack),n=this.localTrackMap.get(fw.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(e,t){return e.map(((e,n)=>{var r;let{stream_type:i}=e;return null===(r=t.find((e=>{let{stream_type:t}=e;return i===t})))||void 0===r?void 0:r.attributes}))}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof QR){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(0===r.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t}))));const i=this.createUnmuteMessage(r);return void await Ev(this,gw.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(gw.RequestUploadStats,e,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Mv(Zv(this.dtlsFailedCount,Yv)),this.emit(gw.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await _v(this,gw.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(gw.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(fw.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof yI))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof yI)).length>1)throw new FE(UE.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof QR)).length>1&&(e.some((e=>e instanceof QR&&e._bypassWebAudio))||!fR().webAudioMediaStreamDest))throw new FE(UE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof yI&&this.pendingLocalTracks.some((e=>e instanceof yI)))throw new FE(UE.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof QR&&this.pendingLocalTracks.some((e=>e instanceof QR))&&(!fR().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof QR&&e._bypassWebAudio))))throw new FE(UE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!LS("DISABLE_DUAL_STREAM_USE_ENCODING")&&fR().supportDualStreamEncoding,r=dL(dL({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():zD(e,r);const o=Uv(8,"track-low-"),s=new yI(i,dL(dL({},n&&{scaleResolutionDownBy:Sk(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return s.on(FC.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,xC.LOW_STREAM)})),s._hints.push(LC.LOW_STREAM),e.addListener(DC.NEED_CLOSE,(()=>{s.close()})),s}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof qD){var i,o,s,a;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:u,peerConnectionState:d}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();iT.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:l,dtlsstate:u,connectionstate:d,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:null!==(i=null==h?void 0:h.protocol)&&void 0!==i?i:"",selectedLocalCandidateType:null!==(o=h.candidateType)&&void 0!==o?o:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(s=p.protocol)&&void 0!==s?s:"",selectedRemoteCandidateType:null!==(a=p.candidateType)&&void 0!==a?a:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:n})}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const o=Array.from(dh(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,s=i.subscribe.find((e=>e.userId===o.uid&&"video"===e.type));iT.firstRemoteVideoDecode(this.store.sessionId,JS.FIRST_VIDEO_DECODE,XS.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:ck.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==s?void 0:s.subscribeEnd)||0,subscriberStart:(null==s?void 0:s.subscribeStart)||0,videoAddNotify:(null==s?void 0:s.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const o=await this.connection.getRemoteSSRC(i);return void 0!==o&&o!==n}resetConnection(e){zS.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===mw.Connected?(zS.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===rw.datachannel?new oL({},this.store):this.isPlanB?new xD({},this.store):new qD({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===fw.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,xC.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof qD&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===pw.TCP_RESTART&&e===hw.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,pw.DISCONNECTED_OR_FAILED)))}}function mL(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function gL(e){let t=IL();return function(e,t){let n=e.appId;void 0!==n&&(BL(t,10),LL(t,n));let r=e.cid;void 0!==r&&(BL(t,16),BL(t,r));let i=e.cname;void 0!==i&&(BL(t,26),LL(t,i));let o=e.deviceId;void 0!==o&&(BL(t,34),LL(t,o));let s=e.elapse;void 0!==s&&(BL(t,40),GL(t,s));let a=e.fileSize;void 0!==a&&(BL(t,48),GL(t,CL(a)));let c=e.height;void 0!==c&&(BL(t,56),GL(t,CL(c)));let l=e.jpg;void 0!==l&&(BL(t,66),BL(t,l.length),function(e,t){let n=kL(e,t.length);e.bytes.set(t,n)}(t,l));let u=e.networkType;void 0!==u&&(BL(t,72),GL(t,CL(u)));let d=e.osType;void 0!==d&&(BL(t,80),GL(t,CL(d)));let h=e.requestId;void 0!==h&&(BL(t,90),LL(t,h));let p=e.sdkVersion;void 0!==p&&(BL(t,98),LL(t,p));let f=e.sequence;void 0!==f&&(BL(t,104),GL(t,CL(f)));let m=e.sid;void 0!==m&&(BL(t,114),LL(t,m));let g=e.timestamp;void 0!==g&&(BL(t,120),GL(t,g));let _=e.uid;void 0!==_&&(BL(t,128),BL(t,_));let E=e.vid;void 0!==E&&(BL(t,136),BL(t,E));let v=e.width;void 0!==v&&(BL(t,144),GL(t,CL(v)));let y=e.service;void 0!==y&&(BL(t,152),BL(t,y));let b=e.callbackData;void 0!==b&&(BL(t,162),LL(t,b));let S=e.jpgEncryption;void 0!==S&&(BL(t,168),BL(t,S));let T=e.requestType;void 0!==T&&(BL(t,176),BL(t,T));let w=e.scorePorn;void 0!==w&&(BL(t,185),jL(t,w));let C=e.scoreSexy;void 0!==C&&(BL(t,193),jL(t,C));let R=e.scoreNeutral;void 0!==R&&(BL(t,201),jL(t,R));let I=e.scene;void 0!==I&&(BL(t,208),BL(t,I));let O=e.ossFilePrefix;void 0!==O&&(BL(t,218),LL(t,O));let A=e.serviceVendor;if(void 0!==A)for(let N of A){BL(t,226);let e=IL();vL(N,e),BL(t,e.limit),xL(t,e),OL(e)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function _L(e){return function(e){let t={};e:for(;!NL(e);){let n=VL(e);switch(n>>>3){case 0:break e;case 1:t.code=VL(e);break;case 2:t.msg=DL(e,VL(e));break;case 3:{let n=yL(e);t.data=EL(e),e.limit=n;break}default:bL(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function EL(e){let t={};e:for(;!NL(e);){let n=VL(e);switch(n>>>3){case 0:break e;case 1:t.requestId=DL(e,VL(e));break;case 2:t.requestType=VL(e)>>>0;break;case 3:t.scorePorn=FL(e);break;case 4:t.scoreSexy=FL(e);break;case 5:t.scoreNeutral=FL(e);break;case 6:t.requestScene=VL(e)>>>0;break;case 7:t.scene=VL(e)>>>0;break;default:bL(e,7&n)}}return t}function vL(e,t){let n=e.service;void 0!==n&&(BL(t,8),BL(t,n));let r=e.vendor;void 0!==r&&(BL(t,16),BL(t,r));let i=e.token;void 0!==i&&(BL(t,26),LL(t,i));let o=e.callbackUrl;void 0!==o&&(BL(t,34),LL(t,o))}function yL(e){let t=VL(e),n=e.limit;return e.limit=e.offset+t,n}function bL(e,t){switch(t){case 0:for(;128&ML(e););break;case 2:AL(e,VL(e));break;case 5:AL(e,4);break;case 1:AL(e,8);break;default:throw new Error("Unimplemented type: "+t)}}xT([mL,MT("design:type",Function),MT("design:paramtypes",[Object,Boolean]),MT("design:returntype",tE)],fL.prototype,"startP2PConnection",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[Object,Object,Array,Object,String,String]),MT("design:returntype",tE)],fL.prototype,"connect",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",void 0)],fL.prototype,"updateRemoteRTPCapabilities",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[Object,Object,Array,Object,String,String]),MT("design:returntype",tE)],fL.prototype,"preConnect",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],fL.prototype,"publishDataChannel",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],fL.prototype,"unpublish",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],fL.prototype,"unpublishDataChannel",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",tE)],fL.prototype,"unpublishLowStream",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[NP,Array]),MT("design:returntype",tE)],fL.prototype,"subscribeDataChannel",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[NP,String,Number,Number,Array]),MT("design:returntype",tE)],fL.prototype,"subscribe",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],fL.prototype,"massSubscribe",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[NP,String,Boolean]),MT("design:returntype",tE)],fL.prototype,"unsubscribe",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[NP,Array]),MT("design:returntype",tE)],fL.prototype,"unsubscribeDataChannel",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],fL.prototype,"massUnsubscribe",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[NP,String]),MT("design:returntype",tE)],fL.prototype,"muteRemote",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[NP,String]),MT("design:returntype",tE)],fL.prototype,"unmuteRemote",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[NP,String]),MT("design:returntype",tE)],fL.prototype,"hasRemoteMediaWithLock",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",tE)],fL.prototype,"disconnectForReconnect",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",tE)],fL.prototype,"updateBitrateLimit",null),xT([mL,MT("design:type",Function),MT("design:paramtypes",[NP,String,Number]),MT("design:returntype",tE)],fL.prototype,"remoteMediaSsrcChanged",null);let SL=new Float32Array(1);new Uint8Array(SL.buffer);let TL=new Float64Array(1),wL=new Uint8Array(TL.buffer);function CL(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let RL=[];function IL(){const e=RL.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function OL(e){RL.push(e)}function AL(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function NL(e){return e.offset>=e.limit}function kL(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function PL(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function DL(e,t){let n=PL(e,t),r=String.fromCharCode,i=e.bytes,o="\ufffd",s="";for(let a=0;a<t;a++){let e,c,l,u,d=i[a+n];0==(128&d)?s+=r(d):192==(224&d)?a+1>=t?s+=o:(e=i[a+n+1],128!=(192&e)?s+=o:(u=(31&d)<<6|63&e,u<128?s+=o:(s+=r(u),a++))):224==(240&d)?a+2>=t?s+=o:(e=i[a+n+1],c=i[a+n+2],32896!=(49344&(e|c<<8))?s+=o:(u=(15&d)<<12|(63&e)<<6|63&c,u<2048||u>=55296&&u<=57343?s+=o:(s+=r(u),a+=2))):240==(248&d)?a+3>=t?s+=o:(e=i[a+n+1],c=i[a+n+2],l=i[a+n+3],8421504!=(12632256&(e|c<<8|l<<16))?s+=o:(u=(7&d)<<18|(63&e)<<12|(63&c)<<6|63&l,u<65536||u>1114111?s+=o:(u-=65536,s+=r(55296+(u>>10),56320+(1023&u)),a+=3))):s+=o}return s}function LL(e,t){let n=t.length,r=0;for(let s=0;s<n;s++){let e=t.charCodeAt(s);e>=55296&&e<=56319&&s+1<n&&(e=(e<<10)+t.charCodeAt(++s)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}BL(e,r);let i=kL(e,r),o=e.bytes;for(let s=0;s<n;s++){let e=t.charCodeAt(s);e>=55296&&e<=56319&&s+1<n&&(e=(e<<10)+t.charCodeAt(++s)-56613888),e<128?o[i++]=e:(e<2048?o[i++]=e>>6&31|192:(e<65536?o[i++]=e>>12&15|224:(o[i++]=e>>18&7|240,o[i++]=e>>12&63|128),o[i++]=e>>6&63|128),o[i++]=63&e|128)}}function xL(e,t){let n=kL(e,t.limit),r=e.bytes,i=t.bytes;for(let o=0,s=t.limit;o<s;o++)r[o+n]=i[o]}function ML(e){return e.bytes[PL(e,1)]}function UL(e,t){let n=kL(e,1);e.bytes[n]=t}function FL(e){let t=PL(e,8),n=e.bytes;return wL[0]=n[t++],wL[1]=n[t++],wL[2]=n[t++],wL[3]=n[t++],wL[4]=n[t++],wL[5]=n[t++],wL[6]=n[t++],wL[7]=n[t++],TL[0]}function jL(e,t){let n=kL(e,8),r=e.bytes;TL[0]=t,r[n++]=wL[0],r[n++]=wL[1],r[n++]=wL[2],r[n++]=wL[3],r[n++]=wL[4],r[n++]=wL[5],r[n++]=wL[6],r[n++]=wL[7]}function VL(e){let t,n=0,r=0;do{t=ML(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function BL(e,t){for(t>>>=0;t>=128;)UL(e,127&t|128),t>>>=7;UL(e,t)}function GL(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,s=kL(e,o),a=e.bytes;switch(o){case 10:a[s+9]=i>>>7&1;case 9:a[s+8]=9!==o?128|i:127&i;case 8:a[s+7]=8!==o?r>>>21|128:r>>>21&127;case 7:a[s+6]=7!==o?r>>>14|128:r>>>14&127;case 6:a[s+5]=6!==o?r>>>7|128:r>>>7&127;case 5:a[s+4]=5!==o?128|r:127&r;case 4:a[s+3]=4!==o?n>>>21|128:n>>>21&127;case 3:a[s+2]=3!==o?n>>>14|128:n>>>14&127;case 2:a[s+1]=2!==o?n>>>7|128:n>>>7&127;case 1:a[s]=1!==o?128|n:127&n}}function qL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const WL=new Map([["moderation",1],["supervise",2]]);class zL extends nv{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(yw.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=cy(t=e.map((e=>WL.get(e)||0))).call(t,((e,t)=>e+t)),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(e){super(),rh(this,"name","AgoraRTCVideoContentInspect"),rh(this,"_connectionState",Ew.CONNECTING),rh(this,"_innerConnectionState",void 0),rh(this,"sequence",0),rh(this,"inspectStartTime",void 0),rh(this,"workerManagerConnection",void 0),rh(this,"workerConnection",void 0),rh(this,"workerMessageLengthLimit",void 0),rh(this,"inspectIntervalMinimum",void 0),rh(this,"qualityRatio",void 0),rh(this,"_connectInfo",void 0),rh(this,"_cancelTokenSource",mS.CancelToken.source()),rh(this,"_retryConfig",void 0),rh(this,"wmSequence",0),rh(this,"inspectInterval",void 0),rh(this,"inspectTimer",null),rh(this,"ossFilePrefix",void 0),rh(this,"extraInfo",void 0),rh(this,"_inspectType",void 0),rh(this,"_inspectMode",void 0),rh(this,"_quality",1),rh(this,"qualityTimer",null),rh(this,"_inspectId",void 0),rh(this,"_needWorkUrlOnly",!1),rh(this,"inspectImage",(()=>{if(this.connectionState!==Ew.CONNECTED)throw new UT(UE.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===Ew.CONNECTED?this.requestToInspectImage():zS.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=Uv(5,"inspect-"),this.workerMessageLengthLimit=LS("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=LS("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=LS("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Jw("worker-manager-"+this._inspectId,Yv),this.on(yw.STATE_CHANGE,((e,t)=>{this._innerConnectionState=e,zS.debug("[".concat(this._inspectId,"] Inspect operation :").concat(vw[e]," ").concat(t||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new Jw("worker-"+this._inspectId,Yv),this.handleWorkerEvents()}async init(e,t){this.emit(yw.STATE_CHANGE,vw.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new tE(((r,i)=>{this.on(yw.CONNECTION_STATE_CHANGE,((e,t)=>{t===Ew.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorkerManager(e)})).catch((e=>{i(e)}))}))}async requestAP(e,t,n){const r=LS("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:s,sid:a,token:c,uid:l}=t;sP++;const u="image_moderation_api",d={service_name:u,json_body:JSON.stringify({appId:i,areaCode:o,cname:s,command:"allocateEdge",requestId:sP,seq:sP,sid:a,token:c,ts:Date.now(),uid:l+""})};let h,p,f=e[0];return Jv((async()=>{h=Date.now();const e=await Fk(f,{data:d,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new UT(UE.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:p});throw zS.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new UT(UE.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw zS.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new UT(UE.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:p});throw zS.error(e.toString()),e}const r=LS("VIDEO_INSPECT_WORKER_MANAGER_HOST"),i=LS("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(i||n)})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,responseTime:p}}),((t,n)=>(iT.apworkerEvent(a,{success:!0,sc:200,serviceName:u,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1)),((t,n)=>(iT.apworkerEvent(a,{success:!1,sc:t.data&&t.data.code||200,serviceName:u,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==UE.OPERATION_ABORTED&&t.code!==UE.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(yw.STATE_CHANGE,vw.AP_CONNECTED);const{addressList:o}=i;return this.wmSequence++,o}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(yw.STATE_CHANGE,vw.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(wT.CONNECTED,(async()=>{this.emit(yw.STATE_CHANGE,vw.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.19.3",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(wT.CLOSED,(()=>{this._innerConnectionState<vw.GET_WORKER_MANAGER_RESPONSE&&zS.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(wT.FAILED,(()=>{this._innerConnectionState<vw.GET_WORKER_MANAGER_RESPONSE&&zS.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(wT.RECONNECTING,(()=>{this._innerConnectionState<vw.GET_WORKER_MANAGER_RESPONSE&&zS.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(wT.ON_MESSAGE,(async e=>{this.emit(yw.STATE_CHANGE,vw.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(e.data);if(200!==n.code)throw zS.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new UT(UE.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw zS.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new UT(UE.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const e=LS("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,r=t.replace(/:\d+\/?$/,":".concat(e));this.emit(yw.STATE_CHANGE,vw.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(yw.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}})),this.workerManagerConnection.on(wT.WILL_RECONNECT,((e,t,n)=>{n(e)})),this.workerManagerConnection.on(wT.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}handleWorkerEvents(){this.workerConnection.on(wT.CONNECTED,(async()=>{this.emit(yw.STATE_CHANGE,vw.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ew.CONNECTED})),this.workerConnection.on(wT.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const n=_L(new Uint8Array(e.data));if(LS("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&zS.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(yw.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;const e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},r=cy(t=Object.keys(e)).call(t,((t,n)=>e[t]>e[n]?t:n),"porn"),i=Object.keys(e).find((e=>e===r));this.emit(yw.INSPECT_RESULT,i)}else this.emit(yw.INSPECT_RESULT,void 0,new UT(UE.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(yw.INSPECT_RESULT,void 0,new UT(UE.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else zS.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(yw.INSPECT_RESULT,void 0,new UT(UE.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(wT.CLOSED,(()=>{this.connectionState=Ew.CLOSED})),this.workerConnection.on(wT.FAILED,(()=>{this.connectionState=Ew.CLOSED})),this.workerConnection.on(wT.RECONNECTING,(()=>{this.connectionState=this.connectionState===Ew.CONNECTED?Ew.RECONNECTING:Ew.CONNECTING})),this.workerConnection.on(wT.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this.workerConnection.on(wT.REQUEST_NEW_URLS,((e,t)=>{this.workerManagerConnection.close(),this.once(yw.REQUEST_NEW_WORKER_URL,(t=>{e([t])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((e=>{this.connectWorkerManager(e,!0)})).catch((e=>{t(e)}))}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){this.sequence++;const e=vv(this,yw.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(yw.INSPECT_RESULT,void 0,new UT(UE.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(yw.INSPECT_RESULT,void 0,new UT(UE.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),u=await _I(l,n,r),d=this.sequence+"-"+i+"-"+a+"-"+c+"-"+Uv(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:zL.intToLong(Number(c-this.inspectStartTime)),fileSize:u.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:u,networkType:6,osType:7,requestId:d,sdkVersion:"4.19.3",sequence:this.sequence,sid:s,timestamp:zL.intToLong(c),uid:a,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};void 0===this.extraInfo&&delete h.callbackData,void 0===this.ossFilePrefix&&delete h.ossFilePrefix;const p=gL(h);if(p.byteLength<this.workerMessageLengthLimit){if(LS("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qL(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},h);delete e.jpg,zS.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return p}{const t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mS.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ew.CLOSED,this.emit(yw.STATE_CHANGE,vw.CLOSED)}}function HL(e){let t=function(){const e=JL.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(ax(t,10),rx(t,n));let r=e.cid;void 0!==r&&(ax(t,16),ax(t,r));let i=e.cname;void 0!==i&&(ax(t,26),rx(t,i));let o=e.deviceId;void 0!==o&&(ax(t,34),rx(t,o));let s=e.elapse;void 0!==s&&(ax(t,40),lx(t,s));let a=e.fileSize;void 0!==a&&(ax(t,48),lx(t,ZL(a)));let c=e.height;void 0!==c&&(ax(t,56),lx(t,ZL(c)));let l=e.jpg;void 0!==l&&(ax(t,66),ax(t,l.length),tx(t,l));let u=e.networkType;void 0!==u&&(ax(t,72),lx(t,ZL(u)));let d=e.osType;void 0!==d&&(ax(t,80),lx(t,ZL(d)));let h=e.requestId;void 0!==h&&(ax(t,90),rx(t,h));let p=e.sdkVersion;void 0!==p&&(ax(t,98),rx(t,p));let f=e.sequence;void 0!==f&&(ax(t,104),lx(t,ZL(f)));let m=e.sid;void 0!==m&&(ax(t,114),rx(t,m));let g=e.timestamp;void 0!==g&&(ax(t,120),lx(t,g));let _=e.uid;void 0!==_&&(ax(t,128),ax(t,_));let E=e.vid;void 0!==E&&(ax(t,136),ax(t,E));let v=e.width;void 0!==v&&(ax(t,144),lx(t,ZL(v)));let y=e.service;void 0!==y&&(ax(t,152),ax(t,y));let b=e.callbackData;void 0!==b&&(ax(t,162),ax(t,b.length),tx(t,b));let S=e.ticket;void 0!==S&&(ax(t,170),rx(t,S))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function KL(e){return function(e){let t={};e:for(;!QL(e);){let n=sx(e);switch(n>>>3){case 0:break e;case 1:t.code=sx(e);break;case 2:t.msg=nx(e,sx(e));break;case 3:t.requestId=nx(e,sx(e));break;case 4:t.timestamp=cx(e,!1);break;default:YL(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function YL(e,t){switch(t){case 0:for(;128&ix(e););break;case 2:XL(e,sx(e));break;case 5:XL(e,4);break;case 1:XL(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function ZL(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let JL=[];function XL(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function QL(e){return e.offset>=e.limit}function $L(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function ex(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function tx(e,t){let n=$L(e,t.length);e.bytes.set(t,n)}function nx(e,t){let n=ex(e,t),r=String.fromCharCode,i=e.bytes,o="\ufffd",s="";for(let a=0;a<t;a++){let e,c,l,u,d=i[a+n];0==(128&d)?s+=r(d):192==(224&d)?a+1>=t?s+=o:(e=i[a+n+1],128!=(192&e)?s+=o:(u=(31&d)<<6|63&e,u<128?s+=o:(s+=r(u),a++))):224==(240&d)?a+2>=t?s+=o:(e=i[a+n+1],c=i[a+n+2],32896!=(49344&(e|c<<8))?s+=o:(u=(15&d)<<12|(63&e)<<6|63&c,u<2048||u>=55296&&u<=57343?s+=o:(s+=r(u),a+=2))):240==(248&d)?a+3>=t?s+=o:(e=i[a+n+1],c=i[a+n+2],l=i[a+n+3],8421504!=(12632256&(e|c<<8|l<<16))?s+=o:(u=(7&d)<<18|(63&e)<<12|(63&c)<<6|63&l,u<65536||u>1114111?s+=o:(u-=65536,s+=r(55296+(u>>10),56320+(1023&u)),a+=3))):s+=o}return s}function rx(e,t){let n=t.length,r=0;for(let s=0;s<n;s++){let e=t.charCodeAt(s);e>=55296&&e<=56319&&s+1<n&&(e=(e<<10)+t.charCodeAt(++s)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}ax(e,r);let i=$L(e,r),o=e.bytes;for(let s=0;s<n;s++){let e=t.charCodeAt(s);e>=55296&&e<=56319&&s+1<n&&(e=(e<<10)+t.charCodeAt(++s)-56613888),e<128?o[i++]=e:(e<2048?o[i++]=e>>6&31|192:(e<65536?o[i++]=e>>12&15|224:(o[i++]=e>>18&7|240,o[i++]=e>>12&63|128),o[i++]=e>>6&63|128),o[i++]=63&e|128)}}function ix(e){return e.bytes[ex(e,1)]}function ox(e,t){let n=$L(e,1);e.bytes[n]=t}function sx(e){let t,n=0,r=0;do{t=ix(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function ax(e,t){for(t>>>=0;t>=128;)ox(e,127&t|128),t>>>=7;ox(e,t)}function cx(e,t){let n,r=0,i=0,o=0;return n=ix(e),r=127&n,128&n&&(n=ix(e),r|=(127&n)<<7,128&n&&(n=ix(e),r|=(127&n)<<14,128&n&&(n=ix(e),r|=(127&n)<<21,128&n&&(n=ix(e),i=127&n,128&n&&(n=ix(e),i|=(127&n)<<7,128&n&&(n=ix(e),i|=(127&n)<<14,128&n&&(n=ix(e),i|=(127&n)<<21,128&n&&(n=ix(e),o=127&n,128&n&&(n=ix(e),o|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|o<<24,unsigned:t}}function lx(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,s=$L(e,o),a=e.bytes;switch(o){case 10:a[s+9]=i>>>7&1;case 9:a[s+8]=9!==o?128|i:127&i;case 8:a[s+7]=8!==o?r>>>21|128:r>>>21&127;case 7:a[s+6]=7!==o?r>>>14|128:r>>>14&127;case 6:a[s+5]=6!==o?r>>>7|128:r>>>7&127;case 5:a[s+4]=5!==o?128|r:127&r;case 4:a[s+3]=4!==o?n>>>21|128:n>>>21&127;case 3:a[s+2]=3!==o?n>>>14|128:n>>>14&127;case 2:a[s+1]=2!==o?n>>>7|128:n>>>7&127;case 1:a[s]=1!==o?128|n:127&n}}const ux={},dx={},hx=4294967296,px=hx*hx,fx=px/2,mx=yx(0,!0),gx=yx(0),_x=bx(0,-2147483648,!1),Ex=bx(-1,2147483647,!1),vx=bx(-1,-1,!0);function yx(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=dx[e],r)?r:(n=bx(e,0,!0),i&&(dx[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=ux[e],r)?r:(n=bx(e,e<0?-1:0,!1),i&&(ux[e]=n),n)}function bx(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function Sx(e,t){if(isNaN(e))return t?mx:gx;if(t){if(e<0)return mx;if(e>=px)return vx}else{if(e<=-fx)return _x;if(e+1>=fx)return Ex}return e<0?t?mx:gx:bx(e%hx|0,e/hx|0,t)}function Tx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class wx extends nv{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(Rw.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(e){var t;super(),rh(this,"name","AgoraRTCImageModeration"),rh(this,"_connectionState",Cw.CONNECTING),rh(this,"_sequence",0),rh(this,"_moderationStartTime",void 0),rh(this,"_workerConnection",void 0),rh(this,"_workerMessageLengthLimit",void 0),rh(this,"_qualityRatio",void 0),rh(this,"_connectInfo",void 0),rh(this,"_cancelTokenSource",mS.CancelToken.source()),rh(this,"_retryConfig",void 0),rh(this,"_moderationInterval",void 0),rh(this,"_moderationTimer",null),rh(this,"_moderationMode",1),rh(this,"_quality",1),rh(this,"_qualityTimer",null),rh(this,"_ticket",void 0),rh(this,"_moderationIntervalMinimum",void 0),rh(this,"_uploadFailedNum",0),rh(this,"_uploadNum",0),rh(this,"_uploadTimer",null),rh(this,"_moderationId",void 0),rh(this,"inspectImage",(()=>{if(this.connectionState!==Cw.CONNECTED)throw new UT(UE.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===Cw.CONNECTED?this.requestToInspectImage():zS.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=Uv(5,"image-moderation-"),this._workerMessageLengthLimit=LS("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=LS("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,this._qualityRatio=LS("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Jw("worker-"+this._moderationId,Yv),this.on(Rw.STATE_CHANGE,((e,t)=>{zS.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Iw[e]," ").concat(t||""))})),this.handleWorkerEvents()}async init(e,t){this.emit(Rw.STATE_CHANGE,Iw.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new tE(((r,i)=>{this.on(Rw.CONNECTION_STATE_CHANGE,((e,t)=>{e===Cw.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorker(e)})).catch((e=>{i(e)}))}))}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,zS.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===Cw.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){const r=LS("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:s,sid:a,token:c,uid:l}=t;sP++;const u="moderation_plugin",d={service_name:u,json_body:JSON.stringify({appId:i,areaCode:o,cname:s,command:"allocateEdge",requestId:sP,seq:sP,sid:a,appToken:c,ts:Date.now(),uid:l+""})};let h,p,f=e[0];return Jv((async()=>{h=Date.now();const e=await Fk(f,{data:d,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new UT(UE.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:p});throw zS.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new UT(UE.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw zS.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new UT(UE.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:p});throw zS.error(e.toString()),e}if(!t.servers.some((e=>!!e.wss))){const e=new UT(UE.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:p});throw zS.error(e.toString()),e}const r=LS("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(n,"/moderation")})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:p}}),((t,n)=>(iT.apworkerEvent(a,{success:!0,sc:200,serviceName:u,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1)),((t,n)=>(iT.apworkerEvent(a,{success:!1,sc:t.data&&t.data.code||200,serviceName:u,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==UE.OPERATION_ABORTED&&t.code!==UE.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(Rw.STATE_CHANGE,Iw.AP_CONNECTED);const{addressList:o,ticket:s}=i;return this._ticket=s,o}async connectWorker(e){this.emit(Rw.STATE_CHANGE,Iw.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(wT.CONNECTED,(async()=>{this.emit(Rw.STATE_CHANGE,Iw.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Cw.CONNECTED})),this._workerConnection.on(wT.CLOSED,(()=>{this.connectionState=Cw.CLOSED})),this._workerConnection.on(wT.FAILED,(()=>{this.connectionState=Cw.CLOSED})),this._workerConnection.on(wT.RECONNECTING,(()=>{this.connectionState=this.connectionState===Cw.CONNECTED?Cw.RECONNECTING:Cw.CONNECTING})),this._workerConnection.on(wT.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const t=KL(new Uint8Array(e.data));LS("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&zS.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,zS.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{iT.reportApiInvoke(this._connectInfo.sid||null,{name:ov.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:sv.TRACER}).onError(new UT(UE.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null}),LS("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else zS.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(wT.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this._workerConnection.on(wT.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=vv(this,Rw.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(LS("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&zS.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else LS("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&zS.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),u=await _I(l,n,r),d=this._sequence+"-"+i+"-"+a+"-"+c+"-"+Uv(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:wx.intToLong(Number(c-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:u,networkType:6,osType:7,requestId:d,sdkVersion:"4.19.3",sequence:this._sequence,sid:s,timestamp:Sx(c),uid:a,vid:o,service:this._moderationMode,ticket:this._ticket},p=HL(h);if(p.byteLength<this._workerMessageLengthLimit){if(LS("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tx(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},h);delete e.jpg,zS.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return p}{const t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mS.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Cw.CLOSED,this.emit(Rw.STATE_CHANGE,Iw.CLOSED)}}function Cx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cx(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Ix extends kw{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}constructor(e,t,n){super(e,t),rh(this,"direction",void 0),rh(this,"store",void 0),rh(this,"peerConnection",void 0),rh(this,"transportEventReceiver",void 0),rh(this,"statsFilter",void 0),rh(this,"localCandidateCount",0),rh(this,"allCandidatesReceived",!1),rh(this,"mutex",new Hv("P2PConnection-mutex")),rh(this,"dataChannel",void 0),rh(this,"onLocalCandidate",void 0),this.store=t,this.peerConnection=new RTCPeerConnection(Ix.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.direction=null!=n?n:TT.SEND_ONLY,this.dataChannel=this.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),this.statsFilter=PD(this.peerConnection,LS("STATS_UPDATE_INTERVAL"),void 0,bE()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{if(e){await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();if(await this.peerConnection.setLocalDescription(t),!t.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");return t.sdp}{const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");return await this.peerConnection.setLocalDescription(e),e.sdp}}catch(e){throw new FE(UE.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{await this.peerConnection.setRemoteDescription({type:"answer",sdp:e})}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(e){try{await this.peerConnection.addIceCandidate(e)}catch(e){throw new FE(UE.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}async send(e){try{const t=[];e.forEach((e=>{const n=this.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});t.push(n)})),bE()&&!0===LS("SIMULCAST")&&await this.applySimulcastForFirefox(t,e),await this.applySimulcastEncodings(t,e),await this.applySendEncodings(t,e);const n=await this.peerConnection.createOffer();if(await this.peerConnection.setLocalDescription(n),!n.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");const r=t.map((e=>{const t=this.getLocalSSRC(e.mid,n.sdp);if(!t)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:e.mid,localSSRC:[{ssrcId:t}]}}));return{sdp:n.sdp,trackMessage:r}}catch(e){throw e instanceof FE?e:new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e),this.peerConnection.removeTrack(e.sender)}));const n=await this.peerConnection.createOffer();if(await this.peerConnection.setLocalDescription(n),!n.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");return n.sdp}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n){try{await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");await this.peerConnection.setLocalDescription(r),zS.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."));const i=this.getRemoteMid(n,t);if(void 0===i)throw new Error("Cannot get transceiver mid when trying to receive track.");const o=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!o||null===o.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,mid:o.mid,sdp:r.sdp}}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async setDescription(e,t){try{if("remote"===e){await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return await this.peerConnection.setLocalDescription(n),zS.debug("[".concat(this.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(e)),n.sdp}await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(e.toString()))}}async stopReceiving(e,t){try{const n=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)})),await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();if(await this.peerConnection.setLocalDescription(r),!r.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return r.sdp}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async restartICE(){try{const e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");return this.store.descriptionStart(),await this.peerConnection.setLocalDescription(e),e.sdp}catch(e){throw new FE(UE.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?bE()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:Rx(Rx({},gD),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:Rx(Rx({},gD),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate)),e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,zS.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,zS.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),LS("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const t={iceServers:[]};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(fv(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...Ix.turnServerConfigToIceServers(e.turnServer.servers)),LS("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...Ix.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),LS("FORCE_TURN_TCP")?t.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(t.iceTransportPolicy="relay")})))),LS("ENABLE_ENCODED_TRANSFORM")&&fR().supportWebRTCEncodedTransform&&(t.encodedInsertableStreams=!0),t}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.tcpport&&(t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(fk(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=udp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"stun:".concat(e.turnServerURL,":").concat(e.tcpport)}))})),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:e,remote:t}=n.getSelectedCandidatePair();zS.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>t.track===e._mediaStreamTrack))),!t)return zS.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return zS.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!fR().supportSetRtpSenderParameters)return zS.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},i={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var o;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(i.maxBitrate=1e3*t),Di(o=e._hints).call(o,LC.LOW_STREAM)&&(n&&(i.maxFramerate=gk(n)),r&&r>=1&&(i.scaleResolutionDownBy=r))}if(LS("DSCP_TYPE")&&LE()){var s;const e=LS("DSCP_TYPE");Di(s=["very-low","low","medium","high"]).call(s,e)&&(i.networkPriority=e)}const a=t.getParameters(),c=null===(n=a.encodings)||void 0===n?void 0:n[0];bE()&&!c&&(r.encodings=[i]),c&&Object.assign(c,i),Object.assign(a,r),zS.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await t.setParameters(a)}async applySendEncodings(e,t){try{if(!fR().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof yI&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){zS.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=zP.parse(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&($P(o,e),iD(o,e,this.store.codec))})),zP.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let a=0;a<e.length;a++){var n,r,i,o,s;const c=e[a],l=t[a];if(l instanceof yI&&!Di(n=l._hints).call(n,LC.LOW_STREAM)&&null!==(r=l._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=l._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(s=l._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!bE()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof yI&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const s=t.sender.getParameters();await t.sender.setParameters(Object.assign(s,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof yI&&LS("SIMULCAST")&&"vp8"===this.store.codec&&!Di(t=e._hints).call(t,LC.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(LS("SDP_LOGGING"))return zS.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}getLocalSSRC(e,t){var n,r;if(t=null!==(n=t)&&void 0!==n?n:null===(r=this.currentLocalDescription)||void 0===r?void 0:r.sdp){var i;const n=null===(i=zP.parse(t).mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===i?void 0:i.attributes.ssrcs;return null==n?void 0:n[0].ssrcId}}getRemoteMid(e,t){var n,r,i;if(t=null!==(n=t)&&void 0!==n?n:null===(r=this.currentRemoteDescription)||void 0===r?void 0:r.sdp)return null===(i=zP.parse(t).mediaDescriptions.find((t=>t.attributes.ssrcs.some((t=>t.ssrcId===e)))))||void 0===i?void 0:i.attributes.mid}async getRemoteSSRC(e,t){var n,r;if(t=null!==(n=t)&&void 0!==n?n:null===(r=this.currentRemoteDescription)||void 0===r?void 0:r.sdp){var i;const n=null===(i=zP.parse(t).mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===i?void 0:i.attributes.ssrcs;return null==n?void 0:n[0].ssrcId}}}function Ox(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}var Ax;function Nx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nx(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}xT([Ox,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],Ix.prototype,"establish",null),xT([Ox,MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],Ix.prototype,"connect",null),xT([Ox,MT("design:type",Function),MT("design:paramtypes",[RTCIceCandidate]),MT("design:returntype",tE)],Ix.prototype,"addRemoteCandidate",null),xT([Ox,MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],Ix.prototype,"send",null),xT([Ox,MT("design:type",Function),MT("design:paramtypes",[String,String,Number]),MT("design:returntype",tE)],Ix.prototype,"receive",null),xT([Ox,MT("design:type",Function),MT("design:paramtypes",[String,String]),MT("design:returntype",tE)],Ix.prototype,"setDescription",null),xT([Ox,MT("design:type",Function),MT("design:paramtypes",[Array,String]),MT("design:returntype",tE)],Ix.prototype,"stopReceiving",null),xT([Ox,MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",tE)],Ix.prototype,"restartICE",null),xT([Ox,MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],Ix.prototype,"close",null),xT([Ox,MT("design:type",Function),MT("design:paramtypes",[String,nR]),MT("design:returntype",tE)],Ix.prototype,"updateEncoderConfig",null),xT([Ox,MT("design:type",Function),MT("design:paramtypes",[String,nR]),MT("design:returntype",tE)],Ix.prototype,"updateSendParameters",null),xT([Ox,MT("design:type",Function),MT("design:paramtypes",[nR,String]),MT("design:returntype",tE)],Ix.prototype,"replaceTrack",null),function(e){e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY"}(Ax||(Ax={}));class Px extends nv{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(gw.StateChange,t,this._state)}constructor(e,t){super(),rh(this,"store",void 0),rh(this,"statsUploader",void 0),rh(this,"sendConnection",void 0),rh(this,"recvConnection",void 0),rh(this,"localTrackMap",new Map),rh(this,"remoteUserMap",new Map),rh(this,"localDataChannels",[]),rh(this,"pendingLocalTracks",[]),rh(this,"pendingRemoteTracks",[]),rh(this,"statsCollector",void 0),rh(this,"dtlsFailedCount",0),rh(this,"sendMutex",new Hv("P2PChannel2-send-mutex")),rh(this,"recvMutex",new Hv("P2PChannel2-recv-mutex")),rh(this,"_state",mw.Disconnected),rh(this,"_restartStates",["disconnected","failed"]),rh(this,"_restartTimer",void 0),rh(this,"handleMuteLocalTrack",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==mw.Connected)return void n(new FE(UE.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const s=r.find((e=>"videoLowTrack"===e[0]));s&&s[1].track._originMediaStreamTrack.stop();let a=!1;var i,o;a="video"===e.trackMediaType?!(null===(i=this.localTrackMap.get(fw.LocalAudioTrack))||void 0===i||!i.track._muted):void 0===(null===(o=this.localTrackMap.get(fw.LocalVideoTrack))||void 0===o?void 0:o.id);const c=r.filter((e=>{let[t,n]=e;return(t!==fw.LocalAudioTrack||a)&&void 0!==n.id})).map((e=>{let[,t]=e;return t}));let l;c.length>0&&(l=await this.sendConnection.stopSending(c.map((e=>e.id))),c.forEach((e=>{e.id=void 0,e.ssrcs=void 0})));const u=this.createMuteMessage(r),d="video"===e.trackMediaType?Aw.MUTE_LOCAL_VIDEO:Aw.MUTE_LOCAL_AUDIO,h=await _v(this,gw.RequestP2PMuteLocal,{action:d,sdp:l,message:u,isMuteAll:a});h&&await this.sendConnection.setDescription("local",h),(l||"audio"===e.trackMediaType)&&await Ev(this,gw.RequestMuteLocal,u),t()}catch(e){n(e)}finally{r()}})),rh(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==mw.Connected)return void n(new FE(UE.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();const i=this.createUnmuteMessage(r),o="video"===e.trackMediaType?Aw.UNMUTE_LOCAL_VIDEO:Aw.UNMUTE_LOCAL_AUDIO;await Ev(this,gw.RequestP2PMuteLocal,{action:o,message:i}),t()}catch(e){n(e)}finally{r()}})),rh(this,"handleUpdateVideoEncoder",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const n=this.localTrackMap.get(fw.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==mw.Connected)return void t();const{id:r,track:i}=n;r&&(await this.sendConnection.updateSendParameters(r,i),await this.sendConnection.updateEncoderConfig(r,i),this.emit(gw.UpdateVideoEncoder,i)),t()}catch(e){n(e)}finally{r()}})),rh(this,"handleSetOptimizationMode",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const n=this.localTrackMap.get(fw.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==mw.Connected)return;const{id:r,track:i}=n;r&&await this.sendConnection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}})),rh(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;zS.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var o;const n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.sendConnection||!n||void 0===n[1].id||this.state!==mw.Connected)return void t();if(await(null===(o=this.sendConnection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),n[0]===fw.LocalVideoTrack&&fR().supportDualStreamEncoding){const t=this.localTrackMap.get(fw.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new tE(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(e){n(e)}finally{var s;null===(s=i)||void 0===s||s()}})),rh(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),rh(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),rh(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),rh(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new lL,this.bindStatsUploaderEvents()}async startP2PConnection(e,t){throw new FE(UE.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e,t,n,r,i,o){throw new FE(UE.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){if(this.state=mw.New,this.sendConnection&&(zS.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),this.recvConnection&&(zS.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),this.sendConnection=new Ix(e,this.store),this.bindConnectionEvents(this.sendConnection),this.recvConnection=new Ix(e,this.store,TT.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection),t){this.store.peerConnectionStart(),await this.recvConnection.establish(t);const e=await this.sendConnection.establish(t);return this.statsUploader.startUploadTransportStats(!0),this.statsUploader.startUploadExtensionUsageStats(),this.state=mw.Connected,e}return await this.recvConnection.establish(t),this.sendConnection.establish(t)}async p2pConnect(e){if(!this.sendConnection||!this.recvConnection)throw new FE(UE.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.recvConnection.connect(e),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=mw.Connected}async addRemoteCandidate(e){if(!this.sendConnection||!this.recvConnection)throw new FE(UE.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e),await this.sendConnection.addRemoteCandidate(e)}async publish(e,t,n){if(!this.sendConnection||this.state!==mw.Connected){this.throwIfTrackTypeNotMatch(e);const t=e.filter((e=>-1===this.pendingLocalTracks.indexOf(e)));return void(this.pendingLocalTracks=this.pendingLocalTracks.concat(t))}this.store.pubId=this.store.pubId+1,ck.markPublishStart(this.store.clientId,this.store.pubId);const r=this.filterTobePublishedTracks(e,t,n);if(0===r.length)return void await this.tryToUnmuteAudio(e);r.forEach((e=>{let{track:t,type:n}=e;const r=Date.now();this.store.publish(t.getTrackId(),n===fw.LocalAudioTrack?"audio":"video",r)})),this.bindLocalTrackEvents(r);const i=this.createGatewayPublishMessage(r);return this.assignLocalTracks(r),r.forEach((e=>{let{track:t,type:n}=e;const r=Date.now();this.store.publish(t.getTrackId(),n===fw.LocalAudioTrack?"audio":"video",void 0,r)})),i}async dopublish(e){if(!this.sendConnection||this.state!==mw.Connected)return;const t=this.localTrackMap.get(e);if(t){const{sdp:n,trackMessage:r}=await this.sendConnection.send([t.track]),{mid:i,localSSRC:o}=r[0];t.id=i,t.ssrcs=o,this.statsCollector.addLocalStats(e),this.statsUploader.startUploadUplinkStats();const s=await _v(this,gw.RequestP2PPublish,{kind:e===fw.LocalAudioTrack?dw.AUDIO:dw.VIDEO,sdp:n,ssrcId:o[0].ssrcId});await this.sendConnection.setDescription("local",s);const a=this.createUnmuteMessage([[e,t]]);await Ev(this,gw.RequestUnmuteLocal,a)}}async setDescription(e,t){let n,r;"local"===e?(n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection):(n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection);try{if(!r||this.state!==mw.Connected)return;return await r.setDescription(e,t)}finally{n()}}publishLowStream(e){return VP((function*(){throw new FE(UE.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(zS.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await _v(this,gw.RequestRePublish,this.pendingLocalTracks),this.emit(gw.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublish(e){if(!this.sendConnection||this.state!==mw.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((t=>!Di(e).call(e,t))));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}})));const n=t.filter((e=>{let[,{id:t}]=e;return void 0!==t}));if(!this.sendConnection||this.state!==mw.Connected)return void e.forEach((e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}));const r=t.find((e=>"videoLowTrack"===e[0]));let i;r&&r[1].track.close();const o=this.createGatewayUnpublishMessage(t);n.length>0&&(i=await this.sendConnection.stopSending(n.map((e=>{let[,{id:t}]=e;return t})))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadUplinkStats();const s=this.createMuteMessage(t);return await tE.all(s.map((async e=>{await Ev(this,gw.RequestMuteLocal,[e])}))),{sdp:i,unpubMsg:o}}async unpublishLowStream(){throw new FE(UE.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async doUnpublish(e){if(!this.sendConnection||this.state!==mw.Connected)return;const t=[];if(e!==dw.AUDIO){const e=this.localTrackMap.get(fw.LocalVideoTrack);void 0!==(null==e?void 0:e.id)&&t.push([fw.LocalVideoTrack,e]);const n=this.localTrackMap.get(fw.LocalVideoLowTrack);void 0!==(null==n?void 0:n.id)&&t.push([fw.LocalVideoLowTrack,n]),this.statsCollector.removeLocalStats(fw.LocalVideoTrack),this.statsCollector.removeLocalStats(fw.LocalVideoLowTrack)}if(e!==dw.VIDEO){const e=this.localTrackMap.get(fw.LocalAudioTrack);void 0!==(null==e?void 0:e.id)&&t.push([fw.LocalAudioTrack,e]),this.statsCollector.removeLocalStats(fw.LocalAudioTrack)}if(t.length>0){const n=await this.sendConnection.stopSending(t.map((e=>{let[,t]=e;return t.id})));t.forEach((e=>{let[,t]=e;t.id=void 0,t.ssrcs=void 0}));const r=await _v(this,gw.RequestP2PUnPublish,{sdp:n,kind:e});await this.sendConnection.setDescription("local",r);const i=this.createMuteMessage(t);await tE.all(i.map((async e=>{await Ev(this,gw.RequestMuteLocal,[e])})))}}async subscribe(e,t,n,r){var i;if(!this.recvConnection||this.state!==mw.Connected)throw new FE(UE.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(i=this.remoteUserMap.get(e))&&void 0!==i&&i.has(t))return;const{track:o,mid:s,sdp:a}=await this.recvConnection.receive(t,n,r);t===dw.AUDIO?(e._audioSSRC=r,e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new AI(o,e.uid,e._uintid,this.store),zS.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new OI(o,e.uid,e._uintid,this.store),zS.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(e,e._videoTrack));const c=this.remoteUserMap.get(e);c?c.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadDownlinkStats(),await Ev(this,gw.RequestP2PUnmuteRemote,t);const l=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));return-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(gw.MediaReconnectEnd,e.uid)),a}async unsubscribe(e,t,n,r){const i=this.pendingRemoteTracks.filter((t=>{let{user:r,kind:i}=t;return void 0!==n?r.uid===e.uid&&n===i:r.uid===e.uid}));if(i.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.recvConnection&&this.state===mw.Connected||r||i.forEach((t=>{let{kind:n}=t;var r;if(n===dw.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===dw.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.recvConnection||this.state!==mw.Connected)return;const o=this.filterTobeUnSubscribedTracks(e,n);if(0===o.length)return void(n!==dw.VIDEO&&Ev(this,gw.RequestP2PMuteRemote,dw.AUDIO));const s=await this.recvConnection.stopReceiving(o.map((e=>{let[,{id:t}]=e;return t})),t);return this.withdrawRemoteTracks(o),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),o.forEach((e=>{let[t,{kind:n}]=e;var i,o;if(n===dw.VIDEO&&t._videoSSRC&&(null===(i=this.recvConnection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===dw.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),r||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(n===dw.AUDIO){var s;this.unbindRemoteTrackEvents(t._audioTrack),r||(null===(s=t._audioTrack)||void 0===s||s._destroy(),t._audioTrack=void 0)}})),o.filter((e=>{let[,{kind:t}]=e;return t!==dw.AUDIO})).forEach((e=>{let[,{kind:t}]=e;Ev(this,gw.RequestP2PMuteRemote,t)})),n!==dw.VIDEO&&Ev(this,gw.RequestP2PMuteRemote,dw.AUDIO),s}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new FE(UE.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new FE(UE.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new FE(UE.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new FE(UE.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void zS.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void zS.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===dw.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||zS.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):zS.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(fw.LocalAudioTrack);if((null==t?void 0:t.track)instanceof tI){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==fw.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===fw.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===fw.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(fw.LocalAudioTrack),o=r?this.localTrackMap.get(fw.LocalVideoLowTrack):this.localTrackMap.get(fw.LocalVideoTrack);iT.publish(this.store.sessionId,{eventElapse:ck.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(LC.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const s=n.find((e=>e instanceof QR)),a=r?null===(o=this.localTrackMap.get(fw.LocalVideoTrack))||void 0===o?void 0:o.track:n.find((e=>e instanceof yI));iT.publish(this.store.sessionId,{eventElapse:ck.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==s?void 0:s.getTrackLabel(),videoName:null==a?void 0:a.getTrackLabel(),screenshare:-1!==(null==a?void 0:a._hints.indexOf(LC.SCREEN_TRACK)),audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===dw.VIDEO?n._videoSSRC:n._audioSSRC;i&&iT.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===dw.VIDEO,audio:r===dw.AUDIO,peerid:n.uid,subscribeRequestid:r===dw.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:ck.measureFromSubscribeStart(this.store.clientId,i)})}reset(){zS.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Hv("P2PChannel2-send-mutex"),this.sendMutex=new Hv("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(fw.LocalAudioTrack);if((null==e?void 0:e.track)instanceof tI){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=mw.Disconnected}getStats(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(fw.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(fw.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof yI||t&&t.track instanceof QR?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(dh(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(fw.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Qh(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(zS.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=mw.Reconnecting,LS("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case fw.LocalVideoTrack:Di(t=r._hints).call(t,LC.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case fw.LocalAudioTrack:r instanceof tI?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case fw.LocalVideoLowTrack:}})),this.emit(gw.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(dh(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(gw.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),zS.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof NP?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e){let t;t=e.direction===TT.SEND_ONLY?await this.sendMutex.lock("From P2PChannel.restartICE"):await this.recvMutex.lock("From P2PChannel.restartICE");try{const t=await e.restartICE(),n=await _v(this,gw.RequestP2PRestartICE,t);e.setDescription("local",n)}finally{t()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(fw.LocalVideoTrack),n=this.localTrackMap.get(fw.LocalAudioTrack),r=e.videoSend.find((e=>{var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)})),i=e.audioSend.find((e=>{var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)}));if(!r||!i)return 1;const o=vv(this,gw.NeedSignalRTT),s=r?r.rttMs:void 0,a=i?i.rttMs:void 0,c=s&&a?(s+a)/2:s||a,l=(c&&o?(c+o)/2:c||o)||0,u=100*e.sendPacketLossRate*.7/50+.3*l/1500,d=u<.17?1:u<.36?2:u<.59?3:u<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(LC.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return aT[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,s=e.audioRecv.find((e=>e.ssrc===i)),a=e.videoRecv.find((e=>e.ssrc===o));if(!s&&!a)return void(t+=1);const c=vv(this,gw.NeedSignalRTT),l=e.rtt,u=(l&&c?(l+c)/2:l||c)||0,d=s?s.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*u/1500;d&&(p=.6*h*100/50+.2*u/1500+.2*d/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new tE(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){const r=[],i=fR(),o=this.getAllTracks();e=Cv(e=e.filter((e=>-1===o.indexOf(e))));let s=!1,a=!1;for(const c of e){if(c instanceof yI&&(this.localTrackMap.has(fw.LocalVideoTrack)||s?new FE(UE.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:fw.LocalVideoTrack}),s=!0),t)){const e=this.getLowVideoTrack(c,n);r.push({track:e,type:fw.LocalVideoLowTrack})}if(c instanceof QR){const e=this.localTrackMap.get(fw.LocalAudioTrack);if(e){if(!(e.track instanceof tI))throw new FE(UE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new FE(UE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(a){const e=r.find((e=>{let{type:t}=e;return t===fw.LocalAudioTrack}));if(!(e.track instanceof tI))throw new FE(UE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new FE(UE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c)}else{if(!i.webAudioMediaStreamDest||c instanceof tI||c._bypassWebAudio)r.push({track:c,type:fw.LocalAudioTrack});else{const e=new tI;e.addAudioTrack(c),r.push({track:e,type:fw.LocalAudioTrack})}a=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Cv(e=e.filter((e=>-1!==n.indexOf(e))));for(const r of e){if(r instanceof QR){const e=this.localTrackMap.get(fw.LocalAudioTrack);if(!e)continue;e.track instanceof tI?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([fw.LocalAudioTrack,e]),e.track.close())):t.push([fw.LocalAudioTrack,e])}if(r instanceof yI){const e=this.localTrackMap.get(fw.LocalVideoTrack);if(!e)continue;t.push([fw.LocalVideoTrack,e]);const n=this.localTrackMap.get(fw.LocalVideoLowTrack);n&&t.push([fw.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case fw.LocalVideoTrack:t.addListener(DC.GET_STATS,this.handleGetLocalVideoStats),t.addListener(DC.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(DC.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(DC.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(DC.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),t.addListener(DC.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(DC.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(DC.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case fw.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case fw.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof tI?e.trackList.forEach((e=>{e.addListener(DC.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(DC.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(DC.GET_STATS,this.handleGetLocalAudioStats),e.addListener(DC.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(DC.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(DC.GET_STATS,this.handleGetLocalAudioStats),e.addListener(DC.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(DC.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(DC.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(DC.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(DC.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case fw.LocalVideoTrack:t.off(DC.GET_STATS,this.handleGetLocalVideoStats),t.off(DC.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(DC.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(DC.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(DC.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),t.off(DC.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(DC.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(DC.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case fw.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case fw.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof tI?e.trackList.forEach((e=>{e.off(DC.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(DC.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(DC.GET_STATS,this.handleGetLocalAudioStats),e.off(DC.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(DC.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(DC.GET_STATS,this.handleGetLocalAudioStats),e.off(DC.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(DC.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(DC.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(DC.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(DC.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof OI&&t.addListener(DC.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof AI&&t.addListener(DC.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(DC.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(dw.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(dw.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e){return e.map((e=>{var t;let n,r,{track:i,type:o}=e;switch(o){case fw.LocalAudioTrack:n=$T.Audio,r={dtx:i instanceof $R&&i._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case fw.LocalVideoTrack:n=Di(t=i._hints).call(t,LC.SCREEN_TRACK)?$T.Screen:$T.High,r=kx(kx({},_k(i)),{},{codec:this.store.codec});break;case fw.LocalVideoLowTrack:n=$T.Low,r=kx(kx({},_k(i)),{},{codec:this.store.codec})}return{kind:o===fw.LocalAudioTrack?dw.AUDIO:dw.VIDEO,stream_type:n,attributes:r,isMuted:i.muted||!i.enabled}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case fw.LocalVideoTrack:n=Di(t=i._hints).call(t,LC.SCREEN_TRACK)?$T.Screen:$T.High;break;case fw.LocalAudioTrack:n=$T.Audio;break;case fw.LocalVideoLowTrack:n=$T.Low}return{stream_type:n,ssrcs:o,mid:s}}))}assignLocalTracks(e){e.forEach((e=>{let{track:t,type:n}=e;this.localTrackMap.set(n,{track:t})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;if(zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(gw.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),Di(n=this._restartStates).call(n,t)||e.direction===TT.SEND_ONLY){if(this._restartTimer)return;const t=()=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(zS.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE")),"CONNECTED"===vv(this,gw.QueryClientConnectionState)&&this.restartICE(e))};this._restartTimer=window.setTimeout((()=>{t(),this._restartTimer=void 0}),800)}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),iT.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:sv.TRACER}).onSuccess(),this.emit(gw.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(dh(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(VC.FIRST_FRAME_DECODED),iT.firstRemoteFrame(this.store.sessionId,JS.FIRST_AUDIO_DECODE,XS.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:ck.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(dh(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&iT.firstRemoteFrame(this.store.sessionId,JS.FIRST_AUDIO_RECEIVED,XS.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:ck.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(dh(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&iT.firstRemoteFrame(this.store.sessionId,JS.FIRST_VIDEO_RECEIVED,XS.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:ck.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(gw.ConnectionTypeChange,n),zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Tk(t))," -> ").concat(JSON.stringify(Tk(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{zS.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Tk(t))," -> ").concat(JSON.stringify(Tk(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=e=>{this.emit(gw.LocalCandidate,e)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(fw.LocalAudioTrack);if(e instanceof QR&&(null==n?void 0:n.track)instanceof tI)return n.track.isActive||t.push([fw.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===fw.LocalVideoTrack)){const e=this.localTrackMap.get(fw.LocalVideoLowTrack);e&&t.push([fw.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(fw.LocalAudioTrack);if(e instanceof QR&&(null==n?void 0:n.track)instanceof tI)return n.track.isActive&&t.push([fw.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===fw.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(fw.LocalVideoLowTrack);e&&t.push([fw.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case fw.LocalAudioTrack:n=$T.Audio;break;case fw.LocalVideoTrack:n=Di(t=i._hints).call(t,LC.SCREEN_TRACK)?$T.Screen:$T.High;break;case fw.LocalVideoLowTrack:n=$T.Low}return{stream_type:n,ssrcs:o,mid:s}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case fw.LocalAudioTrack:n=$T.Audio;break;case fw.LocalVideoTrack:n=Di(t=i._hints).call(t,LC.SCREEN_TRACK)?$T.Screen:$T.High;break;case fw.LocalVideoLowTrack:n=$T.Low}return{stream_type:n,ssrcs:o,mid:s}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}createUnsubscribeMessage(e){const t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case dw.VIDEO:return void(n._videoSSRC&&t.push({stream_type:dw.VIDEO,ssrcId:n._videoSSRC}));case dw.AUDIO:return void(n._audioSSRC&&t.push({stream_type:dw.AUDIO,ssrcId:n._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(fw.LocalVideoTrack),n=this.localTrackMap.get(fw.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof QR){const n=this.filterTobeUnmutedTracks(e[t]);if(0===n.length)continue;const r=this.createUnmuteMessage(n);return void await Ev(this,gw.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(gw.RequestUploadStats,e,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Mv(Zv(this.dtlsFailedCount,Yv)),this.emit(gw.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(fw.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof yI))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof yI)).length>1)throw new FE(UE.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof QR)).length>1&&(e.some((e=>e instanceof QR&&e._bypassWebAudio))||!fR().webAudioMediaStreamDest))throw new FE(UE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof yI&&this.pendingLocalTracks.some((e=>e instanceof yI)))throw new FE(UE.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof QR&&this.pendingLocalTracks.some((e=>e instanceof QR))&&(!fR().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof QR&&e._bypassWebAudio))))throw new FE(UE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!LS("DISABLE_DUAL_STREAM_USE_ENCODING")&&fR().supportDualStreamEncoding,r=kx(kx({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():zD(e,r);const o=Uv(8,"track-low-"),s=new yI(i,kx(kx({},n&&{scaleResolutionDownBy:Sk(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return s.on(FC.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,xC.LOW_STREAM)})),s._hints.push(LC.LOW_STREAM),e.addListener(DC.NEED_CLOSE,(()=>{s.close()})),s}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const o=Array.from(dh(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,s=i.subscribe.find((e=>e.userId===o.uid&&"video"===e.type));iT.firstRemoteVideoDecode(this.store.sessionId,JS.FIRST_VIDEO_DECODE,XS.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:ck.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==s?void 0:s.subscribeEnd)||0,subscriberStart:(null==s?void 0:s.subscribeStart)||0,videoAddNotify:(null==s?void 0:s.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const o=await this.recvConnection.getRemoteSSRC(i);return void 0!==o&&o!==n}resetConnection(e){zS.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(e)),this.state===mw.Connected?(zS.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(e){throw new FE(UE.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new FE(UE.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new FE(UE.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new FE(UE.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new FE(UE.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new FE(UE.NOT_SUPPORTED)}async preConnect(e,t,n,r,i,o){throw new FE(UE.NOT_SUPPORTED)}getEstablishParams(){throw new FE(UE.NOT_SUPPORTED)}async reSubscribe(e){throw new FE(UE.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new FE(UE.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===fw.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,xC.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}}function Dx(e){return function(t,n,r){const i=t[n];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];switch(e){case Ax.SEND_ONLY:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}case Ax.RECEIVE_ONLY:{const e=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}default:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n)),t=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e(),t()}}}},r}}function Lx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lx(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}xT([Dx(),MT("design:type",Function),MT("design:paramtypes",[Object,String]),MT("design:returntype",tE)],Px.prototype,"startP2P",null),xT([Dx(),MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],Px.prototype,"p2pConnect",null),xT([Dx(Ax.SEND_ONLY),MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],Px.prototype,"dopublish",null),xT([Dx(Ax.SEND_ONLY),MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],Px.prototype,"unpublish",null),xT([Dx(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",tE)],Px.prototype,"unpublishLowStream",null),xT([Dx(Ax.SEND_ONLY),MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],Px.prototype,"doUnpublish",null),xT([Dx(Ax.RECEIVE_ONLY),MT("design:type",Function),MT("design:paramtypes",[NP,String,String,Number]),MT("design:returntype",tE)],Px.prototype,"subscribe",null),xT([Dx(Ax.RECEIVE_ONLY),MT("design:type",Function),MT("design:paramtypes",[NP,String,String,Boolean]),MT("design:returntype",tE)],Px.prototype,"unsubscribe",null),xT([Dx(Ax.RECEIVE_ONLY),MT("design:type",Function),MT("design:paramtypes",[NP,String]),MT("design:returntype",tE)],Px.prototype,"muteRemote",null),xT([Dx(Ax.RECEIVE_ONLY),MT("design:type",Function),MT("design:paramtypes",[NP,String]),MT("design:returntype",tE)],Px.prototype,"unmuteRemote",null),xT([Dx(Ax.RECEIVE_ONLY),MT("design:type",Function),MT("design:paramtypes",[NP,String]),MT("design:returntype",tE)],Px.prototype,"hasRemoteMediaWithLock",null),xT([Dx(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",tE)],Px.prototype,"disconnectForReconnect",null),xT([Dx(Ax.RECEIVE_ONLY),MT("design:type",Function),MT("design:paramtypes",[NP,String,Number]),MT("design:returntype",tE)],Px.prototype,"remoteMediaSsrcChanged",null);const Mx=Date.now(),Ux=20,Fx=new Map,jx=new Map;async function Vx(e){const t=Fx.get(e),n=Array.isArray(t)&&t[t.length-1],r=jx.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:kv(n.payload)};0===r.firstRecvTs&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const o=n.sendTs-r.firstSendTs,s=o-(Date.now()-r.firstRecvTs);s>0&&(r.firstRecvTs=Date.now()-o);let a=n.mediaDelay+s;a<=0?(t.pop(),Bx(n.context,i),a=0):a=Math.min(a,Ux),setTimeout((()=>t.length&&Vx(e)),a)}function Bx(e,t){e.safeEmit(lv.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Gx(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return Bx(n,{uid:e.uid,payload:kv(e.payload)});const r="".concat(n.id,"-").concat(e.uid),i=Fx.get(r)||[],o=i.findIndex((t=>e.sendTs>=t.sendTs)),s=xx(xx({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===o?i.push(s):i.splice(o,0,s),Fx.set(r,i);let a=!1;var c;jx.has(r)?a=!(null===(c=jx.get(r))||void 0===c||!c.isSyncing):jx.set(r,{isSyncing:a,firstRecvTs:0,firstSendTs:0}),a||Vx(r)}const qx=pE().name;function Wx(){return!function(e,t,n){const r=pE();if(r.os!==aE.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}(16,0,!0)&&!function(e,t,n){const r=pE();if(r.name!==cE.SAFARI||!r.osVersion)return!1;const i=r.version.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}(16,0,!0)}function zx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zx(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Hv.setLogger(zS);class Kx extends nv{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),rh(this,"store",void 0),rh(this,"_uid",void 0),rh(this,"_channelName",void 0),rh(this,"_uintUid",void 0),rh(this,"_users",[]),rh(this,"_config",void 0),rh(this,"_clientId",void 0),rh(this,"_appId",void 0),rh(this,"_sessionId",null),rh(this,"_key",void 0),rh(this,"_joinInfo",void 0),rh(this,"_gateway",void 0),rh(this,"_statsCollector",void 0),rh(this,"_configDistribute",void 0),rh(this,"_leaveMutex",new Hv("client-leave")),rh(this,"_publishMutex",new Hv("client-publish")),rh(this,"_renewTokenMutex",new Hv("client-renewtoken")),rh(this,"_subscribeMutex",new Hv("client-subscribe")),rh(this,"_encryptionMode","none"),rh(this,"_encryptionSecret",null),rh(this,"_encryptionSalt",null),rh(this,"_proxyServer",void 0),rh(this,"_turnServer",{servers:[],mode:"auto"}),rh(this,"_cloudProxyServerMode","disabled"),rh(this,"_isDualStreamEnabled",!1),rh(this,"_defaultStreamFallbackType",void 0),rh(this,"_lowStreamParameter",void 0),rh(this,"_streamFallbackTypeCacheMap",new Map),rh(this,"_remoteStreamTypeCacheMap",new Map),rh(this,"_axiosCancelSource",mS.CancelToken.source()),rh(this,"_audioVolumeIndicationInterval",void 0),rh(this,"_networkQualityInterval",void 0),rh(this,"_userOfflineTimeout",void 0),rh(this,"_streamRemovedTimeout",void 0),rh(this,"_injectStreamingClient",void 0),rh(this,"_liveTranscodeStreamingClient",void 0),rh(this,"_liveRawStreamingClient",void 0),rh(this,"_channelMediaRelayClient",void 0),rh(this,"_networkQualitySensitivity","normal"),rh(this,"_p2pChannel",void 0),rh(this,"_useLocalAccessPoint",!1),rh(this,"_setLocalAPVersion",void 0),rh(this,"_joinAndNotLeaveYet",!1),rh(this,"_numberOfJoinCount",0),rh(this,"_remoteDefaultVideoStreamType",void 0),rh(this,"_inspect",void 0),rh(this,"_moderation",void 0),rh(this,"_license",void 0),rh(this,"_pendingPublishedUsers",[]),rh(this,"ntpAlignErrorCount",0),rh(this,"remoteInboundOffset",0),rh(this,"_handleLocalTrackEnable",((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),rh(this,"_handleLocalTrackDisable",((e,t,n)=>{this.unpublish(e).then(t).catch(n)})),rh(this,"_handleUserOnline",(e=>{if(LS("BLOCK_LOCAL_CLIENT")&&lT(e.uid,this.channelName))return void zS.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&zS.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const t=this._users.find((t=>t.uid===e.uid));if(t)t._trust_in_room_=!0;else{const t=new NP(e.uid,e.uint_id||e.uid);this._users.push(t),zS.debug("[".concat(this._clientId,"] user online"),e.uid),this.safeEmit(lv.USER_JOINED,t)}})),rh(this,"_handleUserOffline",(e=>{if(LS("BLOCK_LOCAL_CLIENT")&&lT(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),wv(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),zS.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(lv.USER_LEAVED,t,e.reason))})),rh(this,"_handleAddAudioOrVideoStream",((e,t,n,r,i,o,s)=>{if(LS("BLOCK_LOCAL_CLIENT")&&lT(t,this.channelName))return;const a=this._users.find((e=>e.uid===t));if(!a)return void zS.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));zS.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(a.uid,e,void 0,void 0,void 0,Date.now());const c="audio"===e?a.hasAudio:a.hasVideo;a._uintid||(a._uintid=i||t),"audio"===e?a._trust_audio_stream_added_state_=!0:a._trust_video_stream_added_state_=!0,"audio"===e?(a._audio_added_=!0,void 0!==n&&(a._audioSSRC=n),void 0!==r&&(a._cname=r),o&&(a._audioOrtc=o)):(a._video_added_=!0,void 0!==n&&(a._videoSSRC=n),void 0!==r&&(a._cname=r),void 0!==s&&(a._rtxSsrcId=s),o&&(a._videoOrtc=o)),("audio"===e?a.hasAudio:a.hasVideo)&&!c&&(zS.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published ").concat(e)),this.safeEmit(lv.USER_PUBLISHED,a,e)),"video"===e?iT.onGatewayStream(this._sessionId,JS.ON_ADD_VIDEO_STREAM,XS.ON_ADD_VIDEO_STREAM,{peer:i||t,ssrc:a._videoSSRC}):iT.onGatewayStream(this._sessionId,JS.ON_ADD_AUDIO_STREAM,XS.ON_ADD_AUDIO_STREAM,{peer:i||t,ssrc:a._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(a,e,n).then((t=>{if(t&&(zS.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(a.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof fL))return this._p2pChannel.unsubscribe(a,e,!0).then((()=>this._subscribe(a,e,!0).catch((e=>{zS.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(a,e)&&(zS.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(a.uid," after reconnect.")),this._subscribe(a,e,!0).catch((e=>{zS.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),rh(this,"_handleRemoveStream",((e,t,n)=>{if(LS("BLOCK_LOCAL_CLIENT")&&lT(e.uid,this.channelName))return;const r=this._users.find((t=>t.uid===e.uid));if(!r)return void zS.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));zS.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let i=()=>{};if(r.hasAudio&&r.hasVideo?i=()=>{zS.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(lv.USER_UNPUBLISHED,r,"audio"),zS.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(lv.USER_UNPUBLISHED,r,"video")}:r.hasVideo?i=()=>{zS.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(lv.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(i=()=>{zS.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(lv.USER_UNPUBLISHED,r,"audio")}),r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,this._p2pChannel instanceof fL)this._p2pChannel.unsubscribe(r).then((e=>{if(e)return this._gateway.unsubscribe(e,r.uid)}));else if(t&&n)if(e.sdp){const{sdp:i}=e;this._p2pChannel.unsubscribe(r,i).then((e=>{e&&t(e)})).catch(n)}else t&&t();r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0,iT.onGatewayStream(this._sessionId,JS.ON_REMOVE_STREAM,XS.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),i()})),rh(this,"_handleSetStreamLocalEnable",((e,t,n)=>{if(LS("BLOCK_LOCAL_CLIENT")&&lT(t,this.channelName))return;const r=this._users.find((e=>e.uid===t));if(!r)return void zS.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));zS.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));const i="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;const e=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===e)return;{const e=r._audio_enabled_?"enable-local-audio":"disable-local-audio";zS.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(lv.USER_INFO_UPDATED,t,e)}}else{r._trust_video_enabled_state_=!0;const e=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===e)return;{const e=r._video_enabled_?"enable-local-video":"disable-local-video";zS.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(lv.USER_INFO_UPDATED,t,e)}}const o="audio"===e?r.hasAudio:r.hasVideo;return i!==o?!i&&o?(zS.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(lv.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,this._p2pChannel.muteRemote(r,e),zS.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(lv.USER_UNPUBLISHED,r,e)):void 0})),rh(this,"_handleMuteStream",((e,t,n,r,i,o)=>{if(LS("BLOCK_LOCAL_CLIENT")&&lT(e,this.channelName))return;zS.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);const s=this._users.find((t=>t.uid===e));if(!s)return void zS.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));const a="audio"===t?s.hasAudio:s.hasVideo;if("audio"===t){s._trust_audio_mute_state_=!0;const t=s._audio_muted_;if(s._audio_muted_=n,s._audio_muted_===t)return;{const t=s._audio_muted_?"mute-audio":"unmute-audio";zS.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(lv.USER_INFO_UPDATED,e,t)}}else{s._trust_video_mute_state_=!0;const t=s._video_muted_;if(s._video_muted_=n,s._video_muted_===t)return;{const t=s._video_muted_?"mute-video":"unmute-video";zS.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(lv.USER_INFO_UPDATED,e,t)}}const c="audio"===t?s.hasAudio:s.hasVideo;if(a!==c){if(!a&&c)return this.store.useP2P||("audio"===t?s._audioSSRC:s._videoSSRC)?(zS.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(lv.USER_PUBLISHED,s,t)):void zS.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&s._videoTrack&&s._videoTrack._destroy(),"audio"===t&&s._audioTrack,i&&o&&this._p2pChannel instanceof Px&&(r?this._p2pChannel.unsubscribe(s,r,t).then((e=>{i(e)})).catch(o):i()),this._p2pChannel.muteRemote(s,t),zS.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(lv.USER_UNPUBLISHED,s,t)}})),rh(this,"_handleP2PLost",(async e=>{zS.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():zS.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)})),rh(this,"_handleTokenWillExpire",(()=>{zS.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(lv.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),rh(this,"_handleBeforeUnload",(e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),zS.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),rh(this,"_handleUpdateNetworkQuality",(()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(lv.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(lv.NETWORK_QUALITY,e)})),rh(this,"_handleP2PAddAudioOrVideoStream",((e,t)=>{const n=this._users.find((e=>e.uid===t));if(!n)return void zS.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));zS.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(n.uid,e,void 0,void 0,void 0,Date.now());const r="audio"===e?n.hasAudio:n.hasVideo;"audio"===e?n._trust_audio_stream_added_state_=!0:n._trust_video_stream_added_state_=!0,"audio"===e?n._audio_added_=!0:n._video_added_=!0,("audio"===e?n.hasAudio:n.hasVideo)&&!r&&(zS.info("[".concat(this._clientId,"] remote user ").concat(n.uid," published ").concat(e)),this.safeEmit(lv.USER_PUBLISHED,n,e)),this._p2pChannel.hasPendingRemoteMedia(n,e)&&(zS.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(n.uid," after reconnect.")),this._subscribe(n,e,!0).catch((e=>{zS.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),this._config=e,this._clientId=Uv(5,"client-"),this.store=new OS(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),zS.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(AS," build: ").concat(kS,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{gv(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(e){zS.warning("[".concat(this._clientId,"] ").concat(e.toString()))}this._statsCollector=new dk(this.store),this._statsCollector.onStatsException=(e,t,n)=>{zS.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),this.safeEmit(lv.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{const i=this._users.find((t=>t.uid===e));i&&iT.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:i._uintid})},this.store.useDataChannel=fR().supportDataChannel&&LS("SIGNAL_CHANNEL"),this.store.useP2P=LS("P2P"),this._gateway=new xk(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Yv,httpRetryConfig:e.httpRetryConfig||Yv,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new vP,this.store.useP2P?(this._p2pChannel=new Px(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new fL(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];DS("JOIN_GATEWAY_USE_443PORT_ONLY",o),DS("JOIN_GATEWAY_USE_DUAL_DOMAIN",s);const a=this._gateway.signal.websocket;return a instanceof Zw&&(a.use443PortOnly=o,a.tryDoubleDomain=s),async function(e,t,n){iE.get(e)||iE.set(e,[]),oE.get(e)||oE.set(e,t),sE.get(e)||sE.set(e,0);const r=iE.get(e),i=oE.get(e);if(!r||!i)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(sE.get(e)===i){const e=rE();r.push(e),await e.promise}sE.set(e,sE.get(e)+1);for(var o=arguments.length,s=new Array(o>3?o-3:0),a=3;a<o;a++)s[a-3]=arguments[a];const c=await n(...s);return sE.set(e,sE.get(e)-1),sE.get(e)===i-1&&r.length>0&&(r[0].resolve(),r.shift()),0===sE.get(e)&&(iE.set(e,[]),oE.set(e,0),sE.set(e,0)),c}("client.join",LS("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const o=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const s=TS(),a=wS()?window.isSecureContext:"Browser Not Support";if(!wS()&&!s||!window.isSecureContext){const e="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";zS.warning(e)}const c=Fv();"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),zS.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const l=iT.reportApiInvoke(c,{name:ov.JOIN,options:[e,t,n,r],states:{isHttps:s,isSecureContext:a},tag:sv.TRACER});iT.setAppId(e);try{if(!n&&null!==n)throw new UT(UE.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&qE(n,"token",1,2047),qE(e,"appid",1,2047),FT(t),r&&jT(r),i&&qE(i,"optionalInfo",1,2047)}catch(e){throw l.onError(e),e}if(zS.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._leaveMutex.isLocked&&(zS.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),zS.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const e=new UT(UE.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw l.onError(e),e}this._sessionId||(this._sessionId=c,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const u=Hx({clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof r?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(u.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof r&&(u.stringUid=r,this._uintUid?(u.uid=this._uintUid,this._uintUid=void 0):u.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(u.aesmode=this._encryptionMode,u.aespassword=await ev(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new UT(UE.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(u.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:t,appId:e});const d=this._sessionId;setTimeout((()=>{"CONNECTING"===this.connectionState&&d===this._sessionId&&iT.joinChannelTimeout(this._sessionId,5)}),5e3);try{var h;let r;const i=u.cloudProxyServer;if(Di(h=["proxy3","proxy4","proxy5"]).call(h,i)){const e=LS("PROXY_SERVER_TYPE3");Array.isArray(e)?u.proxyServer=e[0]:u.proxyServer=e}if(iT.setProxyServer(u.proxyServer),zS.setProxyServer(u.proxyServer),this.store.requestAPStart(),u.stringUid&&!u.uid){const e=await dP(u.stringUid,u,this._axiosCancelSource.token,this._config.httpRetryConfig||Yv,this.store);zS.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(u.stringUid," => ").concat(e)),u.uid=e,r=await uP(u,this._axiosCancelSource.token,this._config.httpRetryConfig||Yv,!0,this.store)}else r=await uP(u,this._axiosCancelSource.token,this._config.httpRetryConfig||Yv,!0,this.store);if(!this._joinAndNotLeaveYet)throw new UT(UE.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(u,this._axiosCancelSource.token),this._configDistribute.on(lw.UPDATE_BITRATE_LIMIT,(e=>{this._p2pChannel.updateBitrateLimit(e)}))}),0),this._key=n||e;const o=r.gatewayInfo;this._joinInfo=Hx(Hx({},u),{},{cid:o.cid,uid:u.uid?u.uid:o.uid,vid:o.vid,apResponse:o.res,uni_lbs_ip:o.uni_lbs_ip,gatewayAddrs:o.gatewayAddrs});const s=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new UT(UE.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));l.onSuccess(s),this._appId=e,this._channelName=u.cname,this._uid=s,this.store.uid=s,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(yE()?"beforeunload":"pagehide",this._handleBeforeUnload)}),0);const a=u.stringUid?"string uid: ".concat(u.stringUid,",uid: ").concat(u.uid):"uid: ".concat(this._uid);return zS.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(a)),setTimeout((()=>{zS.startUpload()}),5e3),this.store.joinEnd(),p=this,Di(cT).call(cT,p)||cT.push(p),s}catch(e){const t=Array.isArray(e)?e[0]:e;throw t&&t.code===UE.OPERATION_ABORTED?zS.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t):zS.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t),t.code!==UE.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),l.onError(t),t}var p}_joinGateway(){if(!this._joinInfo||!this._key)throw new UT(UE.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!LS("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then((e=>e)).catch((e=>{if(e.code===UE.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,cv.FALLBACK),e;if(e.code===UE.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,cv.FALLBACK),e;throw e})).then((e=>{if(e instanceof UT){if(e.code===UE.INIT_WEBSOCKET_TIMEOUT){if(zS.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new UT(UE.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const e=LS("PROXY_SERVER_TYPE3");if(Array.isArray(e))if(this._joinInfo.apUrl){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),n=t.slice(t.length-2).join(".");e.forEach((e=>{this._joinInfo&&Di(e).call(e,n)&&(this._joinInfo.proxyServer=e)})),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=e[0])}else this._joinInfo.proxyServer=e[0];else this._joinInfo.proxyServer=e;const t=LS("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return t&&t[1]&&"443"!==t[1]&&zS.setProxyServer(this._joinInfo.proxyServer),"443"!==LS("STATS_COLLECTOR_PORT").toString()&&iT.setProxyServer(this._joinInfo.proxyServer),iT.reportApiInvoke(this._sessionId,{name:ov.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:sv.TRACER}).onSuccess(),this.safeEmit(lv.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),LS("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach((e=>{"forceturn"in e&&(e.forceturn=!0)})),this._gateway.join(this._joinInfo,this._key)}if(zS.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new UT(UE.INVALID_OPERATION);return iT.reportApiInvoke(this._sessionId,{name:ov.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:sv.TRACER}).onSuccess(),this._joinGateway()}return e})).then((e=>e))}async leave(){zS.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(yE()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const t=cT.indexOf(e);-1!==t&&cT.splice(t,1)}(this);const e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return zS.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState),zS.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof nR))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new UT(UE.INVALID_PARAMS,"param list is empty");const n=e;if("audience"===this._gateway.role)throw new UT(UE.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof nR))throw new UT(UE.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new UT(UE.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}zS.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach((e=>{const t=this._configDistribute.getBitrateLimit();e instanceof yI&&t&&e.setBitrateLimit(t.uplink)}));try{await this._publishHighStream(n),zS.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))))}catch(e){throw zS.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{r()}}async _publishDataChannel(e){BE(e.id,"id",0,65535,!0),jE(e.ordered,"ordered"),qE(e.metadata,"metadata",0,512),zS.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex((t=>t.id===e.id)))throw new UT(UE.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new UT(UE.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&LS("FORCE_TURN")&&!LS("TURN_ENABLE_TCP")&&!LS("TURN_ENABLE_UDP"))throw new UT(UE.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const t=new ok(e);await this._p2pChannel.publishDataChannel([t]);try{const n={streamId:e.id,ordered:e.ordered,maxRetransmits:LS("DATASTREAM_MAX_RETRANSMITS"),metadata:e.metadata,channelId:t._originDataChannelId};await this._gateway.publishDataChannel(this._uid,n,!0)}catch(e){if(e.code!==UE.DISCONNECT_P2P)throw e}return await t._waitTillOpen(),zS.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(e){throw zS.error("[".concat(this._clientId,"] publish datachannels error"),e.toString()),e}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new UT(UE.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof nR))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);zS.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((e=>"".concat(e.getTrackId()," ")))," "));const n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof Px){const e=await this._p2pChannel.unpublish(t);if(e){const t=await this._gateway.sendExtensionMessage(Ow.UNPUBLISH,e);t&&await this._p2pChannel.setDescription("local",t)}}else{const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),zS.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((e=>"".concat(e.getTrackId())))))}}catch(e){throw zS.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{n&&n()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),zS.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((e=>"".concat(e.id," ")))," "));const t=await this._publishMutex.lock();try{const t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),zS.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((e=>"".concat(e.id)))))}catch(e){throw zS.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t,n){return"datachannel"===t?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async _subscribeDataChannel(e,t){var n;if(BE(t,"channelId",0,65535,!0),!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find((t=>t===e)))throw zS.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new UT(UE.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw zS.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new UT(UE.INVALID_REMOTE_USER,"user is not published");const r=null===(n=e._dataChannels)||void 0===n?void 0:n.find((e=>e.id===t));if(!r)throw zS.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new UT(UE.REMOTE_USER_IS_NOT_PUBLISHED);const i=await this._subscribeMutex.lock();zS.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const n=await this._p2pChannel.subscribeDataChannel(e,[r]);if(n&&Di(n).call(n,r.id))try{var o;if(!r._originDataChannelId)throw zS.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new UT(UE.REMOTE_USER_IS_NOT_PUBLISHED);const t={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:null!==(o=r.metadata)&&void 0!==o?o:""};await this._gateway.subscribeDataChannel(e.uid,t,!0)}catch(t){if((null==t?void 0:t.code)!==UE.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[r]),t;await this._p2pChannel.unsubscribeDataChannel(e,[r]),this._p2pChannel.setPendingRemoteDataChannel(e,r.id)}return await r._waitTillOpen(),zS.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),r}finally{i()}}async _p2pSubscribe(e,t,n){if(VE(t,"mediaType",["audio","video"]),!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((t=>t===e))){const t=new UT(UE.INVALID_REMOTE_USER,"user is not in the channel");throw zS.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new UT(UE.INVALID_REMOTE_USER,"user is not published");throw zS.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!n&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){const n=new UT(UE.REMOTE_USER_IS_NOT_PUBLISHED);throw zS.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}const r=await this._subscribeMutex.lock();zS.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));const i="audio"===t?fw.LocalAudioTrack:this._joinInfo.defaultVideoStream===MC.LOW_STREAM?fw.LocalVideoLowTrack:fw.LocalVideoTrack;try{await this._p2pChannel.hasRemoteMediaWithLock(e,t)?await this._p2pChannel.unmuteRemote(e,t):(this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof Px&&await this._gateway.sendExtensionMessage(Ow.SUBSCRIBE,{trackType:i})),zS.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{zS.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));const n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new UT(UE.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(t){throw zS.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{r()}}async _subscribe(e,t,n){if(this._p2pChannel instanceof Px)return this._p2pSubscribe(e,t);if(VE(t,"mediaType",["audio","video"]),!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((t=>t===e))){const t=new UT(UE.INVALID_REMOTE_USER,"user is not in the channel");throw zS.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new UT(UE.INVALID_REMOTE_USER,"user is not published");throw zS.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const n=new UT(UE.REMOTE_USER_IS_NOT_PUBLISHED);throw zS.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let r="audio"===t?e._audioSSRC:e._videoSSRC,i="audio"===t?e._audioOrtc:e._videoOrtc,o="video"===t?e._rtxSsrcId:void 0,s={stream_type:"audio"===t?dw.AUDIO:dw.VIDEO,ssrcId:r};const a=await this._subscribeMutex.lock();zS.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const a="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==a&&a!==r&&(r=a,i="audio"===t?e._audioOrtc:e._videoOrtc,o="video"===t?e._rtxSsrcId:void 0,s={stream_type:"audio"===t?dw.AUDIO:dw.VIDEO,ssrcId:r}),ck.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,o,i);try{await this._gateway.subscribe(e.uid,s,!0)}catch(n){if((null==n?void 0:n.code)!==UE.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),n;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(n){throw this._p2pChannel.reportSubscribeEvent(!1,null==n?void 0:n.code,e,t),n}zS.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{zS.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));const a="audio"===t?e._audioTrack:e._videoTrack;if(!a)throw new UT(UE.UNEXPECTED_ERROR,"can not find remote track in user object");return a}catch(t){throw zS.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{a()}}async massSubscribe(e){if(WE(e,"subscribeList"),!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();zS.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; ")));const i=(e=[...e]).map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}})),o=await this._p2pChannel.globalLock();try{var s;for(let t=e.length-1;t>=0;t--){const r=e[t],{user:o,mediaType:s}=r;if(VE(s,"mediaType",["audio","video"]),!o){const e=new UT(UE.INVALID_PARAMS,"user property does not exist in subscribeList item");throw zS.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}if(!this._users.find((e=>e===o))){const n=new UT(UE.INVALID_REMOTE_USER,"user is not in the channel");zS.error("[".concat(this._clientId,"] can not massSubscribe ").concat(o.uid,", this user is not in the channel")),i[t].error=n,e.splice(t,1);continue}if("audio"===s&&(!o.hasAudio||void 0===o._audioSSRC)||"video"===s&&(!o.hasVideo||void 0===o._videoSSRC)){const n=new UT(UE.REMOTE_USER_IS_NOT_PUBLISHED);zS.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType ").concat(s,", remote user is not published")),i[t].error=n,e.splice(t,1);continue}const a=nw.Video|nw.LwoVideo,c=n.get(o);if(c){if("video"===s?c&a:c&nw.Audio){e.splice(t,1),zS.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(o.uid,", mediaType:").concat(s," twice"));continue}n.set(o,c|("video"===s?a:nw.Audio))}else n.set(o,"video"===s?a:nw.Audio)}for(let t=e.length-1;t>=0;t--){const r=e[t],{user:i,mediaType:o}=r,s=nw.Video|nw.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,o)){await this._p2pChannel.unmuteRemoteNoLock(i,o);const r=n.get(i);n.set(i,"video"===o?r^s:r^nw.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map((e=>({userId:e.user.uid,type:e.mediaType}))),t);const r=cy(s=Array.from(n.entries())).call(s,((e,t)=>{let[n,r]=t;if(0===r)return e;const i={stream_id:n.uid,stream_type:r};return r&nw.Audio&&(i.audio_ssrc=n._audioSSRC),r&nw.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===dw.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===dw.VIDEO?t._rtxSsrcId:void 0}})));const n=new Map;if(r.length>0){const e=await this._gateway.subscribeAll(r,!0);((null==e?void 0:e.users)||[]).forEach((e=>{let{stream_id:t,video_error_code:r,audio_error_code:i,error_code:o}=e;(r||i||o)&&n.set(t,{video_error_code:r,audio_error_code:i,error_code:o})}))}if(Array.from(n.entries()).length>0){const e=Array.from(n.entries()).map((e=>{let t,[n,r]=e;return r.error_code||r.video_error_code&&r.audio_error_code?t=void 0:r.video_error_code?t=dw.VIDEO:r.audio_error_code&&(t=dw.AUDIO),{user:this.remoteUsers.find((e=>e.uid===n)),mediaType:t}}));await this._p2pChannel.massUnsubscribeNoLock(e)}for(const e of i){const t=n.get(e.user.uid);if(t){const n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){const t=Mw(n);zS.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new UT(UE.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(i.filter((e=>!e.error)).map((e=>({userId:e.user.uid,type:e.mediaType}))),void 0,Date.now()),i.forEach((e=>{var n;iT.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===dw.VIDEO,audio:e.mediaType===dw.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===dw.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)})),zS.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),i}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{o(),r()}}async unsubscribe(e,t,n){if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&VE(t,"mediaType",["audio","video"]),!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((t=>t===e))){const t=new UT(UE.INVALID_REMOTE_USER,"user is not in the channel");throw zS.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}zS.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const r=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof Px)await this._gateway.sendExtensionMessage(Ow.UNSUBSCRIBE,{mediaType:t});else{const n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),zS.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(t){if(t.code===UE.DISCONNECT_P2P)return void zS.warning("disconnecting p2p, abort unsubscribe request.");throw zS.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{r()}}async _unsubscribeDataChannel(e,t){if(t&&BE(t,"id",0,65535,!0),!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find((t=>t===e))){const t=new UT(UE.INVALID_REMOTE_USER,"user is not in the channel");throw zS.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}let n;if("number"==typeof t){const r=e._dataChannels.find((e=>e.id===t));r&&(n=[r])}else n=e._dataChannels;if(void 0===n){const n=new UT(UE.REMOTE_USER_IS_NOT_PUBLISHED);throw zS.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}zS.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(n.map((e=>e.id))));try{const t=await this._p2pChannel.unsubscribeDataChannel(e,n);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),zS.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(t){if(t.code===UE.DISCONNECT_P2P)return void zS.warning("disconnecting p2p, abort unsubscribe request.");throw zS.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}}async massUnsubscribe(e){if(WE(e,"unsubscribeList"),!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");zS.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const e=new UT(UE.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw zS.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}if(VE(i,"mediaType",["video","audio",void 0]),!this._users.find((e=>e===r))){zS.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const o=nw.Video|nw.LwoVideo;if(t.has(r)){const s=t.get(r);let a;switch(i){case"video":a=s&o;break;case"audio":a=s&nw.Audio;break;default:a=s&(nw.Audio|o)}if(a){zS.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?"audio"===i?t.set(r,s|nw.Audio):"video"===i&&t.set(r,s|o):t.set(r,s|nw.Audio|o)}else i?"audio"===i?t.set(r,nw.Audio):"video"===i&&t.set(r,o):t.set(r,nw.Audio|o)}try{const t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),zS.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join()))}catch(e){if(e.code===UE.DISCONNECT_P2P)return void zS.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw zS.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}async setLowStreamParameter(e){!function(e){if(!e)throw new FE(UE.INVALID_PARAMS);zE(e.width)||GE(e.width,"streamParameter.width"),zE(e.height)||GE(e.height,"streamParameter.height"),zE(e.framerate)||GE(e.framerate,"streamParameter.framerate"),zE(e.bitrate)||BE(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&zS.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),zS.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,fw.LocalVideoLowTrack)}async enableDualStream(){if(!fR().supportDualStream)throw iT.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new UT(UE.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new UT(UE.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw iT.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,iT.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),zS.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(fw.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw iT.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,iT.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),zS.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){VE(e,"role",["audience","host"])}(e),t&&gv(t),"rtc"===this.mode)throw zS.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new UT(UE.INVALID_OPERATION,"rtc mode can not use setClientRole");if(t&&t.level&&"host"===e)throw new UT(UE.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new UT(UE.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,zS.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;const t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(qE(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new UT(UE.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,iT.setProxyServer(this._proxyServer),zS.setProxyServer(this._proxyServer),zS.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new UT(UE.INVALID_OPERATION,"You have already set the proxy")}if(fv(e))return this._turnServer={servers:e,mode:"original-manual"},void zS.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((e=>e.urls)).join(","),"."));e.forEach((e=>mv(e))),this._turnServer={servers:e,mode:"manual"},zS.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"you should set license before join channel");if(qE(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new UT(UE.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,zS.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new UT(UE.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(void 0===e&&(e=3),e){case 1:case 2:throw new UT(UE.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new UT(UE.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,zS.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"Stop proxy server after leave channel");iT.setProxyServer(),zS.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",zS.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new UT(UE.INVALID_PARAMS,"accessPoints is required.");WE(e.accessPoints.serverList,"accessPoints.serverList"),qE(e.accessPoints.domain,"accessPoints.domain");const t=(e,t)=>{BE(e,t,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new UT(UE.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");LS("CLOSE_AFB_FOR_LOCAL_AP")&&(DS("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),DS("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,o=e.accessPoints.serverList.map((e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e)),s=o.map((e=>"".concat(e,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,DS("WEBCS_DOMAIN",s),DS("WEBCS_DOMAIN_BACKUP_LIST",s),DS("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(WE(e.report.hostname,"report.hostname"),DS("EVENT_REPORT_DOMAIN",e.report.hostname[0]),DS("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(DS("EVENT_REPORT_DOMAIN",o[0]),DS("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let a=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),a=e.report.port),DS("STATS_COLLECTOR_PORT",a),e.report?DS("ENABLE_EVENT_REPORT",!0):DS("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(WE(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),DS("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let u=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(WE(e.cds.hostname,"cds.hostname"),u=e.cds.hostname):u=o;let d=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),d=e.cds.port),DS("CDS_AP",u.map((e=>"".concat(e,":").concat(d)))),e.cds?DS("ENABLE_CONFIG_DISTRIBUTE",!0):DS("ENABLE_CONFIG_DISTRIBUTE",!1),zS.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(WE(e,"serverList"),qE(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new UT(UE.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,DS("WEBCS_DOMAIN",e),DS("WEBCS_DOMAIN_BACKUP_LIST",e),DS("GATEWAY_DOMAINS",[t]),DS("EVENT_REPORT_DOMAIN",e[0]),DS("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),DS("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),zS.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(VE(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw zS.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else zS.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){VE(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const t=this._users.find((t=>t.uid===e));t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(e){throw zS.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}zS.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){VE(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw zS.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}zS.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n){!function(e){VE(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),qE(t,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(Di(r).call(r,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new UT(UE.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new UT(UE.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||zS.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Pv(n))}async renewToken(e){if(qE(e,"token",1,2047),!this._key||!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(LS("USE_NEW_TOKEN")){zS.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const t=await gP(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Yv);zS.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else zS.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});zS.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,zS.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?zS.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(lv.VOLUME_INDICATOR,e)}),LS("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new UT(UE.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new UT(UE.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new UT(UE.LIVE_STREAMING_TASK_CONFLICT);const n=t?CT.TRANSCODE:CT.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(CT.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((t=>t&&t.hasUrl(e)));if(!t.length)throw new UT(UE.INVALID_PARAMS,"can not find live streaming url to stop");await tE.all(t.map((t=>t&&t.stopLiveStreamingTask(e))))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(CT.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,CT.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(CT.INJECT),n=Array.from(LT(e=t.streamingTasks).call(e)).find((e=>e.mode===CT.INJECT));if(!this._joinInfo||!n)throw new UT(UE.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(e){IP(e);const t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){IP(e);const t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){const e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){const t=new TextEncoder;e.payload=t.encode(e.payload)}if(new Blob([e.payload]).size>1024)throw new UT(UE.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(vT.DATA_STREAM,{payload:Pv(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Mx},!t)}sendMetadata(e){if(!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new UT(UE.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(vT.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Pv(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(YS),!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"can not send custom report, not joined");await iT.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){VE(t.spatialLayer,"spatialLayer",[0,1,2,3]),VE(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw zS.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}setRTM2Flag(e){if(VE(e,"flag",[0,1]),!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(e)}_reset(){if(zS.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=mS.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((e=>e._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Hv("client-publish"),this._subscribeMutex=new Hv("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){const n=e||Fv();e?zS.debug("[".concat(this._clientId,"] new Session ").concat(n)):zS.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n)),this._sessionId=n,this.store.sessionId=n,t?iT.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:t.channel,appid:t.appId,mode:this.mode}):this._joinInfo?iT.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&iT.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new UT(UE.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&LS("FORCE_TURN")&&!LS("TURN_ENABLE_TCP")&&!LS("TURN_ENABLE_UDP"))throw new UT(UE.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");zS.debug("[".concat(this._clientId,"] publish high stream"));try{if(this._p2pChannel instanceof Px){const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(n)try{await this._gateway.sendExtensionMessage(Ow.PUBLISH,n)}catch(t){throw this._p2pChannel.unpublish(e),t}}else{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(e){if(e.code!==UE.DISCONNECT_P2P)throw n.throw(e),e}await n.next((null===(t=i)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const t of e)t instanceof yI&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===UE.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new UT(UE.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new UT(UE.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));zS.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await e.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(t){if(t.code!==UE.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=r)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===UE.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new UT(UE.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new CP(this._joinInfo,this._config.websocketRetryConfig||Yv,this._config.httpRetryConfig||Yv),n=e=>{e.onLiveStreamError=(e,t)=>{iT.reportApiInvoke(this._sessionId,{name:ov.ON_LIVE_STREAM_ERROR,options:[e,t],tag:sv.TRACER}).onSuccess(),this.safeEmit(lv.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{iT.reportApiInvoke(this._sessionId,{name:ov.ON_LIVE_STREAM_WARNING,options:[e,t],tag:sv.TRACER}).onSuccess(),this.safeEmit(lv.LIVE_STREAMING_WARNING,e,t)},e.on(HT.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new UT(UE.INVALID_OPERATION,"can not find join info to get worker manager"));fP(e,this._joinInfo,this._axiosCancelSource.token,Yv).then(t).catch(n)}))};switch(e){case CT.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case CT.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case CT.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(HT.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new UT(UE.INVALID_OPERATION,"can not find join info to get worker manager"));fP(e,this._joinInfo,this._axiosCancelSource.token,Yv).then(t).catch(n)})),this._injectStreamingClient.onInjectStatusChange=(e,t,n)=>{this.safeEmit(lv.INJECT_STREAM_STATUS,e,t,n)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new UT(UE.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),n={width:e,height:t};this._channelMediaRelayClient=new AP(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Yv,this._config.httpRetryConfig||Yv,n),this._channelMediaRelayClient.on("state",(e=>{e===XT.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(lv.CHANNEL_MEDIA_RELAY_STATE,e)})),this._channelMediaRelayClient.on("event",(e=>{this.safeEmit(lv.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];Array.isArray(n)&&n.length>0&&n.forEach((e=>{const{uid:n,stream_id:r,ordered:o,max_retrans_times:s,metadata:a}=e,c=this._users.find((e=>e._uintid===n));if(c){if(zS.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(n)),Di(i).call(i,c)||i.push(c),c._uintid||(c._uintid=n),-1===c._dataChannels.findIndex((t=>t.id===e.stream_id))){const e={id:r,ordered:!!o,maxRetransmits:s,metadata:a},n=new ik(e);c._dataChannels.push(n),zS.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),t||this.safeEmit(lv.USER_PUBLISHED,c,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(c,e.stream_id)&&(zS.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,e.stream_id).catch((e=>{zS.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())})))}else zS.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))})),t&&(this.safeEmit(lv.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach((e=>{const{uid:t,stream_id:n}=e,r=this._users.find((e=>e._uintid===t));if(!r)return void zS.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const i=r._dataChannels.find((t=>t.id===e.stream_id));i&&(zS.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(r,[i]).then((e=>{if(e)return r._dataChannels=r._dataChannels.filter((e=>e!==i)),this._gateway.unsubscribeDataChannel(e,r.uid)})),zS.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(i.id)),this.safeEmit(lv.USER_UNPUBLISHED,r,"datachannel",i._config))}))}_handleRemoveDataChannels(e){const t=this._users.find((t=>t.uid===e.uid));if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){zS.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{zS.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((e=>{this.safeEmit(lv.USER_UNPUBLISHED,t,"datachannel",e._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)})),n()}}else zS.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ew.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(ew.CONNECTION_STATE_CHANGE,((e,t,n)=>{var r;if(n===cv.FALLBACK)return;const i=()=>{this.safeEmit(lv.CONNECTION_STATE_CHANGE,e,t,n)};if(iT.reportApiInvoke(this._sessionId||(null===(r=this._gateway.joinInfo)||void 0===r?void 0:r.sid)||null,{name:ov.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:sv.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),zS.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void i();if("RECONNECTING"===e)this._users.forEach((e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._audioSSRC=void 0,e._videoSSRC=void 0,e._videoOrtc=void 0,e._audioOrtc=void 0,e._cname=void 0,e._rtxSsrcId=void 0})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var o;this._streamFallbackTypeCacheMap.forEach(((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch((e=>{zS.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)}))})),this._remoteStreamTypeCacheMap.forEach(((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch((e=>{zS.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)}))})),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(o=this._joinInfo)||void 0===o?void 0:o.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{zS.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((e=>{zS.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter((e=>!e._trust_in_room_)).forEach((e=>{zS.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach((e=>{e._trust_audio_mute_state_||(zS.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,dw.AUDIO,!1)),e._trust_video_mute_state_||(zS.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,dw.VIDEO,!1)),e._trust_audio_enabled_state_||(zS.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(zS.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(zS.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(zS.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(zS.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))})))}),1e3))}i()})),this._gateway.on(ew.REQUEST_NEW_GATEWAY_LIST,((e,t)=>{if(!this._joinInfo)return t(new UT(UE.UNEXPECTED_ERROR,"can not recover, no join info"));lP(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Yv,this.store).then((t=>{this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);const n=[];t.gatewayInfo.gatewayAddrs.forEach((e=>{let{address:t}=e;const[r,i]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?n.push({proxy:this._joinInfo.proxyServer,host:r,port:i}):n.push({host:r,port:i})})),e(n)})).catch(t)})),this._gateway.on(ew.NETWORK_QUALITY,(e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(lv.NETWORK_QUALITY,e)})),this._gateway.on(ew.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(lv.STREAM_TYPE_CHANGED,e,t),iT.reportApiInvoke(this._sessionId,{name:ov.STREAM_TYPE_CHANGE,options:[e,t],tag:sv.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.on(ew.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(ew.NEED_RENEW_SESSION,(()=>{this._startSession()})),this._gateway.on(ew.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,n)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(e){n(e)}})),this._gateway.on(ew.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;const{dtlsParameters:n,iceParameters:r,candidates:i,rtpCapabilities:o,setup:s,cname:a}=XP(e.ortc,t);this._p2pChannel.connect(r,n,i,o,s,a)})),this._gateway.on(ew.REQUEST_DC_CONNECTION_PARAMS,(e=>{e(this._p2pChannel.getEstablishParams())})),this._gateway.on(ew.RESET_SIGNAL,(e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()})),this._gateway.on(ew.DATACHANNEL_FAILBACK,(()=>{this._joinGateway()})),this._gateway.on(ew.DATACHANNEL_PRECONNECT,(async(e,t,n,r)=>{var i,o,s,a,c,l;await this._p2pChannel.startP2PConnection({turnServer:null===(i=this._joinInfo)||void 0===i?void 0:i.turnServer},!0);const u=function(e,t){let n;return t&&t.ip&&"number"==typeof t.port?(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],zS.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),zS.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],n}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat(null===(o=this._joinInfo)||void 0===o?void 0:o.apResponse.cid,"_").concat(null===(s=this._joinInfo)||void 0===s?void 0:s.apResponse.cert),icePwd:"".concat(null===(a=this._joinInfo)||void 0===a?void 0:a.apResponse.cid,"_").concat(null===(c=this._joinInfo)||void 0===c?void 0:c.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(l=LS("FINGERPRINT"))&&void 0!==l?l:e.fingerprint}]},u,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(r)}))}_handleGatewaySignalEvents(){this._gateway.signal.on(bT.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(bT.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(bT.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc))),this._gateway.signal.on(bT.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(bT.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(bT.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams,deleted:[]},!0)})),this._gateway.signal.on(bT.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(bT.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(bT.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,dw.AUDIO,!0))),this._gateway.signal.on(bT.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,dw.AUDIO,!1))),this._gateway.signal.on(bT.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,dw.VIDEO,!0))),this._gateway.signal.on(bT.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,dw.VIDEO,!1))),this._gateway.signal.on(bT.RECEIVE_METADATA,(e=>{const t=kv(e.metadata);this.safeEmit(lv.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(bT.ON_DATA_STREAM,(async e=>{if(!e)return;let t=0;if(e.ordered||e.syncWithAudio){const n=this._p2pChannel.getStats(),r=this.remoteUsers.find((t=>t.uid===e.uid)),i=null==n?void 0:n.audioRecv.find((e=>e.ssrc===(null==r?void 0:r._audioSSRC)));t=null==i?void 0:i.jitterBufferMs}null==t&&(t=0),Gx(e,t,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(bT.ON_CRYPT_ERROR,(()=>{Nv((()=>{zS.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(lv.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(bT.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(bT.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{zS.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,cv.TOKEN_EXPIRE),this.safeEmit(lv.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(bT.ON_STREAM_FALLBACK_UPDATE,(e=>{zS.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(lv.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")})),this._gateway.signal.on(bT.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),zS.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(bT.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(bT.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(ET.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case vT.PUBLISH:{if(!t)return;const e=t.ortc;if(e){var n,r;const i=e.some((e=>{let{stream_type:t}=e;return t===$T.Audio})),o=e.some((e=>{let{stream_type:t}=e;return t!==$T.Audio})),s=e.some((e=>{let{stream_type:t}=e;return t===$T.Screen||t===$T.ScreenLow}));"offer"===t.state&&iT.publish(this._joinInfo.sid,{eventElapse:ck.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:UE.TIMEOUT,audio:i,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:s,audioName:i?null===(n=e.find((e=>{let{stream_type:t}=e;return t===$T.Audio})))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0,videoName:o?null===(r=e.find((e=>{let{stream_type:t}=e;return t!==$T.Audio})))||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0})}break}case vT.SUBSCRIBE:t&&iT.subscribe(this._joinInfo.sid,{succ:!1,ec:UE.TIMEOUT,audio:t.stream_type===dw.AUDIO,video:t.stream_type===dw.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:ck.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}})),this._gateway.signal.on(bT.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(bT.ON_PUBLISHED_USER_LIST,(e=>{if(null==e||!e.users)return;LS("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((e=>!lT(e.string_id||e.stream_id,this.channelName))));const t=[],n=[];for(const r of e.users){let e=this._users.find((e=>e._uintid===r.stream_id));e?e._trust_in_room_=!0:(e=new NP(r.string_id||r.stream_id,r.stream_id),this._users.push(e),0===this.getListeners(lv.PUBLISHED_USER_LIST).length&&(zS.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(lv.USER_JOINED,e)));const i=nw.Audio&r.stream_type,o=(nw.Video|nw.LwoVideo)&r.stream_type,s=0!=(65280&r.stream_type),a=i&&e.hasAudio,c=o&&e.hasVideo;o&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=r.video_ssrc,e._rtxSsrcId=r.video_rtx),i&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=r.audio_ssrc),i&&!a&&0===this.getListeners(lv.PUBLISHED_USER_LIST).length&&(zS.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(lv.USER_PUBLISHED,e,"audio")),o&&!c&&0===this.getListeners(lv.PUBLISHED_USER_LIST).length&&(zS.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(lv.USER_PUBLISHED,e,"video")),(i&&!a||o&&!c||s)&&t.push(e),o&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),i&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(zS.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((e=>{zS.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())}))),this.getListeners(lv.PUBLISHED_USER_LIST).length>0?LS("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(zS.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((e=>e.uid)).join(", "))),this.safeEmit(lv.PUBLISHED_USER_LIST,t)):zS.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((e=>e.uid)).join(", ")))})),this._gateway.signal.on(bT.ON_RTP_CAPABILITY_CHANGE,(e=>{const{video_codec:t}=e;this._p2pChannel instanceof fL&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((e=>e.toLowerCase())).filter((e=>{var t;return Di(t=Object.keys(MS)).call(t,e)})))}))}_handleP2PEvents(){this._gateway.signal.on(bT.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(Ow.PUBLISH,(async(e,t)=>{e.forEach((e=>e.kind===dw.VIDEO?(this._handleP2PAddAudioOrVideoStream("video",t),e.isMuted?this._handleMuteStream(t,dw.VIDEO,!0):this._handleMuteStream(t,dw.VIDEO,!1)):(this._handleP2PAddAudioOrVideoStream("audio",t),e.isMuted?this._handleMuteStream(t,dw.AUDIO,!0):this._handleMuteStream(t,dw.AUDIO,!1))))})),this._gateway.signal.on(ET.P2P_START,(async(e,t)=>{var n;this._p2pChannel instanceof Px&&t(await this._p2pChannel.startP2P({turnServer:null===(n=this._joinInfo)||void 0===n?void 0:n.turnServer},e))})),this._gateway.signal.on(ET.P2P_CONNECTION,(async e=>{this._p2pChannel instanceof Px&&await this._p2pChannel.p2pConnect(e)})),this._gateway.signal.on(ET.P2P_REMOTE_CANDIDATE_UPDATE,(e=>{this._p2pChannel instanceof Px&&this._p2pChannel.addRemoteCandidate(JSON.parse(e))})),this._gateway.signal.on(Ow.SUBSCRIBE,(async(e,t,n)=>{if(this._p2pChannel instanceof Px){const{trackType:r}=JSON.parse(e);try{await this._p2pChannel.dopublish(r),t()}catch(e){n(e)}}})),this._gateway.signal.on(Ow.UNSUBSCRIBE,(async(e,t,n)=>{if(this._p2pChannel instanceof Px){const{mediaType:r}=JSON.parse(e);try{await this._p2pChannel.doUnpublish(r),t()}catch(e){n(e)}}})),this._gateway.signal.on(Ow.EXCHANGE_SDP,(async(e,t,n)=>{if(this._p2pChannel instanceof Px){const{type:r,sdp:i}=JSON.parse(e);try{t(await this._p2pChannel.setDescription(r,i))}catch(e){n(e)}}})),this._gateway.signal.on(Ow.UNPUBLISH,(async(e,t,n)=>{if(this._p2pChannel instanceof Px){const{unpubMsg:r,uid:i}=e;if(1===r.length){const o=r[0].stream_type===$T.Audio?dw.AUDIO:dw.VIDEO;this._handleMuteStream(i,o,!0);const{sdp:s}=e;if(this._p2pChannel instanceof Px&&s){const e=this._users.find((e=>e.uid===i));if(!e)return zS.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();this._p2pChannel.unsubscribe(e,s,o).then((e=>{e&&t(e)})).catch(n)}else t()}else this._handleRemoveStream(e,t,n)}})),this._gateway.signal.on(Ow.CONTROL,(async(e,t,n)=>{const{action:r,sdp:i,isMuteAll:o,uid:s}=e;switch(r){case Aw.MUTE_LOCAL_VIDEO:this._handleMuteStream(s,dw.VIDEO,!0,i,t,n);break;case Aw.MUTE_LOCAL_AUDIO:t(),this._handleMuteStream(s,dw.AUDIO,!0);break;case Aw.UNMUTE_LOCAL_VIDEO:t(),this._handleP2PAddAudioOrVideoStream("video",s),this._handleMuteStream(s,dw.VIDEO,!1);break;case Aw.UNMUTE_LOCAL_AUDIO:t(),this._handleP2PAddAudioOrVideoStream("audio",s),this._handleMuteStream(s,dw.AUDIO,!1)}o&&this._handleRemoveStream(e,t,n)})),this._gateway.signal.on(Ow.DO_SUBSCRIBE,(async(e,t,n)=>{if(this._p2pChannel instanceof Px){const{kind:r,sdp:i,ssrcId:o,uid:s}=e,a=this._users.find((e=>e.uid===s));if(!a)return zS.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void t();try{t(await this._p2pChannel.subscribe(a,r,i,o))}catch(e){n(e)}}})),this._gateway.signal.on(Ow.DO_UNSUBSCRIBE,(async(e,t,n)=>{if(this._p2pChannel instanceof Px){const{uid:r,kind:i,sdp:o}=e,s=this._users.find((e=>e.uid===r));if(!s)return zS.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void t();try{t(await this._p2pChannel.unsubscribe(s,o,i))}catch(e){n(e)}}})),this._gateway.signal.on(Ow.RESTART_ICE,(async(e,t,n)=>{if(this._p2pChannel instanceof Px)try{t(await this._p2pChannel.setDescription("remote",e))}catch(e){n(e)}})),this._p2pChannel.on(gw.RequestP2PRestartICE,(async(e,t,n)=>{try{t(await this._gateway.sendExtensionMessage(Ow.RESTART_ICE,e))}catch(e){n(e)}})),this._p2pChannel.on(gw.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(Ow.CANDIDATE,JSON.stringify(e))})),this._p2pChannel.on(gw.RequestP2PMuteLocal,(async(e,t,n)=>{try{t(await this._gateway.sendExtensionMessage(Ow.CONTROL,e))}catch(e){n(e)}})),this._p2pChannel.on(gw.RequestP2PPublish,(async(e,t,n)=>{try{t(await this._gateway.sendExtensionMessage(Ow.DO_SUBSCRIBE,e))}catch(e){n(e)}})),this._p2pChannel.on(gw.RequestP2PUnPublish,(async(e,t,n)=>{try{t(await this._gateway.sendExtensionMessage(Ow.DO_UNSUBSCRIBE,e))}catch(e){n(e)}})),this._p2pChannel.on(gw.RequestP2PUnmuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===UE.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(gw.RequestP2PMuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===UE.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(gw.StateChange,((e,t)=>{t===mw.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(gw.RequestMuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===UE.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(gw.RequestUnmuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===UE.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(gw.RequestRePublish,((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),this._p2pChannel.on(gw.RequestRePublishDataChannel,((e,t,n)=>{tE.all(e.map((async e=>{await this._p2pChannel.publishDataChannel([e]);const t={streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,t,!0)}catch(e){if(e.code!==UE.DISCONNECT_P2P)throw e}}))).then(t).catch(n)})),this._p2pChannel.on(gw.RequestReSubscribe,(async(e,t,n)=>{try{for(const{user:t,kind:n}of e)n===dw.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){n(e)}})),this._p2pChannel.on(gw.RequestUploadStats,((e,t)=>{this._gateway.uploadStats(e,t)})),this._p2pChannel.on(gw.MediaReconnectStart,(e=>{this.safeEmit(lv.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(gw.MediaReconnectEnd,(e=>{this.safeEmit(lv.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(gw.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(gw.RequestRestartICE,(async e=>{if(this._p2pChannel instanceof Px)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(e){return void t.throw(e)}const{iceParameters:o}=function(e){const t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(i);await t.next({remoteIceParameters:o})})),this._p2pChannel.on(gw.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(gw.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),{dtlsParameters:s,iceParameters:a,candidates:c,rtpCapabilities:l,setup:u,cname:d}=XP(i,o);await this._p2pChannel.connect(a,s,c,l,u,d),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(gw.RequestUnpublishForReconnectPC,(async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(gw.P2PLost,(()=>{this.safeEmit(lv.P2P_LOST,this.store.uid)})),this._p2pChannel.on(gw.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(gw.ConnectionTypeChange,(e=>{this.safeEmit(lv.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(gw.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(gw.QueryClientConnectionState,(e=>{e(this.connectionState)}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if("CONNECTED"!==this.connectionState||!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new UT(UE.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new UT(UE.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new UT(UE.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach((e=>{var t;if(!Di(t=["supervise","moderation"]).call(t,e))throw new UT(UE.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(e," is not a valid inspect type."))})),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new UT(UE.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new zL(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Yv)}catch(e){throw Array.isArray(e)?e[0]:e}}async disableContentInspect(){if(!this._inspect)throw new UT(UE.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(jE(e,"enabled"),e){if(!t)throw new UT(UE.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(BE(t.interval,"interval",1e3,1/0),"CONNECTED"!==this.connectionState||!this._joinInfo)throw new UT(UE.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);const e=new wx(t);this._moderation=e,this.handleImageModerationEvents(this._moderation),await e.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Yv)}catch(e){throw Array.isArray(e)?e[0]:e}}else{if(!this._moderation)throw new UT(UE.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(Rw.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(lv.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===Cw.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new UT(UE.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(Rw.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}handleVideoInspectEvents(e){e.on(yw.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(lv.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Ew.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(lv.CONTENT_INSPECT_ERROR,new UT(UE.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(yw.INSPECT_RESULT,((e,t)=>{var n;if((null==t?void 0:t.code)===UE.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return zS.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.safeEmit(lv.CONTENT_INSPECT_RESULT,e,t)})),e.on(yw.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}getJoinChannelServiceRecords(){return zS.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){jE(e,"enabled"),DS("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}xT([rT(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",tE)],Kx.prototype,"leave",null),xT([rT({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof nR))return[t];t=[t]}return t.map((e=>e?Object(e).toString():"null"))}}),MT("design:type",Function),MT("design:paramtypes",[Object,Boolean]),MT("design:returntype",tE)],Kx.prototype,"publish",null),xT([rT({argsMap:(e,t)=>(t||(t=[]),t instanceof ok?[t.getChannelId()]:(Array.isArray(t)||(t=[t]),t.map((e=>e.getTrackId()))))}),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",tE)],Kx.prototype,"unpublish",null),xT([rT({argsMap:(e,t,n,r)=>[t.uid,n,r]}),MT("design:type",Function),MT("design:paramtypes",[NP,String,Number]),MT("design:returntype",tE)],Kx.prototype,"subscribe",null),xT([rT({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return[null==t?void 0:t.uid,n]}))}),MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],Kx.prototype,"massSubscribe",null),xT([rT({argsMap:(e,t,n,r)=>[t.uid,n,r]}),MT("design:type",Function),MT("design:paramtypes",[NP,String,Number]),MT("design:returntype",tE)],Kx.prototype,"unsubscribe",null),xT([rT({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return{uid:null==t?void 0:t.uid,mediaType:n}}))}),MT("design:type",Function),MT("design:paramtypes",[Array]),MT("design:returntype",tE)],Kx.prototype,"massUnsubscribe",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",tE)],Kx.prototype,"setLowStreamParameter",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",tE)],Kx.prototype,"enableDualStream",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",tE)],Kx.prototype,"disableDualStream",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[String,Object]),MT("design:returntype",tE)],Kx.prototype,"setClientRole",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[String,Boolean]),MT("design:returntype",void 0)],Kx.prototype,"setProxyServer",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Object,Boolean]),MT("design:returntype",void 0)],Kx.prototype,"setTurnServer",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",void 0)],Kx.prototype,"setLicense",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Number]),MT("design:returntype",void 0)],Kx.prototype,"startProxyServer",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],Kx.prototype,"stopProxyServer",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",void 0)],Kx.prototype,"setLocalAccessPointsV2",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Array,String]),MT("design:returntype",void 0)],Kx.prototype,"setLocalAccessPoints",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Number]),MT("design:returntype",tE)],Kx.prototype,"setRemoteDefaultVideoStreamType",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Object,Number]),MT("design:returntype",tE)],Kx.prototype,"setRemoteVideoStreamType",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Object,Number]),MT("design:returntype",tE)],Kx.prototype,"setStreamFallbackOption",null),xT([rT({argsMap:(e,t)=>[t]}),MT("design:type",Function),MT("design:paramtypes",[String,String,Uint8Array]),MT("design:returntype",void 0)],Kx.prototype,"setEncryptionConfig",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],Kx.prototype,"renewToken",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",void 0)],Kx.prototype,"enableAudioVolumeIndicator",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[String,Boolean]),MT("design:returntype",tE)],Kx.prototype,"startLiveStreaming",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",tE)],Kx.prototype,"setLiveTranscoding",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[String]),MT("design:returntype",tE)],Kx.prototype,"stopLiveStreaming",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[String,Object]),MT("design:returntype",tE)],Kx.prototype,"addInjectStreamUrl",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",tE)],Kx.prototype,"removeInjectStreamUrl",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[RP]),MT("design:returntype",tE)],Kx.prototype,"startChannelMediaRelay",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[RP]),MT("design:returntype",tE)],Kx.prototype,"updateChannelMediaRelay",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",tE)],Kx.prototype,"stopChannelMediaRelay",null),xT([rT({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",tE)],Kx.prototype,"sendCustomReportMessage",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Object,Object]),MT("design:returntype",tE)],Kx.prototype,"pickSVCLayer",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Number]),MT("design:returntype",tE)],Kx.prototype,"setRTM2Flag",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Object]),MT("design:returntype",tE)],Kx.prototype,"enableContentInspect",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",tE)],Kx.prototype,"disableContentInspect",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Boolean,Object]),MT("design:returntype",tE)],Kx.prototype,"setImageModeration",null),xT([rT({reportResult:!0}),MT("design:type",Function),MT("design:paramtypes",[]),MT("design:returntype",Array)],Kx.prototype,"getJoinChannelServiceRecords",null),xT([rT(),MT("design:type",Function),MT("design:paramtypes",[Boolean]),MT("design:returntype",tE)],Kx.prototype,"setPublishAudioFilterEnabled",null);class Yx{constructor(e,t){rh(this,"id",0),rh(this,"element",void 0),rh(this,"peerPair",void 0),rh(this,"context",void 0),rh(this,"audioPlayerElement",void 0),rh(this,"audioTrack",void 0),Yx.count+=1,this.id=Yx.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(e,t)=>{const n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new tE((t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}}))},t=async(e,t)=>await e.setRemoteDescription(t);try{const n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);const r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(e){throw new UT(UE.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new UT(UE.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new UT(UE.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){zS.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((e=>{e.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}rh(Yx,"count",0);const Zx=window.AudioContext||window.webkitAudioContext;class Jx{constructor(){rh(this,"units",[]),rh(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return zS.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Zx);let t=this.units.find((t=>t&&t.getElement()===e));return t||(t=new Yx(e,this.context),this.units.push(t)),t.startEchoCancellation(),zS.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return pE().name!==cE.SAFARI}}xT([rT({report:iT}),MT("design:type",Function),MT("design:paramtypes",[HTMLAudioElement]),MT("design:returntype",Number)],Jx.prototype,"processExternalMediaAEC",null);const Xx=new Jx;function Qx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qx(Object(n),!0).forEach((function(t){rh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const eM=window||document;function tM(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!eM)return;const n=nM._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=e=>{if(!(e&&e.blockedURI&&(nM.onSecurityPolicyViolation||nM.getListeners(Tw.SECURITY_POLICY_VIOLATION).length>0)))return;const t=e.blockedURI;LS("CSP_DETECTED_HOSTNAME_LIST").some((e=>Di(t).call(t,e)))&&(nM.onSecurityPolicyViolation&&"function"==typeof nM.onSecurityPolicyViolation&&nM.onSecurityPolicyViolation(e),nM.getListeners(Tw.SECURITY_POLICY_VIOLATION).length>0&&nM.safeEmit(Tw.SECURITY_POLICY_VIOLATION,e))};n&&eM.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||nM.getListeners(Tw.SECURITY_POLICY_VIOLATION).length>0)&&eM.addEventListener("securitypolicyviolation",r),nM._cspEventHandlerPointer=r}DS("PROCESS_ID","process-".concat(Uv(8,""),"-").concat(Uv(4,""),"-").concat(Uv(4,""),"-").concat(Uv(4,""),"-").concat(Uv(12,""))),function(){const e=pE();pR.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),pR.getStreamFromExtension=e.name===cE.CHROME&&Number(e.version)>34,pR.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),pR.supportMinBitrate=e.name===cE.CHROME||e.name===cE.EDGE,pR.supportSetRtpSenderParameters=function(){const e=pE();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!LE()||!(!yE()&&!gE())||e.name===cE.FIREFOX&&Number(e.version)>=64)}(),e.name===cE.SAFARI&&(Number(e.version)>=14?pR.supportDualStream=!0:pR.supportDualStream=!1),pR.webAudioMediaStreamDest=function(){const e=pE();return!(e.name===cE.SAFARI&&Number(e.version)<12)}(),pR.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,pR.supportWebGL="undefined"!=typeof WebGLRenderingContext,pR.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,LE()||(pR.webAudioWithAEC=!0),pR.supportShareAudio=function(){const e=pE();return(e.os===aE.WIN_10||e.os===aE.WIN_81||e.os===aE.WIN_7||e.os===aE.LINUX||e.os===aE.MAC_OS)&&e.name===cE.CHROME&&Number(e.version)>=74}(),pR.supportDataChannel=!!(TE(76)||function(e){const t=pE();return!(t.name!==cE.FIREFOX||!t.osVersion)&&Number(t.version)>=e}(68)||function(e){const t=pE();return!(t.name!==cE.SAFARI||!t.osVersion)&&Number(t.version)>=e}(14)),pR.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!bE()&&!!e&&e.prototype.setConfiguration instanceof Function}(),pR.supportWebRTCEncodedTransform=function(){const e=pE();return"Chrome"===e.name&&Number(e.version)>=86}(),pR.supportWebRTCInsertableStream=function(){const e=pE();return(e.name===cE.CHROME||e.name===cE.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Rv((()=>{pR.supportDualStreamEncoding=function(){const e=pE();return!!LS("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&LS("CHROME_DUAL_STREAM_USE_ENCODING"))}(),zS.info("browser compatibility",JSON.stringify(pR),JSON.stringify(e))}))}(),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void zS.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();zS.debug("Loading global parameters from cache",t),Object.keys(t).forEach((e=>{if(Object.prototype.hasOwnProperty.call(PS,e)){const{value:r,expires:i}=t[e];if(i&&i<=n)return;xS[e]=r,PS[e]=r}}))}catch(t){zS.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(xS.AREAS)&&xS.AREAS.length>0&&Kk(xS.AREAS,!0);const nM=function(e){const t=new nv,n=e,r={getListeners:t.getListeners.bind(t),on:(e,n)=>(function(e,t){e===Tw.SECURITY_POLICY_VIOLATION&&tM(t,!0)}(e,n),t.on.bind(t)(e,n)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return $x($x({},n),r)}({__TRACK_LIST__:kC,VERSION:AS,BUILD:kS,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:(e,t,n)=>{zS.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),DS(e,t,n)},getParameter:LS,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const n=(await t.createOffer()).sdp;if(!n)return e;t.close(),t=null,e=function(e){const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(e){throw new UT(UE.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){const e=iT.reportApiInvoke(null,{name:ov.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:sv.TRACER});let t=!1;try{const e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(e&&n&&r)}catch(e){return zS.error("check system requirement failed: ",e),!1}let n=!1;const r=pE();r.name===cE.CHROME&&Number(r.version)>=58&&(!EE()||_E())&&(n=!0),r.name===cE.FIREFOX&&Number(r.version)>=56&&(n=!0),r.name===cE.OPERA&&Number(r.version)>=45&&(n=!0),r.name===cE.SAFARI&&Number(r.version)>=11&&(n=!0),(PE()||pE().name===cE.QQ)&&(n=!0),zS.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return AR.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return AR.getRecordingDevices(e)},getCameras:function(e){return AR.getCamerasDevices(e)},getElectronScreenSources:yR,getPlaybackDevices:function(e){return AR.getSpeakers(e)},createClient:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=iT.reportApiInvoke(null,{name:ov.CREATE_CLIENT,options:[e],tag:sv.TRACER});try{!function(e){VE(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),VE(e.mode,"config.mode",["rtc","live"]),void 0!==e.audioCodec&&VE(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&qE(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&mv(e.turnServer),void 0!==e.httpRetryConfig&&pv(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&pv(e.websocketRetryConfig)}(e)}catch(e){throw t.onError(e),e}return Wx()||("vp9"===e.codec&&(e.codec="vp8",zS.debug("browser not support vp9, force use vp8")),DS("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===e.audioCodec&&(e.audioCodec="opus"),t.onSuccess(),new Kx(Hx(Hx({forceWaitGatewayResponse:!0},e),{},{role:"rtc"===e.mode?"host":e.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=iT.reportApiInvoke(null,{tag:sv.TRACER,name:ov.CREATE_CAM_VIDEO_TRACK,options:[TI({},e)]}),n=nI(e),r=Uv(8,"track-cam-");let i=null;const o="720p_auto"===e.encoderConfig;zS.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{i=(await CR({video:n},r)).getVideoTracks()[0]||null}catch(e){throw t.onError(e),e}if(!i){const e=new FE(UE.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(e),e.throw(zS)}e.optimizationMode&&wI(r,i,e,RC(e.encoderConfig));const s=new bI(i,e,n,e.scalabiltyMode?OC(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return o&&s.startMonitorStats(),t.onSuccess(s.getTrackId()),zS.info("create camera video success, trackId:",r),s},createCustomVideoTrack:function(e){const t=iT.reportApiInvoke(null,{tag:sv.TRACER,name:ov.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new yI(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?OC(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,Uv(8,"track-cus-"),[LC.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),zS.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const n=iT.reportApiInvoke(null,{tag:sv.TRACER,name:ov.CREATE_SCREEN_VIDEO_TRACK,options:[TI({},e),t]}),r="720p_auto"===e.encoderConfig;e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const i=function(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&vE()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:i,systemAudio:o}=e;(TE(107)||wE(107)||CE(93))&&(n&&(VE(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(VE(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(VE(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(TE(105)||wE(105)||CE(91))&&o&&(VE(o,"systemAudio",["exclude","include"]),t.systemAudio=o),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const s=e.encoderConfig?IC(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:s?s.width:void 0,maxHeight:s?s.height:void 0},s&&(s.frameRate&&("number"==typeof s.frameRate?(t.mandatory.maxFrameRate=s.frameRate,t.mandatory.minFrameRate=s.frameRate):(t.mandatory.maxFrameRate=s.frameRate.max||s.frameRate.ideal||s.frameRate.exact||void 0,t.mandatory.minFrameRate=s.frameRate.min||s.frameRate.ideal||s.frameRate.exact||void 0),t.frameRate=s.frameRate),s.width&&(t.width=s.width),s.height&&(t.height=s.height)),t}(e),o=Uv(8,"track-scr-v-");let s=null,a=null;const c=fR();if(!c.supportShareAudio&&"enable"===t){const e=new FE(UE.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(e),e.throw(zS)}zS.info("start create screen video track with config",e,"withAudio",t,"trackId",o);try{const e=await CR({screen:i,screenAudio:"auto"===t?c.supportShareAudio:"enable"===t},o);s=e.getVideoTracks()[0]||null,a=e.getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}if(!s){const e=new FE(UE.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(zS)}if(!a&&"enable"===t){s&&s.stop();const e=new FE(UE.SHARE_AUDIO_NOT_ALLOWED);return n.onError(e),e.throw(zS)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(wI(o,s,e,e.encoderConfig&&IC(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const l=new yI(s,e.encoderConfig?IC(e.encoderConfig):{},e.scalabiltyMode?OC(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[LC.SCREEN_TRACK]);if(r&&l.startMonitorStats(),!a)return n.onSuccess(l.getTrackId()),zS.info("create screen video track success","video:",l.getTrackId()),l;const u=new QR(a,void 0,Uv(8,"track-scr-a-"),!1,!0);return n.onSuccess([l.getTrackId(),u.getTrackId()]),zS.info("create screen video track success","video:",l.getTrackId(),"audio:",u.getTrackId()),[l,u]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=iT.reportApiInvoke(null,{tag:sv.TRACER,name:ov.CREATE_MIC_AND_CAM_TRACKS,options:[e,t]}),r="720p_auto"===t.encoderConfig,i=nI(t),o=rI(e),s=Uv(8,"track-mic-"),a=Uv(8,"track-cam-");let c=null,l=null;zS.info("start create camera video track(".concat(a,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const e=await CR({audio:o,video:i},"".concat(s,"-").concat(a));c=e.getAudioTracks()[0],l=e.getVideoTracks()[0]}catch(e){throw n.onError(e),e}if(!c||!l){const e=new FE(UE.UNEXPECTED_ERROR,"can not find tracks in media stream");return n.onError(e),e.throw(zS)}t.optimizationMode&&wI(a,l,t,RC(t.encoderConfig));const u=new $R(c,e,o,s),d=new bI(l,t,i,t.scalabiltyMode?OC(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a);return r&&d.startMonitorStats(),n.onSuccess([u.getTrackId(),d.getTrackId()]),zS.info("create camera video track(".concat(a,") and microphone audio track(").concat(s,") success")),[u,d]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=iT.reportApiInvoke(null,{tag:sv.TRACER,name:ov.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=rI(e),r=Uv(8,"track-mic-");let i=null;zS.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{i=(await CR({audio:n},r)).getAudioTracks()[0]||null}catch(e){throw t.onError(e),e}if(!i){const e=new FE(UE.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(e),e.throw(zS)}const o=new $R(i,e,n,r);return t.onSuccess(o.getTrackId()),zS.info("create microphone audio track success, trackId:",r),o},createCustomAudioTrack:function(e){const t=iT.reportApiInvoke(null,{tag:sv.TRACER,name:ov.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new QR(e.mediaStreamTrack,e.encoderConfig?NC(e.encoderConfig):{},Uv(8,"track-cus-"),!1,!0);return zS.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const o={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":i,cacheOnlineFile:n,encoderConfig:r},s=iT.reportApiInvoke(null,{tag:sv.TRACER,name:ov.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(LS("DISABLE_WEBAUDIO"))throw new FE(UE.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const a=Uv(8,"track-buf-");zS.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",a);const c=i;if(!(i instanceof AudioBuffer))try{i=await sI(i,n)}catch(e){return s.onError(e),e.throw(zS)}const l=new iI(i),u=new eI(c,l,r?NC(r):{},a);return zS.info("create buffer source audio track success, trackId:",a),s.onSuccess(u.getTrackId()),u},setAppType:function(e){if(zS.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw zS.debug("Invalid appType"),new UT(UE.INVALID_PARAMS,"invalid app type",e);DS("APP_TYPE",Math.floor(e))},setLogLevel:function(e){zS.setLogLevel(e)},enableLogUpload:function(){LS("USE_NEW_LOG")?DS("UPLOAD_LOG",!0):zS.enableLogUpload()},disableLogUpload:function(){LS("USE_NEW_LOG")?DS("UPLOAD_LOG",!1):zS.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new RP},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=iT.reportApiInvoke(null,{tag:sv.TRACER,name:ov.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof QR||e instanceof AI)){const e=new UT(UE.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof QR?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let o=i,s=i;const a=Date.now();return new tE((i=>{const c=setInterval((()=>{const l=e.getVolumeLevel();o=l>o?l:o,s=l<s?l:s;const u=o-s>1e-4,d=Date.now()-a;if(u||d>t){clearInterval(c);const t=u,s={duration:d,deviceLabel:r,maxVolumeLevel:o,result:t};zS.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(s))),n.onSuccess(s),i(t)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=iT.reportApiInvoke(null,{tag:sv.TRACER,name:ov.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof yI||e instanceof OI)){const e=new UT(UE.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof yI?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(yE()||gE())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([i]),o.play();const s=document.createElement("canvas");s.width=160,s.height=120;let a=0,c=0;try{const e=Date.now();a=await function(e,t,n,r){let i,o=0,s=null;return new tE(((a,c)=>{function l(){o>r&&i&&(i(),a(o));const t=n.getContext("2d");if(!t){const e=new UT(UE.UNEXPECTED_ERROR,"can not get canvas 2d context.");return zS.error(e.toString()),void c(e)}t.drawImage(e,0,0,160,120);const l=t.getImageData(0,0,n.width,n.height),u=Math.floor(l.data.length/3);if(s){for(let e=0;e<u;e+=3)if(l.data[e]!==s[e])return o+=1,void(s=l.data);s=l.data}else s=l.data}setTimeout((()=>{i&&(i(),a(o))}),t),i=hR((()=>{l()}),30)}))}(o,t,s,4),c=Date.now()-e}catch(e){throw n.onError(e),e}qx===cE.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;const l=a>4,u={duration:c,changedPicNum:a,deviceLabel:r,result:l};return zS.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(u))),n.onSuccess(u),l},setArea:Kk,audioElementPlayCenter:UR,processExternalMediaAEC:function(e){Xx.processExternalMediaAEC(e)},registerExtensions:function(e){e.forEach((e=>{const t=e;t.__registered__=!0,t.logger.hookLog=zS.extLog,t.reporter.hookApiInvoke=iT.extApiInvoke,t.parameters&&Object.keys(t.parameters).forEach((e=>{t.parameters[e]=LS(e)}))}))},ChannelMediaRelayError:QT,ChannelMediaRelayEvent:JT,ChannelMediaRelayState:XT,RemoteStreamFallbackType:UC,RemoteStreamType:MC,ConnectionDisconnectedReason:cv,AudienceLatencyLevelType:av,AREAS:iw});return Object.defineProperties(nM,{onAudioAutoplayFailed:{get:()=>kR.onAudioAutoplayFailed,set:e=>{kR.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>kR.onAutoplayFailed,set:e=>{kR.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>nM._onSecurityPolicyViolation,set(e){nM._onSecurityPolicyViolation=e,tM(e)}},__CLIENT_LIST__:{get:()=>LS("SHOW_GLOBAL_CLIENT_LIST")?cT:[]}}),AR.on(XC.CAMERA_DEVICE_CHANGED,(e=>{zS.info("camera device changed",JSON.stringify(e)),nM.onCameraChanged&&nM.onCameraChanged(e),nM.safeEmit(Tw.CAMERA_CHANGED,e)})),AR.on(XC.RECORDING_DEVICE_CHANGED,(e=>{zS.info("microphone device changed",JSON.stringify(e)),nM.onMicrophoneChanged&&nM.onMicrophoneChanged(e),nM.safeEmit(Tw.MICROPHONE_CHANGED,e)})),AR.on(XC.PLAYOUT_DEVICE_CHANGED,(e=>{zS.debug("playout device changed",JSON.stringify(e)),nM.onPlaybackDeviceChanged&&nM.onPlaybackDeviceChanged(e),nM.safeEmit(Tw.PLAYBACK_DEVICE_CHANGED,e)})),UR.onAutoplayFailed=()=>{zS.info("detect audio element autoplay failed"),kR.onAudioAutoplayFailed&&kR.onAudioAutoplayFailed()},sR.on("autoplay-failed",(()=>{zS.info("detect webaudio autoplay failed"),kR.onAudioAutoplayFailed&&kR.onAudioAutoplayFailed(),nM.safeEmit(Tw.AUTOPLAY_FAILED)})),bv.on(hv.NETWORK_STATE_CHANGE,((e,t)=>{zS.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=nM),nM}()},1197:function(module,__unused_webpack_exports,__webpack_require__){"use strict";var t;module=__webpack_require__.nmd(module),t=function(){function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ua(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sl(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function J(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){function o(e){sl(a,r,i,o,s,"next",e)}function s(e){sl(a,r,i,o,s,"throw",e)}var a=e.apply(t,n);o(void 0)}))}}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ha(e,t,n){return t&&tl(e.prototype,t),n&&tl(e,n),e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function la(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&df(e,t)}function wd(e){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function df(e,t){return(df=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ul(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Sh(e,t,n){return(Sh=ul()?Reflect.construct:function(e,t,n){var r=[null];return r.push.apply(r,t),e=new(Function.bind.apply(e,r)),n&&df(e,n.prototype),e}).apply(null,arguments)}function ef(e){var t="function"==typeof Map?new Map:void 0;return(ef=function(e){function n(){return Sh(e,arguments,wd(this).constructor)}if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),df(n,e)})(e)}function ff(e,t){if(null==e)return{};if(null==e)var n={};else{n={};var r,i=Object.keys(e);for(r=0;r<i.length;r++){var o=i[r];0<=t.indexOf(o)||(n[o]=e[o])}}if(Object.getOwnPropertySymbols)for(r=Object.getOwnPropertySymbols(e),o=0;o<r.length;o++)i=r[o],0<=t.indexOf(i)||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i]);return n}function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ma(e){var t=ul();return function(){var r=wd(e);if(t){var i=wd(this).constructor;r=Reflect.construct(r,arguments,i)}else r=r.apply(this,arguments);return!r||"object"!=typeof r&&"function"!=typeof r?n(this):r}}function Th(e,t,n){return(Th="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wd(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}function ra(e,t){var n=Array.isArray(e)?e:void 0;if(!n)if(null==(n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"])))n=void 0;else{var r,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0;var a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}n=i}if(!(e=n||vl(e,t)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function G(e){var t=Array.isArray(e)?Uh(e):void 0;if(t||(t="undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"]?Array.from(e):void 0),!(e=t||vl(e)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function vl(e,t){if(e){if("string"==typeof e)return Uh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Uh(e,t)}}function Uh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function fa(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function $a(e){var t={exports:{}};return e(t,t.exports),t.exports}function wl(e,t){var n,r=3>arguments.length?e:arguments[2];return va(e)===r?e[t]:(n=Fb.f(e,t))?Q(n,"value")?n.value:void 0===n.get?void 0:n.get.call(r):ha(n=Vb(e))?wl(n,t,r):void 0}function rs(e){var t=e.charCodeAt(0)<<24,n=0|ss(~t),r=0,i=0|e.length,o="";if(5>n&&i>=n){for(t=t<<n>>>24+n,r=1;r<n;r=r+1|0)t=t<<6|63&e.charCodeAt(r);65535>=t?o+=xd(t):1114111>=t?o+=xd(55296+((t=t-65536|0)>>10)|0,56320+(1023&t)|0):r=0}for(;r<i;r=r+1|0)o+="\ufffd";return o}function xl(){}function ts(e){var t=0|e.charCodeAt(0);if(55296<=t&&56319>=t){var n=0|e.charCodeAt(1);if(!(n==n&&56320<=n&&57343>=n))return xd(239,191,189);if(65535<(t=(t-55296<<10)+n-56320+65536|0))return xd(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}return 127>=t?e:2047>=t?xd(192|t>>>6,128|63&t):xd(224|t>>>12,128|t>>>6&63,128|63&t)}function yl(){}function ea(){ea.init.call(this)}function ng(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+X(e))}function zl(e,t,n,r){ng(n);var i=e._events;if(void 0===i)i=e._events=Object.create(null),e._eventsCount=0;else{void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events);var o=i[t]}return void 0===o?(i[t]=n,++e._eventsCount):("function"==typeof o?o=i[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),0<(n=void 0===e._maxListeners?ea.defaultMaxListeners:e._maxListeners)&&o.length>n&&!o.warned&&(o.warned=!0,(n=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=o.length,console&&console.warn&&console.warn(n))),e}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(e,t,n){return e={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},(t=us.bind(e)).listener=n,e.wrapFn=t}function Bl(e,t,n){if(void 0===(e=e._events))return[];if(void 0===(t=e[t]))return[];if("function"==typeof t)return n?[t.listener||t]:[t];if(n)for(n=Array(t.length),e=0;e<n.length;++e)n[e]=t[e].listener||t[e];else n=Cl(t,t.length);return n}function Dl(e){var t=this._events;if(void 0!==t){if("function"==typeof(e=t[e]))return 1;if(void 0!==e)return e.length}return 0}function Cl(e,t){for(var n=Array(t),r=0;r<t;++r)n[r]=e[r];return n}function vs(e,t,n){"function"==typeof e.on&&El(e,"error",t,n)}function El(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(e));e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}function ws(e){return e?G(e):xs((function(){return[]}),(function(e,t){return e.push(t),e}))}function Fl(e,t){var n,r,i,o;return w.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:n=Gl(e)([Hl,Hl,function(e,t){return t}])[2],r=0;case 2:if(!(r<t.length)){s.next=17;break}if(i=t[r],!((o=n(Vh,i))instanceof og)){s.next=11;break}if((o=Wh(o.deref()))===Vh){s.next=10;break}return s.next=10,o;case 10:return s.abrupt("return");case 11:if(o===Vh){s.next=14;break}return s.next=14,o;case 14:r++,s.next=2;break;case 17:case"end":return s.stop()}}),ys)}function pg(e,t){return null!=t&&"function"==typeof t[Symbol.iterator]?Fl(pg(e),t):function(t){var n=t[2];return zs(t,(function(t,r){return n(t,e(r))}))}}function Ac(e){return Object.prototype.toString.call(e).slice(8,-1)}function yd(e){return"Object"===Ac(e)&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function Il(e){var t;return(t="Boolean"===Ac(e)||"Null"===Ac(e)||"Undefined"===Ac(e))||(t="Number"===Ac(e)&&!isNaN(e)),t||"String"===Ac(e)||"Symbol"===Ac(e)}function zd(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ce(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function de(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function gf(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new qg;++t<n;)this.add(e[t])}function ee(e){this.size=(this.__data__=new rg(e)).size}function fe(e,t,n,r,i,o){var s,a=1&t,c=2&t,l=4&t;if(n&&(s=i?n(e,r,i,o):n(e)),void 0!==s)return s;if(!lb(e))return e;if(r=Va(e)){if(s=As(e),!a)return Xh(e,s)}else{var u=hf(e),d="[object Function]"==u||"[object GeneratorFunction]"==u;if(jf(e))return Jl(e,a);if("[object Object]"==u||"[object Arguments]"==u||d&&!i){if(s=c||d?{}:Kl(e),!a)return c?Bs(e,Cs(s,e)):Ds(e,Es(s,e))}else{if(!wa[u])return i?e:{};s=Fs(e,u,a)}}if(o||(o=new ge),i=o.get(e))return i;o.set(e,s),Gs(e)?e.forEach((function(r){s.add(fe(r,t,n,r,e,o))})):Hs(e)&&e.forEach((function(r,i){s.set(i,fe(r,t,n,i,e,o))})),c=l?c?Ll:Yh:c?kf:Ad;var h=r?void 0:c(e);return Is(h||e,(function(r,i){h&&(r=e[i=r]),Ml(s,i,fe(r,t,n,i,e,o))})),s}function Zh(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;return o.has(i)?o.get(i):(r=e.apply(this,r),n.cache=o.set(i,r)||o,r)};return n.cache=new(Zh.Cache||qg),n}function Nl(e){if("string"==typeof e)return e;if(Va(e))return he(e,Nl)+"";if(ie(e))return Ol?Ol.call(e):"";var t=e+"";return"0"==t&&1/e==-Js?"-0":t}function $h(e,t,n,r,i){var o=-1,s=e.length;for(n||(n=Ks),i||(i=[]);++o<s;){var a=e[o];0<t&&n(a)?1<t?$h(a,t-1,n,r,i):ai(i,a):r||(i[i.length]=a)}return i}function je(e,t,n,r,i){if(e===t)t=!0;else if(null==e||null==t||!gc(e)&&!gc(t))t=e!=e&&t!=t;else e:{var o=Va(e),s=Va(t),a=o?"[object Array]":hf(e),c=s?"[object Array]":hf(t),l="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a);if(s="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),(c=a==c)&&jf(e)){if(!jf(t)){t=!1;break e}o=!0,l=!1}if(c&&!l)i||(i=new ge),t=o||bi(e)?Pl(e,t,n,r,je,i):Ls(e,t,a,n,r,je,i);else{if(!(1&n)&&(o=l&&Ql.call(e,"__wrapped__"),a=s&&Ql.call(t,"__wrapped__"),o||a)){e=o?e.value():e,t=a?t.value():t,i||(i=new ge),t=je(e,t,n,r,i);break e}if(c)t:if(i||(i=new ge),o=1&n,a=Yh(e),s=a.length,c=Yh(t).length,s==c||o){for(c=s;c--;){var u=a[c];if(!(o?u in t:Ms.call(t,u))){t=!1;break t}}if(l=i.get(e),u=i.get(t),l&&u)t=l==t&&u==e;else{l=!0,i.set(e,t),i.set(t,e);for(var d=o;++c<s;){var h=e[u=a[c]],p=t[u];if(r)var f=o?r(p,h,u,t,e,i):r(h,p,u,e,t,i);if(void 0===f?h!==p&&!je(h,p,n,r,i):!f){l=!1;break}d||(d="constructor"==u)}l&&!d&&(n=e.constructor)!=(r=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof n&&n instanceof n&&"function"==typeof r&&r instanceof r)&&(l=!1),i.delete(e),i.delete(t),t=l}}else t=!1;else t=!1}}return t}function xa(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function mb(e){return!0===(e&&e.__isLong__)}function Bd(e,t){var n;if(t){if((t=0<=(e>>>=0)&&256>e)&&(n=Rl[e]))return n;n=ya(e,0>(0|e)?-1:0,!0),t&&(Rl[e]=n)}else{if((t=-128<=(e|=0)&&128>e)&&(n=Sl[e]))return n;n=ya(e,0>e?-1:0,!1),t&&(Sl[e]=n)}return n}function Gb(e,t){if(isNaN(e))return t?Cd:Hb;if(t){if(0>e)return Cd;if(e>=Tl)return Ul}else{if(e<=-Vl)return nb;if(e+1>=Vl)return Wl}return 0>e?Gb(-e,t).neg():ya(e%ke|0,e/ke|0,t)}function ya(e,t,n){return new xa(e,t,n)}function ci(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return Hb;if("number"==typeof t?(n=t,t=!1):t=!!t,2>(n=n||10)||36<n)throw RangeError("radix");var r;if(0<(r=e.indexOf("-")))throw Error("interior hyphen");if(0===r)return ci(e.substring(1),t,n).neg();r=Gb(sg(n,8));for(var i=Hb,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),a=parseInt(e.substring(o,o+s),n);8>s?(s=Gb(sg(n,s)),i=i.mul(s).add(Gb(a))):i=(i=i.mul(r)).add(Gb(a))}return i.unsigned=t,i}function Wb(e,t){return"number"==typeof e?Gb(e,t):"string"==typeof e?ci(e,t):ya(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}function O(e,t){function n(){this.constructor=e}di(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function le(e){return"function"==typeof e}function me(e){setTimeout((function(){throw e}),0)}function ei(e){return null!==e&&"object"===X(e)}function Xl(e){return e.reduce((function(e,t){return e.concat(t instanceof lf?t.errors:t)}),[])}function fi(e){for(;e;){var t=e.destination,n=e.isStopped;if(e.closed||n)return!1;e=t&&t instanceof ia?t:null}return!0}function Yc(e){return e}function gi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Yl(e)}function Yl(e){return 0===e.length?Yc:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}function Zl(e){if(e||(e=Ib.Promise||Promise),!e)throw Error("no Promise impl found");return e}function $l(){return function(e){return e.lift(new Ns(e))}}function mf(e){return e?Os(e):vb}function Os(e){return new Y((function(t){return e.schedule((function(){return t.complete()}))}))}function Zc(e){return e&&"function"==typeof e.schedule}function hi(e,t){return new Y((function(n){var r=new Oa,i=0;return r.add(t.schedule((function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||r.add(this.schedule()))}))),r}))}function nf(e,t){return t?hi(e,t):new Y(am(e))}function bb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Zc(t=e[e.length-1])?(e.pop(),hi(e,t)):nf(e)}function Z(e,t){return new Y(t?function(n){return t.schedule(Ps,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function Ps(e){e.subscriber.error(e.error)}function Qs(e,t){return void 0===t&&(t=0),function(n){return n.lift(new Rs(e,t))}}function bm(e){return e in ii&&(delete ii[e],!0)}function hc(){}function ba(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Ss(e,t))}}function cm(e,t,n){if(t){if(!Zc(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return cm(e,n).apply(void 0,r).pipe(ba((function(e){return Jb(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i,o=this,s={context:o,subject:i,callbackFunc:e,scheduler:n};return new Y((function(r){if(n)return n.schedule(Ts,0,{args:t,subscriber:r,params:s});if(!i){i=new of;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.next(1>=e.length?e[0]:e),i.complete()}]))}catch(e){fi(i)?i.error(e):console.warn(e)}}return i.subscribe(r)}))}}function Ts(e){var t=this,n=e.args,r=e.subscriber,i=e.params;e=i.callbackFunc;var o=i.context,s=i.scheduler,a=i.subject;if(!a){a=i.subject=new of,i=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.add(s.schedule(Us,0,{value:1>=e.length?e[0]:e,subject:a}))};try{e.apply(o,n.concat([i]))}catch(e){a.error(e)}}this.add(a.subscribe(r))}function Us(e){var t=e.subject;t.next(e.value),t.complete()}function dm(e,t,n){if(t){if(!Zc(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return dm(e,n).apply(void 0,r).pipe(ba((function(e){return Jb(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new Y((function(r){var o=i.context,s=i.subject;if(n)return n.schedule(Vs,0,{params:i,subscriber:r,context:o});if(!s){s=i.subject=new of;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(t=e.shift())?s.error(t):(s.next(1>=e.length?e[0]:e),s.complete())}]))}catch(e){fi(s)?s.error(e):console.warn(e)}}return s.subscribe(r)}))}}function Vs(e){var t=this,n=e.params,r=e.subscriber;e=e.context;var i=n.callbackFunc,o=n.args,s=n.scheduler,a=n.subject;if(!a){a=n.subject=new of,n=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(n=e.shift())?t.add(s.schedule(em,0,{err:n,subject:a})):t.add(s.schedule(Ws,0,{value:1>=e.length?e[0]:e,subject:a}))};try{i.apply(e,o.concat([n]))}catch(e){this.add(s.schedule(em,0,{err:e,subject:a}))}}this.add(a.subscribe(r))}function Ws(e){var t=e.subject;t.next(e.value),t.complete()}function em(e){e.subject.error(e.err)}function fm(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}function ji(e,t,n,r,i){if(void 0===i&&(i=new Xs(e,n,r)),!i.closed)return t instanceof Y?t.subscribe(i):pf(t)(i)}function Ys(e,t){return new Y((function(n){var r=new Oa;return r.add(t.schedule((function(){var i=e[ne]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}function Zs(e,t){return new Y((function(n){var r=new Oa;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}function $s(e,t){if(!e)throw Error("Iterable cannot be null");return new Y((function(n){var r,i=new Oa;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(t.schedule((function(){r=e[$c](),i.add(t.schedule((function(){if(!n.closed){try{var e=r.next(),t=e.value,i=e.done}catch(e){return void n.error(e)}i?n.complete():(n.next(t),this.schedule())}})))}))),i}))}function gm(e,t){if(null!=e){if(e&&"function"==typeof e[ne])return Ys(e,t);if(fm(e))return Zs(e,t);if(hm(e))return hi(e,t);if(e&&"function"==typeof e[$c]||"string"==typeof e)return $s(e,t)}throw new TypeError((null!==e&&X(e)||e)+" is not observable")}function Kb(e,t){return t?gm(e,t):e instanceof Y?e:new Y(pf(e))}function ic(e,t){if(!t.closed){if(e instanceof Y)return e.subscribe(t);try{var n=pf(e)(t)}catch(e){t.error(e)}return n}}function cb(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(cb((function(n,r){return Kb(e(n,r)).pipe(ba((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new at(e,n))})}function tg(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),cb(Yc,e)}function im(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return tg(1)(bb.apply(void 0,e))}function ad(e){return new Y((function(t){try{var n=e()}catch(e){return void t.error(e)}return(n?Kb(n):mf()).subscribe(t)}))}function jm(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(Jb(n))return ug(n,null);if(ei(n)&&Object.getPrototypeOf(n)===Object.prototype)return ug((e=Object.keys(n)).map((function(e){return n[e]})),e)}if("function"==typeof e[e.length-1]){var r=e.pop();return ug(e=1===e.length&&Jb(e[0])?e[0]:e,null).pipe(ba((function(e){return r.apply(void 0,e)})))}return ug(e,null)}function ug(e,t){return new Y((function(n){var r=e.length;if(0===r)n.complete();else for(var i=Array(r),o=0,s=0,a=function(a){var c=Kb(e[a]),l=!1;n.add(c.subscribe({next:function(e){l||(l=!0,s++),i[a]=e},error:function(e){return n.error(e)},complete:function(){++o!==r&&l||(s===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=i[n],e}),{}):i),n.complete())}}))},c=0;c<r;c++)a(c)}))}function gb(e,t,n,r){return le(n)&&(r=n,n=void 0),r?gb(e,t,n).pipe(ba((function(e){return Jb(e)?r.apply(void 0,e):r(e)}))):new Y((function(r){km(e,t,(function(e){1<arguments.length?r.next(Array.prototype.slice.call(arguments)):r.next(e)}),r,n)}))}function km(e,t,n,r,i){if(e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener){e.addEventListener(t,n,i);var o=function(){return e.removeEventListener(t,n,i)}}else if(e&&"function"==typeof e.on&&"function"==typeof e.off)e.on(t,n),o=function(){return e.off(t,n)};else if(e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener)e.addListener(t,n),o=function(){return e.removeListener(t,n)};else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var s=0,a=e.length;s<a;s++)km(e[s],t,n,r,i)}r.add(o)}function lm(e,t,n){return n?lm(e,t).pipe(ba((function(e){return Jb(e)?n.apply(void 0,e):n(e)}))):new Y((function(n){var r=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{var i=e(r)}catch(e){return void n.error(e)}if(le(t))return function(){return t(r,i)}}))}function bt(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(e){return void t.error(e)}if(!r)return void t.complete();if(t.closed)return}try{var i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function ki(e){return!Jb(e)&&0<=e-parseFloat(e)+1}function mm(e,t){return void 0===e&&(e=0),void 0===t&&(t=bd),(!ki(e)||0>e)&&(e=0),t&&"function"==typeof t.schedule||(t=bd),new Y((function(n){return n.add(t.schedule(ct,e,{subscriber:n,counter:0,period:e})),n}))}function ct(e){var t=e.subscriber,n=e.counter;e=e.period,t.next(n),this.schedule({subscriber:t,counter:n+1,period:e},e)}function Xb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];t=Number.POSITIVE_INFINITY;var n=null,r=e[e.length-1];return Zc(r)?(n=e.pop(),1<e.length&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof r&&(t=e.pop()),null===n&&1===e.length&&e[0]instanceof Y?e[0]:tg(t)(nf(e,n))}function li(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return vb;var n=e[0],r=e.slice(1);return 1===e.length&&Jb(n)?li.apply(void 0,n):new Y((function(e){var t=function(){return e.add(li.apply(void 0,r).subscribe(e))};return Kb(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})}))}function dt(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription;if(e=e.obj,!r.closed)if(n<t.length){var o=t[n];r.next([o,e[o]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:e}))}else r.complete()}function et(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}function wb(e,t){return function(n){return n.lift(new ft(e,t))}}function Ca(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!Jb(e[0]))return e[0];e=e[0]}return nf(e,void 0).lift(new gt)}function ht(e){var t=e.start,n=e.index,r=e.subscriber;n>=e.count?r.complete():(r.next(t),r.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}function Bc(e,t,n){void 0===e&&(e=0);var r=-1;return ki(t)?r=1>Number(t)?1:Number(t):Zc(t)&&(n=t),Zc(n)||(n=bd),new Y((function(t){var i=ki(e)?e:+e-n.now();return n.schedule(it,i,{index:0,period:r,subscriber:t})}))}function it(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}function mi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"function"==typeof(t=e[e.length-1])&&e.pop(),nf(e,void 0).lift(new jt(t))}function Ga(e){return function(t){var n=new kt(e);return t=t.lift(n),n.caught=t}}function ni(e,t){return cb(e,t,1)}function nm(e){return void 0===e&&(e=null),function(t){return t.lift(new lt(e))}}function cd(e,t){void 0===t&&(t=bd);var n=e instanceof Date&&!isNaN(+e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new mt(n,t))}}function om(e,t){return function(n){return n.lift(new nt(e,t))}}function Dd(e){return void 0===e&&(e=ot),function(t){return t.lift(new pt(e))}}function ot(){return new vg}function Ka(e){return function(t){return 0===e?mf():t.lift(new qt(e))}}function pm(e,t){return t?function(n){return n.pipe(pm((function(n,r){return Kb(e(n,r)).pipe(ba((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new rt(e))}}function wg(e){return function(t){return t.lift(new st(e))}}function aa(e,t){var n=2<=arguments.length;return function(r){return r.pipe(e?wb((function(t,n){return e(t,n,r)})):Yc,Ka(1),n?nm(t):Dd((function(){return new vg})))}}function tt(){return function(e){return e.lift(new ut)}}function qm(e){return function(t){return 0===e?mf():t.lift(new vt(e))}}function qf(e){return function(t){return t.lift(new wt(e))}}function xg(e,t){var n=!1;return 2<=arguments.length&&(n=!0),function(r){return r.lift(new xt(e,t,n))}}function rm(e,t){return 2<=arguments.length?function(n){return gi(xg(e,t),qm(1),nm(t))(n)}:function(t){return gi(xg((function(t,n,r){return e(t,n,r+1)})),qm(1))(t)}}function yt(e,t){return function(n){var r="function"==typeof e?e:function(){return e};if("function"==typeof t)return n.lift(new zt(r,t));var i=Object.create(n,At);return i.source=n,i.subjectFactory=r,i}}function oe(e){return function(t){return t.lift(new Bt(e,t))}}function Ct(){return new Pa}function pe(){return function(e){return $l()(yt(Ct)(e))}}function sm(e,t,n){var r=e&&"object"===X(e)?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n};return function(e){return e.lift(Dt(r))}}function Dt(e){var t,n,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=void 0===(r=e.windowTime)?Number.POSITIVE_INFINITY:r,s=e.refCount,a=e.scheduler,c=0,l=!1,u=!1;return function(e){if(c++,!t||l){l=!1;var r=(t=new qe(i,o,a)).subscribe(this);n=e.subscribe({next:function(e){t.next(e)},error:function(e){l=!0,t.error(e)},complete:function(){u=!0,n=void 0,t.complete()}}),u&&(n=void 0)}else r=t.subscribe(this);this.add((function(){c--,r.unsubscribe(),r=void 0,n&&!u&&s&&0===c&&(n.unsubscribe(),t=n=void 0)}))}}function Cc(e,t){return"function"==typeof t?function(n){return n.pipe(Cc((function(n,r){return Kb(e(n,r)).pipe(ba((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new Et(e))}}function ob(e){return function(t){return t.lift(new Ft(e))}}function Gt(e,t){return void 0===t&&(t=!1),function(n){return n.lift(new Ht(e,t))}}function ca(e,t,n){return function(r){return r.lift(new It(e,t,n))}}function Jt(e,t,n){return void 0===t&&(t=bd),void 0===n&&(n=Kt),function(r){return r.lift(new Lt(e,t,n.leading,n.trailing))}}function Mt(e){e.subscriber.clearThrottle()}function Nt(e,t,n){return void 0===n&&(n=bd),function(r){var i=e instanceof Date&&!isNaN(+e),o=i?+e-n.now():Math.abs(e);return r.lift(new Ot(o,i,t,n))}}function hb(e,t){return void 0===t&&(t=bd),Nt(e,Z(new pb),t)}function Pt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;return"function"==typeof e[e.length-1]&&(n=e.pop()),t.lift(new Qt(e,n))}}function tm(e,t,n,r,i){e!==t&&um(t,(function(o,s){if(i||(i=new ge),lb(o)){o=i;var a=oi(e,s),c=oi(t,s),l=o.get(c);if(l)pi(e,s,l);else{var u=void 0===(l=r?r(a,c,s+"",e,t,o):void 0);if(u){var d=Va(c),h=!d&&jf(c),p=!d&&!h&&bi(c);l=c,d||h||p?Va(a)?l=a:gc(a)&&Ed(a)?l=Xh(a):h?(u=!1,l=Jl(c,!0)):p?(u=!1,l=vm(c,!0)):l=[]:wm(c)||rf(c)?(l=a,rf(a)?l=re(a,kf(a)):lb(a)&&!qi(a)||(l=Kl(c))):u=!1}u&&(o.set(c,l),tm(l,c,n,r,o),o.delete(c)),pi(e,s,l)}}else void 0===(a=r?r(oi(e,s),o,s+"",e,t,i):void 0)&&(a=o),pi(e,s,a)}),kf)}function Rt(e){var t=1,n=ri;1==(1>=arguments.length?0:arguments.length-1)?"number"==typeof(1>=arguments.length?void 0:arguments[1])?t=1>=arguments.length?void 0:arguments[1]:n=1>=arguments.length?void 0:arguments[1]:2==(1>=arguments.length?0:arguments.length-1)&&(t=1>=arguments.length?void 0:arguments[1],n=2>=arguments.length?void 0:arguments[2]);var r=t||1;return function(t){return t.pipe(xg((function(t,i){var o=n.now(),s=o-e;if((t=t.filter((function(e){return e.until>s}))).length>=r){var a=t[t.length-1],c=t[0].until+e*Math.floor(t.length/r);t.push({delay:a.until<o?c-o:c-a.until,until:c,value:i})}else t.push({delay:0,until:o,value:i});return t}),[]),ba((function(e){return e[e.length-1]})),ni((function(e){var t=bb(e.value);return e.delay?t.pipe(cd(e.delay,n)):t})))}}function St(e,t){var n=(t=void 0===t?{protocols:xm,makeWebSocket:ym}:t).protocols,r=void 0===n?xm:n,i=void 0===(t=t.makeWebSocket)?ym:t;return new Y((function(t){var n,o=new Pa,s=i(e,r),a=!1,c=!1,l=function(e){if(n)throw a=!0,e=Error("Web socket message factory function called more than once"),t.error(e),e;return n=e.subscribe((function(e){s.send(e)})),o};return s.onopen=function(){c?(a=!0,s.close()):t.next(l)},s.onmessage=function(e){o.next(e.data)},s.onerror=function(e){a=!0,t.error(Error(e.message))},s.onclose=function(e){a||(a=!0,c?(t.complete(),o.complete()):t.error(Error(1e3===e.code?"Normal closure":e.reason)))},function(){c=!0,n&&n.unsubscribe(),a||(a=!0,s.close())}}))}function yg(){this._listeners={}}function zm(e){return"undefined"!=typeof Float32Array?function(){function t(e,t,n){o[0]=e,t[n]=s[0],t[n+1]=s[1],t[n+2]=s[2],t[n+3]=s[3]}function n(e,t,n){o[0]=e,t[n]=s[3],t[n+1]=s[2],t[n+2]=s[1],t[n+3]=s[0]}function r(e,t){return s[0]=e[t],s[1]=e[t+1],s[2]=e[t+2],s[3]=e[t+3],o[0]}function i(e,t){return s[3]=e[t],s[2]=e[t+1],s[1]=e[t+2],s[0]=e[t+3],o[0]}var o=new Float32Array([-0]),s=new Uint8Array(o.buffer),a=128===s[3];e.writeFloatLE=a?t:n,e.writeFloatBE=a?n:t,e.readFloatLE=a?r:i,e.readFloatBE=a?i:r}():function(){function t(e,t,n,r){var i=0>t?1:0;if(i&&(t=-t),0===t)e(0<1/t?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(34028234663852886e22<t)e((i<<31|2139095040)>>>0,n,r);else if(11754943508222875e-54>t)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){return n=e(t,n),e=2*(n>>31)+1,t=n>>>23&255,n&=8388607,255===t?n?NaN:1/0*e:0===t?1401298464324817e-60*e*n:e*Math.pow(2,t-150)*(n+8388608)}e.writeFloatLE=t.bind(null,Am),e.writeFloatBE=t.bind(null,Bm),e.readFloatLE=n.bind(null,Cm),e.readFloatBE=n.bind(null,Dm)}(),"undefined"!=typeof Float64Array?function(){function t(e,t,n){o[0]=e,t[n]=s[0],t[n+1]=s[1],t[n+2]=s[2],t[n+3]=s[3],t[n+4]=s[4],t[n+5]=s[5],t[n+6]=s[6],t[n+7]=s[7]}function n(e,t,n){o[0]=e,t[n]=s[7],t[n+1]=s[6],t[n+2]=s[5],t[n+3]=s[4],t[n+4]=s[3],t[n+5]=s[2],t[n+6]=s[1],t[n+7]=s[0]}function r(e,t){return s[0]=e[t],s[1]=e[t+1],s[2]=e[t+2],s[3]=e[t+3],s[4]=e[t+4],s[5]=e[t+5],s[6]=e[t+6],s[7]=e[t+7],o[0]}function i(e,t){return s[7]=e[t],s[6]=e[t+1],s[5]=e[t+2],s[4]=e[t+3],s[3]=e[t+4],s[2]=e[t+5],s[1]=e[t+6],s[0]=e[t+7],o[0]}var o=new Float64Array([-0]),s=new Uint8Array(o.buffer),a=128===s[7];e.writeDoubleLE=a?t:n,e.writeDoubleBE=a?n:t,e.readDoubleLE=a?r:i,e.readDoubleBE=a?i:r}():function(){function t(e,t,n,r,i,o){var s=0>r?1:0;if(s&&(r=-r),0===r)e(0,i,o+t),e(0<1/r?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(17976931348623157e292<r)e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+n);else if(22250738585072014e-324>r)e((r/=5e-324)>>>0,i,o+t),e((s<<31|r/4294967296)>>>0,i,o+n);else{var a=Math.floor(Math.log(r)/Math.LN2);1024===a&&(a=1023),e(4503599627370496*(r*=Math.pow(2,-a))>>>0,i,o+t),e((s<<31|a+1023<<20|1048576*r&1048575)>>>0,i,o+n)}}function n(e,t,n,r,i){return t=e(r,i+t),r=e(r,i+n),e=2*(r>>31)+1,t=4294967296*(1048575&r)+t,2047===(n=r>>>20&2047)?t?NaN:1/0*e:0===n?5e-324*e*t:e*Math.pow(2,n-1075)*(t+4503599627370496)}e.writeDoubleLE=t.bind(null,Am,0,4),e.writeDoubleBE=t.bind(null,Bm,4,0),e.readDoubleLE=n.bind(null,Cm,0,4),e.readDoubleBE=n.bind(null,Dm,4,0)}(),e}function Am(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function Bm(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function Cm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function Dm(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function Wa(e,t){this.lo=e>>>0,this.hi=t>>>0}function sf(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function si(){}function Tt(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(e,t,n){t[n]=255&e}function ui(e,t){this.len=e,this.next=void 0,this.val=t}function vi(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[n++]=127&e.lo|128,e.lo>>>=7;t[n++]=e.lo}function wi(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function jc(){xi.call(this)}function Ut(e,t,n){40>e.length?V.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}function Yb(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function La(e){this.buf=e,this.pos=0,this.len=e.length}function yi(){var e=new Em(0,0),t=0;if(!(4<this.len-this.pos)){for(;3>t;++t){if(this.pos>=this.len)throw Yb(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;4>t;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;if(t=0,4<this.len-this.pos){for(;5>t;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}else for(;5>t;++t){if(this.pos>=this.len)throw Yb(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}throw Error("invalid varint encoding")}function zg(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(e){zi.call(this,e)}function tf(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}function za(e){return"string"==typeof e&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e)&&"null"!==e}function Gm(e){try{var t=e.split(".").map((function(e){return Number(e)}))}catch(e){return!1}if(4!==t.length||0===t[0])return!1;for(e=0;e<t.length;e++){var n=t[e];if(!Number.isInteger(n)||0>n||255<n)return!1}return!0}function Hm(e,t){if(!Array.isArray(t)||0===t.length||32<t.length||t.some((function(e){return 0===e.length||32<e.length})))throw new I("arguments is not valid",Ja);if(!za(e))throw new I("ID is invalid",Ja)}function uf(e){var t=e.attributes,n=e.attrSizeMap,r=e.maxAttrsCount,i=e.maxAttrValueSize;if(e=e.maxTotalSize,!yd(t))throw new I("attributes must be an object",Ja);if(Object.keys(t).length>r)throw new ib("Exceed the limit of ".concat(r," attributes"),se);if(0===Object.keys(t).length)throw new I("The attributes is an empty object",Ja);var o=0,s=0;for(t=Object.entries(t);s<t.length;s++){var a=ra(t[s],2),c=a[1];a=new Blob([a[0]]).size;var l=new Blob([c]).size;if(0===a||32<a)throw new I("Invalid attribute key",Ja);if(l>i)throw new ib("Invalid attribute value, over the limit of ".concat(i," bytes"),se);if("string"!=typeof c||0===c.length)throw new I("Invalid attribute value",Ja);o+=a,o+=l}if(o>e)throw new ib("The attributes size overflow",se);if(void 0!==n){if(Object.keys(n).length>r)throw new ib("Exceed the limit of ".concat(r," attributes"),se);for(o=r=0,n=Object.entries(n);o<n.length;o++){if(s=(t=ra(n[o],2))[1],0===(t=new Blob([t[0]]).size))throw new I("Invalid attribute key",Ja);if(s>i)throw new ib("Invalid attribute value, over the limit of ".concat(i," bytes"),se);r+=t,r+=s}if(r>e)throw new ib("The attributes size overflow",se)}}function Ag(e,t){return Math.floor(Math.random()*(Math.floor(t)-Math.ceil(e)+1))+e}function Bg(){var e=Ag(0,4294967295),t=Ag(1,4294967295);return new U(e,t,!0)}function Xa(e){return e.toString().padEnd(32,"0")}function Im(e,t){return new TypeError("Unexpected ".concat(e,": ").concat(t))}function Jm(e,t){return e=e.split(".").map((function(e){return Number(e)})),t=t.split(".").map((function(e){return Number(e)})),Math.sqrt(1e3*Math.pow(e[0]-t[0],2)+100*Math.pow(e[1]-t[1],2)+10*Math.pow(e[2]-t[2],2)+1*Math.pow(e[3]-t[3],2))}function Km(e){return e.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e.toNumber():e.toString()}function Ai(e,t){t="".concat(e).concat(t||"");var n=Lm.get(t)||1;return Lm.set(t,n+1),"".concat(e).concat(n)}function Mm(e,t){var n="number"==typeof t?t:void 0!==t&&"string"!=typeof t?t.code:void 0;return t="number"!=typeof t&&"string"!=typeof t&&void 0!==t&&void 0!==t.serverCode?t.serverCode:void 0,n="".concat(void 0!==n?" Error Code ".concat(n):"").concat(void 0!==t?", server Code ".concat(t):""),e="string"==typeof e&&e?Cg(e):Array.isArray(e)&&"string"==typeof e[0]&&e[0]?Cg(Nm.apply(void 0,[e[0]].concat(G(e.slice(1))))):"","".concat(""===n?"":"".concat(n," - ")).concat(e)}function Om(e){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark((function e(t){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pm(e){return e instanceof Blob||"[object Blob]"===Object.prototype.toString.call(e)}function Dg(e){var t=255&e,n=e>>8&255,r=e>>16&255;return"".concat(e>>24&255,".").concat(r,".").concat(n,".").concat(t)}function te(e,t,n){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark((function e(t,n,r){var i,o,s,a,c,l,u,d,h,p,f,m,g,_,E,v,y,b,S,T,C,R,I,O,A,N;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.body,o=n.headers,s=void 0===o?{}:o,a=n.timeout,c=void 0===a?1e4:a,l=n.signal,u=n.withCredentials,d=void 0!==u&&u,h=(r||{}).useBinaryResponse,p=void 0!==h&&h,(f=new XMLHttpRequest).open("POST",t,!0),f.responseType=p?"arraybuffer":"text",f.withCredentials=d,f.timeout=c,m=i instanceof FormData,g=i instanceof Uint8Array,!(1<(_=Object.keys(s).filter((function(e){return"content-type"===e.toLowerCase()}))).length)){e.next=14;break}throw new RangeError("multiple content-type");case 14:0===_.length&&(g?s["Content-Type"]="application/octet-stream":m||(s["Content-Type"]="application/json"));case 15:if("setRequestHeader"in f){e.next=46;break}return f.abort(),e.next=19,fetch(t,{body:m||g?i:JSON.stringify(i),cache:"no-cache",credentials:d?"include":"same-origin",headers:s,method:"POST",mode:"cors",referrer:"no-referrer",signal:l});case 19:if(E=e.sent,!(200<=(v=E.status)&&300>v||304===v)){e.next=31;break}if(!p){e.next=27;break}return e.next=25,E.arrayBuffer();case 25:return y=e.sent,e.abrupt("return",{status:v,responseData:y});case 27:return e.next=29,E.text();case 29:return b=e.sent,e.abrupt("return",{status:v,responseText:b});case 31:return S=new da(["Post XHR failure, status %d",v]),e.prev=32,e.next=35,E.text();case 35:throw T=e.sent,S.statusCode=v,S.message=T||"Request failed, status ".concat(v),S;case 41:throw e.prev=41,e.t0=e.catch(32),S.statusCode=v,S.message="Request failed, status ".concat(v),S;case 46:if(0!==Object.keys(s).length)for(C=0,R=Object.entries(s);C<R.length;C++)I=ra(R[C],2),O=I[0],A=I[1],f.setRequestHeader(O,A);return void 0!==l&&(N=function e(){f.abort(),l.removeEventListener("abort",e)},l.addEventListener("abort",N)),m||g?f.send(i):f.send(JSON.stringify(i)),e.abrupt("return",new Promise((function(e,t){f.onload=function(){var n=f.status;if(200<=n&&300>n||304===n)e(p?{status:n,responseData:f.response}:{status:n,responseText:f.responseText});else{var r=new da(["Post XHR failure, status %d",n]);r.statusCode=n,r.message=f.response||"Request failed, status ".concat(f.status),t(r)}},f.ontimeout=function(e){t(new db(["XHR request timed out after %d ms",c],{originalError:e}))},f.onerror=function(){var e=new da(["Post XHR failure, status %d",f.status]);e.statusCode=f.status,e.message=f.response||"Request failed, status ".concat(f.status),t(e)},f.onabort=function(){try{t(new DOMException("The request aborted.","AbortError"))}catch(n){var e=Error("The request aborted.");e.name="AbortError",t(e)}}})));case 50:case"end":return e.stop()}}),e,null,[[32,41]])})))).apply(this,arguments)}function Rm(e){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark((function e(t){var n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Image).src=t,e.abrupt("return",new Promise((function(e,t){n.onload=function(){e({width:n.width,height:n.height})},n.onerror=t})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xt(e,t){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark((function e(t,n){var r,i,o,s,a,c,l,u,d,h;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.thumbnailHeight,i=void 0===r?0:r,o=t.thumbnailWidth,s=void 0===o?0:o,a=t.width,c=void 0===a?0:a,l=t.height,u=void 0===l?0:l,d=t.thumbnail,h=[],"number"==typeof i&&"number"==typeof s&&"number"==typeof c&&"number"==typeof u){e.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=c&&0>=u&&h.push(Rm(Sm(n)).then((function(e){c=e.width,u=e.height}))),0>=s&&0>=i&&void 0!==d&&h.push(Ji(d).then(function(){var e=J(w.mark((function e(t){var n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Rm(Sm(t));case 2:n=e.sent,s=n.width,i=n.height;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),e.next=9,Promise.all(h).catch((function(){}));case 9:return e.abrupt("return",{width:c,height:u,thumbnailWidth:s,thumbnailHeight:i});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tm(e,t){if(!yd(e))throw new I("message object is not a plain object",t);if(void 0===e.messageType)if(e.rawMessage instanceof Uint8Array){if(e.messageType="RAW",void 0!==e.text)throw new I("Raw messages cannot have text property. Use description instead",t)}else{if("string"!=typeof e.text)throw new I("messageType is undefined",t);if(e.messageType="TEXT",void 0!==e.rawMessage)throw new I("Text messages cannot have rawMessage property",t)}}function Gg(e){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark((function e(t){var n,r,i,o,s,a,c,l,u,d,h,p,f,m,g,_,E,v,y,b,S;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.message,r=t.peerId,i=t.toPeer,o=t.session,s=t.errorCodes,a=t.diff,c=t.logger,l=t.options,void 0!==o){e.next=3;break}throw new K("The client is not logged in. Cannot do the operation",s.NOT_LOGGED_IN);case 3:if(u=!1,"TEXT"!==n.messageType||!n.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!i){e.next=11;break}if(d=n.text.split("_"),h=ra(d,3),p=h[0],f=h[1],void 0!==h[2]&&za(f)&&"AgoraRTMLegacyEndcallCompatibleMessagePrefix"===p){e.next=10;break}throw new I("Message is not valid",ve);case 10:u=!0;case 11:if(m=Date.now(),g=o.messageSentTimes.length-1,!((_=o.messageSentTimes[g])&&_+3e3<m)){e.next=18;break}o.messageSentTimes=[m],e.next=29;break;case 18:E=g;case 19:if(!(0<=E)){e.next=28;break}if(!(o.messageSentTimes[E]+3e3<m)){e.next=23;break}return o.messageSentTimes=o.messageSentTimes.slice(E+1,g+1),e.abrupt("break",28);case 23:if(!(180<=g-E+1)){e.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",s.TOO_OFTEN);case 25:E--,e.next=19;break;case 28:o.messageSentTimes.push(m);case 29:e.t0=n.messageType,e.next="TEXT"===e.t0?32:"RAW"===e.t0?37:"FILE"===e.t0||"IMAGE"===e.t0?39:40;break;case 32:if(!u){e.next=36;break}return v=n.text.split("_"),y=ra(v,3),b=y[1],S=y[2],c.info("[rtm-API] EndCall message send api is called"),e.abrupt("return",o.sendInvitationMessage({peerId:r,type:"CallCancel",extra:S,channelId:b,callId:"0"}));case 36:return e.abrupt("return",o.sendTextMessage(n.text,r,i,l,1e4-a));case 37:return void 0===n.description&&(n.description=""),e.abrupt("return",o.sendRawMessage(n.rawMessage,n.description,r,i,l,1e4-a));case 39:return e.abrupt("return",o.sendMediaMessage(n.messageType,n,r,i,l,1e4-a));case 40:throw new I("Invalid message type",ve);case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yt(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=e.replace(/(https?:\/\/)?(www.)?/i,"");return t||(n=n.split(".").slice(e.length-2).join(".")),-1!==n.indexOf("/")?n.split("/")[0]:n}function oa(e){if("string"!=typeof e)return"[Sensitive Info]";var t=Math.floor(.7*e.length),n=e.length;return Um(e,t,n,"*".repeat(n-t))}function Vm(e,t,n){function r(i){if(void 0===e)return e;if(Il(i))return i;if(Array.isArray(i))return i.map(r);var o={},s=0;for(i=Hg(i);s<i.length;s++){var a=ra(i[s],2),c=a[0];if("string"==typeof(a=a[1])&&n.includes(c)){o[c]="string"==typeof a?oa(a):"[Sensitive Info]";break}t.includes(c)?o[c]="[Hidden Info]":o[c]=null==a?a:n.includes(c)?"[Sensitive Info]":r(a)}return o}return Array.isArray(e)?e.map(r):r(e)}function Wm(e){return Object.getOwnPropertyNames(e).forEach((function(t){"object"==X(t=e[t])&&null!==t&&Wm(t)})),Object.freeze(e)}function pa(e){return new TextDecoder("utf-8").decode(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function Ig(e){return(new TextEncoder).encode(e).length}function Xm(){for(var e=0,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e+=n[t].length;for(e=new Uint8Array(e),r=t=0;r<n.length;r++){var i=n[r];e.set(i,t),t+=i.length}return e}function we(e,t,n){var r=e.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(e=null==r?void 0:r[1],r=null==r?void 0:r[2]){var i;for(r=r.substr(1).split("&"),i=0;i<r.length;i++)if(r[i].split("=")[0]==t){r[i]=t+"="+encodeURIComponent(n);break}return i==r.length&&r.push(t+"="+encodeURIComponent(n)),e+"?"+r.join("&")}return e+"?"+t+"="+encodeURIComponent(n)}function Ji(e){return new Promise((function(t,n){var r=new FileReader;r.onloadend=function(){var e=r.result||new ArrayBuffer(0);t(e)},r.onerror=n,r.readAsArrayBuffer(e)}))}function Zt(e,t){e=e=[e],"string"==typeof(t=t||{})&&(t={type:t});try{var n=new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder);for(var r=0;r<e.length;r+=1)n.append(e[r]);n=n.getBlob(t.type)}return n}function Um(e,t,n,r){return"string"!=typeof e?"[Sensitive Info]":e.substring(0,t)+r+e.substring(n)}function Ym(e){var t=[];return function e(n){if(null===n||"object"!==X(n))return n;if(-1!==t.indexOf(n))return"[Circular]";if(t.push(n),"function"==typeof n.toJSON)try{var r=e(n.toJSON());return t.pop(),r}catch(e){return"[Throws: "+(e?e.message:"?")+"]"}return Array.isArray(n)?(r=n.map(e),t.pop(),r):(r=Object.keys(n).reduce((function(t,r){e:{if($t.call(n,r))try{var i=n[r];break e}catch(e){i="[Throws: "+(e?e.message:"?")+"]";break e}i=n[r]}return t[r]=e(i),t}),{}),t.pop(),r)}(e)}function au(e){if(!(100<(e=String(e)).length)&&(e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e))){var t=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*t;case"weeks":case"week":case"w":return 6048e5*t;case"days":case"day":case"d":return 864e5*t;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*t;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*t;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t}}}function Jg(e,t,n,r){return Math.round(e/n)+" "+r+(t>=1.5*n?"s":"")}function bu(e){var t=e.areas,n=e.excludedArea;if(1===t.length&&t[0]===F.GLOBAL&&n===F.CHINA)return xe([F.OVERSEA]);if(t.includes(F.GLOBAL)){if(e=xf(Kg).filter((function(e){return e!==F.GLOBAL&&e!==F.OVERSEA})),n in yf){t=yf[n];var r=[].concat(G(null!=t?t:[]),[n]);return xe(e.filter((function(e){return!r.includes(e)})))}if(Zm(n)){var i=cu(n);return xe(e.filter((function(e){return e!==n&&e!==i})))}}if(Zm(n)||n in yf)return xe(t);throw new I("Invalid excludedArea area config")}function Ma(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,t].concat(G(i.map(ye))));try{var s=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(G(i.map(ye)))),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var a=Date.now();return J(w.mark((function n(){var r,o;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,s;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(G(i.map(ye)))),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==s?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-a):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-a,ye(r)):"Object"!==Ac(r)||yd(r)?e.resultTracker("%s result is %o",t,ye(r)):e.resultTracker("%s result is %s",t,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),s},n}function Nb(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,t].concat(i));try{var s=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(i)),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var a=Date.now();return J(w.mark((function n(){var r,o;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,s;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(i)),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==s?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-a):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-a,r):"Object"!==Ac(r)||yd(r)?e.resultTracker("%s result is %o",t,r):e.resultTracker("%s result is %s",t,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),s},n}function du(e,t){var n="".concat(e,"Uri");if("number"!=typeof(n=Li[n])||0===n)throw new TypeError("Got Unknown URI Name");return t=new(e=$m[e])(t),t=e.encode(t).finish(),new eu({uri:n,data:t})}function an(e,t){return"".concat(e.split(".").join("-"),".edge.").concat(t?"sd-rtn.com":"agora.io")}function eb(e,t,n){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark((function e(t,n,r){var i,o;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;break;case 2:return i=fu[t].encode(n).finish(),o=function(){var e=J(w.mark((function e(n){var s,a,c,l=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(3<(a=1<l.length&&void 0!==l[1]?l[1]:0))){e.next=3;break}return e.abrupt("return");case 3:return c=we(c=r?"https://".concat(null!==(s=null==M?void 0:M.PROXY_NGINX[0])&&void 0!==s?s:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(n,"&p=6443&d=events/proto-raw"):"https://".concat(n,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),c=we(c,"id",gu[t].toString()),e.next=8,te(c,{body:i,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch((function(e){return o(n,a+1)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=4,e.next=7,o((null==M?void 0:M.EVENT_REPORT_DOMAIN[0])||"webcollector-rtm.agora.io");case 7:e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(4),e.next=13,o(M&&bn(1<(null==M?void 0:M.EVENT_REPORT_DOMAIN.length)?null==M?void 0:M.EVENT_REPORT_DOMAIN.slice(1):null==M?void 0:M.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return e.stop()}}),e,null,[[4,9]])})))).apply(this,arguments)}function fb(e){return void 0===e?U.fromNumber(0):U.fromNumber(Date.now()-e)}function hu(e){return btoa(String.fromCharCode.apply({},e.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map((function(e){return parseInt(e,16)})))).replace(/={1,2}$/,"")}function Lg(e,t){return U.fromValue(e).eq(t)}function Mg(e,t){var n=void 0===t?e.val:t,r=e.isBoolean;t=e.isNumber;var i=e.oneof,o=e.len;if(2!==[r,t,i].filter((function(e){return!e})).length)throw new TypeError("invalid field type");if(void 0!==n&&(e=!1,void 0!==i&&(i=Ni(i),iu(i,Lg).length===i.length&&void 0!==ju(i,(function(e){return Lg(n,e)}))&&(e=!0)),r=void 0!==r&&(0===n||1===n)&&1===o,t=void 0!==t&&n.toString(2).length<=o,!(e||r||t)))throw Error("invalid field value")}function cn(e){return function(){var t=e();if(!t)throw new K("Client is not logged in. Cannot do the operation");return t}}var Ya="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof __webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{},Ng=function(e){return e&&e.Math==Math&&e},y=Ng("object"==typeof globalThis&&globalThis)||Ng("object"==typeof window&&window)||Ng("object"==typeof self&&self)||Ng("object"==typeof Ya&&Ya)||function(){return this}()||Function("return this")(),R=function(e){try{return!!e()}catch(e){return!0}},ka=!R((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(e){return!!(e=en(this,e))&&e.enumerable}:dn,dd=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ku={}.toString,Zb=function(e){return ku.call(e).slice(8,-1)},lu="".split,Af=R((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==Zb(e)?lu.call(e,""):Object(e)}:Object,jb=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},qb=function(e){return Af(jb(e))},ha=function(e){return"object"==typeof e?null!==e:"function"==typeof e},lc=function(e,t){if(!ha(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!ha(r=n.call(e))||"function"==typeof(n=e.valueOf)&&!ha(r=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!ha(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},Qa=function(e){return Object(jb(e))},mu={}.hasOwnProperty,Q=function(e,t){return mu.call(Qa(e),t)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R((function(){return 7!=Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a})),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(e,t){if(e=qb(e),t=lc(t,!0),fn)try{return gn(e,t)}catch(e){}if(Q(e,t))return dd(!zf.call(e,t),e[t])}},va=function(e){if(!ha(e))throw TypeError(String(e)+" is not an object");return e},hn=Object.defineProperty,Ra={f:ka?hn:function(e,t,n){if(va(e),t=lc(t,!0),va(n),fn)try{return hn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},Na=ka?function(e,t,n){return Ra.f(e,t,dd(1,n))}:function(e,t,n){return e[t]=n,e},Oi=function(e,t){try{Na(y,e,t)}catch(n){y[e]=t}return t},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;"function"!=typeof ed.inspectSource&&(ed.inspectSource=function(e){return nu.call(e)});var Pi=ed.inspectSource,jn=y.WeakMap,ou="function"==typeof jn&&/native code/.test(Pi(jn)),fd=$a((function(e){(e.exports=function(e,t){return ed[e]||(ed[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"\xa9 2021 Denis Pushkarev (zloirock.ru)"})})),pu=0,qu=Math.random(),Ae=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(e){return kn[e]||(kn[e]=Ae(e))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(e,t){if(ln.call(Gd,e))throw new TypeError("Object already initialized");return t.facade=e,tu.call(Gd,e,t),t},Qg=function(e){return su.call(Gd,e)||{}},Ri=function(e){return ln.call(Gd,e)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(e,t){if(Q(e,Ce))throw new TypeError("Object already initialized");return t.facade=e,Na(e,Ce,t),t},Qg=function(e){return Q(e,Ce)?e[Ce]:{}},Ri=function(e){return Q(e,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(e){return Ri(e)?Qg(e):Qi(e,{})},getterFor:function(e){return function(t){var n;if(!ha(t)||(n=Qg(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},Ta=$a((function(e){var t=Za.get,n=Za.enforce,r=String(String).split("String");(e.exports=function(e,t,i,o){var s=!!o&&!!o.unsafe,a=!!o&&!!o.enumerable;if(o=!!o&&!!o.noTargetGet,"function"==typeof i){"string"!=typeof t||Q(i,"name")||Na(i,"name",t);var c=n(i);c.source||(c.source=r.join("string"==typeof t?t:""))}e===y?a?e[t]=i:Oi(t,i):(s?!o&&e[t]&&(a=!0):delete e[t],a?e[t]=i:Na(e,t,i))})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||Pi(this)}))})),mn=function(e){return"function"==typeof e?e:void 0},mc=function(e,t){return 2>arguments.length?mn(y[e])||mn(y[e]):y[e]&&y[e][t]||y[e]&&y[e][t]},uu=Math.ceil,vu=Math.floor,$b=function(e){return isNaN(e=+e)?0:(0<e?vu:uu)(e)},wu=Math.min,ta=function(e){return 0<e?wu($b(e),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(e,t){return 0>(e=$b(e))?xu(e+t,0):yu(e,t)},nn=function(e){return function(t,n,r){t=qb(t);var i=ta(t.length);if(r=xb(r,i),e&&n!=n){for(;i>r;)if((n=t[r++])!=n)return!0}else for(;i>r;r++)if((e||r in t)&&t[r]===n)return e||r||0;return!e&&-1}},on=nn(!0),Si=nn(!1),pn=function(e,t){e=qb(e);var n,r=0,i=[];for(n in e)!Q(Be,n)&&Q(e,n)&&i.push(n);for(;t.length>r;)Q(e,n=t[r++])&&(~Si(i,n)||i.push(n));return i},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(e){return pn(e,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(e){var t=Hd.f(va(e)),n=Bf.f;return n?t.concat(n(e)):t},rn=function(e,t){for(var n=qn(t),r=Ra.f,i=Fb.f,o=0;o<n.length;o++){var s=n[o];Q(e,s)||r(e,s,i(t,s))}},Au=/#|\.prototype\./,nc=function(e,t){return(e=Bu[Cu(e)])==Du||e!=Eu&&("function"==typeof t?R(t):!!t)},Cu=nc.normalize=function(e){return String(e).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(e,t){var n,r,i,o=e.target,s=e.global,a=e.stat;if(r=s?y:a?y[o]||Oi(o,{}):(y[o]||{}).prototype)for(i in t){var c=t[i],l=e.noTargetGet?(n=Fu(r,i))&&n.value:r[i];if(!(n=nc(s?i:o+(a?".":"#")+i,e.forced))&&void 0!==l){if(typeof c==typeof l)continue;rn(c,l)}(e.sham||l&&l.sham)&&Na(c,"sham",!0);try{Ta(r,i,c,e)}catch(e){}}},yb=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Id=function(e,t,n){if(yb(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},gd=Array.isArray||function(e){return"Array"==Zb(e)},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R((function(){return!String(Symbol())||!Symbol.sham&&id&&41>id})),vn=oc&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(e){return Q(Cf,e)&&(oc||"string"==typeof Cf[e])||(oc&&Q(Df,e)?Cf[e]=Df[e]:Cf[e]=Gu("Symbol."+e)),Cf[e]},Hu=qa("species"),Sg=function(e,t){if(gd(e)){var n=e.constructor;"function"!=typeof n||n!==Array&&!gd(n.prototype)?ha(n)&&null===(n=n[Hu])&&(n=void 0):n=void 0}return new(void 0===n?Array:n)(0===t?0:t)},wn=[].push,jd=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,s=7==e,a=5==e||o;return function(c,l,u,d){var h=Qa(c),p=Af(h);l=Id(l,u,3),u=ta(p.length);var f,m=0;for(d=d||Sg,c=t?d(c,u):n||s?d(c,0):void 0;u>m;m++)if((a||m in p)&&(f=l(d=p[m],m,h),e))if(t)c[m]=f;else if(f)switch(e){case 3:return!0;case 5:return d;case 6:return m;case 2:wn.call(c,d)}else switch(e){case 4:return!1;case 7:wn.call(c,d)}return o?-1:r||i?i:c}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6);jd(7);var Ku=qa("species"),Ef=function(e){return 51<=id||!R((function(){var t=[];return(t.constructor={})[Ku]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(e){return yn(this,e,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(e){return pn(e,Rg)},Mu=R((function(){Dc(1)}));N({target:"Object",stat:!0,forced:Mu},{keys:function(e){return Dc(Qa(e))}});var Ee=function(e,t){var n=[][e];return!!n&&R((function(){n.call(null,t||function(){throw 1},1)}))},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(e){return Nu.call(qb(this),void 0===e?",":e)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(e){return xn(this,e,1<arguments.length?arguments[1]:void 0)}});var Ui=function(e){var t=e.return;if(void 0!==t)return va(t.call(e)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(e){return void 0!==e&&(Fe.Array===e||Su[Ru]===e)},Ge=function(e,t,n){(t=lc(t))in e?Ra.f(e,t,dd(0,n)):e[t]=n},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi="[object z]"===String(Bn),Uu=qa("toStringTag"),Vu="Arguments"==Zb(function(){return arguments}()),Ff=Wi?Zb:function(e){var t;if(void 0===e)var n="Undefined";else{if(null===e)var r="Null";else{e:{var i=e=Object(e);try{r=i[Uu];break e}catch(e){}r=void 0}r="string"==typeof(n=r)?n:Vu?Zb(e):"Object"==(t=Zb(e))&&"function"==typeof e.callee?"Arguments":t}n=r}return n},Wu=qa("iterator"),Xi=function(e){if(null!=e)return e[Wu]||e["@@iterator"]||Fe[Ff(e)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,(function(){throw 2}))}catch(c){}var Tg=function(e,t){if(!t&&!Dn)return!1;var n=!1;try{(t={})[Cn]=function(){return{next:function(){return{done:n=!0}}}},e(t)}catch(e){}return n},Yu=!Tg((function(e){Array.from(e)}));N({target:"Array",stat:!0,forced:Yu},{from:function(e){var t,n=Qa(e),r="function"==typeof this?this:Array,i=arguments.length,o=1<i?arguments[1]:void 0,s=void 0!==o,a=Xi(n),c=0;if(s&&(o=Id(o,2<i?arguments[2]:void 0,2)),null==a||r==Array&&Vi(a)){var l=ta(n.length);for(r=new r(l);l>c;c++)a=s?o(n[c],c):n[c],Ge(r,c,a)}else for(i=(n=a.call(n)).next,r=new r;!(t=i.call(n)).done;c++){if(s){a=n;var u=o;t=[t.value,c];try{l=u(va(t)[0],t[1])}catch(e){throw Ui(a),e}}else l=t.value;Ge(r,c,a=l)}return r.length=c,r}});var Fn=function(e){return function(t,n){t=String(jb(t)),n=$b(n);var r,i=t.length;if(0>n||n>=i)return e?"":void 0;var o=t.charCodeAt(n);return 55296>o||56319<o||n+1===i||56320>(r=t.charCodeAt(n+1))||57343<r?e?t.charAt(n):o:e?t.slice(n,n+2):r-56320+(o-55296<<10)+65536}};Fn(!1);var Gn=Fn(!0),Hn=!R((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(e){return e=Qa(e),Q(e,In)?e[In]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(null==Kd||R((function(){var e={};return Kd[Yi].call(e)!==e})))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(e,t){va(e);for(var n,r=Dc(t),i=r.length,o=0;i>o;)Ra.f(e,n=r[o++],t[n]);return e},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch(e){}if(aj){var e=aj;e.write("<script><\/script>"),e.close(),e=e.parentWindow.Object}else(e=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),e=e.F;for(Wg=e,e=Rg.length;e--;)delete Wg.prototype[Rg[e]];return Wg()};Be[Mn]=!0;var ac=Object.create||function(e,t){if(null!==e){$i.prototype=va(e);var n=new $i;$i.prototype=null,n[Mn]=e}else n=Wg();return void 0===t?n:av(n,t)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(e,t,n){e&&!Q(e=n?e:e.prototype,Nn)&&bv(e,Nn,{configurable:!0,value:t})},cv=function(){return this},dv=function(e,t,n){return t+=" Iterator",e.prototype=ac(Ug,{next:dd(1,n)}),Ec(e,t,!1),Fe[t]=cv,e},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,t={};try{var n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;n.call(t,[]),e=t instanceof Array}catch(e){}return function(t,r){if(va(t),!ha(r)&&null!==r)throw TypeError("Can't set "+String(r)+" as a prototype");return e?n.call(t,r):t.__proto__=r,t}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(e,t,n,r,i,o,s){dv(n,t,r),r=function(e){if(e===i&&h)return h;if(!Vg&&e in u)return u[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}};var a,c=t+" Iterator",l=!1,u=e.prototype,d=u[Gf]||u["@@iterator"]||i&&u[i],h=!Vg&&d||r(i),p="Array"==t&&u.entries||d;if(p&&(e=Vb(p.call(new e)),Ug!==Object.prototype&&e.next&&(Vb(e)!==Ug&&(Ua?Ua(e,Ug):"function"!=typeof e[Gf]&&Na(e,Gf,ev)),Ec(e,c,!0))),"values"==i&&d&&"values"!==d.name&&(l=!0,h=function(){return d.call(this)}),u[Gf]!==h&&Na(u,Gf,h),Fe[t]=h,i){var f={values:r("values"),keys:o?h:r("keys"),entries:r("entries")};if(s)for(a in f)!Vg&&!l&&a in u||Ta(u,a,f[a]);else N({target:t,proto:!0,forced:Vg||l},f)}return f},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",(function(e){fv(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e=gv(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(t=Gn(t,n),e.index+=t.length,{value:t,done:!1})}));var cj=qa("unscopables"),dj=Array.prototype;null==dj[cj]&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(e){dj[cj][e]=!0},On=!0;"find"in[]&&Array(1).find((function(){On=!1})),N({target:"Array",proto:!0,forced:On},{find:function(e){return zn(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(e){var t=String(jb(this)),n="";if(0>(e=$b(e))||1/0==e)throw RangeError("Wrong number of repetitions");for(;0<e;(e>>>=1)&&(t+=t))1&e&&(n+=t);return n};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(e){return e!=e}}),y.Number.isNaN;var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(e,t,n){for(var r in t)Ta(e,r,t[r],n);return e},Qn=qa("species"),If=function(e){e=mc(e);var t=Ra.f;ka&&e&&!e[Qn]&&t(e,Qn,{configurable:!0,get:function(){return this}})},Gc=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Jf=function(e,t){this.stopped=e,this.result=t},Xg=function(e,t,n){var r,i=!(!n||!n.AS_ENTRIES),o=!(!n||!n.IS_ITERATOR),s=!(!n||!n.INTERRUPTED),a=Id(t,n&&n.that,1+i+s),c=function(e){return l&&Ui(l),new Jf(!0,e)};if(t=function(e){return i?(va(e),s?a(e[0],e[1],c):a(e[0],e[1])):s?a(e,c):a(e)},o)var l=e;else{if("function"!=typeof(o=Xi(e)))throw TypeError("Target is not iterable");if(Vi(o)){for(o=0,n=ta(e.length);n>o;o++)if((r=t(e[o]))&&r instanceof Jf)return r;return new Jf(!1)}l=o.call(e)}for(e=l.next;!(o=e.call(l)).done;){try{r=t(o.value)}catch(e){throw Ui(l),e}if("object"==typeof r&&r&&r instanceof Jf)return r}return new Jf(!1)},iv=qa("species"),kd=function(e,t){var n;return void 0===(e=va(e).constructor)||null==(n=va(e)[iv])?t:yb(n)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc="process"==Zb(y.process),Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(e){if(Kf.hasOwnProperty(e)){var t=Kf[e];delete Kf[e],t()}},ij=function(e){return function(){hj(e)}},Un=function(e){hj(e.data)},Vn=function(e){y.postMessage(e+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Kf[++gj]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Lf(gj),gj},Sn=function(e){delete Kf[e]},Hc)var Lf=function(e){jv.nextTick(ij(e))};else if(fj&&fj.now)Lf=function(e){fj.now(ij(e))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&"function"==typeof postMessage&&!y.importScripts&&Yg&&"file:"!==Yg.protocol&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(e){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(e)}}:function(e){setTimeout(ij(e),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var e;for(Hc&&(e=$n.domain)&&e.exit();Md;){var t=Md.fn;Md=Md.next;try{t()}catch(e){throw Md?$g():Mf=void 0,e}}Mf=void 0,e&&e.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(e){e={fn:e,next:void 0},Mf&&(Mf.next=e),Md||(Md=e,$g()),Mf=e},nv=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=yb(t),this.reject=yb(n)},lj={f:function(e){return new nv(e)}},mj=function(e,t){return va(e),ha(t)&&t.constructor===e?t:((0,(e=lj.f(e)).resolve)(t),e.promise)},ov=function(e,t){var n=y.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},nj=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},pv="object"==typeof window,qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io="function"==typeof PromiseRejectionEvent,jo=!1,Nf=nc("Promise",(function(){var e=Pi(zb)!==String(zb);if(!e&&66===id)return!0;if(51<=id&&/native code/.test(zb))return!1;var t=new zb((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(t.constructor={})[qv]=n,!(jo=t.then((function(){}))instanceof n)||!e&&pv&&!io})),vv=Nf||!Tg((function(e){zb.all(e).catch((function(){}))})),ko=function(e){var t;return!(!ha(e)||"function"!=typeof(t=e.then))&&t},qj=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;fo((function(){for(var r=e.value,i=1==e.state,o=0;n.length>o;){var s,a=n[o++],c=i?a.ok:a.fail,l=a.resolve,u=a.reject,d=a.domain;try{if(c){if(i||(2===e.rejection&&wv(e),e.rejection=1),!0===c)var h=r;else if(d&&d.enter(),h=c(r),d){d.exit();var p=!0}h===a.promise?u(ho("Promise-chain cycle")):(s=ko(h))?s.call(h,l,u):l(h)}else u(r)}catch(e){d&&!p&&d.exit(),u(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&xv(e)}))}},lo=function(e,t,n){var r;if(uv){var i=oj.createEvent("Event");i.promise=t,i.reason=n,i.initEvent(e,!1,!0),y.dispatchEvent(i)}else i={promise:t,reason:n};!io&&(r=y["on"+e])?r(i):"unhandledrejection"===e&&ov("Unhandled promise rejection",n)},xv=function(e){jj.call(y,(function(){var t=e.facade,n=e.value;if(1!==e.rejection&&!e.parent){var r=nj((function(){Hc?pj.emit("unhandledRejection",n,t):lo("unhandledrejection",t,n)}));if(e.rejection=Hc||1!==e.rejection&&!e.parent?2:1,r.error)throw r.value}}))},wv=function(e){jj.call(y,(function(){var t=e.facade;Hc?pj.emit("rejectionHandled",t):lo("rejectionhandled",t,e.value)}))},Ie=function(e,t,n){return function(r){e(t,r,n)}},Je=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,qj(e,!0))},rj=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw ho("Promise can't be resolved itself");var r=ko(t);r?fo((function(){var n={done:!1};try{r.call(t,Ie(rj,n,e),Ie(Je,n,e))}catch(t){Je(n,t,e)}})):(e.value=t,e.state=1,qj(e,!1))}catch(t){Je({done:!1},t,e)}}};if(Nf){zb=function(e){Gc(this,zb,"Promise"),yb(e),sj.call(this);var t=go(this);try{e(Ie(rj,t),Ie(Je,t))}catch(e){Je(t,e)}},bh=zb.prototype;var sj=function(e){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(e,t){var n=sv(this),r=He(kd(this,zb));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Hc?pj.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&qj(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}});var yv=function(){var e=new sj,t=go(e);this.promise=e,this.resolve=Ie(rj,t),this.reject=Ie(Je,t)};if(lj.f=He=function(e){return e===zb||e===zv?new yv(e):tv(e)},"function"==typeof Fc&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",(function(e,t){var n=this;return new zb((function(e,t){Av.call(n,e,t)})).then(e,t)}),{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch(c){}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:zb}),Ec(zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(e){var t=He(this);return t.reject.call(void 0,e),t.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(e){return mj(this,e)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(e){var t=this,n=He(t),r=n.resolve,i=n.reject,o=nj((function(){var n=yb(t.resolve),o=[],s=0,a=1;Xg(e,(function(e){var c=s++,l=!1;o.push(void 0),a++,n.call(t,e).then((function(e){l||(l=!0,o[c]=e,--a||r(o))}),i)})),--a||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=He(t),r=n.reject,i=nj((function(){var i=yb(t.resolve);Xg(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(e){return no?mo.apply(this,arguments)||0:Si(this,e,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var e=va(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},pc=R((function(){var e=RegExp("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),Cv=R((function(){var e=RegExp("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),0!==c.lastIndex||0!==a.lastIndex),po=pc||Cv,vj=void 0!==/()??/.exec("")[1],c,a;(uj||vj||po)&&(oo=function(e){var t,n=po&&this.sticky,r=tj.call(this),i=this.source,o=0,s=e;if(n){-1===(r=r.replace("y","")).indexOf("g")&&(r+="g"),s=String(e).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&"\n"!==e[this.lastIndex-1])&&(i="(?: "+i+")",s=" "+s,o++);var a=new RegExp("^(?:"+i+")",r)}if(vj&&(a=new RegExp("^"+i+"$(?!\\s)",r)),uj)var c=this.lastIndex;var l=ch.call(n?a:this,s);return n?l?(l.input=l.input.slice(o),l[0]=l[0].slice(o),l.index=this.lastIndex,this.lastIndex+=l[0].length):this.lastIndex=0:uj&&l&&(this.lastIndex=this.global?l.index+l[0].length:c),vj&&l&&1<l.length&&Dv.call(l[0],a,(function(){for(t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(l[t]=void 0)})),l});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),qo="$0"==="a".replace(/./,"$0"),ro=qa("replace"),so=!!/./[ro]&&""===/./[ro]("a","$0"),Gv=!R((function(){var e=/(?:)/,t=e.exec;return e.exec=function(){return t.apply(this,arguments)},2!==(e="ab".split(e)).length||"a"!==e[0]||"b"!==e[1]})),dh=function(e,t,n,r){var i=qa(e),o=!R((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),s=o&&!R((function(){var t=!1,n=/a/;return"split"===e&&((n={constructor:{}}).constructor[Ev]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!o||!s||"replace"===e&&(!Fv||!qo||so)||"split"===e&&!Gv){var a=/./[i],c=(n=n(i,""[e],(function(e,t,n,r,i){var s=t.exec;return s===Of||s===wj.exec?o&&!i?{done:!0,value:a.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,e,n[0]),Ta(wj,i,2==t?function(e,t){return c.call(e,this,t)}:function(e){return c.call(e,this)})}r&&Na(wj[i],"sham",!0)},xj=function(e,t,n){return t+(n?Gn(e,t).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(e,t,n,r,i,o){var s=n+e.length,a=r.length,c=Kv;return void 0!==i&&(i=Qa(i),c=Jv),Iv.call(o,c,(function(o,c){switch(c.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(s);case"<":o=i[c.slice(1,-1)];break;default:var l=+c;if(0===l)return o;if(l>a)return 0===(l=Hv(l/10))?o:l<=a?void 0===r[l-1]?c.charAt(1):r[l-1]+c.charAt(1):o;o=r[l-1]}return void 0===o?"":o}))},Ke=function(e,t){var n=e.exec;if("function"==typeof n){if("object"!=typeof(e=n.call(e,t)))throw TypeError("RegExp exec method returned something other than an Object or null");return e}if("RegExp"!==Zb(e))throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(e,t)},Mv=Math.max,Nv=Math.min,Ov=function(e){return void 0===e?e:String(e)};dh("replace",2,(function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o=r.REPLACE_KEEPS_$0,s=i?"$":"$0";return[function(n,r){var i=jb(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&o||"string"==typeof r&&-1===r.indexOf(s)){var a=n(t,e,this,r);if(a.done)return a.value}var c=va(e);e=String(this),(a="function"==typeof r)||(r=String(r));var l=c.global;if(l){var u=c.unicode;c.lastIndex=0}for(var d=[];;){var h=Ke(c,e);if(null===h)break;if(d.push(h),!l)break;""===String(h[0])&&(c.lastIndex=xj(e,ta(c.lastIndex),u))}for(u="",l=c=0;l<d.length;l++){h=d[l];for(var p=String(h[0]),f=Mv(Nv($b(h.index),e.length),0),m=[],g=1;g<h.length;g++)m.push(Ov(h[g]));h=h.groups,a?(m=[p].concat(m,f,e),void 0!==h&&m.push(h),h=String(r.apply(void 0,m))):h=Lv(p,e,f,m,h,r),f>=c&&(u+=e.slice(c,f)+h,c=f+p.length)}return u+e.slice(c)}]}));var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(e,t){var n=qb(this),r=ta(n.length);if(e=xb(e,r),t=xb(void 0===t?r:t,r),gd(n)){var i=n.constructor;if("function"!=typeof i||i!==Array&&!gd(i.prototype)?ha(i)&&null===(i=i[Qv])&&(i=void 0):i=void 0,i===Array||void 0===i)return Rv.call(n,e,t)}for(i=new(void 0===i?Array:i)(Sv(t-e,0)),r=0;e<t;e++,r++)e in n&&Ge(i,r,n[e]);return i.length=r,i}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",(function(e,t){Tv(this,{type:"Array Iterator",target:qb(e),index:0,kind:t})}),(function(){var e=Uv(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Le=function(e){if(void 0===e)return 0;e=$b(e);var t=ta(e);if(e!==t)throw RangeError("Wrong length or index");return t},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(e){var t=Qa(this),n=ta(t.length),r=arguments.length,i=xb(1<r?arguments[1]:void 0,n);for(n=void 0===(r=2<r?arguments[2]:void 0)?n:xb(r,n);n>i;)t[i++]=e;return t},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,Ab=bc,cc=y.DataView,eh=cc&&cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(e,t,n){var r,i=Array(n),o=(1<<(n=8*n-t-1))-1,s=o>>1,a=23===t?Ic(2,-24)-Ic(2,-77):0,c=0>e||0===e&&0>1/e?1:0,l=0;if((e=Vv(e))!=e||1/0===e){e=e!=e?1:0;var u=o}else u=Wv(Xv(e)/Yv),1>e*(r=Ic(2,-u))&&(u--,r*=2),2<=(e=1<=u+s?e+a/r:e+a*Ic(2,1-s))*r&&(u++,r/=2),u+s>=o?(e=0,u=o):1<=u+s?(e=(e*r-1)*Ic(2,t),u+=s):(e=e*Ic(2,s-1)*Ic(2,t),u=0);for(;8<=t;i[l++]=255&e,e/=256,t-=8);for(u=u<<t|e,n+=t;0<n;i[l++]=255&u,u/=256,n-=8);return i[--l]|=128*c,i},xo=function(e,t){var n=e.length,r=8*n-t-1,i=(1<<r)-1,o=i>>1;r-=7,--n;var s=e[n--],a=127&s;for(s>>=7;0<r;a=256*a+e[n],n--,r-=8);var c=a&(1<<-r)-1;for(a>>=-r,r+=t;0<r;c=256*c+e[n],n--,r-=8);if(0===a)a=1-o;else{if(a===i)return c?NaN:s?-1/0:1/0;c+=Ic(2,t),a-=o}return(s?-1:1)*c*Ic(2,a-t)},yo=function(e){return[255&e]},zo=function(e){return[255&e,e>>8&255]},Ao=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Bo=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},aw=function(e){return wo(e,23,4)},bw=function(e){return wo(e,52,8)},gh=function(e,t){$v(e.prototype,t,{get:function(){return Me(this)[t]}})},md=function(e,t,n,r){n=Le(n);var i=Me(e);if(n+t>i.byteLength)throw fh("Wrong index");return e=Me(i.buffer).bytes,n+=i.byteOffset,t=e.slice(n,n+t),r?t:t.reverse()},nd=function(e,t,n,r,i,o){n=Le(n);var s=Me(e);if(n+t>s.byteLength)throw fh("Wrong index");for(e=Me(s.buffer).bytes,n+=s.byteOffset,r=r(+i),i=0;i<t;i++)e[n+i]=r[o?i:t-i-1]};if(to){if(!R((function(){bc(1)}))||!R((function(){new bc(-1)}))||R((function(){return new bc,new bc(1.5),new bc(NaN),"ArrayBuffer"!=bc.name}))){Ab=function(e){return Gc(this,Ab),new bc(Le(e))};for(var cw=Ab.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in Ab||Na(Ab,zj,bc[zj]);cw.constructor=Ab}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new cc(new Ab(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(e,t){Eo.call(this,e,t<<24>>24)},setUint8:function(e,t){Eo.call(this,e,t<<24>>24)}},{unsafe:!0})}else Ab=function(e){Gc(this,Ab,"ArrayBuffer"),e=Le(e),uo(this,{bytes:yj.call(Array(e),0),byteLength:e}),ka||(this.byteLength=e)},cc=function(e,t,n){Gc(this,cc,"DataView"),Gc(e,Ab,"DataView");var r=Me(e).byteLength;if(0>(t=$b(t))||t>r)throw fh("Wrong offset");if(t+(n=void 0===n?r-t:ta(n))>r)throw fh("Wrong length");uo(this,{buffer:e,byteLength:n,byteOffset:t}),ka||(this.buffer=e,this.byteLength=n,this.byteOffset=t)},ka&&(gh(Ab,"byteLength"),gh(cc,"buffer"),gh(cc,"byteLength"),gh(cc,"byteOffset")),Hf(cc.prototype,{getInt8:function(e){return md(this,1,e)[0]<<24>>24},getUint8:function(e){return md(this,1,e)[0]},getInt16:function(e){var t=md(this,2,e,1<arguments.length?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=md(this,2,e,1<arguments.length?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return xo(md(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return xo(md(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,t){nd(this,1,e,yo,t)},setUint8:function(e,t){nd(this,1,e,yo,t)},setInt16:function(e,t){nd(this,2,e,zo,t,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,t){nd(this,2,e,zo,t,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,t){nd(this,4,e,Ao,t,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,t){nd(this,4,e,Ao,t,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,t){nd(this,4,e,aw,t,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,t){nd(this,8,e,bw,t,2<arguments.length?arguments[2]:void 0)}});Ec(Ab,"ArrayBuffer"),Ec(cc,"DataView");var Pf={ArrayBuffer:Ab,DataView:cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R((function(){return!new Aj(2).slice(1,void 0).byteLength}));N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(e,t){if(void 0!==Go&&void 0===t)return Go.call(va(this),e);var n=va(this).byteLength;e=xb(e,n),t=xb(void 0===t?n:t,n),n=new(kd(this,Aj))(ta(t-e));for(var r=new Fo(this),i=new Fo(n),o=0;e<t;)i.setUint8(o++,r.getUint8(e++));return n}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&"Opera"!==Ff(y.opera),Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(e){return!!ha(e)&&(e=Ff(e),Q(rc,e)||Q(fw,e))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||"function"!=typeof qc||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(e){if(jh(e))return e;throw TypeError("Target is not a typed array")},Ne=function(e){if(Ua){if(Ko.call(qc,e))return e}else for(var t in rc)if(Q(rc,Bb)){var n=y[t];if(n&&(e===n||Ko.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},Aa=function(e,t,n){if(ka){if(n)for(var r in rc){var i=y[r];if(i&&Q(i.prototype,e))try{delete i.prototype[e]}catch(e){}}dc[e]&&!n||Ta(dc,e,n?t:Jc&&Bj[e]||t)}},Oo=function(e,t,n){var r,i;if(ka){if(Ua){if(n)for(r in rc)if((i=y[r])&&Q(i,e))try{delete i[e]}catch(e){}if(qc[e]&&!n)return;try{return Ta(qc,e,n?t:Jc&&qc[e]||t)}catch(e){}}for(r in rc)!(i=y[r])||i[e]&&!n||Ta(i,e,t)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R((function(){Od(1)}))||!R((function(){new Od(-1)}))||!Tg((function(e){new Od,new Od(null),new Od(1.5),new Od(e)}),!0)||R((function(){return 1!==new Od(new gw(2),1,void 0).length})),kh=function(e,t){if(0>(e=$b(e)))throw RangeError("The argument can't be less than 0");if(e%t)throw RangeError("Wrong offset");return e},Ej=function(e){var t=Qa(e),n=arguments.length,r=1<n?arguments[1]:void 0,i=void 0!==r,o=Xi(t);if(null!=o&&!Vi(o)){var s=o.call(t),a=s.next;for(t=[];!(o=a.call(s)).done;)t.push(o.value)}for(i&&2<n&&(r=Id(r,arguments[2],2)),o=ta(t.length),s=new(Ne(this))(o),n=0;o>n;n++)s[n]=i?r(t[n],n):t[n];return s},lh=function(e,t,n){var r,i;return Ua&&"function"==typeof(r=t.constructor)&&r!==n&&ha(i=r.prototype)&&i!==n.prototype&&Ua(e,i),e},Sf=$a((function(e){var t=Hd.f,n=Za.get,r=Za.set,i=Ra.f,o=Fb.f,s=Math.round,a=y.RangeError,c=Pf.ArrayBuffer,l=Pf.DataView,u=function(e,t){var n=0,r=t.length;for(e=new(Ne(e))(r);r>n;)e[n]=t[n++];return e},d=function(e,t){i(e,t,{get:function(){return n(this)[t]}})},h=function(e){var t;return e instanceof c||"ArrayBuffer"==(t=Ff(e))||"SharedArrayBuffer"==t},p=function(e,t){return jh(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},f=function(e,t){return p(e,t=lc(t,!0))?dd(2,e[t]):o(e,t)},m=function(e,t,n){return!(p(e,t=lc(t,!0))&&ha(n)&&Q(n,"value"))||Q(n,"get")||Q(n,"set")||n.configurable||Q(n,"writable")&&!n.writable||Q(n,"enumerable")&&!n.enumerable?i(e,t,n):(e[t]=n.value,e)};ka?(Qf||(Fb.f=f,Ra.f=m,d(Rf,"buffer"),d(Rf,"byteOffset"),d(Rf,"byteLength"),d(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:f,defineProperty:m}),e.exports=function(e,o,d){var p=e.match(/\d+$/)[0]/8,f=e+(d?"Clamped":"")+"Array",m="get"+e,g="set"+e,_=y[f],E=_;e=E&&E.prototype;var v={},b=function(e,t){i(e,t,{get:function(){var e=n(this);return e.view[m](t*p+e.byteOffset,!0)},set:function(e){var r=n(this);d&&(e=0>(e=s(e))?0:255<e?255:255&e),r.view[g](t*p+r.byteOffset,e,!0)},enumerable:!0})};Qf?Dj&&(E=o((function(e,t,n,r){return Gc(e,E,f),lh(ha(t)?h(t)?void 0!==r?new _(t,kh(n,p),r):void 0!==n?new _(t,kh(n,p)):new _(t):jh(t)?u(E,t):Ej.call(E,t):new _(Le(t)),e,E)})),Ua&&Ua(E,Po),Jd(t(_),(function(e){e in E||Na(E,e,_[e])})),E.prototype=e):(E=o((function(e,t,n,i){Gc(e,E,f);var o=0,s=0;if(ha(t)){if(!h(t))return jh(t)?u(E,t):Ej.call(E,t);var d=t;if(s=kh(n,p),t=t.byteLength,void 0===i){if(t%p)throw a("Wrong length");if(0>(i=t-s))throw a("Wrong length")}else if((i=ta(i)*p)+s>t)throw a("Wrong length");t=i/p}else t=Le(t),d=new c(i=t*p);for(r(e,{buffer:d,byteOffset:s,byteLength:i,length:t,view:new l(d)});o<t;)b(e,o++)})),Ua&&Ua(E,Po),e=E.prototype=ac(Rf)),e.constructor!==E&&Na(e,"constructor",E),No&&Na(e,No,f),v[f]=E,N({global:!0,forced:E!=_,sham:!Qf},v),"BYTES_PER_ELEMENT"in E||Na(E,"BYTES_PER_ELEMENT",p),"BYTES_PER_ELEMENT"in e||Na(e,"BYTES_PER_ELEMENT",p),If(f)}):e.exports=function(){}}));Sf("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var hw=Math.min,iw=[].copyWithin||function(e,t){var n=Qa(this),r=ta(n.length),i=xb(e,r),o=xb(t,r),s=2<arguments.length?arguments[2]:void 0;for(r=hw((void 0===s?r:xb(s,r))-o,r-i),s=1,o<i&&i<o+r&&(s=-1,o+=r-1,i+=r-1);0<r--;)o in n?n[i]=n[o]:delete n[i],i+=s,o+=s;return n};Aa("copyWithin",(function(e,t){return iw.call(Da(this),e,t,2<arguments.length?arguments[2]:void 0)})),Aa("every",(function(e){return Ju(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("fill",(function(e){return yj.apply(Da(this),arguments)})),Aa("filter",(function(e){var t=yn(Da(this),e,1<arguments.length?arguments[1]:void 0),n=kd(this,this.constructor),r=0,i=t.length;for(n=new(Ne(n))(i);i>r;)n[r]=t[r++];return n})),Aa("find",(function(e){return zn(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("findIndex",(function(e){return An(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("forEach",(function(e){Jd(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("includes",(function(e){return on(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("indexOf",(function(e){return Si(Da(this),e,1<arguments.length?arguments[1]:void 0)}));var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&("values"==Fj.name||null==Fj.name),To=function(){return jw.call(Da(this))};Aa("entries",(function(){return lw.call(Da(this))})),Aa("keys",(function(){return kw.call(Da(this))})),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",(function(e){return mw.apply(Da(this),arguments)}));var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(e){if(Uo)return Gj.apply(this,arguments)||0;var t=qb(this),n=ta(t.length),r=n-1;for(1<arguments.length&&(r=nw(r,$b(arguments[1]))),0>r&&(r=n+r);0<=r;r--)if(r in t&&t[r]===e)return r||0;return-1}:Gj;Aa("lastIndexOf",(function(e){return pw.apply(Da(this),arguments)})),Aa("map",(function(e){return xn(Da(this),e,1<arguments.length?arguments[1]:void 0,(function(e,t){return new(Ne(kd(e,e.constructor)))(t)}))}));var Vo=function(e){return function(t,n,r,i){yb(n),t=Qa(t);var o=Af(t),s=ta(t.length),a=e?s-1:0,c=e?-1:1;if(2>r)for(;;){if(a in o){i=o[a],a+=c;break}if(a+=c,e?0>a:s<=a)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=a:s>a;a+=c)a in o&&(i=n(i,o[a],a,t));return i}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",(function(e){return Wo(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)})),Aa("reduceRight",(function(e){return qw(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)}));var rw=Math.floor;Aa("reverse",(function(){for(var e,t=Da(this).length,n=rw(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var sw=R((function(){new Int8Array(1).set({})}));Aa("set",(function(e){Da(this);var t=kh(1<arguments.length?arguments[1]:void 0,1),n=this.length,r=Qa(e),i=ta(r.length),o=0;if(i+t>n)throw RangeError("Wrong length");for(;o<i;)this[t+o]=r[o++]}),sw);var tw=[].slice,uw=R((function(){new Int8Array(1).slice()}));Aa("slice",(function(e,t){e=tw.call(Da(this),e,t);var n=kd(this,this.constructor);t=0;var r=e.length;for(n=new(Ne(n))(r);r>t;)n[t]=e[t++];return n}),uw),Aa("some",(function(e){return Iu(Da(this),e,1<arguments.length?arguments[1]:void 0)}));var vw=[].sort;Aa("sort",(function(e){return vw.call(Da(this),e)})),Aa("subarray",(function(e,t){var n=Da(this),r=n.length;return e=xb(e,r),new(kd(n,n.constructor))(n.buffer,n.byteOffset+e*n.BYTES_PER_ELEMENT,ta((void 0===t?r:xb(t,r))-e))}));var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R((function(){Xo.call(new mh(1))})),yw=R((function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()}))||!R((function(){mh.prototype.toLocaleString.call([1,2])}));Aa("toLocaleString",(function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)}),yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R((function(){nh.call({})}))&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch(e){return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R((function(){return"/a/b"!=ap.call({source:"a",flags:"b"})})),Fw="toString"!=ap.name;(Ew||Fw)&&Ta(RegExp.prototype,"toString",(function(){var e=va(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in $o)?tj.call(e):n)}),{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(e,t){var n,r,i=Qa(this),o=ta(i.length),s=xb(e,o),a=arguments.length;if(0===a?a=n=0:1===a?(a=0,n=o-s):(a-=2,n=Iw(Hw($b(t),0),o-s)),9007199254740991<o+a-n)throw TypeError("Maximum allowed length exceeded");var c=Sg(i,n);for(r=0;r<n;r++){var l=s+r;l in i&&Ge(c,r,i[l])}if(c.length=n,a<n){for(r=s;r<o-n;r++){var u=r+a;(l=r+n)in i?i[u]=i[l]:delete i[u]}for(r=o;r>o-n+a;r--)delete i[r-1]}else if(a>n)for(r=o-n;r>s;r--)u=r+a-1,(l=r+n-1)in i?i[u]=i[l]:delete i[u];for(r=0;r<a;r++)i[r+s]=arguments[r+2];return i.length=o-n+a,c}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch(c){Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh])for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch(c){Kc[Oe]=ld[Oe]}}}var dp=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};dh("search",1,(function(e,t,n){return[function(t){var n=jb(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;e=va(e);var i=String(this);return r=e.lastIndex,dp(r,0)||(e.lastIndex=0),i=Ke(e,i),dp(e.lastIndex,r)||(e.lastIndex=r),null===i?-1:i.index}]})),$a((function(e){!function(t,n){e.exports?e.exports=n(t):n(t)}("undefined"!=typeof self?self:Ya,(function(e){function t(e){return btoa(e).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function n(e){return e=(e+="===").slice(0,-e.length%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"))}function r(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function i(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),String.fromCharCode.apply(String,e)}function o(e){var t={name:(e.name||e||"").toUpperCase().replace("V","v")};switch(t.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":e.length&&(t.length=e.length);break;case"HMAC":e.hash&&(t.hash=o(e.hash)),e.length&&(t.length=e.length);break;case"RSAES-PKCS1-v1_5":e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":e.hash&&(t.hash=o(e.hash)),e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return t}function s(e){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[e.name][(e.hash||{}).name||e.length||""]}function a(e){(e instanceof ArrayBuffer||e instanceof Uint8Array)&&(e=JSON.parse(decodeURIComponent(escape(i(e)))));var t={kty:e.kty,alg:e.alg,ext:e.ext||e.extractable};switch(t.kty){case"oct":t.k=e.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach((function(n){n in e&&(t[n]=e[n])}));break;default:throw new TypeError("Unsupported key type")}return t}function c(e){var n=l(e),r=!1;if("1.2.840.113549.1.1.1"!==(2<n.length&&(r=!0,n.shift()),e={ext:!0},n[0][0]))throw new TypeError("Unsupported key type");var o="n e d p q dp dq qi".split(" ");for(n=l(n[1]),r&&n.shift(),r=0;r<n.length;r++)n[r][0]||(n[r]=n[r].subarray(1)),e[o[r]]=t(i(n[r]));return e.kty="RSA",e}function l(e,t){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t||(t={pos:0,end:e.length}),2>t.end-t.pos||t.end>e.length)throw new RangeError("Malformed DER");var n=e[t.pos++],r=e[t.pos++];if(128<=r){if(r&=127,t.end-t.pos<r)throw new RangeError("Malformed DER");for(var o=0;r--;)o<<=8,o|=e[t.pos++];r=o}if(t.end-t.pos<r)throw new RangeError("Malformed DER");switch(n){case 2:n=e.subarray(t.pos,t.pos+=r);break;case 3:if(e[t.pos++])throw Error("Unsupported bit string");r--;case 4:n=new Uint8Array(e.subarray(t.pos,t.pos+=r)).buffer;break;case 5:n=null;break;case 6:if(!((e=btoa(i(e.subarray(t.pos,t.pos+=r))))in b))throw Error("Unsupported OBJECT ID "+e);n=b[e];break;case 48:for(n=[],r=t.pos+r;t.pos<r;)n.push(l(e,t));break;default:throw Error("Unsupported DER tag 0x"+n.toString(16))}return n}function u(e,t){t||(t=[]);var n=t.length+2;if(t.push(0,0),e instanceof Uint8Array)for(var i=2,o=e.length,s=0;s<o;s++)t.push(e[s]);else if(e instanceof ArrayBuffer)for(i=4,o=e.byteLength,e=new Uint8Array(e),s=0;s<o;s++)t.push(e[s]);else if(null===e)i=5,o=0;else if("string"==typeof e&&e in S)for(i=6,o=(e=r(atob(S[e]))).length,s=0;s<o;s++)t.push(e[s]);else if(e instanceof Array){for(s=0;s<e.length;s++)u(e[s],t);i=48,o=t.length-n}else{if(!("object"===X(e)&&3===e.tag&&e.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+e);for(i=3,o=(e=new Uint8Array(e.value)).byteLength,t.push(0),s=0;s<o;s++)t.push(e[s]);o++}if(128<=o){for(s=o,o=4,t.splice(n,0,s>>24&255,s>>16&255,s>>8&255,255&s);1<o&&!(s>>24);)s<<=8,o--;4>o&&t.splice(n,4-o),o|=128}return t.splice(n-2,2,i,o),t}function d(e,t,n,r){Object.defineProperties(this,{_key:{value:e},type:{value:e.type,enumerable:!0},extractable:{value:void 0===n?e.extractable:n,enumerable:!0},algorithm:{value:void 0===t?e.algorithm:t,enumerable:!0},usages:{value:void 0===r?e.usages:r,enumerable:!0}})}function h(e){return"verify"===e||"encrypt"===e||"wrapKey"===e}function p(e){return"sign"===e||"decrypt"===e||"unwrapKey"===e}if("function"!=typeof Promise)throw"Promise support required";var f=e.crypto||e.msCrypto;if(f){var m=f.subtle||f.webkitSubtle;if(m){var g=e.Crypto||f.constructor||Object,_=e.SubtleCrypto||m.constructor||Object;e.CryptoKey||e.Key;var E=-1<e.navigator.userAgent.indexOf("Edge/"),v=!!e.msCrypto&&!E,y=!f.subtle&&!!f.webkitSubtle;if(v||y){var b={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},S={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach((function(e){var t=m[e];m[e]=function(i,l,u){var g=[].slice.call(arguments);switch(e){case"generateKey":var _=o(i),E=l,b=u;break;case"importKey":_=o(u),E=g[3],b=g[4],"jwk"===i&&((l=a(l)).alg||(l.alg=s(_)),l.key_ops||(l.key_ops="oct"!==l.kty?"d"in l?b.filter(p):b.filter(h):b.slice()),g[1]=function(e){return e=a(e),v&&(e.extractable=e.ext,delete e.ext),r(unescape(encodeURIComponent(JSON.stringify(e)))).buffer}(l));break;case"unwrapKey":_=g[4],E=g[5],b=g[6],g[2]=u._key}if("generateKey"===e&&"HMAC"===_.name&&_.hash)return _.length=_.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[_.hash.name],m.importKey("raw",f.getRandomValues(new Uint8Array(_.length+7>>3)),_,E,b);if(y&&"generateKey"===e&&"RSASSA-PKCS1-v1_5"===_.name&&(!_.modulusLength||2048<=_.modulusLength))return(i=o(i)).name="RSAES-PKCS1-v1_5",delete i.hash,m.generateKey(i,!0,["encrypt","decrypt"]).then((function(e){return Promise.all([m.exportKey("jwk",e.publicKey),m.exportKey("jwk",e.privateKey)])})).then((function(e){return e[0].alg=e[1].alg=s(_),e[0].key_ops=b.filter(h),e[1].key_ops=b.filter(p),Promise.all([m.importKey("jwk",e[0],_,!0,e[0].key_ops),m.importKey("jwk",e[1],_,E,e[1].key_ops)])})).then((function(e){return{publicKey:e[0],privateKey:e[1]}}));if((y||v&&"SHA-1"===(_.hash||{}).name)&&"importKey"===e&&"jwk"===i&&"HMAC"===_.name&&"oct"===l.kty)return m.importKey("raw",r(n(l.k)),u,g[3],g[4]);if(y&&"importKey"===e&&("spki"===i||"pkcs8"===i))return m.importKey("jwk",c(l),u,g[3],g[4]);if(v&&"unwrapKey"===e)return m.decrypt(g[3],u,l).then((function(e){return m.importKey(i,e,g[4],g[5],g[6])}));try{var S=t.apply(m,g)}catch(e){return Promise.reject(e)}return v&&(S=new Promise((function(e,t){S.onabort=S.onerror=function(e){t(e)},S.oncomplete=function(t){e(t.target.result)}}))),S=S.then((function(e){return"HMAC"!==_.name||_.length||(_.length=8*e.algorithm.length),0==_.name.search("RSA")&&(_.modulusLength||(_.modulusLength=(e.publicKey||e).algorithm.modulusLength),_.publicExponent||(_.publicExponent=(e.publicKey||e).algorithm.publicExponent)),e.publicKey&&e.privateKey?{publicKey:new d(e.publicKey,_,E,b.filter(h)),privateKey:new d(e.privateKey,_,E,b.filter(p))}:new d(e,_,E,b)}))}})),["exportKey","wrapKey"].forEach((function(e){var o=m[e];m[e]=function(c,l,d){var f=[].slice.call(arguments);switch(e){case"exportKey":f[1]=l._key;break;case"wrapKey":f[1]=l._key,f[2]=d._key}if((y||v&&"SHA-1"===(l.algorithm.hash||{}).name)&&"exportKey"===e&&"jwk"===c&&"HMAC"===l.algorithm.name&&(f[0]="raw"),!y||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(f[0]="jwk"),v&&"wrapKey"===e)return m.exportKey(c,l).then((function(e){return"jwk"===c&&(e=r(unescape(encodeURIComponent(JSON.stringify(a(e)))))),m.encrypt(f[3],d,e)}));try{var g=o.apply(m,f)}catch(e){return Promise.reject(e)}return v&&(g=new Promise((function(e,t){g.onabort=g.onerror=function(e){t(e)},g.oncomplete=function(t){e(t.target.result)}}))),"exportKey"===e&&"jwk"===c&&(g=g.then((function(e){return(y||v&&"SHA-1"===(l.algorithm.hash||{}).name)&&"HMAC"===l.algorithm.name?{kty:"oct",alg:s(l.algorithm),key_ops:l.usages.slice(),ext:!0,k:t(i(e))}:((e=a(e)).alg||(e.alg=s(l.algorithm)),e.key_ops||(e.key_ops="public"===l.type?l.usages.filter(h):"private"===l.type?l.usages.filter(p):l.usages.slice()),e)}))),!y||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(g=g.then((function(e){var t=[["",null]],i=!1;if("RSA"!==(e=a(e)).kty)throw new TypeError("Unsupported key type");for(var o="n e d p q dp dq qi".split(" "),s=[],c=0;c<o.length&&o[c]in e;c++){var l=s[c]=r(n(e[o[c]]));128&l[0]&&(s[c]=new Uint8Array(l.length+1),s[c].set(l,1))}return 2<s.length&&(i=!0,s.unshift(new Uint8Array([0]))),t[0][0]="1.2.840.113549.1.1.1",t.push(new Uint8Array(u(s)).buffer),i?t.unshift(new Uint8Array([0])):t[1]={tag:3,value:t[1]},new Uint8Array(u(t)).buffer}))),g}})),["encrypt","decrypt","sign","verify"].forEach((function(e){var t=m[e];m[e]=function(n,r,i,s){if(v&&(!i.byteLength||s&&!s.byteLength))throw Error("Empty input is not allowed");var a=[].slice.call(arguments),c=o(n);if(!v||"sign"!==e&&"verify"!==e||"RSASSA-PKCS1-v1_5"!==n&&"HMAC"!==n||(a[0]={name:n}),v&&r.algorithm.hash&&(a[0].hash=a[0].hash||r.algorithm.hash),v&&"decrypt"===e&&"AES-GCM"===c.name){var l=n.tagLength>>3;a[2]=(i.buffer||i).slice(0,i.byteLength-l),n.tag=(i.buffer||i).slice(i.byteLength-l)}v&&"AES-GCM"===c.name&&void 0===a[0].tagLength&&(a[0].tagLength=128),a[1]=r._key;try{var u=t.apply(m,a)}catch(e){return Promise.reject(e)}return v&&(u=new Promise((function(t,n){u.onabort=u.onerror=function(e){n(e)},u.oncomplete=function(n){if(n=n.target.result,"encrypt"===e&&n instanceof AesGcmEncryptResult){var r=n.ciphertext,i=n.tag;(n=new Uint8Array(r.byteLength+i.byteLength)).set(new Uint8Array(r),0),n.set(new Uint8Array(i),r.byteLength),n=n.buffer}t(n)}}))),u}})),v){var T=m.digest;m.digest=function(e,t){if(!t.byteLength)throw Error("Empty input is not allowed");try{var n=T.call(m,e,t)}catch(e){return Promise.reject(e)}return n=new Promise((function(e,t){n.onabort=n.onerror=function(e){t(e)},n.oncomplete=function(t){e(t.target.result)}}))},e.crypto=Object.create(f,{getRandomValues:{value:function(e){return f.getRandomValues(e)}},subtle:{value:m}}),e.CryptoKey=d}y&&(f.subtle=m,e.Crypto=g,e.SubtleCrypto=_,e.CryptoKey=d)}}}}))}));var Jw=qa("match"),Lj=function(e){var t;return ha(e)&&(void 0!==(t=e[Jw])?!!t:"RegExp"==Zb(e))},Kw=[].push,Lw=Math.min;dh("split",2,(function(e,t,n){var r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(e,n){var r=String(jb(this));if(0===(n=void 0===n?4294967295:n>>>0))return[];if(void 0===e)return[r];if(!Lj(e))return t.call(r,e,n);var i,o,s,a=[],c=0;for(e=new RegExp(e.source,(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":"")+"g");(i=Of.call(e,r))&&!((o=e.lastIndex)>c&&(a.push(r.slice(c,i.index)),1<i.length&&i.index<r.length&&Kw.apply(a,i.slice(1)),s=i[0].length,c=o,a.length>=n));)e.lastIndex===i.index&&e.lastIndex++;return c===r.length?(s||!e.test(""))&&a.push(""):a.push(r.slice(c)),a.length>n?a.slice(0,n):a}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t;return[function(t,n){var i=jb(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,e,this,i,r!==t);if(o.done)return o.value;var s=va(e);e=String(this);var a=kd(s,RegExp);if(o=s.unicode,s=new a(pc?"^(?:"+s.source+")":s,(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(pc?"g":"y")),0===(i=void 0===i?4294967295:i>>>0))return[];if(0===e.length)return null===Ke(s,e)?[e]:[];var c=0,l=0;for(a=[];l<e.length;){s.lastIndex=pc?0:l;var u,d=Ke(s,pc?e.slice(l):e);if(null===d||(u=Lw(ta(s.lastIndex+(pc?l:0)),e.length))===c)l=xj(e,l,o);else{if(a.push(e.slice(c,l)),a.length===i)return a;for(c=1;c<=d.length-1;c++)if(a.push(d[c]),a.length===i)return a;l=c=u}}return a.push(e.slice(c)),a}]}),pc),function(e){e.console||(e.console={}),e=e.console;for(var t,n=function(){},r=["memory"],i="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");t=r.pop();)e[t]||(e[t]={});for(;t=i.pop();)e[t]||(e[t]=n)}("undefined"==typeof window?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R((function(){Vb(1)}));N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(e){return Vb(Qa(e))}});var ep=[].slice,Mj={},Nw=Function.bind||function(e){var t=yb(this),n=ep.call(arguments,1),r=function(){var i=n.concat(ep.call(arguments));if(this instanceof r){var o=i.length;if(!(o in Mj)){for(var s=[],a=0;a<o;a++)s[a]="a["+a+"]";Mj[o]=Function("C,a","return new C("+s.join(",")+")")}i=Mj[o](t,i)}else i=t.apply(e,i);return i};return ha(t.prototype)&&(r.prototype=t.prototype),r},Nj=mc("Reflect","construct"),fp=R((function(){function e(){}return!(Nj((function(){}),[],e)instanceof e)})),gp=!R((function(){Nj((function(){}))})),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(e,t){yb(e),va(t);var n=3>arguments.length?e:yb(arguments[2]);if(gp&&!fp)return Nj(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}return(n=[null]).push.apply(n,t),new(Nw.apply(e,n))}n=n.prototype,n=ac(ha(n)?n:Object.prototype);var r=Function.apply.call(e,n,t);return ha(r)?r:n}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R((function(){ip(1)}));N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(e,t){return ip(qb(e),t)}});var jp=Hd.f,Pw={}.toString,kp="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(e){if(kp&&"[object Window]"==Pw.call(e))try{var t=jp(e)}catch(e){t=kp.slice()}else t=jp(qb(e));return t},lp={f:qa},Qw=Ra.f,ph=function(e){var t=y.Symbol||(y.Symbol={});Q(t,e)||Qw(t,e,{value:lp.f(e)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R((function(){return 7!=ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=op(Ob,t);r&&delete Ob[t],od(e,t,n),r&&e!==Ob&&od(Ob,t,r)}:od,Uj=function(e,t){var n=Lc[e]=ac(sb.prototype);return Rw(n,{type:"Symbol",tag:e,description:t}),ka||(n.description=t),n},Vj=vn?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof sb},qh=function(e,t,n){return e===Ob&&qh(Uf,t,n),va(e),t=lc(t,!0),va(n),Q(Lc,t)?(n.enumerable?(Q(e,rb)&&e[rb][t]&&(e[rb][t]=!1),n=ac(n,{enumerable:dd(0,!1)})):(Q(e,rb)||od(e,rb,dd(1,{})),e[rb][t]=!0),Tj(e,t,n)):od(e,t,n)},qp=function(e,t){va(e);var n=qb(t);return t=Dc(n).concat(Wj(n)),Jd(t,(function(t){ka&&!Xj.call(n,t)||qh(e,t,n[t])})),e},Xj=function(e){e=lc(e,!0);var t=Sw.call(this,e);return!(this===Ob&&Q(Lc,e)&&!Q(Uf,e))&&(!(t||!Q(this,e)||!Q(Lc,e)||Q(this,rb)&&this[rb][e])||t)},rp=function(e,t){if(e=qb(e),t=lc(t,!0),e!==Ob||!Q(Lc,t)||Q(Uf,t)){var n=op(e,t);return!n||!Q(Lc,t)||Q(e,rb)&&e[rb][t]||(n.enumerable=!0),n}},sp=function(e){e=pp(qb(e));var t=[];return Jd(e,(function(e){Q(Lc,e)||Q(Be,e)||t.push(e)})),t},Wj=function(e){var t=e===Ob;e=pp(t?Uf:qb(e));var n=[];return Jd(e,(function(e){!Q(Lc,e)||t&&!Q(Ob,e)||n.push(Lc[e])})),n};if(oc||(sb=function(){if(this instanceof sb)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=Ae(e),n=function(e){this===Ob&&n.call(Uf,e),Q(this,rb)&&Q(this[rb],t)&&(this[rb][t]=!1),Tj(this,t,dd(1,e))};return ka&&Sj&&Tj(Ob,t,{configurable:!0,set:n}),Uj(t,e)},Ta(sb.prototype,"toString",(function(){return np(this).tag})),Ta(sb,"withoutSetter",(function(e){return Uj(Ae(e),e)})),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(e){return Uj(qa(e),e)},ka&&(od(sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:sb}),Jd(Dc(Tw),(function(e){ph(e)})),N({target:"Symbol",stat:!0,forced:!oc},{for:function(e){if(e=String(e),Q(Pj,e))return Pj[e];var t=sb(e);return Pj[e]=t,Qj[t]=e,t},keyFor:function(e){if(!Vj(e))throw TypeError(e+" is not a symbol");if(Q(Qj,e))return Qj[e]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(e,t){return void 0===t?ac(e):qp(ac(e),t)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R((function(){Bf.f(1)}))},{getOwnPropertySymbols:function(e){return Bf.f(Qa(e))}}),Tf){var Uw=!oc||R((function(){var e=sb();return"[null]"!=Tf([e])||"{}"!=Tf({a:e})||"{}"!=Tf(Object(e))}));N({target:"JSON",stat:!0,forced:Uw},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(ha(t)||void 0!==e)&&!Vj(e))return gd(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Vj(t))return t}),i[1]=t,Tf.apply(null,i)}})}sb.prototype[mp]||Na(sb.prototype,mp,sb.prototype.valueOf),Ec(sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&"function"==typeof Mc&&(!("description"in Mc.prototype)||void 0!==Mc().description)){var tp={},Vf=function(){var e=1>arguments.length||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Vf?new Mc(e):void 0===e?Mc():Mc(e);return""===e&&(tp[t]=!0),t};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw="Symbol(test)"==String(Mc("test")),Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var e=ha(this)?this.valueOf():this,t=Ww.call(e);return Q(tp,e)?"":""===(e=Xw?t.slice(7,-1):t.replace(Yw,"$1"))?void 0:e}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}var c=function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return n(t,[{key:"addEventListener",value:function(e,t,n){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:n})}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=0,r=(e=this.listeners[e]).length;n<r;n++)if(e[n].callback===t){e.splice(n,1);break}}},{key:"dispatchEvent",value:function(e){if(e.type in this.listeners){for(var t=this.listeners[e.type].slice(),n=0,r=t.length;n<r;n++){var i=t[n];try{i.callback.call(this,e)}catch(e){Promise.resolve().then((function(){throw e}))}i.options&&i.options.once&&this.removeEventListener(e.type,i.callback)}return!e.defaultPrevented}}}]),t}(),l=function(t){function o(){e(this,o);var t=l.call(this);return t.listeners||c.call(s(t)),Object.defineProperty(s(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(s(t),"onabort",{value:null,writable:!0,configurable:!0}),t}r(o,t);var l=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n=i(e);if(t){var r=i(this).constructor;n=Reflect.construct(n,arguments,r)}else n=n.apply(this,arguments);return!n||"object"!==X(n)&&"function"!=typeof n?s(this):n}}(o);return n(o,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),a(i(o.prototype),"dispatchEvent",this).call(this,e)}}]),o}(c),u=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new l,writable:!0,configurable:!0})}return n(t,[{key:"abort",value:function(){try{var e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(u.prototype[Symbol.toStringTag]="AbortController",l.prototype[Symbol.toStringTag]="AbortSignal"),function(e){if(e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var t=!0}else t="function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController;t&&(e.AbortController=u,e.AbortSignal=l)}("undefined"!=typeof self?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-Zw($w(e+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(e){return 31-bx(e>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(e){if(e=e&&e.buffer||e,up.call(e)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var t="",n=0,r=0|(e=Zj?new ak(e):e).length;n<r;n=n+32768|0)t+=xd.apply(0,e[Zj?"slice":"subarray"](n,n+32768|0));return t.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(e){for(var t=0|(e=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,n=new ak(t),r=0;r<t;r=r+1|0)n[r]=e.charCodeAt(r);return n},window.TextEncoder||(window.TextEncoder=yl),function(e){var t,n,r,i,o,s,a,c,l,u,d;!function(e){e.LOGIN="LOGIN",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.LOGIN_FAILURE="LOGIN_FAILURE",e.LOGIN_TIMEOUT="LOGIN_TIMEOUT",e.INTERRUPTED="INTERRUPTED",e.LOGOUT="LOGOUT",e.BANNED_BY_SERVER="BANNED_BY_SERVER",e.REMOTE_LOGIN="REMOTE_LOGIN"}(t||(t={})),e.ConnectionChangeReason=t,function(e){e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECTING="RECONNECTING",e.ABORTED="ABORTED"}(n||(n={})),e.ConnectionState=n,function(e){e.IDLE="IDLE",e.SENT_TO_REMOTE="SENT_TO_REMOTE",e.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",e.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",e.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(r||(r={})),e.LocalInvitationState=r,function(e){e.INVITATION_RECEIVED="INVITATION_RECEIVED",e.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",e.REFUSED="REFUSED",e.ACCEPTED="ACCEPTED",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(i||(i={})),e.RemoteInvitationState=i,function(e){e.UNKNOWN="UNKNOWN",e.PEER_NO_RESPONSE="PEER_NO_RESPONSE",e.INVITATION_EXPIRE="INVITATION_EXPIRE",e.PEER_OFFLINE="PEER_OFFLINE",e.NOT_LOGGEDIN="NOT_LOGGEDIN"}(o||(o={})),e.LocalInvitationFailureReason=o,function(e){e.UNKNOWN="UNKNOWN",e.PEER_OFFLINE="PEER_OFFLINE",e.ACCEPT_FAILURE="ACCEPT_FAILURE",e.INVITATION_EXPIRE="INVITATION_EXPIRE"}(s||(s={})),e.RemoteInvitationFailureReason=s,function(e){e.ONLINE="ONLINE",e.UNREACHABLE="UNREACHABLE",e.OFFLINE="OFFLINE"}(a||(a={})),e.PeerOnlineState=a,(c||(c={})).ONLINE_STATUS="ONLINE_STATUS",e.PeerSubscriptionOption=c,function(e){e.TEXT="TEXT",e.RAW="RAW",e.IMAGE="IMAGE",e.FILE="FILE"}(l||(l={})),e.MessageType=l,function(e){e.CN="CN",e.NA="NA",e.EU="EU",e.AS="AS",e.JP="JP",e.IN="IN",e.GLOB="GLOB",e.OC="OC",e.SA="SA",e.AF="AF",e.OVS="OVS"}(u||(u={})),e.LegacyAreaCode=u,function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"}(d||(d={})),e.AreaCode=d}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(e){return on(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(e){if(Lj(e))throw TypeError("The method doesn't accept regular expressions");return e},ex=qa("match"),dk=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[ex]=!1,"/./"[e](t)}catch(e){}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(e){return!!~String(jb(this)).indexOf(ck(e),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(e){return Jd(this,e,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch(c){rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a((function(e){e=function(e){function t(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function n(e,t,n,o){return t=Object.create((t&&t.prototype instanceof i?t:i).prototype),o=new h(o||[]),t._invoke=function(e,t,n){var i=S;return function(o,s){if(i===w)throw Error("Generator is already running");if(i===C){if("throw"===o)throw s;return f()}for(n.method=o,n.arg=s;;){if((o=n.delegate)&&(o=l(o,n))){if(o===R)continue;return o}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===S)throw i=C,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);if(i=w,"normal"===(o=r(e,t,n)).type){if(i=n.done?C:T,o.arg===R)continue;return{value:o.arg,done:n.done}}"throw"===o.type&&(i=C,n.method="throw",n.arg=o.arg)}}}(e,n,o),t}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function o(){}function s(){}function a(e){["next","throw","return"].forEach((function(n){t(e,n,(function(e){return this._invoke(n,e)}))}))}function c(e,t){function n(i,o,s,a){if("throw"!==(i=r(e[i],e,o)).type){var c=i.arg;return(i=c.value)&&"object"===X(i)&&_.call(i,"__await")?t.resolve(i.__await).then((function(e){n("next",e,s,a)}),(function(e){n("throw",e,s,a)})):t.resolve(i).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,a)}))}a(i.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function l(e,t){var n=e.iterator[t.method];if(n===m){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=m,l(e,t),"throw"===t.method))return R;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return R}return"throw"===(n=r(n,e.iterator,t.arg)).type?(t.method="throw",t.arg=n.arg,t.delegate=null,R):(n=n.arg)?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=m),t.delegate=null,R):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,R)}function u(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function d(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function h(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(u,this),this.reset(!0)}function p(e){if(e){var t=e[v];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1;return(t=function t(){for(;++n<e.length;)if(_.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=m,t.done=!0,t}).next=t}}return{next:f}}function f(){return{value:m,done:!0}}var m,g=Object.prototype,_=g.hasOwnProperty,E="function"==typeof Symbol?Symbol:{},v=E.iterator||"@@iterator",y=E.asyncIterator||"@@asyncIterator",b=E.toStringTag||"@@toStringTag";try{t({},"")}catch(e){t=function(e,t,n){return e[t]=n}}e.wrap=n;var S="suspendedStart",T="suspendedYield",w="executing",C="completed",R={};t(E={},v,(function(){return this}));var I=Object.getPrototypeOf;(I=I&&I(I(p([]))))&&I!==g&&_.call(I,v)&&(E=I);var O=s.prototype=i.prototype=Object.create(E);return o.prototype=s,t(O,"constructor",s),t(s,"constructor",o),o.displayName=t(s,b,"GeneratorFunction"),e.isGeneratorFunction=function(e){return!!(e="function"==typeof e&&e.constructor)&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,t(e,b,"GeneratorFunction")),e.prototype=Object.create(O),e},e.awrap=function(e){return{__await:e}},a(c.prototype),t(c.prototype,y,(function(){return this})),e.AsyncIterator=c,e.async=function(t,r,i,o,s){void 0===s&&(s=Promise);var a=new c(n(t,r,i,o),s);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},a(O),t(O,b,"Generator"),t(O,v,(function(){return this})),t(O,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t,n=[];for(t in e)n.push(t);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=p,h.prototype={constructor:h,reset:function(e){if(this.next=this.prev=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(d),!e)for(var t in this)"t"===t.charAt(0)&&_.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,r){return o.type="throw",o.arg=e,n.next=t,r&&(n.method="next",n.arg=m),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=_.call(i,"catchLoc"),a=_.call(i,"finallyLoc");if(s&&a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!a)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&_.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}return i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null),(n=i?i.completion:{}).type=e,n.arg=t,i?(this.method="next",this.next=i.finallyLoc,R):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),R},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),d(n),R}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.tryLoc===e){if("throw"===(e=n.completion).type){var r=e.arg;d(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:p(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=m),R}},e}(e.exports);try{regeneratorRuntime=e}catch(t){"object"===("undefined"==typeof globalThis?"undefined":X(globalThis))?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})),yp=!R((function(){return Object.isExtensible(Object.preventExtensions({}))})),fk=$a((function(e){var t=Ra.f,n=Ae("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},s=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!ha(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Q(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!Q(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return yp&&s.REQUIRED&&i(e)&&!Q(e,n)&&o(e),e}};Be[n]=!0})),zp=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",s=y[e],a=s&&s.prototype,c=s,l={},u=function(e){var t=a[e];Ta(a,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!ha(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!ha(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!ha(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(nc(e,"function"!=typeof s||!(i||a.forEach&&!R((function(){(new s).entries().next()})))))c=n.getConstructor(t,e,r,o),fk.REQUIRED=!0;else if(nc(e,!0)){var d=new c,h=d[o](i?{}:-0,1)!=d,p=R((function(){d.has(1)})),f=Tg((function(e){new s(e)})),m=!i&&R((function(){for(var e=new s,t=5;t--;)e[o](t,t);return!e.has(-0)}));f||((c=t((function(t,n){return Gc(t,c,e),t=lh(new s,t,c),null!=n&&Xg(n,t[o],{that:t,AS_ENTRIES:r}),t}))).prototype=a,a.constructor=c),(p||m)&&(u("delete"),u("has"),r&&u("get")),(m||h)&&u(o),i&&a.clear&&delete a.clear}return l[e]=c,N({global:!0,forced:c!=s},l),Ec(c,e),i||n.setStrong(c,e,r),c},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(e,t,n,r){var i=e((function(e,o){Gc(e,i,t),Bp(e,{type:t,index:ac(null),first:void 0,last:void 0,size:0}),ka||(e.size=0),null!=o&&Xg(o,e[r],{that:e,AS_ENTRIES:n})})),o=gk(t),s=function(e,t,n){var r,i=o(e),s=a(e,t);return s?s.value=n:(i.last=s={index:r=Ap(t,!0),key:t,value:n,previous:t=i.last,next:void 0,removed:!1},i.first||(i.first=s),t&&(t.next=s),ka?i.size++:e.size++,"F"!==r&&(i.index[r]=s)),e},a=function(e,t){e=o(e);var n=Ap(t);if("F"!==n)return e.index[n];for(e=e.first;e;e=e.next)if(e.key==t)return e};return Hf(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,ka?e.size=0:this.size=0},delete:function(e){var t=o(this);if(e=a(this,e)){var n=e.next,r=e.previous;delete t.index[e.index],e.removed=!0,r&&(r.next=n),n&&(n.previous=r),t.first==e&&(t.first=n),t.last==e&&(t.last=r),ka?t.size--:this.size--}return!!e},forEach:function(e){for(var t,n=o(this),r=Id(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),Hf(i.prototype,n?{get:function(e){return(e=a(this,e))&&e.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),ka&&gx(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=gk(t),o=gk(r);bj(e,t,(function(e,t){Bp(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),If(t)}};zp("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(e){return function(t){return t=String(jb(t)),1&e&&(t=t.replace(hx,"")),2&e&&(t=t.replace(ix,"")),t}};hk(1),hk(2);var ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=8!==sh("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff08")||22!==sh("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff0x16")?function(e,t){return e=ik(String(e)),sh(e,t>>>0||(jx.test(e)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx="Number"==Zb(ac(th)),Ep=function(e){var t,n=lc(e,!1);if("string"==typeof n&&2<n.length)if(43===(e=(n=ik(n)).charCodeAt(0))||45===e){if(88===(e=n.charCodeAt(2))||120===e)return NaN}else if(48===e){switch(n.charCodeAt(1)){case 66:case 98:e=2;var r=49;break;case 79:case 111:e=8,r=55;break;default:return+n}var i=(n=n.slice(2)).length;for(t=0;t<i;t++){var o=n.charCodeAt(t);if(48>o||o>r)return NaN}return parseInt(n,e)}return+n};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function(e){var t=1>arguments.length?0:e,n=this;return n instanceof Pd&&(nx?R((function(){th.valueOf.call(n)})):"Number"!=Zb(n))?lh(new pd(Ep(t)),n,Pd):Ep(t)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R((function(){var e=[];return e[Gp]=!1,e.concat()[0]!==e})),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(e){var t,n=Qa(this),r=Sg(n,0),i=0,o=-1;for(t=arguments.length;o<t;o++){var s=-1===o?n:arguments[o],a=s;if(ha(a)){var c=a[Gp];a=void 0!==c?!!c:gd(a)}else a=!1;if(a){if(9007199254740991<i+(c=ta(s.length)))throw TypeError("Maximum allowed index exceeded");for(a=0;a<c;a++,i++)a in s&&Ge(r,i,s[a])}else{if(9007199254740991<=i)throw TypeError("Maximum allowed index exceeded");Ge(r,i++,s)}}return r.length=i,r}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R((function(){kk((function(){}))}));N({target:"Reflect",stat:!0,forced:rx},{apply:function(e,t,n){return yb(e),va(n),kk?kk(e,t,n):qx.call(e,t,n)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R((function(){return!Object.getOwnPropertyNames(1)}));N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe="object"===("undefined"==typeof Reflect?"undefined":X(Reflect))?Reflect:null,Hp=Pe&&"function"==typeof Pe.apply?Pe.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},ux=Pe&&"function"==typeof Pe.ownKeys?Pe.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},Ip=Number.isNaN||function(e){return e!=e};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(e){if("number"!=typeof e||0>e||Ip(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Jp=e}}),ea.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||Ip(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ea.prototype.getMaxListeners=function(){return void 0===this._maxListeners?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);n="error"===e;var r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var i;if(0<t.length&&(i=t[0]),i instanceof Error)throw i;throw(t=Error("Unhandled error."+(i?" ("+i.message+")":""))).context=i,t}if(void 0===(n=r[e]))return!1;if("function"==typeof n)Hp(n,this,t);else for(r=Cl(n,i=n.length),n=0;n<i;++n)Hp(r[n],this,t);return!0},ea.prototype.addListener=function(e,t){return zl(this,e,t,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(e,t){return zl(this,e,t,!0)},ea.prototype.once=function(e,t){return ng(t),this.on(e,Al(this,e,t)),this},ea.prototype.prependOnceListener=function(e,t){return ng(t),this.prependListener(e,Al(this,e,t)),this},ea.prototype.removeListener=function(e,t){var n;ng(t);var r=this._events;if(void 0===r)return this;var i=r[e];if(void 0===i)return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){var o=-1;for(n=i.length-1;0<=n;n--)if(i[n]===t||i[n].listener===t){var s=i[n].listener;o=n;break}if(0>o)return this;if(0===o)i.shift();else{for(;o+1<i.length;o++)i[o]=i[o+1];i.pop()}1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(e){var t=this._events;if(void 0===t)return this;if(void 0===t.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==t[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete t[e]),this;if(0===arguments.length){var n=Object.keys(t);for(t=0;t<n.length;++t){var r=n[t];"removeListener"!==r&&this.removeAllListeners(r)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=t[e]))this.removeListener(e,n);else if(void 0!==n)for(t=n.length-1;0<=t;t--)this.removeListener(e,n[t]);return this},ea.prototype.listeners=function(e){return Bl(this,e,!0)},ea.prototype.rawListeners=function(e){return Bl(this,e,!1)},ea.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Dl.call(e,t)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}El(e,t,o,{once:!0}),"error"!==t&&vs(e,i,{once:!0})}))};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R((function(){if(ka&&1!==Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=Qe({},e)[n]||"abcdefghijklmnopqrst"!=Dc(Qe({},t)).join("")}))?function(e,t){for(var n=Qa(e),r=arguments.length,i=1,o=Bf.f,s=zf;r>i;)for(var a,c=Af(arguments[i++]),l=o?Dc(c).concat(o(c)):Dc(c),u=l.length,d=0;u>d;)a=l[d++],(!ka||s.call(c,a))&&(n[a]=c[a]);return n}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(e){return vx(e)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R((function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||"/a/i"!=sc(Wf,"i")})))){for(var Oc=function(e,t){var n,r=this instanceof Oc,i=Lj(e),o=void 0===t;return!r&&i&&e.constructor===Oc&&o||(nk?i&&!o&&(e=e.source):e instanceof Oc&&(o&&(t=tj.call(e)),e=e.source),pc&&(n=!!t&&-1<t.indexOf("y"))&&(t=t.replace(/y/g,"")),e=lh(nk?new sc(e,t):sc(e,t),r?this:lk,Oc),pc&&n&&(zx(e).sticky=!0)),e},Bx=function(e){e in Oc||xx(Oc,e,{configurable:!0,get:function(){return sc[e]},set:function(t){sc[e]=t}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Sf("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Sf("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Sf("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var ok=function(e,t){return e===t?0:null==e?null==t?0:-1:null==t?null==e?0:1:"function"==typeof e.compare?e.compare(t):"function"==typeof t.compare?-t.compare(e):e<t?-1:e>t?1:0},pk=[],Op=pk.sort,Cx=R((function(){pk.sort(void 0)})),Dx=R((function(){pk.sort(null)})),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(e){return void 0===e?Op.call(Qa(this)):Op.call(Qa(this),yb(e))}});var Pp=Object.getPrototypeOf({}),Xf=function(e,t){var n;return e===t||(null==e?e==t:"function"===X(e.equiv)?e.equiv(t):null==t?e==t:"function"===X(t.equiv)?t.equiv(e):"string"!==X(e)&&"string"!==X(t)&&(null!=(n=Object.getPrototypeOf(e))&&n!==Pp||null!=(n=Object.getPrototypeOf(t))&&n!==Pp?"function"!==X(e)&&void 0!==e.length&&"function"!==X(t)&&void 0!==t.length?Gx(e,t):e instanceof Set&&t instanceof Set?Hx(e,t):e instanceof Map&&t instanceof Map?Ix(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:Fx(e,t)))},Gx=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf,r=e.length;if(r===t.length)for(;0<=--r&&n(e[r],t[r]););return 0>r},Hx=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf;return e.size===t.size&&n(G(e.keys()).sort(),G(t.keys()).sort())},Ix=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf;return e.size===t.size&&n(G(e).sort(),G(t).sort())},Fx=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(!t.hasOwnProperty(r)||!n(e[r],t[r]))return!1;return!0},Qp=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return void 0!==e?": "+e:""};return function(n){function r(n){return W(this,r),i.call(this,e(n)+t(n))}la(r,n);var i=ma(r);return r}(ef(Error))},Jx=Qp((function(){return"illegal argument(s)"})),vh=function(e){throw new Jx(e)},qk=Qp((function(){return"index out of bounds"})),Rp=1/4294967295,Kx=function(){function e(){W(this,e)}return Ha(e,[{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return this.int()*Rp*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(this.int()*Rp-.5)*e}},{key:"minmax",value:function(e,t){return this.float()*(t-e)+e}}]),e}(),rk=Math.random,Lx=new(function(e){function t(){return W(this,t),n.apply(this,arguments)}la(t,e);var n=ma(t);return Ha(t,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return rk()*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(rk()-.5)*e}}]),t}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R((function(){sk(1)}));N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(e){return sk&&ha(e)?sk(Mx(e)):e}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(e){return Wo(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(e){return null!=e&&"function"==typeof e.xform?e.xform():e},og=function(){function e(t){W(this,e),this.value=t}return Ha(e,[{key:"deref",value:function(){return this.value}}]),e}(),Wh=function(e){return e instanceof og?e.deref():e},xs=function(e,t){return[e,function(e){return e},t]},Qx=w.mark((function(e,t){var n,r,i,o,s,a;return w.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=Gl(e)(ws()),r=n[1],i=n[2],o=0;case 4:if(!(o<t.length)){c.next=15;break}if(s=t[o],!((a=i([],s))instanceof og)){c.next=10;break}return c.delegateYield(Wh(r(a.deref())),"t0",9);case 9:return c.abrupt("return");case 10:if(!a.length){c.next=12;break}return c.delegateYield(a,"t1",12);case 12:o++,c.next=4;break;case 15:return c.delegateYield(Wh(r([])),"t2",16);case 16:case"end":return c.stop()}}),Qx)})),ys=w.mark(Fl),zs=function(e,t){return[e[0],e[1],t]},Sp=!0;"findIndex"in[]&&Array(1).findIndex((function(){Sp=!1})),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(e){return An(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function e(t){W(this,e),this._length=0,t&&this.into(t)}return Ha(e,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new e(this)}},{key:"empty",value:function(){return new e}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var e,t=this.head;t;)e=t.next,delete t.value,delete t.prev,delete t.next,t=e;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(e){var t=this._length;if(t<e._length)return-1;if(t>e._length)return 1;if(0===t)return 0;t=this.head,e=e.head;for(var n=0;t&&0==n;)n=ok(t.value,e.value),t=t.next,e=e.next;return n}},{key:"equiv",value:function(t){if(!(t instanceof e||null!=t&&"function"!=typeof t&&void 0!==t.length)||this._length!==t.length)return!1;if(!this._length||this===t)return!0;for(var n=this.head,r=0;r<t.length;r++){if(!Xf(n.value,t[r]))return!1;n=n.next}return!0}},{key:Symbol.iterator,value:w.mark((function e(){var t;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.head;case 1:if(!t){e.next=7;break}return e.next=4,t.value;case 4:t=t.next,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"seq",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;if(!(e>=t||0>e)){e=this.nthCell(e);var n=this.nthCell(t-1);return t=function e(t){return{first:function(){return t.value},next:function(){return t!==n&&t.next?e(t.next):void 0}}},e?t(e):void 0}}},{key:"cycle",value:w.mark((function e(){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this,"t0",2);case 2:e.next=0;break;case 4:case"end":return e.stop()}}),e,this)}))},{key:"$reduce",value:function(e,t){for(var n=this.head;n&&!(t instanceof og);)t=e(t,n.value),n=n.next;return t}},{key:"drop",value:function(){var e=this.head;if(e)return(this.head=e.next)?delete this.head.prev:delete this.tail,this._length--,e.value}},{key:"cons",value:function(e){return e={value:e,next:this.head},this.head?this.head.prev=e:this.tail=e,this.head=e,this._length++,this}},{key:"insertBefore",value:function(e,t){return e||vh("cell is undefined"),t={value:t,next:e,prev:e.prev},e.prev?e.prev.next=t:this.head=t,e.prev=t,this._length++,this}},{key:"insertAfter",value:function(e,t){return e||vh("cell is undefined"),t={value:t,next:e.next,prev:e},e.next?e.next.prev=t:this.tail=t,e.next=t,this._length++,this}},{key:"insertBeforeNth",value:function(e,t){if(0>e&&(e+=this._length),0>=e)return this.cons(t);if(0>e||e>=this._length)throw new qk(e);return this.insertBefore(this.nthCellUnsafe(e),t)}},{key:"insertAfterNth",value:function(e,t){if(0>e&&(e+=this._length),e>=this._length-1)return this.push(t);if(0>e||e>=this._length)throw new qk(e);return this.insertAfter(this.nthCellUnsafe(e),t)}},{key:"insertSorted",value:function(e,t){t=t||ok;for(var n=this.head;n;){if(0>=t(e,n.value))return this.insertBefore(n,e);n=n.next}return this.push(e)}},{key:"find",value:function(e){for(var t=this.head;t;){if(t.value===e)return t;t=t.next}}},{key:"findWith",value:function(e){for(var t=this.head;t;){if(e(t.value))return t;t=t.next}}},{key:"concat",value:function(){for(var e=this.copy(),t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e.into(n[t]);return e}},{key:"into",value:function(e){for(var t=0;t<e.length;t++)this.push(e[t])}},{key:"slice",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;t=0>t?t+this._length:t,n=0>n?n+this._length:n,(0>t||0>n)&&vh("invalid indices: ${from} / ${to}");for(var r=new e,i=this.nthCell(t);i&&++t<=n;)r.push(i.value),i=i.next;return r}},{key:"splice",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length?arguments[2]:void 0;if("number"==typeof t){if(0>t&&(t+=this._length),0>t||t>=this._length)throw new qk(t);var i=this.nthCellUnsafe(t)}else i=t;var o=new e;if(0<n)for(;i&&0<n--;)this.remove(i),o.push(i.value),i=i.next;else i&&(i=i.next);if(r)if(i)for(n=0;n<r.length;n++)this.insertBefore(i,r[n]);else for(i=0;i<r.length;i++)this.push(r[i]);return o}},{key:"remove",value:function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,this._length--,this}},{key:"swap",value:function(e,t){if(e!==t){var n=e.value;e.value=t.value,t.value=n}return this}},{key:"push",value:function(e){return this.tail?(e={value:e,prev:this.tail},this.tail=this.tail.next=e,this._length++,this):this.cons(e)}},{key:"pop",value:function(){var e=this.tail;if(e)return(this.tail=e.prev)?delete this.tail.next:delete this.head,this._length--,e.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(e){return this.head?(this.head.value=e,this):this.cons(e)}},{key:"setTail",value:function(e){return this.tail?(this.tail.value=e,this):this.push(e)}},{key:"setNth",value:function(e,t){var n=this.nthCell(e);return!n&&vh("index out of bounds: ".concat(e)),n.value=t,this}},{key:"nth",value:function(e,t){return(e=this.nthCell(e))?e.value:t}},{key:"nthCell",value:function(e){if(0>e&&(e+=this._length),!(0>e||e>=this._length))return this.nthCellUnsafe(e)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var e=this.peek();return this.pop(),this.cons(e)}}},{key:"map",value:function(t){for(var n=new e,r=this.head;r;)n.push(t(r.value)),r=r.next;return n}},{key:"filter",value:function(t){for(var n=new e,r=this.head;r;)t(r.value)&&n.push(r.value),r=r.next;return n}},{key:"reduce",value:function(e,t){for(var n=this.head;n;)t=e(t,n.value),n=n.next;return t}},{key:"shuffle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Lx;if(2>this._length)return this;for(e=null!=e?e:Math.ceil(1.5*Math.log2(this._length));0<e;e--)for(var n=this.head;n;){var r=n.next;.5>t.float()?this.asHead(n):this.asTail(n),n=r}return this}},{key:"sort",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:ok;if(!this._length)return this;for(var t=1;;){var n=this.head;this.tail=this.head=void 0;for(var r=0;n;){r++;for(var i=n,o=0,s=0;s<t&&(o++,i=i.next);s++);for(s=t;0<o||0<s&&i;){if(0===o){var a=i;i=i.next,s--}else i&&0!==s?0>=e(n.value,i.value)?(a=n,n=n.next,o--):(a=i,i=i.next,s--):(a=n,n=n.next,o--);this.tail?this.tail.next=a:this.head=a,a.prev=this.tail,this.tail=a}n=i}if(this.tail.next=void 0,1>=r)return this;t*=2}}},{key:"reverse",value:function(){for(var e=this.head,t=this.tail,n=(this._length>>>1)+(1&this._length);e&&t&&0<n;){var r=e.value;e.value=t.value,t.value=r,e=e.next,t=t.prev,n--}return this}},{key:"asHead",value:function(e){return e===this.head||(this.remove(e),this.head.prev=e,e.next=this.head,e.prev=void 0,this.head=e,this._length++),this}},{key:"asTail",value:function(e){return e===this.tail||(this.remove(e),this.tail.next=e,e.prev=this.tail,e.next=void 0,this.tail=e,this._length++),this}},{key:"toString",value:function(){for(var e=[],t=this.head;t;)e.push(String(t.value)),t=t.next;return e.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(e){if(e<=this._length>>1)var t=this.head,n="next";else t=this.tail,n="prev",e=this._length-e-1;for(;0<e--&&t;)t=t[n];return t}}]),e}(),tc=function(){function e(t,n){W(this,e),n=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},n),this.map=n.map(),this.items=new Rx,this._size=0,this.opts=n,t&&this.into(t)}return Ha(e,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg((function(e){return[e.k,e]}),this.items)}},{key:"keys",value:function(){return pg((function(e){return e.k}),this.items)}},{key:"values",value:function(){return pg((function(e){return e.v}),this.items)}},{key:"copy",value:function(){var e=this.empty();e.items=this.items.copy();for(var t=e.items.head;t;)e.map.set(t.value.k,t),t=t.next;return e}},{key:"empty",value:function(){return new e(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var e=this.opts.release;if(e){for(var t;t=this.items.drop();)e(t.k,t.v);return!0}return this.items.release()}},{key:"has",value:function(e){return this.map.has(e)}},{key:"get",value:function(e,t){return(e=this.map.get(e))?this.resetEntry(e):t}},{key:"set",value:function(e,t){var n=this.opts.ksize(e)+this.opts.vsize(t),r=this.map.get(e);return this._size+=Math.max(0,n-(r?r.value.s:0)),this.ensureSize()&&this.doSetEntry(r,e,t,n),t}},{key:"into",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.set(n[0],n[1])}return this}},{key:"getSet",value:function(e,t){var n=this,r=this.map.get(e);return r?Promise.resolve(this.resetEntry(r)):t().then((function(t){return n.set(e,t)}))}},{key:"delete",value:function(e){return!!(e=this.map.get(e))&&(this.removeEntry(e),!0)}},{key:"resetEntry",value:function(e){return this.items.asTail(e),e.value.v}},{key:"ensureSize",value:function(){for(var e=this.opts.release,t=this.opts.maxsize,n=this.opts.maxlen;this._size>t||this.length>=n;){var r=this.items.drop();if(!r)return!1;this.map.delete(r.k),e&&e(r.k,r.v),this._size-=r.s}return!0}},{key:"removeEntry",value:function(e){var t=e.value;this.map.delete(t.k),this.items.remove(e),this.opts.release&&this.opts.release(t.k,t.v),this._size-=t.s}},{key:"doSetEntry",value:function(e,t,n,r){e?(e.value.v=n,e.value.s=r,this.items.asTail(e)):(this.items.push({k:t,v:n,s:r}),this.map.set(t,this.items.tail))}}]),e}(),Sx=function(e){function t(e,r){return W(this,t),r=Object.assign({ttl:36e5},r),n.call(this,e,r)}la(t,e);var n=ma(t);return Ha(t,[{key:"empty",value:function(){return new t(null,this.opts)}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"get",value:function(e,t){if(e=this.map.get(e)){if(e.value.t>=Date.now())return this.resetEntry(e);this.removeEntry(e)}return t}},{key:"set",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,r=this.opts.ksize(e)+this.opts.vsize(t),i=this.map.get(e);return this._size+=Math.max(0,r-(i?i.value.s:0)),this.ensureSize()&&(n=Date.now()+n,i?(i.value.v=t,i.value.s=r,i.value.t=n,this.items.asTail(i)):(this.items.push({k:e,v:t,s:r,t:n}),this.map.set(e,this.items.tail))),t}},{key:"getSet",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,i=this.get(e);return i?Promise.resolve(i):t().then((function(t){return n.set(e,t,r)}))}},{key:"prune",value:function(){for(var e=Date.now(),t=this.items.head;t;)t.value.t<e&&this.removeEntry(t),t=t.next}},{key:"ensureSize",value:function(){for(var e=this.opts.maxsize,n=this.opts.maxlen,r=Date.now(),i=this.items.head;i&&(this._size>e||this.length>=n);)i.value.t<r&&this.removeEntry(i),i=i.next;return Th(wd(t.prototype),"ensureSize",this).call(this)}}]),t}(tc),Tp="object"==X(Ya)&&Ya&&Ya.Object===Object&&Ya,Tx="object"==("undefined"==typeof self?"undefined":X(self))&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(e){if(null==e)e=void 0===e?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(e)){var t=Ux.call(e,Yf),n=e[Yf];try{e[Yf]=void 0;var r=!0}catch(e){}var i=Vx.call(e);r&&(t?e[Yf]=n:delete e[Yf]),e=i}else e=Wx.call(e);return e},lb=function(e){var t=X(e);return null!=e&&("object"==t||"function"==t)},qi=function(e){return!!lb(e)&&("[object Function]"==(e=Qd(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)},tk=Cb["__core-js_shared__"],Wp=function(){var e=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Xx=Function.prototype.toString,Rd=function(e){if(null!=e){try{return Xx.call(e)}catch(e){}return e+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(e,t){return e=null==e?void 0:e[t],!lb(e)||Wp&&Wp in e||!(qi(e)?Zx:Yx).test(Rd(e))?void 0:e},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},zd.prototype.get=function(e){var t=this.__data__;return Zf?"__lodash_hash_undefined__"===(e=t[e])?void 0:e:$x.call(t,e)?t[e]:void 0},zd.prototype.has=function(e){var t=this.__data__;return Zf?void 0!==t[e]:ay.call(t,e)},zd.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Zf&&void 0===t?"__lodash_hash_undefined__":t,this};var $f=function(e,t){return e===t||e!=e&&t!=t},wh=function(e,t){for(var n=e.length;n--;)if($f(e[n][0],t))return n;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(e){var t=this.__data__;return!(0>(e=wh(t,e)))&&(e==t.length-1?t.pop():by.call(t,e,1),--this.size,!0)},ce.prototype.get=function(e){var t=this.__data__;return 0>(e=wh(t,e))?void 0:t[e][1]},ce.prototype.has=function(e){return-1<wh(this.__data__,e)},ce.prototype.set=function(e,t){var n=this.__data__,r=wh(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(e,t){e=e.__data__;var n=X(t);return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?e["string"==typeof t?"string":"hash"]:e.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(e){return e=xh(this,e).delete(e),this.size-=e?1:0,e},de.prototype.get=function(e){return xh(this,e).get(e)},de.prototype.has=function(e){return xh(this,e).has(e)},de.prototype.set=function(e,t){var n=xh(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},gf.prototype.has=function(e){return this.__data__.has(e)};var Xp=function(e,t,n,r){var i=e.length;for(n+=r?1:-1;r?n--:++n<i;)if(t(e[n],n,e))return n;return-1},cy=function(e){return e!=e},dy=function(e,t){var n;if(n=!(null==e||!e.length)){if(t==t)e:{n=-1;for(var r=e.length;++n<r;)if(e[n]===t){e=n;break e}e=-1}else e=Xp(e,cy,0);n=-1<e}return n},ey=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1},fy=function(e,t){return e.has(t)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(e){return new Re(e)}:gy,vk=function(e,t,n){var r=-1,i=dy,o=e.length,s=!0,a=[],c=a;if(n)s=!1,i=ey;else if(200<=o){if(i=t?null:iy(e))return uk(i);s=!1,i=fy,c=new gf}else c=t?[]:a;e:for(;++r<o;){var l=e[r],u=t?t(l):l;if(l=n||0!==l?l:0,s&&u==u){for(var d=c.length;d--;)if(c[d]===u)continue e;t&&c.push(u),a.push(l)}else i(c,u,n)||(c!==a&&c.push(u),a.push(l))}return a},Yp=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},he=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(e){var t=this.__data__;return e=t.delete(e),this.size=t.size,e},ee.prototype.get=function(e){return this.__data__.get(e)},ee.prototype.has=function(e){return this.__data__.has(e)},ee.prototype.set=function(e,t){var n=this.__data__;if(n instanceof rg){var r=n.__data__;if(!ag||199>r.length)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new qg(r)}return n.set(e,t),this.size=n.size,this};var ge=ee,Is=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},yh=function(){try{var e=Sd(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),bg=function(e,t,n){"__proto__"==t&&yh?yh(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},jy=Object.prototype.hasOwnProperty,Ml=function(e,t,n){var r=e[t];jy.call(e,t)&&$f(r,n)&&(void 0!==n||t in e)||bg(e,t,n)},re=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var a=t[o],c=r?r(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),i?bg(n,a,c):Ml(n,a,c)}return n},gc=function(e){return null!=e&&"object"==X(e)},Zp=function(e){return gc(e)&&"[object Arguments]"==Qd(e)},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(e){return gc(e)&&ky.call(e,"callee")&&!ly.call(e,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a((function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e;t=n&&n.exports===t?Cb.Buffer:void 0,e.exports=(t?t.isBuffer:void 0)||my})),ny=/^(?:0|[1-9]\d*)$/,wk=function(e,t){var n=X(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&ny.test(e))&&-1<e&&0==e%1&&e<t},xk=function(e){return"number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(e){return gc(e)&&xk(e.length)&&!!Ea[Qd(e)]},zh=function(e){return function(t){return e(t)}},Se=$a((function(e,t){var n=t&&!t.nodeType&&t;n=(t=n&&e&&!e.nodeType&&e)&&t.exports===n&&Tp.process;e:{try{var r=t&&t.require&&t.require("util").types;if(r){var i=r;break e}i=n&&n.binding&&n.binding("util");break e}catch(e){}i=void 0}e.exports=i})),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(e,t){var n=Va(e),r=!n&&rf(e),i=!n&&!r&&jf(e),o=!n&&!r&&!i&&bi(e);if(n=n||r||i||o){r=e.length;for(var s=String,a=-1,c=Array(r);++a<r;)c[a]=s(a);r=c}else r=[];for(var l in s=r.length,e)!t&&!py.call(e,l)||n&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||wk(l,s))||r.push(l);return r},qy=Object.prototype,yk=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||qy)},cq=function(e,t){return function(n){return e(t(n))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(e){return null!=e&&xk(e.length)&&!qi(e)},Ad=function(e){if(Ed(e))e=bq(e);else if(yk(e)){var t,n=[];for(t in Object(e))sy.call(e,t)&&"constructor"!=t&&n.push(t);e=n}else e=ry(e);return e},Es=function(e,t){return e&&re(t,Ad(t),e)},ty=Object.prototype.hasOwnProperty,kf=function(e){if(Ed(e))e=bq(e,!0);else if(lb(e)){var t=yk(e),n=[];for(r in e)("constructor"!=r||!t&&ty.call(e,r))&&n.push(r);e=n}else{var r=[];if(null!=e)for(t in Object(e))r.push(t);e=r}return e},Cs=function(e,t){return e&&re(t,kf(t),e)},Jl=$a((function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e,r=(t=n&&n.exports===t?Cb.Buffer:void 0)?t.allocUnsafe:void 0;e.exports=function(e,t){return t?e.slice():(t=e.length,t=r?r(t):new e.constructor(t),e.copy(t),t)}})),Xh=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},uy=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(e){return null==e?[]:(e=Object(e),uy(eq(e),(function(t){return vy.call(e,t)})))}:dq,Ds=function(e,t){return re(e,zk(e),t)},ai=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)ai(t,zk(e)),e=Ak(e);return t}:dq,Bs=function(e,t){return re(e,fq(e),t)},gq=function(e,t,n){return t=t(e),Va(e)?t:ai(t,n(e))},Yh=function(e){return gq(e,Ad,zk)},Ll=function(e){return gq(e,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&"[object DataView]"!=Td(new Bk(new ArrayBuffer(1)))||ag&&"[object Map]"!=Td(new ag)||Ck&&"[object Promise]"!=Td(Ck.resolve())||Re&&"[object Set]"!=Td(new Re)||Dk&&"[object WeakMap]"!=Td(new Dk))&&(Td=function(e){var t=Qd(e);if(e=(e="[object Object]"==t?e.constructor:void 0)?Rd(e):"")switch(e){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return t});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&By.call(e,"index")&&(n.index=e.index,n.input=e.input),n},Ah=Cb.Uint8Array,Ek=function(e){var t=new e.constructor(e.byteLength);return new Ah(t).set(new Ah(e)),t},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(e,t){return t=t?Ek(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.length)},Fs=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Ek(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return t=n?Ek(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return(t=new e.constructor(e.source,Cy.exec(e))).lastIndex=e.lastIndex,t;case"[object Symbol]":return iq?Object(iq.call(e)):{}}},jq=Object.create,Dy=function(){function e(){}return function(t){return lb(t)?jq?jq(t):(e.prototype=t,t=new e,e.prototype=void 0,t):{}}}(),Kl=function(e){return"function"!=typeof e.constructor||yk(e)?{}:Dy(Ak(e))},Ey=function(e){return gc(e)&&"[object Map]"==hf(e)},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(e){return gc(e)&&"[object Set]"==hf(e)},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(e){return"symbol"==X(e)||gc(e)&&"[object Symbol]"==Qd(e)},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(e,t){if(Va(e))return!1;var n=X(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ie(e))||Hy.test(e)||!Gy.test(e)||null!=t&&e in Object(t)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(e){var t=(e=Zh(e,(function(e){return 500===t.size&&t.clear(),e}))).cache;return e}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Iy,(function(e,n,r,i){t.push(r?i.replace(Jy,"$1"):n||e)})),t})),Js=1/0,mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(e,t){return Va(e)?e:Fk(e,t)?[e]:Ky(null==e?"":Nl(e))},Ly=1/0,cg=function(e){if("string"==typeof e||ie(e))return e;var t=e+"";return"0"==t&&1/e==-Ly?"-0":t},Ch=function(e,t){for(var n=0,r=(t=Bh(t,e)).length;null!=e&&n<r;)e=e[cg(t[n++])];return n&&n==r?e:void 0},My=function(e,t){if(!(2>(t=Bh(t,e)).length)){var n=t,r=0,i=-1,o=-1,s=n.length;for(0>r&&(r=-r>s?0:s+r),0>(i=i>s?s:i)&&(i+=s),s=r>i?0:i-r>>>0,r>>>=0,i=Array(s);++o<s;)i[o]=n[o+r];e=Ch(e,i)}return(n=null==e)||(n=null==t?0:t.length,n=delete e[cg(n?t[n-1]:void 0)]),n},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(e){return!(!gc(e)||"[object Object]"!=Qd(e))&&(null===(e=Ak(e))||"function"==typeof(e=Ny.call(e,"constructor")&&e.constructor)&&e instanceof e&&nq.call(e)==Oy)},Py=function(e){return wm(e)?void 0:e},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(e){return Va(e)||rf(e)||!!(oq&&e&&e[oq])},Qy=function(e){return null!=e&&e.length?$h(e,1):[]},Ry=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},pq=Math.max,qq=function(e,t,n){return t=pq(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=pq(r.length-t,0),s=Array(o);++i<o;)s[i]=r[t+i];for(i=-1,o=Array(t+1);++i<t;)o[i]=r[i];return o[t]=n(s),Ry(e,this,o)}},Sy=function(e){return function(){return e}},Dh=function(e){return e},Ty=Date.now,rq=function(e){var t=0,n=0;return function(){var r=Ty(),i=16-(r-n);if(n=r,0<i){if(800<=++t)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(yh?function(e,t){return yh(e,"toString",{configurable:!0,enumerable:!1,value:Sy(t),writable:!0})}:Dh),Gk=(e=function(e,t){var n={};if(null==e)return n;var r=!1;t=he(t,(function(t){return t=Bh(t,e),r||(r=1<t.length),t})),re(e,Ll(e),n),r&&(n=fe(n,7,Py));for(var i=t.length;i--;)My(n,t[i]);return n},rq(qq(e,void 0,Qy),e+"")),Uy=function(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var s=e[i];t(r,s,n(s),e)}return r},um=function(e,t,n){for(var r=-1,i=Object(e),o=(n=n(e)).length;o--;){var s=n[++r];if(!1===t(i[s],s,i))break}return e},sq=function(e,t){return e&&um(e,t,Ad)},Hk=function(e,t){return function(t,n){if(null==t)return t;if(!Ed(t))return e(t,n);for(var r=t.length,i=-1,o=Object(t);++i<r&&!1!==n(o[i],i,o););return t}}(sq),Vy=function(e,t,n,r){return Hk(e,(function(e,i,o){t(r,e,n(e),o)})),r},tq=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},Pl=function(e,t,n,r,i,o){var s=1&n,a=e.length,c=t.length;if(a!=c&&!(s&&c>a))return!1;c=o.get(e);var l=o.get(t);if(c&&l)return c==t&&l==e;c=-1,l=!0;var u=2&n?new gf:void 0;for(o.set(e,t),o.set(t,e);++c<a;){var d=e[c],h=t[c];if(r)var p=s?r(h,d,c,t,e,o):r(d,h,c,e,t,o);if(void 0!==p){if(p)continue;l=!1;break}if(u){if(!tq(t,(function(e,t){if(!u.has(t)&&(d===e||i(d,e,n,r,o)))return u.push(t)}))){l=!1;break}}else if(d!==h&&!i(d,h,n,r,o)){l=!1;break}}return o.delete(e),o.delete(t),l},Wy=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(e,t,n,r,i,o,s){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!o(new Ah(e),new Ah(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=Wy;case"[object Set]":if(a||(a=uk),e.size!=t.size&&!(1&r))break;return(n=s.get(e))?n==t:(r|=2,s.set(e,t),t=Pl(a(e),a(t),r,i,o,s),s.delete(e),t);case"[object Symbol]":if(Ik)return Ik.call(e)==Ik.call(t)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(e,t,n,r){var i=n.length,o=i,s=!r;if(null==e)return!o;for(e=Object(e);i--;){var a=n[i];if(s&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<o;){var c=(a=n[i])[0],l=e[c],u=a[1];if(s&&a[2]){if(void 0===l&&!(c in e))return!1}else{if(a=new ge,r)var d=r(l,u,c,e,t,a);if(void 0===d?!je(u,l,3,r,a):!d)return!1}}return!0},Yy=function(e){for(var t=Ad(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,i==i&&!lb(i)]}return t},vq=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},Zy=function(e){var t=Yy(e);return 1==t.length&&t[0][2]?vq(t[0][0],t[0][1]):function(n){return n===e||Xy(n,e,t)}},$y=function(e,t){return Fk(e)&&t==t&&!lb(t)?vq(cg(e),t):function(n){var r=null==n?void 0:Ch(n,e);if(void 0===(r=void 0===r?void 0:r)&&r===t){if(r=null!=n){for(var i=-1,o=(r=Bh(r=e,n)).length,s=!1;++i<o;){var a=cg(r[i]);if(!(s=null!=n&&null!=n&&a in Object(n)))break;n=n[a]}r=s||++i!=o?s:!!(o=null==n?0:n.length)&&xk(o)&&wk(a,o)&&(Va(n)||rf(n))}a=r}else a=je(t,r,3);return a}},az=function(e){return function(t){return null==t?void 0:t[e]}},bz=function(e){return function(t){return Ch(t,e)}},Te=function(e){return"function"==typeof e?e:null==e?Dh:"object"==X(e)?Va(e)?$y(e[0],e[1]):Zy(e):Fk(e)?az(cg(e)):bz(e)},Jk=function(e,t){return function(t,n){return(Va(t)?Uy:Vy)(t,e,Te(n),{})}}((function(e,t,n){bg(e,n,t)})),uc=function(e,t){var n={};return t=Te(t),sq(e,(function(e,r,i){bg(n,r,t(e,r,i))})),n},e;N({target:"String",proto:!0,forced:R((function(){var e="".sub('"');return e!==e.toLowerCase()||3<e.split('"').length}))},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(c){}xa.prototype.__isLong__,Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(e){if(2>(e=e||10)||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var t=Gb(e),n=this.div(t);return t=n.mul(t).sub(this),n.toString(e)+t.toInt().toString(e)}return"-"+this.neg().toString(e)}n=Gb(sg(e,6),this.unsigned),t=this;for(var r="";;){var i=t.div(n),o=(t.sub(i.mul(n)).toInt()>>>0).toString(e);if((t=i).isZero())return o+r;for(;6>o.length;)o="0"+o;r=""+o+r}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},D.isZero=function(){return 0===this.high&&0===this.low},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return 1==(1&this.low)},D.isEven=function(){return 0==(1&this.low)},D.equals=function(e){return mb(e)||(e=Wb(e)),(this.unsigned===e.unsigned||1!=this.high>>>31||1!=e.high>>>31)&&this.high===e.high&&this.low===e.low},D.eq=D.equals,D.notEquals=function(e){return!this.eq(e)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(e){return 0>this.comp(e)},D.lt=D.lessThan,D.lessThanOrEqual=function(e){return 0>=this.comp(e)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(e){return 0<this.comp(e)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(e){return 0<=this.comp(e)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(e){if(mb(e)||(e=Wb(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(e){mb(e)||(e=Wb(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=e.high>>>16,o=65535&e.high,s=e.low>>>16;return r=(s=((e=(65535&this.low)+(65535&e.low))>>>16)+(r+s))>>>16,ya((65535&s)<<16|65535&e,(t=((r+=n+o)>>>16)+(t+i)&65535)<<16|65535&r,this.unsigned)},D.subtract=function(e){return mb(e)||(e=Wb(e)),this.add(e.neg())},D.sub=D.subtract,D.multiply=function(e){if(this.isZero())return Hb;if(mb(e)||(e=Wb(e)),Qb){var t=Qb.mul(this.low,this.high,e.low,e.high);return ya(t,Qb.get_high(),this.unsigned)}if(e.isZero())return Hb;if(this.eq(nb))return e.isOdd()?nb:Hb;if(e.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(wq)&&e.lt(wq))return Gb(this.toNumber()*e.toNumber(),this.unsigned);t=this.high>>>16;var n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,a=e.low>>>16,c=i*(e=65535&e.low),l=(c>>>16)+r*e,u=l>>>16;u+=(l=(65535&l)+i*a)>>>16;var d=(u+=n*e)>>>16;return ya((65535&l)<<16|65535&c,(d=(d+=(u=(65535&u)+r*a)>>>16)+((u=(65535&u)+i*s)>>>16)+(t*e+n*a+r*s+i*o)&65535)<<16|65535&u,this.unsigned)},D.mul=D.multiply,D.divide=function(e){if(mb(e)||(e=Wb(e)),e.isZero())throw Error("division by zero");if(Qb)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?ya(e=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Cd;if(e.gt(this.shru(1)))return xq;var t=Cd}else{if(this.eq(nb)){if(e.eq(Ue)||e.eq(Kk))return nb;if(e.eq(nb))return Ue;var n=this.shr(1).div(e).shl(1);if(n.eq(Hb))return e.isNegative()?Ue:Kk;var r=this.sub(e.mul(n));return n.add(r.div(e))}if(e.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();t=Hb}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));var i=Math.ceil(Math.log(n)/Math.LN2);i=48>=i?1:sg(2,i-48);for(var o=Gb(n),s=o.mul(e);s.isNegative()||s.gt(r);)s=(o=Gb(n-=i,this.unsigned)).mul(e);o.isZero()&&(o=Ue),t=t.add(o),r=r.sub(s)}return t},D.div=D.divide,D.modulo=function(e){return mb(e)||(e=Wb(e)),Qb?ya(e=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(e){return mb(e)||(e=Wb(e)),ya(this.low&e.low,this.high&e.high,this.unsigned)},D.or=function(e){return mb(e)||(e=Wb(e)),ya(this.low|e.low,this.high|e.high,this.unsigned)},D.xor=function(e){return mb(e)||(e=Wb(e)),ya(this.low^e.low,this.high^e.high,this.unsigned)},D.shiftLeft=function(e){return mb(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?ya(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ya(0,this.low<<e-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(e){return mb(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?ya(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ya(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(e){if(mb(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return 32>e?ya(this.low>>>e|t<<32-e,t>>>e,this.unsigned):ya(32===e?t:t>>>e-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},D.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},xa.fromBytes=function(e,t,n){return n?xa.fromBytesLE(e,t):xa.fromBytesBE(e,t)},xa.fromBytesLE=function(e,t){return new xa(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},xa.fromBytesBE=function(e,t){return new xa(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var di=function(e,t){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e?console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=e},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(e){},error:function(e){if(Ib.useDeprecatedSynchronousErrorHandling)throw e;me(e)},complete:function(){}},Jb=Array.isArray||function(e){return e&&"number"==typeof e.length},lf=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),Oa=function(){function e(e){this.closed=!1,this._subscriptions=this._parentOrParents=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){if(!this.closed){var t=this._parentOrParents,n=this._ctorUnsubscribe,r=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,t instanceof e)t.remove(this);else if(null!==t)for(var o=0;o<t.length;++o)t[o].remove(this);if(le(r)){n&&(this._unsubscribe=void 0);try{r.call(this)}catch(e){var s=e instanceof lf?Xl(e.errors):[e]}}if(Jb(i))for(o=-1,t=i.length;++o<t;)if(ei(n=i[o]))try{n.unsubscribe()}catch(e){s=s||[],e instanceof lf?s=s.concat(Xl(e.errors)):s.push(e)}if(s)throw new lf(s)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(X(t)){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof e||(t=n,(n=new e)._subscriptions=[t]);break;default:throw Error("unrecognized teardown "+t+" added to Subscription.")}if(null===(t=n._parentOrParents))n._parentOrParents=this;else if(t instanceof e){if(t===this)return n;n._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return n;t.push(this)}return null===(t=this._subscriptions)?this._subscriptions=[n]:t.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;t&&-1!==(e=t.indexOf(e))&&t.splice(e,1)},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),Fh="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(e){function t(n,r,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=Eh;break;case 1:if(!n){o.destination=Eh;break}if("object"===X(n)){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new yq(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new yq(o,n,r,i)}return o}return O(t,e),t.prototype[Fh]=function(){return this},t.create=function(e,n,r){return(e=new t(e,n,r)).syncErrorThrowable=!1,e},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=e,this},t}(Oa),yq=function(e){function t(t,n,r,i){var o=e.call(this)||this;if(o._parentSubscriber=t,t=o,le(n))var s=n;else n&&(s=n.next,r=n.error,i=n.complete,n!==Eh&&(le((t=Object.create(n)).unsubscribe)&&o.add(t.unsubscribe.bind(t)),t.unsubscribe=o.unsubscribe.bind(o)));return o._context=t,o._next=s,o._error=r,o._complete=i,o}return O(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?this.__tryOrSetError(t,this._error,e):this.__tryOrUnsub(this._error,e),this.unsubscribe();else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):me(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;me(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};Ib.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,n):this.__tryOrUnsub(n)}this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw e;me(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{t.call(this._context,n)}catch(t){return Ib.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0):me(t),!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._parentSubscriber=this._context=null,e.unsubscribe()},t}(ia),ne="function"==typeof Symbol&&Symbol.observable||"@@observable",Y=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator;e:{if(e){if(e instanceof ia)break e;if(e[Fh]){e=e[Fh]();break e}}e=e||t||n?new ia(e,t,n):new ia(Eh)}if(r?e.add(r.call(e,this.source)):e.add(this.source||Ib.useDeprecatedSynchronousErrorHandling&&!e.syncErrorThrowable?this._subscribe(e):this._trySubscribe(e)),Ib.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable&&(e.syncErrorThrowable=!1,e.syncErrorThrown))throw e.syncErrorValue;return e},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){Ib.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),fi(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Zl(t))((function(t,r){var i=n.subscribe((function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[ne]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Yl(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Zl(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}(),qd=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),zq=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return O(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;this.subject=null,!t||0===t.length||e.isStopped||e.closed||-1!==(e=t.indexOf(this.subscriber))&&t.splice(e,1)}},t}(Oa),Aq=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return O(t,e),t}(ia),Pa=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return O(t,e),t.prototype[Fh]=function(){return new Aq(this)},t.prototype.lift=function(e){var t=new Bq(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new qd;if(!this.isStopped){var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].next(e)}},t.prototype.error=function(e){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=e,this.isStopped=!0;var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var e=this.observers,t=e.length;e=e.slice();for(var n=0;n<t;n++)e[n].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new qd;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new qd;return this.hasError?(e.error(this.thrownError),Oa.EMPTY):this.isStopped?(e.complete(),Oa.EMPTY):(this.observers.push(e),new zq(this,e))},t.prototype.asObservable=function(){var e=new Y;return e.source=this,e},t.create=function(e,t){return new Bq(e,t)},t}(Y),Bq=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return O(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Oa.EMPTY},t}(Pa),Ns=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;return n._refCount++,e=new cz(e,n),t=t.subscribe(e),e.closed||(e.connection=n.connect()),t},e}(),cz=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return O(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null},t}(ia),Cq=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return O(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),e.closed&&(this._connection=null,e=Oa.EMPTY)),e},t.prototype.refCount=function(){return $l()(this)},t}(Y),At=function(){var e=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),dz=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return O(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(Aq);!function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}O(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null}}(ia),function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).keySelector=n,t.elementSelector=r,t.durationSelector=i,t.subjectSelector=o,t.groups=null,t.attemptedToUnsubscribe=!1,t.count=0,t}O(t,e),t.prototype._next=function(e){try{var t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r=n.get(t);if(this.elementSelector)try{var i=this.elementSelector(e)}catch(e){this.error(e)}else i=e;if(!r&&(r=this.subjectSelector?this.subjectSelector():new Pa,n.set(t,r),e=new Mk(t,r,this),this.destination.next(e),this.durationSelector)){e=void 0;try{e=this.durationSelector(new Mk(t,r))}catch(e){return void this.error(e)}this.add(e.subscribe(new ez(t,r,this)))}r.closed||r.next(i)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach((function(t,n){t.error(e)})),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach((function(e,t){e.complete()})),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))}}(ia);var ez=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return O(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(ia),Mk=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return O(t,e),t.prototype._subscribe=function(e){var t=new Oa,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new fz(n)),t.add(r.subscribe(e)),t},t}(Y),fz=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return O(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),--t.count,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(Oa),gz=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return O(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Pa),dg=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return O(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,e=this.id;var n=this.scheduler;return null!=e&&(this.id=this.recycleAsyncId(n,e,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(e=this._execute(e,t))?e:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},t.prototype._execute=function(e,t){t=!1;var n=void 0;try{this.work(e)}catch(e){t=!0,n=!!e&&e||Error(e)}if(t)return this.unsubscribe(),n},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return O(t,e),t.prototype.schedule=function(e,t){return this},t}(Oa)),hz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),0<n?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return 0<n||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(dg),Nk=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),eg=function(e){function t(n,r){void 0===r&&(r=Nk.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return O(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Nk),fg=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t}(eg))(hz),vb=new Y((function(e){return e.complete()})),am=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}},Ok;!function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"}(Ok||(Ok={}));var Ve=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),Rs=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new Dq(e,this.scheduler,this.delay))},e}(),Dq=function(e){function t(t,n,r){return void 0===r&&(r=0),(t=e.call(this,t)||this).scheduler=n,t.delay=r,t}return O(t,e),t.dispatch=function(e){e.notification.observe(e.destination),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new iz(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(Ve.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(Ve.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},t}(ia),iz=function(e,t){this.notification=e,this.destination=t},qe=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=1>t?1:t,i._windowTime=1>n?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return O(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new jz(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t=this._infiniteTimeWindow,n=t?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var o=Oa.EMPTY;else this.observers.push(e),o=new zq(this,e);if(r&&e.add(e=new Dq(e,r)),t)for(t=0;t<i&&!e.closed;t++)e.next(n[t]);else for(t=0;t<i&&!e.closed;t++)e.next(n[t].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),o},t.prototype._getNow=function(){return(this.scheduler||fg).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(e-r[o].time<n);)o++;return i>t&&(o=Math.max(o,i-t)),0<o&&r.splice(0,o),r},t}(Pa),jz=function(e,t){this.time=e,this.value=t},of=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return O(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),Oa.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(e){var t=kz++;return ii[t]=!0,lz.then((function(){return bm(t)&&e()})),t},clearImmediate:function(e){bm(e)}},mz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=Eq.setImmediate(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(Eq.clearImmediate(n),t.scheduled=void 0)},t}(dg),ri=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame((function(){return t.flush(null)}))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(dg),Fq=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(eg))(oz),pz=function(e){function t(t,n){void 0===t&&(t=Gq),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return O(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(eg),Gq=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return O(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),this.delay=e.frame+r,(e=e.actions).push(this),e.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(dg),Qk=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),vg=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),pb=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),Ss=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new qz(e,this.project,this.thisArg))},e}(),qz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).project=n,t.count=0,t.thisArg=r||t,t}return O(t,e),t.prototype._next=function(e){try{var t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(ia),Rk=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(ia),Xs=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return O(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(ia),rz=function(e){return function(t){return e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,me),t}},$c="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(e){return function(t){for(var n=e[$c]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t}},tz=function(e){return function(t){var n=e[ne]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}},hm=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},pf=function(e){if(e&&"function"==typeof e[ne])return tz(e);if(hm(e))return am(e);if(fm(e))return rz(e);if(e&&"function"==typeof e[$c])return sz(e);throw e=ei(e)?"an invalid object":"'"+e+"'",new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new uz(e,this.resultSelector))},e}(),uz=function(e){function t(t,n){return(t=e.call(this,t)||this).resultSelector=n,t.active=0,t.values=[],t.observables=[],t}return O(t,e),t.prototype._next=function(e){this.values.push(Hq),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.toRespond=this.active=t;for(var n=0;n<t;n++)this.add(ji(this,e[n],void 0,n))}},t.prototype.notifyComplete=function(e){0==--this.active&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=(e=this.values)[n];r=this.toRespond?r===Hq?--this.toRespond:this.toRespond:0,e[n]=t,0===r&&(this.resultSelector?this._tryResultSelector(e):this.destination.next(e.slice()))},t.prototype._tryResultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Rk),vc=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return O(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(ia);!function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i}O(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(ia);var wc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(ia);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}O(t,e),t.prototype.notifyNext=function(e,t,n,r){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()}}(ia);var at=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new wz(e,this.project,this.concurrent))},e}(),wz=function(e){function t(t,n,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),(t=e.call(this,t)||this).project=n,t.concurrent=r,t.hasCompleted=!1,t.buffer=[],t.active=0,t.index=0,t}return O(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(n)},t.prototype._innerSub=function(e){var t=new vc(this),n=this.destination;n.add(t),(e=ic(e,t))!==t&&n.add(e)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,0<e.length?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(wc),Sk=y.parseFloat,Iq=-1/0!=1/Sk("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff-0")?function(e){e=ik(String(e));var t=Sk(e);return 0===t&&"-"==e.charAt(0)?-0:t}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new xz(e,this.predicate,this.thisArg))},e}(),xz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).predicate=n,t.thisArg=r,t.count=0,t}return O(t,e),t.prototype._next=function(e){try{var t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(ia),gt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new yz(e))},e}(),yz=function(e){function t(t){return(t=e.call(this,t)||this).hasFirst=!1,t.observables=[],t.subscriptions=[],t}return O(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=ji(this,e[n],void 0,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},t.prototype.notifyNext=function(e,t,n){if(!this.hasFirst){for(this.hasFirst=!0,e=0;e<this.subscriptions.length;e++)if(e!==n){var r=this.subscriptions[e];r.unsubscribe(),this.remove(r)}this.subscriptions=null}this.destination.next(t)},t}(Rk),jt=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new zz(e,this.resultSelector))},e}(),zz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).resultSelector=n,t.iterators=[],t.active=0,t.resultSelector="function"==typeof n?n:void 0,t}return O(t,e),t.prototype._next=function(e){var t=this.iterators;Jb(e)?t.push(new Az(e)):"function"==typeof e[$c]?t.push(new Bz(e[$c]())):t.push(new Cz(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0===t)this.destination.complete();else{this.active=t;for(var n=0;n<t;n++){var r=e[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){var i=e[r];if("function"==typeof i.hasValue&&!i.hasValue())return}var o=!1,s=[];for(r=0;r<t;r++){var a=(i=e[r]).next();if(i.hasCompleted()&&(o=!0),a.done)return void n.complete();s.push(a.value)}this.resultSelector?this._tryresultSelector(s):n.next(s),o&&n.complete()},t.prototype._tryresultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(ia),Bz=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return!(!e||!e.done)},e}(),Az=function(){function e(e){this.array=e,this.length=this.index=0,this.length=e.length}return e.prototype[$c]=function(){return this},e.prototype.next=function(e){e=this.index++;var t=this.array;return e<this.length?{value:t[e],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),Cz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).parent=n,t.observable=r,t.stillUnsubscribed=!0,t.buffer=[],t.isComplete=!1,t}return O(t,e),t.prototype[$c]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return 0<this.buffer.length},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return ic(this.observable,new vc(this))},t}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(e){return!!e&&(e instanceof Y||"function"==typeof e.lift&&"function"==typeof e.subscribe)},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=t=void 0;return Zc(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&Jb(e[0])&&(e=e[0]),nf(e,n).lift(new vz(t))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(e,t,n,r,i){if(1==arguments.length){var o=e.initialState;t=e.condition,n=e.iterate;var s=e.resultSelector||Yc;i=e.scheduler}else void 0===r||Zc(r)?(o=e,s=Yc,i=r):(o=e,s=r);return new Y((function(e){var r=o;if(i)return i.schedule(bt,0,{subscriber:e,iterate:n,condition:t,resultSelector:s,state:r});for(;;){if(t){var a=void 0;try{a=t(r)}catch(t){e.error(t);break}if(!a){e.complete();break}}a=void 0;try{a=s(r)}catch(t){e.error(t);break}if(e.next(a),e.closed)break;try{r=n(r)}catch(t){e.error(t);break}}}))},iif:function(e,t,n){return void 0===t&&(t=vb),void 0===n&&(n=vb),ad((function(){return e()?t:n}))},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(e,t){return new Y(t?function(n){var r=Object.keys(e),i=new Oa;return i.add(t.schedule(dt,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i}:function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})},partition:function(e,t,n){return[wb(t,n)(new Y(pf(e))),wb(et(t,n))(new Y(pf(e)))]},race:Ca,range:function(e,t,n){return void 0===e&&(e=0),new Y((function(r){void 0===t&&(t=e,e=0);var i=0,o=e;if(n)return n.schedule(ht,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(o++),r.closed)break}}))},throwError:Z,timer:Bc,using:function(e,t){return new Y((function(n){try{var r=e()}catch(e){return void n.error(e)}try{var i=t(r)}catch(e){return void n.error(e)}var o=(i?Kb(i):vb).subscribe(n);return function(){o.unsubscribe(),r&&r.unsubscribe()}}))},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ez(e,this.selector,this.caught))},e}(),Ez=function(e){function t(t,n,r){return(t=e.call(this,t)||this).selector=n,t.caught=r,t}return O(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle(),t=new vc(this),this.add(t),(n=ic(n,t))!==t&&this.add(n)}},t}(wc),lt=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new Fz(e,this.defaultValue))},e}(),Fz=function(e){function t(t,n){return(t=e.call(this,t)||this).defaultValue=n,t.isEmpty=!0,t}return O(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(ia),mt=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Gz(e,this.delay,this.scheduler))},e}(),Gz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).delay=n,t.scheduler=r,t.queue=[],t.active=!1,t.errored=!1,t}return O(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;0<n.length&&0>=n[0].time-r.now();)n.shift().notification.observe(i);0<n.length?(t=Math.max(0,n[0].time-r.now()),this.schedule(e,t)):(this.unsubscribe(),t.active=!1)},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler;e=new Hz(t.now()+this.delay,e),this.queue.push(e),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(Ve.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},t}(ia),Hz=function(e,t){this.time=e,this.notification=t},nt=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new Iz(e,this.keySelector,this.flushes))},e}(),Iz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).keySelector=n,t.values=new Set,r&&t.add(ic(r,new vc(t))),t}return O(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t=this.destination;try{var n=this.keySelector(e)}catch(e){return void t.error(e)}this._finalizeNext(n,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(wc),pt=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new Jz(e,this.errorFactory))},e}(),Jz=function(e){function t(t,n){return(t=e.call(this,t)||this).errorFactory=n,t.hasValue=!1,t}return O(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(ia),qt=function(){function e(e){if(this.total=e,0>this.total)throw new Qk}return e.prototype.call=function(e,t){return t.subscribe(new Kz(e,this.total))},e}(),Kz=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.count=0,t}return O(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(ia),rt=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Lz(e,this.project))},e}(),Lz=function(e){function t(t,n){return(t=e.call(this,t)||this).project=n,t.hasSubscription=!1,t.hasCompleted=!1,t.index=0,t}return O(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this.hasSubscription=!0,this._innerSub(n)},t.prototype._innerSub=function(e){var t=new vc(this),n=this.destination;n.add(t),(e=ic(e,t))!==t&&n.add(e)},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(wc),st=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new Mz(e,this.callback))},e}(),Mz=function(e){function t(t,n){return(t=e.call(this,t)||this).add(new Oa(n)),t}return O(t,e),t}(ia),ut=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Nz(e))},e}(),Nz=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype._next=function(e){},t}(ia),vt=function(){function e(e){if(this.total=e,0>this.total)throw new Qk}return e.prototype.call=function(e,t){return t.subscribe(new Oz(e,this.total))},e}(),Oz=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.ring=[],t.count=0,t}return O(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(0<t)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=t++%n;e.next(r[o])}e.complete()},t}(ia),wt=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new Pz(e,this.value))},e}(),Pz=function(e){function t(t,n){return(t=e.call(this,t)||this).value=n,t}return O(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(ia),xt=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new Qz(e,this.accumulator,this.seed,this.hasSeed))},e}(),Qz=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this).accumulator=n,t._seed=r,t.hasSeed=i,t.index=0,t}return O(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.accumulator(this.seed,e,t)}catch(e){this.destination.error(e)}this.seed=n,this.destination.next(n)},t}(ia),zt=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory();return(e=n(r).subscribe(e)).add(t.subscribe(r)),e},e}(),Bt=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Rz(e,this.notifier,this.source))},e}(),Rz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).notifier=n,t.source=r,t}return O(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.retriesSubscription=this.errors=void 0;else{n=new Pa;try{r=(0,this.notifier)(n)}catch(t){return e.prototype.error.call(this,t)}i=ic(r,new vc(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(wc),Et=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Sz(e,this.project))},e}(),Sz=function(e){function t(t,n){return(t=e.call(this,t)||this).project=n,t.index=0,t}return O(t,e),t.prototype._next=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this._innerSub(n)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe(),t=new vc(this);var n=this.destination;n.add(t),this.innerSubscription=ic(e,t),this.innerSubscription!==t&&n.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(wc),Ft=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){e=new Tz(e);var n=ic(this.notifier,new vc(e));return n&&!e.seenValue?(e.add(n),t.subscribe(e)):e},e}(),Tz=function(e){function t(t){return(t=e.call(this,t)||this).seenValue=!1,t}return O(t,e),t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(wc),Ht=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new Uz(e,this.predicate,this.inclusive))},e}(),Uz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).predicate=n,t.inclusive=r,t.index=0,t}return O(t,e),t.prototype._next=function(e){var t=this.destination;try{var n=this.predicate(e,this.index++)}catch(e){return void t.error(e)}this.nextOrComplete(e,n)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;t?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(ia),It=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new Vz(e,this.nextOrObserver,this.error,this.complete))},e}(),Vz=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this)._tapNext=hc,t._tapError=hc,t._tapComplete=hc,t._tapError=r||hc,t._tapComplete=i||hc,le(n)?(t._context=t,t._tapNext=n):n&&(t._context=n,t._tapNext=n.next||hc,t._tapError=n.error||hc,t._tapComplete=n.complete||hc),t}return O(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(ia),Kt={leading:!0,trailing:!1};!function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.destination=t,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}O(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._sendValue;this._hasValue&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=void 0},t.prototype.throttle=function(e){(e=this.tryDurationSelector(e))&&this.add(this._throttled=ic(e,new vc(this)))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=void 0,t&&this.send()},t.prototype.notifyNext=function(){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()}}(wc);for(var Lt=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new Wz(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),Wz=function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).duration=n,t.scheduler=r,t.leading=i,t.trailing=o,t._hasTrailingValue=!1,t._trailingValue=null,t}return O(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(ia),Ot=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new Xz(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Xz=function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).absoluteTimeout=n,t.waitFor=r,t.withObservable=i,t.scheduler=o,t.scheduleTimeout(),t}return O(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(ic(t,new vc(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},t}(wc),Qt=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new Yz(e,this.observables,this.project))},e}(),Yz=function(e){function t(t,n,r){(t=e.call(this,t)||this).observables=n,t.project=r,t.toRespond=[],r=n.length,t.values=Array(r);for(var i=0;i<r;i++)t.toRespond.push(i);for(i=0;i<r;i++)t.add(ji(t,n[i],void 0,i));return t}return O(t,e),t.prototype.notifyNext=function(e,t,n){this.values[n]=t,0<(e=this.toRespond).length&&-1!==(n=e.indexOf(n))&&e.splice(n,1)},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){0===this.toRespond.length&&(e=[e].concat(this.values),this.project?this._tryProject(e):this.destination.next(e))},t.prototype._tryProject=function(e){try{var t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Rk),Jq=$a((function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=Array(16);e.exports=function(){for(var e,t=0;16>t;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}})),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(e,t){return t=t||0,[ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]]].join("")},Ud=function(e,t,n){if(n=t&&n||0,"string"==typeof e&&(t="binary"===e?Array(16):null,e=null),(e=(e=e||{}).random||(e.rng||Jq)())[6]=15&e[6]|64,e[8]=63&e[8]|128,t)for(var r=0;16>r;++r)t[n+r]=e[r];return t||Kq(e)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;!function(e){e[e.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",e[e.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",e[e.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",e[e.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",e[e.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"}(Pc||(Pc={})),function(e){e[e.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",e[e.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",e[e.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",e[e.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",e[e.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",e[e.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(e){e[e.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(e){e[e.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(e){e[e.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",e[e.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",e[e.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",e[e.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",e[e.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",e[e.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(e){e[e.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",e[e.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",e[e.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",e[e.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",e[e.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(e){e[e.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",e[e.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",e[e.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",e[e.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",e[e.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",e[e.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",e[e.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(e){e[e.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",e[e.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",e[e.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",e[e.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(e){e[e.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",e[e.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",e[e.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",e[e.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",e[e.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",e[e.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",e[e.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",e[e.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",e[e.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",e[e.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",e[e.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(e){e[e.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(e){e[e.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",e[e.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",e[e.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",e[e.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",e[e.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",e[e.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",e[e.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(e){e[e.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(e){e[e.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",e[e.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",e[e.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",e[e.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",e[e.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",e[e.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",e[e.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",e[e.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(e){e[e.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(e){e[e.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",e[e.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",e[e.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",e[e.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(e){e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(e){e[e.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",e[e.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",e[e.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",e[e.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",e[e.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(e){e[e.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",e[e.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",e[e.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",e[e.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",e[e.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Pc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;rd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED;sd.GET_MEMBERS_ERR_TIMEOUT,sd.GET_MEMBERS_ERR_TOO_OFTEN;var dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE;ec.JOIN_CHANNEL_ERR_REJECTED;var hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED;ec.JOIN_CHANNEL_ERR_TOO_OFTEN;var Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED;Rb.LOGIN_ERR_NOT_AUTHORIZED;var kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Rc.RENEW_TOKEN_ERR_REJECTED,Rc.RENEW_TOKEN_ERR_TOO_OFTEN;var sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(e,t){var n;return Hk(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n},Mh=function(e,t,n){if(!lb(n))return!1;var r=X(t);return!!("number"==r?Ed(n)&&wk(t,n.length):"string"==r&&t in n)&&$f(n[t],e)},dl=function(e,t,n){var r=Va(e)?tq:DA;return n&&Mh(e,t,n)&&(t=void 0),r(e,Te(t))},EA=function(e,t){var n=-1,r=Ed(e)?Array(e.length):[];return Hk(e,(function(e,i,o){r[++n]=t(e,i,o)})),r},FA=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e},GA=function(e,t,n){t=t.length?he(t,(function(e){return Va(e)?function(t){return Ch(t,1===e.length?e[0]:e)}:e})):[Dh];var r=-1;return t=he(t,zh(Te)),e=EA(e,(function(e,n,i){return{criteria:he(t,(function(t){return t(e)})),index:++r,value:e}})),FA(e,(function(e,t){e:{for(var r=-1,i=e.criteria,o=t.criteria,s=i.length,a=n.length;++r<s;){t:{var c=i[r],l=o[r];if(c!==l){var u=void 0!==c,d=null===c,h=c==c,p=ie(c),f=void 0!==l,m=null===l,g=l==l,_=ie(l);if(!m&&!_&&!p&&c>l||p&&f&&g&&!m&&!_||d&&f&&g||!u&&g||!h){c=1;break t}if(!d&&!p&&!_&&c<l||_&&u&&h&&!d&&!p||m&&u&&h||!f&&h||!g){c=-1;break t}}c=0}if(c){e=r>=a?c:c*("desc"==n[r]?-1:1);break e}}e=e.index-t.index}return e}))},jr=function(e,t){return rq(qq(e,t,Dh),e+"")},kr=jr((function(e,t){if(null==e)return[];var n=t.length;return 1<n&&Mh(e,t[0],t[1])?t=[]:2<n&&Mh(t[0],t[1],t[2])&&(t=[t[0]]),GA(e,$h(t,1),[])})),lr=function(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}(Dz),mr=$a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=[],r=function(e,t){return new WebSocket(e,t)};t.normalClosureMessage="Normal closure",t.default=function(e,i){var o=(i=void 0===i?{protocols:n,makeWebSocket:r}:i).protocols,s=void 0===o?n:o,a=void 0===(i=i.makeWebSocket)?r:i;return new lr.Observable((function(n){var r,i=new lr.Subject,o=a(e,s),c=!1,l=!1,u=function(e){if(r)throw c=!0,e=Error("Web socket message factory function called more than once"),n.error(e),e;return r=e.subscribe((function(e){o.send(e)})),i};return o.onopen=function(){l?(c=!0,o.close()):n.next(u)},o.onmessage=function(e){i.next(e.data)},o.onerror=function(e){c=!0,n.error(Error(e.message))},o.onclose=function(e){c||(c=!0,l?(n.complete(),i.complete()):n.error(Error(1e3===e.code?t.normalClosureMessage:e.reason)))},function(){l=!0,r&&r.unsubscribe(),c||(c=!0,o.close())}}))}}));!function(e){e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")&&e.default}(mr);var pi=function(e,t,n){(void 0===n||$f(e[t],n))&&(void 0!==n||t in e)||bg(e,t,n)},oi=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},HA=function(e){return jr((function(t,n){var r=-1,i=n.length,o=1<i?n[i-1]:void 0,s=2<i?n[2]:void 0;for(o=3<e.length&&"function"==typeof o?(i--,o):void 0,s&&Mh(n[0],n[1],s)&&(o=3>i?void 0:o,i=1),t=Object(t);++r<i;)(s=n[r])&&e(t,s,r,o);return t}))}((function(e,t,n,r){tm(e,t,n,r)})),IA=Math.floor,JA=Math.random,nr=function(e,t){return e+IA(JA()*(t-e+1))},or=function(e){var t=e.length;return t?e[nr(0,t-1)]:void 0},KA=function(e,t){return he(t,(function(t){return e[t]}))},Ni=function(e){return null==e?[]:KA(e,Ad(e))},LA=function(e){return or(Ni(e))},bn=function(e){return(Va(e)?or:LA)(e)},xm=[],ym=function(e,t){return new WebSocket(e,t)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(e){return!ha(e)&&isFinite(e)&&MA(e)===e}}),Oo("from",Ej,Dj);var NA=function(e,t){for(var n=Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,s){n[r]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,s(e))}}))},OA=$a((function(e,t){t.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;1<--t%4&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};var n=Array(64),r=Array(123);for(e=0;64>e;)r[n[e]=26>e?e+65:52>e?e+71:62>e?e-4:e-59|43]=e++;t.encode=function(e,t,r){for(var i,o=null,s=[],a=0,c=0;t<r;){var l=e[t++];switch(c){case 0:s[a++]=n[l>>2],i=(3&l)<<4,c=1;break;case 1:s[a++]=n[i|l>>4],i=(15&l)<<2,c=2;break;case 2:s[a++]=n[i|l>>6],s[a++]=n[63&l],c=0}8191<a&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return c&&(s[a++]=n[i],s[a++]=61,1===c&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))},t.decode=function(e,t,n){for(var i,o=n,s=0,a=0;a<e.length;){var c=e.charCodeAt(a++);if(61===c&&1<s)break;if(void 0===(c=r[c]))throw Error("invalid encoding");switch(s){case 0:i=c,s=1;break;case 1:t[n++]=i<<2|(48&c)>>4,i=c,s=2;break;case 2:t[n++]=(15&i)<<4|(60&c)>>2,i=c,s=3;break;case 3:t[n++]=(3&i)<<6|c,s=0}}if(1===s)throw Error("invalid encoding");return n-o},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}));yg.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},yg.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else{e=this._listeners[e];for(var n=0;n<e.length;)e[n].fn===t?e.splice(n,1):++n}return this},yg.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var PA=zm(zm),QA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(e){}return null},RA=$a((function(e,t){t.length=function(e){for(var t,n=0,r=0;r<e.length;++r)128>(t=e.charCodeAt(r))?n+=1:2048>t?n+=2:55296==(64512&t)&&56320==(64512&e.charCodeAt(r+1))?(++r,n+=4):n+=3;return n},t.read=function(e,t,n){if(1>n-t)return"";for(var r,i=null,o=[],s=0;t<n;)128>(r=e[t++])?o[s++]=r:191<r&&224>r?o[s++]=(31&r)<<6|63&e[t++]:239<r&&365>r?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(r>>10),o[s++]=56320+(1023&r)):o[s++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],8191<s&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},t.write=function(e,t,n){for(var r,i,o=n,s=0;s<e.length;++s)128>(r=e.charCodeAt(s))?t[n++]=r:(2048>r?t[n++]=r>>6|192:(55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&i),++s,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-o}})),SA=function(e,t,n){var r=n||8192,i=r>>>1,o=null,s=r;return function(n){return 1>n||n>i?e(n):(s+n>r&&(o=e(r),s=0),n=t.call(o,s,s+=n),7&s&&(s=1+(7|s)),n)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(e){if(0===e)return Xd;var t=0>e;t&&(e=-e);var n=e>>>0;return e=(e-n)/4294967296>>>0,t&&(e=~e>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++e&&(e=0))),new Wa(n,e)},Wa.from=function(e){if("number"==typeof e)return Wa.fromNumber(e);if(V.isString(e)){if(!V.Long)return Wa.fromNumber(parseInt(e,10));e=V.Long.fromString(e)}return e.low||e.high?new Wa(e.low>>>0,e.high>>>0):Xd},Wa.prototype.toNumber=function(e){if(!e&&this.hi>>>31){e=1+~this.lo>>>0;var t=~this.hi>>>0;return e||(t=t+1>>>0),-(e+4294967296*t)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(e){return V.Long?new V.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var td=String.prototype.charCodeAt;Wa.fromHash=function(e){return e===TA?Xd:new Wa((td.call(e,0)|td.call(e,1)<<8|td.call(e,2)<<16|td.call(e,3)<<24)>>>0,(td.call(e,4)|td.call(e,5)<<8|td.call(e,6)<<16|td.call(e,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},Wa.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},Wa.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?16384>e?128>e?1:2:2097152>e?3:4:16384>t?128>t?5:6:2097152>t?7:8:128>n?9:10};var V=$a((function(e,t){function n(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function r(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=NA,t.base64=OA,t.EventEmitter=yg,t.float=PA,t.inquire=QA,t.utf8=RA,t.pool=SA,t.LongBits=Wa,t.isNode=!!(void 0!==Ya&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),t.global=t.isNode&&Ya||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||Ya,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"===X(e)},t.isset=t.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!==X(n)||0<(Array.isArray(n)?n.length:Object.keys(n).length))},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,n){return e=t.LongBits.fromHash(e),t.Long?t.Long.fromBits(e.lo,e.hi,n):e.toNumber(!!n)},t.merge=n,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=r,t.ProtocolError=r("ProtocolError"),t.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;-1<n;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},t.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}})),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(e){return new V.Array(e)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(e,t,n){return this.tail=this.tail.next=new sf(e,t,n),this.len+=t,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(e,t,n){for(;127<e;)t[n++]=127&e|128,e>>>=7;t[n]=e},ja.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new ui(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},ja.prototype.int32=function(e){return 0>e?this._push(vi,10,Nh.fromNumber(e)):this.uint32(e)},ja.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},ja.prototype.uint64=function(e){return e=Nh.from(e),this._push(vi,e.length(),e)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(e){return e=Nh.from(e).zzEncode(),this._push(vi,e.length(),e)},ja.prototype.bool=function(e){return this._push(ti,1,e?1:0)},ja.prototype.fixed32=function(e){return this._push(wi,4,e>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(e){return e=Nh.from(e),this._push(wi,4,e.lo)._push(wi,4,e.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(e){return this._push(V.float.writeFloatLE,4,e)},ja.prototype.double=function(e){return this._push(V.float.writeDoubleLE,8,e)};var UA=V.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};ja.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(ti,1,0);if(V.isString(e)){var n=ja.alloc(t=pr.length(e));pr.decode(e,n,0),e=n}return this.uint32(t)._push(UA,t,e)},ja.prototype.string=function(e){var t=qr.length(e);return t?this.uint32(t)._push(qr.write,t,e):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},ja.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},ja._configure=function(e){el=e,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&"set"===V.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},jc.prototype.bytes=function(e){V.isString(e)&&(e=V._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(jc.writeBytesBuffer,t,e),this},jc.prototype.string=function(e){var t=V.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Ut,t,e),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new La(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new La(e);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(e){return(La.create=function(e){return V.Buffer.isBuffer(e)?new fl(e):sr(e)})(e)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++])return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return e}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},La.prototype.bool=function(){return 0!==this.uint32()},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var e=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var e=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},La.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Yb(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},La.prototype.string=function(){var e=this.bytes();return VA.read(e,0,e.length)},La.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw Yb(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw Yb(this)}while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},La._configure=function(e){fl=e,La.create=tr(),fl._configure();var t=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[t](!1)},uint64:function(){return yi.call(this)[t](!0)},sint64:function(){return yi.call(this).zzDecode()[t](!1)},fixed64:function(){return Fm.call(this)[t](!0)},sfixed64:function(){return Fm.call(this)[t](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function e(t,n,r,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return V.asPromise(e,s,t,n,r,i);if(s.rpcImpl)try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return s.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return s.emit("error",e,t),o(e)}return s.emit("data",n,t),o(null,n)}s.end(!0)}))}catch(e){s.emit("error",e,t),setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},tf.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a((function(e,t){t.Service=tf})),XA={},fc=$a((function(e,t){function n(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}var r=t;r.build="minimal",r.Writer=xi,r.BufferWriter=jc,r.Reader=zi,r.BufferReader=Fd,r.util=V,r.rpc=WA,r.roots=XA,r.configure=n,n()}));fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var e={},t=Object.create(e);return t[e[0]="Unknown"]=0,t[e[1]="PingUri"]=1,t[e[2]="PongUri"]=2,t[e[11]="UserJoinUri"]=11,t[e[12]="UserRespUri"]=12,t[e[21]="UserQuitUri"]=21,t[e[22]="UserDropUri"]=22,t[e[31]="GroupEnterUri"]=31,t[e[32]="GroupLeaveUri"]=32,t[e[33]="GroupReplyUri"]=33,t[e[36]="GroupEnterNoticeUri"]=36,t[e[37]="GroupLeaveNoticeUri"]=37,t[e[38]="GroupEventNoticeUri"]=38,t[e[39]="GroupCountNoticeUri"]=39,t[e[41]="UserStatusListUri"]=41,t[e[42]="UserStatusResultUri"]=42,t[e[51]="GroupStatusListUri"]=51,t[e[52]="GroupStatusResultUri"]=52,t[e[55]="GroupAllUsersListUri"]=55,t[e[56]="GroupAllUsersResultUri"]=56,t[e[100]="MessageUri"]=100,t[e[101]="AckUri"]=101,t[e[115]="FileUploadIndexGetUri"]=115,t[e[116]="FileUploadIndexRetUri"]=116,t[e[117]="FileUploadIndexSetUri"]=117,t[e[118]="FileUploadIndexFinUri"]=118,t[e[119]="FileUploadIndexErrUri"]=119,t[e[125]="FileDownloadIndexGetUri"]=125,t[e[126]="FileDownloadIndexRetUri"]=126,t[e[127]="FileDownloadIndexErrUri"]=127,t[e[201]="UserJoinNoticeUri"]=201,t[e[202]="UserQuitNoticeUri"]=202,t[e[203]="UserWaitNoticeUri"]=203,t[e[301]="UserAttributeGetUri"]=301,t[e[302]="UserAttributeRetUri"]=302,t[e[303]="UserAttributeSetUri"]=303,t[e[304]="UserAttributeModUri"]=304,t[e[305]="UserAttributeDelUri"]=305,t[e[307]="UserAttributeRspUri"]=307,t[e[308]="UserAttributeErrUri"]=308,t[e[311]="UserAttributeKeysGetUri"]=311,t[e[312]="UserAttributeKeysRetUri"]=312,t[e[351]="GroupAttributeGetUri"]=351,t[e[352]="GroupAttributeRetUri"]=352,t[e[353]="GroupAttributeSetUri"]=353,t[e[354]="GroupAttributeModUri"]=354,t[e[355]="GroupAttributeDelUri"]=355,t[e[356]="GroupAttributeAltUri"]=356,t[e[357]="GroupAttributeRspUri"]=357,t[e[358]="GroupAttributeErrUri"]=358,t[e[361]="GroupAttributeKeysGetUri"]=361,t[e[362]="GroupAttributeKeysRetUri"]=362,t[e[401]="SubscribeUserStatusUri"]=401,t[e[402]="UnsubscribeUserStatusUri"]=402,t[e[499]="SubscribeResponseUri"]=499,t}(),Oh=t.Wrapper=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.uri=0,e.prototype.data=q.newBuffer([]),e.encode=function(e,t){return t||(t=L.create()),null!=e.uri&&Object.hasOwnProperty.call(e,"uri")&&t.uint32(8).int32(e.uri),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Wrapper;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.uri=e.int32();break;case 2:r.data=e.bytes();break;default:e.skipType(7&i)}}return r},e}(),ZA=t.Ping=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Ping;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),$A=t.Pong=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Pong;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),aB=t.UserJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.opt&&Object.hasOwnProperty.call(e,"opt")&&t.uint32(16).uint64(e.opt),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(24).uint64(e.instance),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(34).string(e.account),null!=e.ticket&&Object.hasOwnProperty.call(e,"ticket")&&t.uint32(42).string(e.ticket),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserJoin;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.opt=e.uint64();break;case 3:r.instance=e.uint64();break;case 4:r.account=e.string();break;case 5:r.ticket=e.string();break;default:e.skipType(7&i)}}return r},e}(),bB=t.UserResp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserResp;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),cB=t.UserQuit=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.encode=function(e,t){return t||(t=L.create()),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserQuit;e.pos<n;){var i=e.uint32();e.skipType(7&i)}return r},e}(),dB=t.UserDrop=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(8).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserDrop;e.pos<n;){var i=e.uint32();i>>>3===1?r.code=e.uint32():e.skipType(7&i)}return r},e}(),eB=t.GroupEnter=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupEnter;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),fB=t.GroupLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupLeave;e.pos<n;){var i=e.uint32();i>>>3===1?r.account=e.string():e.skipType(7&i)}return r},e}(),gB=t.GroupReply=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupReply;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),ur=t.GroupLeaveNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupLeaveNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.user=e.string();break;case 3:r.group=e.string();break;case 4:r.instance=e.uint64();break;case 5:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),vr=t.GroupEnterNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupEnterNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.user=e.string();break;case 3:r.group=e.string();break;case 4:r.instance=e.uint64();break;case 5:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),wr=t.Message=function(){function e(e){if(this.MiscMap={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=q.newBuffer([]),e.prototype.MiscMap=q.emptyObject,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){if(t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.options&&Object.hasOwnProperty.call(e,"options")&&t.uint32(32).uint64(e.options),null!=e.src&&Object.hasOwnProperty.call(e,"src")&&t.uint32(42).string(e.src),null!=e.dst&&Object.hasOwnProperty.call(e,"dst")&&t.uint32(50).string(e.dst),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(58).bytes(e.payload),null!=e.MiscMap&&Object.hasOwnProperty.call(e,"MiscMap"))for(var n=Object.keys(e.MiscMap),r=0;r<n.length;++r)t.uint32(66).fork().uint32(10).string(n[r]).uint32(18).bytes(e.MiscMap[n[r]]).ldelim();return null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(72).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r,i,o=new t.Message;e.pos<n;)switch(r=e.uint32(),r>>>3){case 1:o.instance=e.uint64();break;case 2:o.dialogue=e.uint64();break;case 3:o.sequence=e.uint64();break;case 4:o.options=e.uint64();break;case 5:o.src=e.string();break;case 6:o.dst=e.string();break;case 7:o.payload=e.bytes();break;case 8:o.MiscMap===q.emptyObject&&(o.MiscMap={});var s=e.uint32()+e.pos;for(r="",i=[];e.pos<s;){var a=e.uint32();switch(a>>>3){case 1:r=e.string();break;case 2:i=e.bytes();break;default:e.skipType(7&a)}}o.MiscMap[r]=i;break;case 9:o.ms=e.uint64();break;default:e.skipType(7&r)}return o},e}(),xr=t.Ack=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(32).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Ack;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.dialogue=e.uint64();break;case 3:r.sequence=e.uint64();break;case 4:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),hB=t.FileUploadIndexGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(18).bytes(e.hash),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(24).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.hash=e.bytes();break;case 3:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),iB=t.FileUploadIndexRet=function(){function e(e){if(this.servers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(16).uint32(e.unit),null!=e.servers&&e.servers.length){t.uint32(26).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.unit=e.uint32();break;case 3:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),jB=t.FileUploadIndexSet=function(){function e(e){if(this.servers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(18).bytes(e.hash),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(24).uint32(e.unit),null!=e.servers&&e.servers.length){t.uint32(34).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.hash=e.bytes();break;case 3:r.unit=e.uint32();break;case 4:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),kB=t.FileUploadIndexFin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.unit=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(16).uint32(e.zone),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(24).uint32(e.unit),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexFin;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.zone=e.uint32();break;case 3:r.unit=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),lB=t.FileUploadIndexErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),mB=t.FileDownloadIndexGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.prototype.unit=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(16).uint32(e.zone),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(26).bytes(e.hash),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(32).uint32(e.size),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(40).uint32(e.unit),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.zone=e.uint32();break;case 3:r.hash=e.bytes();break;case 4:r.size=e.uint32();break;case 5:r.unit=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),nB=t.FileDownloadIndexRet=function(){function e(e){if(this.servers=[],this.backups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.zone=0,e.prototype.servers=q.emptyArray,e.prototype.backups=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(16).uint32(e.unit),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(24).uint32(e.zone),null!=e.servers&&e.servers.length){t.uint32(34).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}if(null!=e.backups&&e.backups.length){for(t.uint32(42).fork(),n=0;n<e.backups.length;++n)t.uint32(e.backups[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.unit=e.uint32();break;case 3:r.zone=e.uint32();break;case 4:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;case 5:if(r.backups&&r.backups.length||(r.backups=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.backups.push(e.uint32());else r.backups.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),oB=t.FileDownloadIndexErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),pB=t.GroupAllUsersList=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&t.uint32(24).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&t.uint32(32).uint32(e.pageNumber),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.pageSize=e.uint32();break;case 4:r.pageNumber=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),qB=t.GroupAllUsersResult=function(){function e(e){if(this.memberInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.totalSize&&Object.hasOwnProperty.call(e,"totalSize")&&n.uint32(24).uint32(e.totalSize),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&n.uint32(32).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&n.uint32(40).uint32(e.pageNumber),null!=e.memberInfos&&e.memberInfos.length)for(var r=0;r<e.memberInfos.length;++r)t.GroupAllUsersResult.MemberInfo.encode(e.memberInfos[r],n.uint32(50).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.totalSize=e.uint32();break;case 4:r.pageSize=e.uint32();break;case 5:r.pageNumber=e.uint32();break;case 6:r.memberInfos&&r.memberInfos.length||(r.memberInfos=[]),r.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.MemberInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersResult.MemberInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.ts=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),rB=t.UserStatusList=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),sB=t.UserStatusResult=function(){function e(e){if(this.userInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.userInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.userInfos&&e.userInfos.length)for(var r=0;r<e.userInfos.length;++r)t.UserStatusResult.UserStatusInfo.encode(e.userInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.userInfos&&r.userInfos.length||(r.userInfos=[]),r.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.UserStatusInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusResult.UserStatusInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.ts=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),tB=t.UserAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),uB=t.UserAttributeRet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeRet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),vB=t.UserAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&n.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeSet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(26).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeSet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),wB=t.UserAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&n.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeMod.AttributeInfo.encode(e.attributeInfos[r],n.uint32(26).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeMod;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeMod.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),xB=t.UserAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeDel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),yB=t.UserAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),zB=t.UserAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeKeysGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),AB=t.UserAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeKeysRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),BB=t.UserAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRsp;e.pos<n;){var i=e.uint32();i>>>3===1?r.seq=e.uint64():e.skipType(7&i)}return r},e}(),CB=t.GroupStatusList=function(){function e(e){if(this.groups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groups=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.groups&&e.groups.length)for(var n=0;n<e.groups.length;++n)t.uint32(18).string(e.groups[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.groups&&r.groups.length||(r.groups=[]),r.groups.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),DB=t.GroupStatusResult=function(){function e(e){if(this.groupInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groupInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.groupInfos&&e.groupInfos.length)for(var r=0;r<e.groupInfos.length;++r)t.GroupStatusResult.GroupInfo.encode(e.groupInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.groupInfos&&r.groupInfos.length||(r.groupInfos=[]),r.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.GroupInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.group="",e.prototype.memberCount=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(10).string(e.group),null!=e.memberCount&&Object.hasOwnProperty.call(e,"memberCount")&&t.uint32(16).uint32(e.memberCount),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusResult.GroupInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.group=e.string();break;case 2:r.memberCount=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),EB=t.GroupCountNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(32).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupCountNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.group=e.string();break;case 4:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),FB=t.GroupAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),GB=t.GroupAttributeRet=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.attributeMaps&&e.attributeMaps.length)for(var r=0;r<e.attributeMaps.length;++r)t.GroupAttributeRet.AttributeMap.encode(e.attributeMaps[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.attributeMaps&&r.attributeMaps.length||(r.attributeMaps=[]),r.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRet.AttributeMap;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;case 3:r.origin=e.string();break;case 4:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),e}(),HB=t.GroupAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&n.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.GroupAttributeSet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeSet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),IB=t.GroupAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&n.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.GroupAttributeMod.AttributeInfo.encode(e.attributeInfos[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeMod;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeMod.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),JB=t.GroupAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(34).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeDel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),KB=t.GroupAttributeAlt=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&n.uint32(24).uint64(e.instance),null!=e.attributeMaps&&e.attributeMaps.length)for(var r=0;r<e.attributeMaps.length;++r)t.GroupAttributeAlt.AttributeMap.encode(e.attributeMaps[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeAlt;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.instance=e.uint64();break;case 4:r.attributeMaps&&r.attributeMaps.length||(r.attributeMaps=[]),r.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeAlt.AttributeMap;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;case 3:r.origin=e.string();break;case 4:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),e}(),LB=t.GroupAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRsp;e.pos<n;){var i=e.uint32();i>>>3===1?r.seq=e.uint64():e.skipType(7&i)}return r},e}(),MB=t.GroupAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),NB=t.GroupAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeKeysGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;default:e.skipType(7&i)}}return r},e}(),OB=t.GroupAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeKeysRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),PB=t.SubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeUserStatus;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),QB=t.UnsubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UnsubscribeUserStatus;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),RB=t.UserJoinNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserJoinNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),SB=t.UserQuitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserQuitNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),TB=t.UserWaitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserWaitNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),UB=t.SubscribeResponse=function(){function e(e){if(this.errors=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.errors=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.errors&&e.errors.length)for(var r=0;r<e.errors.length;++r)t.SubscribeResponse.SubscribeErrorsType.encode(e.errors[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeResponse;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.errors&&r.errors.length||(r.errors=[]),r.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.SubscribeErrorsType=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeResponse.SubscribeErrorsType;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(e){return function(t,n,r){var i=(t=String(jb(t))).length;return r=void 0===r?" ":String(r),(n=ta(n))<=i||""==r?t:(n-=i,(i=Pn.call(r,WB(n/r.length))).length>n&&(i=i.slice(0,n)),e?t+i:i+t)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(e){return YB(this,e,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(e){return function(t){t=qb(t);for(var n,r=Dc(t),i=r.length,o=0,s=[];i>o;)n=r[o++],ka&&!ZB.call(t,n)||s.push(e?[n,t[n]]:t[n]);return s}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(e){return $B(e)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var e=bC(String.prototype,"endsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(e){var t=String(jb(this));ck(e);var n=1<arguments.length?arguments[1]:void 0,r=ta(t.length);return n=void 0===n?r:cC(ta(n),r),r=String(e),Br?Br.call(t,r,n):t.slice(n-r.length,n)===r}}),dh("match",1,(function(e,t,n){return[function(t){var n=jb(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;if(e=va(e),r=String(this),!e.global)return Ke(e,r);var i=e.unicode;e.lastIndex=0;for(var o,s=[],a=0;null!==(o=Ke(e,r));)o=String(o[0]),s[a]=o,""===o&&(e.lastIndex=xj(r,ta(e.lastIndex),i)),a++;return 0===a?null:s}]}));var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var e=eC(String.prototype,"startsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(e){var t=String(jb(this));ck(e);var n=ta(fC(1<arguments.length?arguments[1]:void 0,t.length)),r=String(e);return Dr?Dr.call(t,r,n):t.slice(n,n+r.length)===r}});var Nm=function(e){var t=Array.prototype.slice.call(arguments,1);return t.length&&(e=e.replace(/(%?)(%([jds]))/g,(function(e,n,r,i){switch(r=t.shift(),i){case"s":r=""+r;break;case"d":r=Number(r);break;case"j":r=JSON.stringify(r)}return n?(t.unshift(r),e):r}))),t.length&&(e+=" "+t.join(" ")),""+e.replace(/%{2,2}/g,"%")},hC=/\s/,iC=function(e){for(var t=e.length;t--&&hC.test(e.charAt(t)););return t},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(e){if("number"==typeof e)return e;if(ie(e))return Fr;if(lb(e)&&(e="function"==typeof e.valueOf?e.valueOf():e,e=lb(e)?e+"":e),"string"!=typeof e)return 0===e?e:+e;e=e?e.slice(0,iC(e)+1).replace(jC,""):e;var t=lC.test(e);return t||mC.test(e)?nC(e.slice(2),t?2:8):kC.test(e)?Fr:+e},oC=Math.max,pC=Math.min,qC=function(e,t,n){function r(t){var n=c,r=l;return c=l=void 0,p=t,u=e.apply(r,n)}function i(e){var n=e-h;return e-=p,void 0===h||n>=t||0>n||m&&e>=_}function o(){var e=Cb.Date.now();if(i(e))return s(e);var n=setTimeout,r=e-p;e=t-(e-h),r=m?pC(e,_-r):e,d=n(o,r)}function s(e){return d=void 0,g&&c?r(e):(c=l=void 0,u)}function a(){var e=Cb.Date.now(),n=i(e);if(c=arguments,l=this,h=e,n){if(void 0===d)return p=e=h,d=setTimeout(o,t),f?r(e):u;if(m)return clearTimeout(d),d=setTimeout(o,t),r(h)}return void 0===d&&(d=setTimeout(o,t)),u}var c,l,u,d,h,p=0,f=!1,m=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");if(t=gl(t)||0,lb(n)){f=!!n.leading;var _=(m="maxWait"in n)?oC(gl(n.maxWait)||0,t):_;g="trailing"in n?!!n.trailing:g}return a.cancel=function(){void 0!==d&&clearTimeout(d),p=0,c=h=l=d=void 0},a.flush=function(){return void 0===d?u:s(Cb.Date.now())},a},yc=function(e){function t(e,i){return W(this,t),m(n(e=r.call(this,Mm(e,i))),"originalError",void 0),m(n(e),"code",void 0),m(n(e),"serverCode",void 0),"number"==typeof i?e.code=i:"string"==typeof i?e.name=i:void 0!==i&&(i.originalError&&(e.originalError=i.originalError),void 0!==i.code&&(e.code=i.code),void 0!==i.serverCode&&(e.serverCode=i.serverCode)),e}la(t,e);var r=ma(t);return t}(ef(Error)),Ia=function(e){function t(e,i){return W(this,t),m(n(e=r.call(this,Mm(e,i))),"name","RtmInternalError"),m(n(e),"code",void 0),e.code=i,e}la(t,e);var r=ma(t);return t}(ef(Error)),Ph=function(){return function(e){function t(e){W(this,t);var r=Object.keys(e);return n.call(this,e[r[0]],r[0])}la(t,e);var n=ma(t);return t}(Ia)},Fa=Ph(),db=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmTimeoutError"),e}la(t,e);var r=ma(t);return t}(yc),I=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvalidArgumentError"),e}la(t,e);var r=ma(t);return t}(yc),K=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvalidStatusError"),e}la(t,e);var r=ma(t);return t}(yc),hl=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInterruptedError"),e}la(t,e);var r=ma(t);return t}(yc),ib=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmLimitExceededError"),e}la(t,e);var r=ma(t);return t}(yc),rC=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvokeTooOftenError"),e}la(t,e);var r=ma(t);return t}(yc),da=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnavailableError"),m(n(e),"serverCode",void 0),m(n(e),"statusCode",void 0),e}la(t,e);var r=ma(t);return t}(yc),Ye=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnauthenticatedError"),m(n(e),"serverCode",void 0),e}la(t,e);var r=ma(t);return t}(yc),Wc=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnknownError"),e}la(t,e);var r=ma(t);return t}(yc),Sa=function(e){return e instanceof db||e instanceof pb},sa=function(e){return e instanceof yc},Yd=function(e,t,n){return['Executing "%s.%s" timed out after %ds',e,t,n/1e3]},Lm=new Map,sC=function(){var e=new Date;return"".concat(e.toISOString().split("T")[1].replace(/\..+/,""),".").concat(e.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(e){return"string"==typeof e?e.endsWith(".")?e:"".concat(e,"."):e},Sm=function(e){for(var t="",n=(e=new Uint8Array(e)).byteLength,r=-1;++r<n;)t+=String.fromCharCode(e[r]);return t=btoa(t),"data:;base64,".concat(t)},tC=R((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}));N({target:"Date",proto:!0,forced:tC},{toJSON:function(e){e=Qa(this);var t=lc(e);return"number"!=typeof t||isFinite(t)?e.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(e,t,n){return JSON.stringify(Ym(e),t,n)};Gr.ensureProperties=Ym;var uC=function(e,t){t=t||{};var n=X(e);if("string"===n&&0<e.length)return au(e);if("number"===n&&isFinite(e))return e=t.long?864e5<=(t=Math.abs(e))?Jg(e,t,864e5,"day"):36e5<=t?Jg(e,t,36e5,"hour"):6e4<=t?Jg(e,t,6e4,"minute"):1e3<=t?Jg(e,t,1e3,"second"):e+" ms":864e5<=(t=Math.abs(e))?Math.round(e/864e5)+"d":36e5<=t?Math.round(e/36e5)+"h":6e4<=t?Math.round(e/6e4)+"m":1e3<=t?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},vC=function(e){function t(e){function r(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];if(r.enabled){e=Number(new Date),r.diff=e-(i||e),r.prev=i,i=r.curr=e,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var s=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,i){return"%%"===e?"%":(s++,"function"==typeof(i=t.formatters[i])&&(e=i.call(r,n[s]),n.splice(s,1),s--),e)})),t.formatArgs.call(r,n),(r.log||t.log).apply(r,n)}}var i,o=null;return r.namespace=e,r.useColors=t.useColors(),r.color=t.selectColor(e),r.extend=n,r.destroy=t.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:function(){return null===o?t.enabled(e):o},set:function(e){o=e}}),"function"==typeof t.init&&t.init(r),r}function n(e,n){return(e=t(this.namespace+(void 0===n?":":n)+e)).log=this.log,e}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=[].concat(G(t.names.map(r)),G(t.skips.map(r).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.names=[],t.skips=[];var n,r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r=0;for(n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=uC,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t},Hr=$a((function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){try{var e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};e:{try{var n=localStorage;break e}catch(e){}n=void 0}t.storage=n,t.destroy=function(){var e=!1;return function(){e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),t.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),t.log=console.debug||console.log||function(){},e.exports=vC(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(e){e[e.Uploading=0]="Uploading",e[e.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function e(t){W(this,e),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=t.processId,this.sdkVersion=t.sdkVersion,this.rtmConfig=t.rtmConfig,this.uploadRequest=t.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(e,[{key:"upload",value:function(e){this.LogCache.push(e),this.uploadState===Ze.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(e){var t=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark((function n(){var r,i,o;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={sdk_version:t.sdkVersion,process_id:t.processId,payload:JSON.stringify(e)},n.prev=1,n.next=4,t.uploadRequest(r,null!==(i=t.rtmConfig.enableCloudProxy)&&void 0!==i&&i);case 4:if(!Uk){n.next=6;break}throw Error("RTM is busy");case 6:n.next=13;break;case 8:return n.prev=8,n.t0=n.catch(1),o=2>t.uploadResendCount++?2e3:1e4,setTimeout((function(){return t.postLog(t.LogsToPost)}),o),n.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),0!==t.LogCache.length){n.next=17;break}return t.uploadState=Ze.Free,n.abrupt("return");case 17:t.uploadResendCount=0,t.LogsToPost=40>t.LogCache.length?t.LogCache.splice(0,t.LogCache.length):t.LogCache.splice(0,40),t.postLog(t.LogsToPost);case 20:case"end":return n.stop()}}),n,null,[[1,8]])}))),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),e}(),Jr=function(e,t,n,r,i,o,s,a){var c=0;for(s=!!s&&Id(s,a,3);c<r;){if(c in n){if(a=s?s(n[c],c,t):n[c],0<o&&gd(a))i=Jr(e,t,a,ta(a.length),i,o-1)-1;else{if(9007199254740991<=i)throw TypeError("Exceed the acceptable array length");e[i]=a}i++}c++}return i},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=Qa(this),n=ta(t.length),r=Sg(t,0);return r.length=xC(r,t,t,n,0,void 0===e?1:$b(e)),r}}),N({target:"Object",stat:!0},{values:function(e){return aC(e)}});var yC=["CODE"],Db,ud,F;!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"}(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(e){return Object.values(yf).flat().includes(e)},cu=function(e){var t;return null===(t=Hg(yf).find((function(t){return(t=ra(t,2))[0],t[1].includes(e)})))||void 0===t?void 0:t[0]},AC=function(e){return e.sort((function(e,t){return Kr.indexOf(e)-Kr.indexOf(t)}))},xe=function(e){var t=new Set;if(0===(e=AC(e).slice(0,3).map((function(e){var n=Kg[e];if(void 0===n)throw new Ia("invalid area key");return e=n.CODE,n=ff(n,yC),t.add(e),n}))).length)throw new Ia("areas cannot be empty");return ua({CODES:t},e.reduce((function(e,t){for(var n=0,r=Hg(e);n<r.length;n++){var i=ra(r[n],2),o=i[0];i=i[1],e[o]=Array.from(new Set([].concat(G(t[o]),G(i))))}return e})))},M,Lr=function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(2<(i=2<c.length&&void 0!==c[2]?c[2]:0))){e.next=3;break}return e.abrupt("return");case 3:return o={withCredentials:!0,body:t,timeout:2e4},s=0<i?(null==M?void 0:M.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(null==M?void 0:M.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",a=n?"https://".concat(null!==(r=null==M?void 0:M.PROXY_NGINX[0])&&void 0!==r?r:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(s,"&p=443&d=upload/v1"):"https://".concat(s,"/upload/v1"),e.next=8,te(a,o).catch((function(e){return Lr(t,n,i+1)}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(e){if("string"==typeof e)return oa(e);if(Array.isArray(e)&&e.every((function(e){return"string"==typeof e})))return e.map((function(e){return oa(e)}));if(!Il(e)){for(var t={},n=0;n<Or.length;n++){var r=Or[n];r in e&&(t[r]=e[r])}if(0<Object.keys(t).length)return t;if(5>Object.keys(e).length){for(n=0,e=Object.entries(e);n<e.length;n++){var i=ra(e[n],2);r=i[0],i=i[1],il.includes(r)?t[r]="[Hidden Info]":t[oa(r)]="string"==typeof i?oa(i):"[Sensitive Info]"}return t}return"[Sensitive Info]"}return e},Pr=function(e){return"object"===X(e)?yd(e)?Vm(fe(e,5),il,Nr):e.constructor&&e.constructor.name:e},Qr=function(e,t){return e instanceof Error?e.message:"string"!=typeof e?JSON.stringify(Vm(fe(e,5),il,Nr)):(t=t.map((function(e){return e instanceof Error?e.message:"object"===X(e)?Gr(Array.isArray(e)?e.map(Pr):Pr(e)):e})),Nm.apply(void 0,[e.replace(/%[%Oo]/g,(function(e){return"%%"===e?"%":"%o"===e||"%O"===e?"%s":e}))].concat(G(t))))},CC=1,Rr=function(e,t,n){var r=Hr(e);return r.enabled=!0,r.log=n,r.useColors=!1,function(n){for(var i=arguments.length,o=Array(1<i?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];if(t.enableLogUpload){i=Cg(n);var a=Qr(i,o);Mr.upload({log_item_id:"".concat(CC++),log_level:e,payload_str:"[".concat(sC(),"] ").concat(e," - ").concat(256<a.length?a.slice(0,256):a)})}switch(i=function(e){var t=a||Qr(Cg(n),o),i=Nc.LOG_HANDLER;"function"==typeof i&&i({level:e,message:t}),r(t)},e){case"RTM:INFO":t.logFilter.info&&i("log");break;case"RTM:WARN":t.logFilter.warn&&i("warning");break;case"RTM:ERROR":t.logFilter.error&&i("error");break;case"RTM:TRACK":t.logFilter.track&&i("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":case"RTM:DEBUG":t.logFilter.debug&&i("debug")}}},jl,Sr=function(e){return function(t){var n=1===jl||void 0===e?"":"Ins#".concat(e," ");return"".concat(n).concat(t)}},kl=function(e,t,n){var r=Sr(jl);return Rr("RTM:".concat(t),n,(function(t){return e(r(t))}))},tb=function(){return function(e){function t(e,i){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];W(this,t);var s=r.call(this);if(m(n(s),"logError",void 0),m(n(s),"invokeTracker",void 0),m(n(s),"resultTracker",void 0),m(n(s),"errorTracker",void 0),m(n(s),"eventTracker",void 0),m(n(s),"info",void 0),m(n(s),"warn",void 0),m(n(s),"log",void 0),m(n(s),"genLogger",void 0),m(n(s),"loggerId",void 0),m(n(s),"logger",void 0),m(n(s),"name",void 0),s.logger=e,s.name=i,s.loggerId=e.loggerId,s.info=e.info,s.warn=e.warn,s.logError=e.logError,s.genLogger=e.genLogger,s.log=e.genLogger("RTM:DEBUG","<".concat(i,"> ")),s.invokeTracker=e.genTracker("Invoke"),s.eventTracker=e.genTracker("Event"),s.resultTracker=e.genTracker("Result"),s.errorTracker=e.genTracker("Error"),o){var a=s.emit.bind(n(s));s.emit=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];e=t[0],n=t.slice(1);var r=BC.includes(e);s.eventTracker.apply(s,["%s: ".concat(0<n.length?"%s emitted with args: ".concat(n.map((function(){return"%o"}))):"%s emitted"),i,e].concat(G(r?n.map(ye):n)));try{a.apply(void 0,t)}catch(t){s.logError("Caught in the callback function of the event %s",e,t)}}}return s}la(t,e);var r=ma(t);return t}(ea)},DC=function(e){return kl(console.log.bind(console),"INFO",e)},EC=function(e){return kl(console.warn.bind(console),"WARN",e)},FC=function(e){return kl(console.error.bind(console),"ERROR",e)},Tr=function(e,t){return function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=Sr(e),o=console.debug.bind(console),s=Rr(n,t,(function(e){return o(i(e))}));return function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return s.apply(void 0,[r+e].concat(n))}}},GC=function(e,t){return function(n){return Tr(e,t)("RTM:TRACK","[".concat(n,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(e,t){var n=-1,r=e.length,i=r-1;for(t=void 0===t?r:t;++n<t;){var o=e[r=nr(n,i)];e[r]=e[n],e[n]=o}return e.length=t,e},IC=function(e){return Ur(Xh(e))},JC=function(e){return Ur(Ni(e))},$e=function(e){return(Va(e)?IC:JC)(e)},af={0:9591,1:9593},$d=function(e){return"https://".concat(e,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(e){function t(e,i,o,s,a,c){W(this,t);var l=r.call(this,a,Ai("Socket-",a.loggerId));if(m(n(l),"isActiveClose",!1),m(n(l),"loggedIn",!1),m(n(l),"useNewDomain",void 0),m(n(l),"receivedPacket",new Pa),m(n(l),"open$",void 0),m(n(l),"input$",new Pa),m(n(l),"userJoin$",new Pa),m(n(l),"attemptsSinceLastError",0),m(n(l),"message$",new Pa),m(n(l),"socket$",void 0),m(n(l),"toClose",new Pa),m(n(l),"toReconnect",new Pa),m(n(l),"sendLogger",void 0),m(n(l),"receiveLogger",void 0),m(n(l),"ip",void 0),m(n(l),"env",void 0),m(n(l),"ticket",void 0),m(n(l),"context",void 0),m(n(l),"getDomain",(function(){return an(l.ip,l.useNewDomain)})),m(n(l),"socketReconnector",(function(e){var t=function(e){return l.attemptsSinceLastError+=1,l.warn("The %s of Env %d reconnecting %s",l.name,l.env,e.message),Bc(3e3)};return e.pipe(Ga((function(e){return l.log("socket connection closed"),l.loggedIn=!1,2<=l.attemptsSinceLastError?(l.warn("socket connection failure"),l.emit("connectionFailure"),l.close(),Z(e)):l.isActiveClose?vb:(l.emit("reconnect"),l.useNewDomain=!l.useNewDomain,Z(e))})),oe((function(e){return e.pipe(Cc(t))})))})),l.ip=e,l.env=i,l.ticket=o,l.context=s,l.useNewDomain=null!=c?c:.5<=Math.random(),l.sendLogger=l.genLogger("RTM:MSG:SEND"),l.receiveLogger=l.genLogger("RTM:MSG:RECV"),0!==i&&1!==i)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(e))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var u=af[i];l.log("Opening websocket address %s for the Env %d",l.ip,l.env);var d=Xb(l.input$,l.userJoin$.pipe(Rt(2)),l.message$).pipe(ba((function(e){return Oh.encode(e).finish()})));return e=Xb(St("",{protocols:[],makeWebSocket:function(){if(l.context.config.enableCloudProxy){if(0===l.context.cloudProxyServers.length)throw l.logError("No cloud proxy server to connect"),new da;var e="wss://".concat(an(bn(l.context.cloudProxyServers),!1),"/");e=we(e,"sid",l.context.sid),e=we(e,"remote_port",u.toString()),e=we(e,"remote_ip",l.ip),e=we(e,"token",l.context.key),e=new WebSocket(e)}else e=new WebSocket("wss://".concat(l.getDomain(),":").concat(u));return e.binaryType="arraybuffer",e}}),l.toReconnect),l.socket$=Ca(e,Tk.pipe(hb(15e3),Ga((function(e){return Sa(e)&&l.warn("socket open timed out"),Z(e)})))).pipe(ba((function(e){if(e instanceof Error)throw l.warn("Env_%d: Force reconnect the socket",l.env),e;return e(d).pipe(ba((function(e){return Oh.decode(new Uint8Array(e))})))})),l.socketReconnector),l.open$=l.socket$.pipe(ca((function(e){l.log("Websocket opened",l.name),e.subscribe((function(e){var t=e.data;e=Li[e.uri].slice(0,-3),t=$m[e].decode(t);var n=HA({},Gk(t,"toJSON"),(function(e,t){return t instanceof U?Km(t):t})),r=!1;if((t instanceof vr||t instanceof ur)&&t.instance.lessThanOrEqual(4294967295)&&(r=!0),t instanceof wr||t instanceof xr){var i=t.instance,o=t.sequence;(t.dialogue.lessThanOrEqual(4294967295)||i.lessThanOrEqual(4294967295)||o.lessThan(1))&&(r=!0)}r?l.warn("Env_%d: Illegal %s, abandoned %o",l.env,e,n):("Pong"!==e&&l.receiveLogger("Env_%d: %s %o",l.env,e,n),l.receivedPacket.next([e,t]))}),(function(){}))})),qf(void 0),ob(l.toClose),pe()),l}la(t,e);var r=ma(t);return Ha(t,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(e,t){if("Ping"!==e){var n=uc(t,(function(e){return e instanceof U?Km(e):e}));this.sendLogger("Env_%d: %s %o",this.env,e,n)}t=du(e,t),"UserJoin"===e?this.userJoin$.next(t):"Message"===e?this.message$.next(t):this.input$.next(t)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(e){var t=this;return this.receivedPacket.pipe(ca((function(e){var n=ra(e,2);e=n[0],n=n[1],"UserResp"===e&&(t.attemptsSinceLastError=0,t.loggedIn=!0),"UserDrop"===e&&t.emit("socketUserDrop",n)})),wb((function(t){return ra(t,1)[0]===e})),ba((function(e){return ra(e,2)[1]})))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),t}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(e){return XB(this,e,1<arguments.length?arguments[1]:void 0)}});var OC=function(e){var t=xf(Kg);e=Yt(e);for(var n=0;n<t.length;n++){var r=Kg[t[n]];if(null!=r&&r.AP_DOMAINS.includes(e)||null!=r&&r.AP_BACKUP_DOMAINS.includes(e)||null!=r&&r.PROXY_AP.includes(e))return[r.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(e){function t(e,i){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];W(this,t);var s=r.call(this,i,"AccessPoint");return m(n(s),"handleUniLbsError",(function(e,t){var n=e;if(4<e.toString().length){var r=e.toString().padStart(8,"0"),i=parseInt(r.slice(0,4),10);if(r=parseInt(r.slice(4,8),10),201===i)n=r;else if(101===i&&!QC.includes(r))return Z(Error("service is currently unavailable"))}if(i=n.toString(),!Object.keys(Vr).includes(i))return(e=new da(["Login is rejected by the server. The response code is %d",e],jg)).serverCode=n,Z(e);switch(i=Vr[i],n=PC[i],i){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(t=new Ye(n,$q)).serverCode=e,Z(t);case"INVALID_USER_ID":return(t=new Ye(n,Jh)).serverCode=e,Z(t);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(t=new Ye(n,Kh)).serverCode=e,Z(t);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(t=new Ye(n,ar)).serverCode=e,Z(t);case"CANNOT_MEET_AREA_DEMAND":return(t=OC(t)).forEach((function(e){return s.failedAreas.add(e)})),s.failedAreas.size===(void 0===M?2:M.CODES.size)?((t=new I(n,jg)).serverCode=e,Z(t)):Z(Error("ap ".concat(t.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(t=new da(n,jg)).serverCode=e,Z(t);default:return Z(Im("ApResErrType",i))}})),m(n(s),"getApEdgeInfo$",void 0),m(n(s),"getApEdgeInfoEndFirst$",void 0),m(n(s),"apFinish$",new Pa),m(n(s),"retryCount",0),m(n(s),"failedAreas",new Set),m(n(s),"usedUrl",[]),m(n(s),"newDomainUsed",!1),m(n(s),"backupNewDomainUsed",!1),m(n(s),"genUrl",(function(){return void 0===M?mi.apply(void 0,G($e([KC,LC]))).pipe(ni((function(e){return bb.apply(void 0,G(e))}))):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))})),m(n(s),"genBackupUrl",(function(){return void 0===M?mi.apply(void 0,G($e([MC,NC]))).pipe(ni((function(e){return bb.apply(void 0,G(e))}))):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))})),m(n(s),"getApUrl$",(function(e){var n,r;return s.genUrl().pipe(wb((function(e){return(!s.newDomainUsed||!e.includes("sd-rtn.com"))&&(e.includes("sd-rtn.com")&&(s.newDomainUsed=!0),!dl(s.usedUrl,(function(t){var n;return t===(null===(n=e.match(Qh))||void 0===n?void 0:n[1])})))})),ca((function(e){var t;void 0===M&&"string"==typeof(e=null===(t=e.match(Qh))||void 0===t?void 0:t[1])&&s.usedUrl.push(e)})),Ka(e?Math.max(Nc.RECONNECTING_AP_NUM,null!==(n=null==M?void 0:M.CODES.size)&&void 0!==n?n:0):null!==(r=null==M?void 0:M.CODES.size)&&void 0!==r?r:2),Dd((function(){return t.runOutOfUrlSymbol})),Ga((function(e,n){return s.newDomainUsed=!1,e===t.runOutOfUrlSymbol?(s.usedUrl=[],n):Z(e)})))})),m(n(s),"getBackupApUrl$",(function(e){var n,r;return s.genBackupUrl().pipe(wb((function(e){return(!s.backupNewDomainUsed||!e.includes("sd-rtn.com"))&&(e.includes("sd-rtn.com")&&(s.backupNewDomainUsed=!0),!dl(s.usedUrl,(function(t){var n;return t===(null===(n=e.match(Qh))||void 0===n?void 0:n[1])})))})),ca((function(e){var t;void 0===M&&"string"==typeof(e=null===(t=e.match(Qh))||void 0===t?void 0:t[1])&&s.usedUrl.push(e)})),Ka(e?Math.max(Nc.RECONNECTING_AP_NUM,null!==(n=null==M?void 0:M.CODES.size)&&void 0!==n?n:0):null!==(r=null==M?void 0:M.CODES.size)&&void 0!==r?r:2),Dd((function(){return t.runOutOfUrlSymbol})),Ga((function(e,n){return s.backupNewDomainUsed=!1,e===t.runOutOfUrlSymbol?(s.usedUrl=[],n):Z(e)})))})),m(n(s),"getProxyApUrl$",(function(e){var t,n;return bb.apply(void 0,G(((null==M?void 0:M.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(e?Math.max(Nc.RECONNECTING_AP_NUM,null!==(t=null==M?void 0:M.CODES.size)&&void 0!==t?t:0):null!==(n=null==M?void 0:M.CODES.size)&&void 0!==n?n:2))})),m(n(s),"context",void 0),m(n(s),"fetchCloudProxy",(function(e,t){var n=Ai("AP-",s.loggerId);s.log("The AccessPoint requests %s(%s)",e,n);var r=new AbortController;return s.apFinish$.pipe(Ka(1)).subscribe((function(){return r.abort()})),ad(J(w.mark((function i(){var o;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=Ag(0,Number.MAX_SAFE_INTEGER),s.log("%s request opid: %d",n,o),i.abrupt("return",te(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:s.context.sid,opid:o,appid:s.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:null!=t?t:s.context.key,cname:s.context.uid,uid:0,detail:ua({},void 0===M?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map((function(e){return e===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):e})).join(",")})}}]},signal:r.signal}));case 3:case"end":return i.stop()}}),i)})))).pipe(Ga((function(t){return"AbortError"!==t.name&&(s.logError(t),s.warn("The AP server %s request failure",e,t)),vb})),cb(function(){var t=J(w.mark((function t(r){var i,o,a,c,l,u,d,h,p,f,m,g,_,E,v,y,b,S,T;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.responseText,o=JSON.parse(i),s.log("The %s response is %o",n,o),(void 0===(a=o.response_body)||0===a.length||a.some((function(e){var t;return void 0===(null===(t=e.buffer)||void 0===t?void 0:t.code)||23!==e.uri})))&&Z(new da("cloud proxy response_body not valid",jg)),0===(c=a.filter((function(e){return 0!==e.buffer.code}))).length){t.next=14;break}if(void 0===(l=c.find((function(e){return 128===e.buffer.flag})))){t.next=12;break}return t.abrupt("return",s.handleUniLbsError(l.buffer.code,e));case 12:return s.logError("cloud proxy error response"),t.abrupt("return",s.handleUniLbsError(c[0].buffer.code,e));case 14:for(u=[],d=0;d<a.length;d++)if(262144===(null==(f=a[d])||null===(h=f.buffer)||void 0===h?void 0:h.flag))null===(m=f.buffer)||void 0===m||null===(g=m.edges_services)||void 0===g||null===(_=g.forEach)||void 0===_||_.call(g,(function(e){Gm(e=e.ip)&&-1===s.context.cloudProxyServers.indexOf(e)&&(s.log("got cloud proxy server: %s",e),s.context.cloudProxyServers.push(e))}));else if(128===(null==f||null===(p=f.buffer)||void 0===p?void 0:p.flag)){for(b=function(e,t){var n=t[e];u.some((function(e){return e.ip===n.ip}))||u.push({ip:n.ip,ticket:f.buffer.cert})},S=0,T=f.buffer.edges_services;S<T.length;S++)b(S,T);s.context.rtmArea=null!==(E=null===(v=f.buffer)||void 0===v||null===(y=v.detail)||void 0===y?void 0:y[9])&&void 0!==E?E:""}return t.abrupt("return",bb.apply(void 0,G(u).concat([fg])));case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Ga((function(e){return sa(e)?Z(e):vb})),tg(),wb((function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket})))})),m(n(s),"fetchAp",(function(e,t){var n=Ai("AP-",s.loggerId);s.log("The AccessPoint requests %s(%s)",e,n);var r=new AbortController;return s.apFinish$.pipe(Ka(1)).subscribe((function(){return r.abort()})),ad(J(w.mark((function i(){var o;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=Ag(0,Number.MAX_SAFE_INTEGER),s.log("%s request opid: %d",n,o),i.abrupt("return",te(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:o,key:t||s.context.key,cname:s.context.uid,detail:ua({},void 0===M?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map((function(e){return e===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):e})).join(",")}),uid:0,sid:s.context.sid},signal:r.signal}));case 3:case"end":return i.stop()}}),i)})))).pipe(Ga((function(t){return"AbortError"!==t.name&&(s.logError(t),s.warn("The AP server %s request failure",e,t)),vb})),cb(function(){var t=J(w.mark((function t(r){var i,o,a,c,l,u,d;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.responseText,o=JSON.parse(i),s.log("The %s response is %o",n,o),c=(a=o).code,l=a.addresses,u=a.detail,0===c){t.next=6;break}return t.abrupt("return",s.handleUniLbsError(c,e));case 6:if(0!==(d=l).length){t.next=11;break}return t.abrupt("return",Z(Error("No available edge address to connect")));case 11:return s.context.rtmArea=null==u?void 0:u[9],t.abrupt("return",bb.apply(void 0,G(d).concat([fg])));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),tg(),Ga((function(e){return sa(e)?Z(e):vb})),wb((function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket})))})),s.context=e,s.getApEdgeInfoEndFirst$=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return Bc(0,e||o?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca((function(){s.retryCount+=1})),cb((function(){return s.context.config.enableCloudProxy?s.getProxyApUrl$(e||o):(4<=s.retryCount&&(s.retryCount=0),3>=s.retryCount?s.getApUrl$(e||o):s.getBackupApUrl$(e||o))})),cb((function(e){return s.context.config.enableCloudProxy?s.fetchCloudProxy(e):s.fetchAp(e)})),Ga((function(e){return e instanceof pb&&s.warn("AP request timeout"),Z(e)})),om((function(e){return e.ip})),ob(s.apFinish$))},s.getApEdgeInfo$=function(e){return Bc(0,e||o?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca((function(){s.retryCount+=1})),cb((function(){return s.context.config.enableCloudProxy?s.getProxyApUrl$(e||o):3>=s.retryCount?s.getApUrl$(e||o):s.getBackupApUrl$(e||o)})),cb((function(e){return(s.context.config.enableCloudProxy?s.fetchCloudProxy(e):s.fetchAp(e)).pipe()})),Ga((function(e){return e instanceof pb&&s.warn("AP request timeout"),Z(e)})),om((function(e){return e.ip})),ob(s.apFinish$))},s}la(t,e);var r=ma(t);return Ha(t,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),t}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(e){function t(e,i,o){W(this,t);var s=r.call(this,i,"Connection");m(n(s),"apClient",void 0),m(n(s),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(s),"curOpenSockets",[void 0,void 0]),m(n(s),"ipIterator",0),m(n(s),"firstEnv",.5<=Math.random()?1:0),m(n(s),"firstSocketOpener",void 0),m(n(s),"secondSocketOpener",void 0),m(n(s),"firstOpenKeeperSubject",new Pa),m(n(s),"secondOpenKeeperSubject",new Pa),m(n(s),"edgeInfoReplayed",void 0),m(n(s),"firstEnvOpenSocket",void 0),m(n(s),"firstOpenKeeperSub",void 0),m(n(s),"secondOpenKeeperSub",void 0),m(n(s),"context",void 0),m(n(s),"logger",void 0),s.context=e,s.logger=i,s.apClient=new Wr(s.context,i),s.apClient.apFinish$.subscribe((function(){s.log("Ap client fetch finished")}));var a,c=[];return s.edgeInfoReplayed=s.apClient.getApEdgeInfo$(o).pipe(oe((function(e){return e.pipe(ca((function(e){if(sa(e))throw e})),cd(o?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))})),wb((function(e){return!dl(c,e)})),Dd((function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),ca((function(e){c.push(e),s.log("An edge info got %o",e)})),ca({error:function(e){s.emit("connectionInitFailure",e)}}),wg((function(){s.apClient.clearUp()})),sm()),s.firstEnvOpenSocket=s.edgeInfoReplayed.pipe(cb((function(e){if(void 0===e)return Z(Error("Invalid edge info"));var t=new ml(e.ip,s.firstEnv,e.ticket,s.context,i,a);return s.firstEnv=1===s.firstEnv?0:1,t.on("connectionFailure",(function(){return s.onSocketConnectionFailure(t)})),a=!t.useNewDomain,t.open$.pipe(qf(t))})),ca((function(e){s.log("The websocket of ENV_%d opened to %s:%d",e.env,e.ip,af[e.env]),s.curOpenSockets[e.env]=e,s.lastOpenSockets[e.env].next(e),s.firstEnv=e.env,s.openSecondSocket(e.env,e.ip,e.useNewDomain)})),Ka(1),pe()),s.firstSocketOpener=s.firstEnvOpenSocket.pipe(cb((function(e){return e.open$.pipe(ca((function(){s.log("The websocket of first ENV_%d re-opened to %s:%d",e.env,e.ip,af[e.env]),s.curOpenSockets[e.env]=e,s.lastOpenSockets[e.env].next(e)})))}))),e=s.firstOpenKeeperSubject.pipe(Cc(Yc)),s.firstOpenKeeperSub=e.subscribe({error:s.logError}),s}la(t,e);var r=ma(t);return Ha(t,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(e,t){if(![0,1].includes(e))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var n=e===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var r=this.curOpenSockets[e];this.curOpenSockets[e]=void 0,r&&(r.isActiveClose=!0,setTimeout((function(){r.close()}),t)),void 0!==n&&setTimeout((function(){null==n||n.unsubscribe()}),t)}},{key:"waitClosing",value:function(e){var t=this;return e.isActiveClose=!0,e.open$.pipe(tt(),Ga((function(e){return e.message===mr.normalClosureMessage?vb:Z(e)})),hb(5e3),Ga((function(n){return n instanceof pb?(t.warn("Force closing the ENV_%d connection",e.env),vb):Z(n)})))}},{key:"onSocketConnectionFailure",value:function(e){var t=[0,1].filter((function(t){return t!==e.env}))[0];(t=this.curOpenSockets[t])&&t.loggedIn?this.reopenSocketWithApRequest(e.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(e,t,n){var r=this,i=1===e?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm((function(e,t){return[].concat(G(e),[t])}),[]),ba((function(e){return kr(e,(function(e){return Jm(t,e.ip)})).slice(-1)[0]})),Ka(1),cb((function(e){if(void 0===e)return Z(Error("Invalid edge info"));var t=new ml(e.ip,i,e.ticket,r.context,r.logger,n);return t.on("connectionFailure",(function(){return r.onSocketConnectionFailure(t)})),t.open$.pipe(ca((function(){r.lastOpenSockets[i].next(t),r.curOpenSockets[i]=t})))})),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(e){var t=this,n=[0,1].filter((function(t){return t!==e}))[0];if(void 0!==(n=this.curOpenSockets[n])){var r,i=n.ip;n=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd((function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),oe((function(e){return e.pipe(ca((function(e){if(e.code===Kh)t.emit("tokenExpired"),t.apClient.apFinish$.next(void 0);else if(sa(e))throw e})),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))})),ca((function(e){t.log("An edge info got %o",e)})),wg((function(){t.apClient.clearUp()}))).pipe(rm((function(e,t){return[].concat(G(e),[t])}),[]),ba((function(e){return(e=kr(e,(function(e){return Jm(i,e.ip)}))).length-1>=t.ipIterator?e.slice(-t.ipIterator++-1)[0]:(t.ipIterator=0,e.slice(-1)[0])})),Dd(),cb((function(n){if(void 0===n)return Z(Error("Invalid edge info"));var i=new ml(n.ip,e,n.ticket,t.context,t.logger,r);return i.on("connectionFailure",(function(){return t.onSocketConnectionFailure(i)})),r=!i.useNewDomain,i.open$.pipe(qf(i))})),ca((function(n){t.log("The websocket of ENV_%d re-opened to %s:%d using ap",n.env,n.ip,af[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)})),cb((function(n){return n.open$.pipe(ca((function(){t.log("The websocket of ENV_%d re-opened to %s:%d",n.env,n.ip,af[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)})))})),pe()),e===this.firstEnv?this.firstOpenKeeperSubject.next(n):this.secondOpenKeeperSubject.next(n)}}}]),t}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.appId="",e.prototype.ver="",e.prototype.buildno=0,e.prototype.installId="",e.prototype.os=0,e.prototype.did="",e.prototype.index=null,e.prototype.token="",e.prototype.version=0,e.prototype.subVersion=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.appId&&Object.hasOwnProperty.call(e,"appId")&&t.uint32(42).string(e.appId),null!=e.ver&&Object.hasOwnProperty.call(e,"ver")&&t.uint32(50).string(e.ver),null!=e.buildno&&Object.hasOwnProperty.call(e,"buildno")&&t.uint32(56).int32(e.buildno),null!=e.installId&&Object.hasOwnProperty.call(e,"installId")&&t.uint32(66).string(e.installId),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(128).int32(e.os),null!=e.did&&Object.hasOwnProperty.call(e,"did")&&t.uint32(138).string(e.did),null!=e.index&&Object.hasOwnProperty.call(e,"index")&&zc.Session.CommonIndex.encode(e.index,t.uint32(162).fork()).ldelim(),null!=e.token&&Object.hasOwnProperty.call(e,"token")&&t.uint32(170).string(e.token),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(176).int32(e.version),null!=e.subVersion&&Object.hasOwnProperty.call(e,"subVersion")&&t.uint32(184).int32(e.subVersion),t},e.CommonIndex=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.index1="",e.prototype.index2="",e.prototype.index3="",e.encode=function(e,t){return t||(t=Xc.create()),null!=e.index1&&Object.hasOwnProperty.call(e,"index1")&&t.uint32(10).string(e.index1),null!=e.index2&&Object.hasOwnProperty.call(e,"index2")&&t.uint32(18).string(e.index2),null!=e.index3&&Object.hasOwnProperty.call(e,"index3")&&t.uint32(26).string(e.index3),t},e}(),e}(),SC=zc.Link=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.destServerIp="",e.prototype.ackedServerIp="",e.prototype.responseTime=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.ec&&Object.hasOwnProperty.call(e,"ec")&&t.uint32(40).int32(e.ec),null!=e.sc&&Object.hasOwnProperty.call(e,"sc")&&t.uint32(48).int32(e.sc),null!=e.destServerIp&&Object.hasOwnProperty.call(e,"destServerIp")&&t.uint32(58).string(e.destServerIp),null!=e.ackedServerIp&&Object.hasOwnProperty.call(e,"ackedServerIp")&&t.uint32(66).string(e.ackedServerIp),null!=e.responseTime&&Object.hasOwnProperty.call(e,"responseTime")&&t.uint32(72).int32(e.responseTime),t},e}(),TC=zc.Logout=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),t},e}(),UC=zc.KickedOff=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.linkId=0,e.prototype.code=0,e.prototype.server="",e.prototype.serverCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.linkId&&Object.hasOwnProperty.call(e,"linkId")&&t.uint32(48).int32(e.linkId),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(56).int32(e.code),null!=e.server&&Object.hasOwnProperty.call(e,"server")&&t.uint32(66).string(e.server),null!=e.serverCode&&Object.hasOwnProperty.call(e,"serverCode")&&t.uint32(72).int32(e.serverCode),t},e}(),VC=zc.ChnJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),WC=zc.ChnJoinRes=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.prototype.serverErrCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),null!=e.serverErrCode&&Object.hasOwnProperty.call(e,"serverErrCode")&&t.uint32(64).int32(e.serverErrCode),t},e}(),XC=zc.ChnLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),YC=zc.ConnectionStateChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.oldState=0,e.prototype.newState=0,e.prototype.reason=0,e.prototype.reconnId=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.oldState&&Object.hasOwnProperty.call(e,"oldState")&&t.uint32(40).int32(e.oldState),null!=e.newState&&Object.hasOwnProperty.call(e,"newState")&&t.uint32(48).int32(e.newState),null!=e.reason&&Object.hasOwnProperty.call(e,"reason")&&t.uint32(56).int32(e.reason),null!=e.reconnId&&Object.hasOwnProperty.call(e,"reconnId")&&t.uint32(64).int32(e.reconnId),t},e}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(e){function t(e,i,o){return W(this,t),m(n(o=r.call(this,o,"Context")),"_token",void 0),m(n(o),"config",void 0),m(n(o),"_uid",void 0),m(n(o),"_sid",void 0),m(n(o),"_area","CN"),m(n(o),"appId",void 0),m(n(o),"enableCloudProxy",!1),m(n(o),"cloudProxyServers",[]),o.appId=e,o.config=i,o}la(t,e);var r=ma(t);return Ha(t,[{key:"token",set:function(e){this._token="string"==typeof e&&e?e:void 0}},{key:"uid",get:function(){if("string"==typeof this._uid&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(e){if(this.log("The user ID is set to %s",oa(e)),!za(e))throw new Ia;this._uid=e}},{key:"key",get:function(){if("string"==typeof this._token&&this._token)return this._token;if("string"==typeof this.appId&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if("string"==typeof this._sid&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(e){if(this.log("sid is set to %s",e),"string"!=typeof e||!e)throw new Ia;this._sid=e}},{key:"rtmArea",get:function(){if("string"==typeof this._area&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(e){this.log("area is set to %s",e),"string"==typeof e&&e?this._area=e:this.warn("set area failed")}}]),t}(tb()),$C=!!Fc&&R((function(){Fc.prototype.finally.call({then:function(){}},(function(){}))}));if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(e){var t=kd(this,mc("Promise")),n="function"==typeof e;return this.then(n?function(n){return mj(t,e()).then((function(){return n}))}:e,n?function(n){return mj(t,e()).then((function(){throw n}))}:e)}}),"function"==typeof Fc){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var e=J(w.mark((function e(t){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Uint8Array,e.next=3,crypto.subtle.digest("SHA-256",t);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$r=function(e){return Array.from(e).map((function(e){return e.toString(16).padStart(2,"0")})).join("")},bD=function(e){if("string"!=typeof e)throw new TypeError("Expected input to be a string");if(0!=e.length%2)throw new RangeError("Expected string to be an even number of characters");for(var t=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)t[n/2]=parseInt(e.substring(n,n+2),16);return t},as=function(e){return btoa(String.fromCharCode.apply(String,G(e))).replace(/={1,2}$/,"")},bs=function(){var e=J(w.mark((function e(t){var n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,crypto.subtle.digest("SHA-1",t);case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n=sha1.arrayBuffer(t);case 9:return e.abrupt("return",as(new Uint8Array(n)));case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),cs=function(e,t,n,r){r[t]=!0,n.has(e)?n.get(e).add(t):n.set(e,new Set([t]))},cD=function(e){switch(e){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(e){function t(e,i,o,s){W(this,t);var a=r.call(this,o,"ChunkDownloadManager");if(m(n(a),"abortController",new AbortController),m(n(a),"downloadedSize",0),m(n(a),"successCount",0),m(n(a),"timer",void 0),m(n(a),"chunks",[]),m(n(a),"retUnit",void 0),m(n(a),"singleThread",!1),m(n(a),"initialized",!1),m(n(a),"ee",void 0),m(n(a),"chunkCount",void 0),m(n(a),"aborted",!1),m(n(a),"serverToIndices",new Map),m(n(a),"backupToIndices",new Map),m(n(a),"indexToBackupServers",[]),m(n(a),"busyBackupServers",new Map),m(n(a),"downloadingChunks",new Set),m(n(a),"metaInfo",void 0),m(n(a),"transHandler",void 0),a.metaInfo=e,a.transHandler=i,a.ee=void 0===s?new ea:s,o=e.size,e=e.unit,0===o)throw new Ia("size cannot be 0");return void 0!==i.cancelSignal&&i.cancelSignal.addEventListener("abort",(function(){a.abortController.abort()}),{once:!0}),a.abortController.signal.addEventListener("abort",(function(){a.aborted=!0}),{once:!0}),a.chunkCount=Math.ceil(o/(32768*e)),a}la(t,e);var r=ma(t);return Ha(t,[{key:"setInfoByResponse",value:function(e){var t=this,n=e.serverList,r=e.backupList;if(e=e.unit,n.length<this.chunkCount&&r.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var i=Array(this.chunkCount).fill(!1);if(n.forEach((function(e,n){return e.forEach((function(e){return cs(e,n,t.serverToIndices,i)}))})),r.forEach((function(e,n){return e.forEach((function(e){return cs(e,n,t.backupToIndices,i)}))})),i.some((function(){return!1})))throw new da("Not enough servers to download",mg);this.indexToBackupServers=r.map((function(e){return new Set(e)})),this.retUnit=e}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):1===this.serverToIndices.size&&0===Array.from(this.serverToIndices.keys())[0]?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(e){var t=this,n=this.downloadedSize+e;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=n,void 0!==this.timer&&0!==e&&(clearTimeout(this.timer),this.timer=void 0),void 0===this.timer&&this.successCount!==this.chunkCount&&(this.timer=setTimeout((function(){t.ee.emit("timedOut"),t.abortController.abort()}),12e4)),this.initialized&&0===e||void 0===this.transHandler.onOperationProgress||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var e=0,t=0,n=this.chunks;t<n.length;t++)e+=n[t].byteLength;if(e!==this.metaInfo.size)throw new Ia("invalid chunks total size");e=new Uint8Array(e),n=t=0;for(var r=this.chunks;n<r.length;n++){var i=r[n];e.set(new Uint8Array(i),t),t+=i.byteLength}return t=Array.from(e.subarray(0,4)).map((function(e){return e.toString(16)})).join("").toUpperCase(),Zt(e.buffer,cD(t))}},{key:"getDownloadUrl",value:function(e){var t=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(e).split(".").join("-"),".edge.").concat(t,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var e=J(w.mark((function e(t){var n,r=this,i=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<i.length&&void 0!==i[1]&&i[1],e.next=3,Promise.all(Array.from(t.entries()).map((function(e){return e=ra(e,2),r.postDownloadRequest(e[0],Array.from(e[1]),n).catch((function(e){404===e.statusCode?(r.ee.emit("notExist"),r.abortController.abort()):"AbortError"!==e.name&&(Sa(e)?r.singleThread?(r.abortController.abort(),r.ee.emit("timedOut")):(r.warn("%d download timed out after %d, retrying use single thread",e.index,r.singleThread?6e4:3e4),r.abortController.abort(),r.singleThread=!0,r.ee.emit("multiTimeOut")):(r.ee.emit("error",e),r.abortController.abort()))}))})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var e=J(w.mark((function e(t,n,r){var i,o,s,a,c,l,u,d,h,p=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h=function(){return(h=J(w.mark((function e(o){var s,h,p,f,m,g,_,E,v;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0!==o||0!==t){e.next=5;break}throw new Ia("Invalid serverIp");case 5:s=void 0===o?u.getDownloadUrl(t):o;case 6:return u.downloadingChunks.add(i),e.next=9,l(s);case 9:return h=e.sent,p=h.responseData,u.downloadingChunks.delete(i),e.abrupt("return",p);case 15:if(e.prev=15,e.t0=e.catch(0),u.downloadingChunks.delete(i),n.unshift(i),u.metaInfo.useNewDomain=!1,"AbortError"!==e.t0.name){e.next=22;break}throw e.t0;case 22:if(!Sa(e.t0)){e.next=25;break}throw e.t0.index=i,e.t0;case 25:if(f=a,a+=1,!(2>f)){e.next=30;break}return e.t0 instanceof Ia||u.warn("%o, %d download failed, retrying",e.t0,i),e.abrupt("return",d());case 30:if(504!==e.t0.statusCode){e.next=34;break}throw(m=new db("download server timed out",{originalError:e.t0,serverCode:504})).index=i,m;case 34:if(!r||2!==f||0===c[0]){e.next=45;break}return e.t0 instanceof Ia||u.warn("%d download failed, using backup: %d, %o",i,c[0],e.t0),e.next=38,u.busyBackupServers.get(c[0]);case 38:return g=d(u.getDownloadUrl(c[0])),u.busyBackupServers.set(c[0],g),e.next=42,g;case 42:return _=e.sent,u.busyBackupServers.delete(c[0]),e.abrupt("return",_);case 45:if(!(r&&2<f&&void 0!==c[1]&&0!==c[1])){e.next=56;break}return u.warn("%d download failed, using backup 1: %d",i,c[1]),e.next=49,u.busyBackupServers.get(c[1]);case 49:return E=d(u.getDownloadUrl(c[1])),u.busyBackupServers.set(c[1],E),e.next=53,E;case 53:return v=e.sent,u.busyBackupServers.delete(c[1]),e.abrupt("return",v);case 56:throw e.t0.index=i,e.t0;case 58:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)},d=function(e){return h.apply(this,arguments)},!this.aborted){e.next=4;break}throw new Ia("download already aborted");case 4:if(void 0!==(i=n.shift())){e.next=8;break}return this.log("%s download finished",t),e.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){e.next=10;break}return e.abrupt("return");case 10:if(!this.downloadingChunks.has(i)){e.next=13;break}return this.log("%s already downloading, return",i),e.abrupt("return");case 13:if(void 0===this.chunks[i]){e.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",i),e.next=18,this.postDownloadRequest(t,n,r);case 18:return e.abrupt("return");case 19:return o=new FormData,s={hash:hu(this.metaInfo.hashHexStr),unit:void 0===this.retUnit?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:i},o.append("parameter",JSON.stringify(s)),a=0,c=Array.from(this.indexToBackupServers[i]),l=function(e){return te(e,{body:o,signal:p.abortController.signal,timeout:p.singleThread?12e4:3e4},{useBinaryResponse:!0})},u=this,e.next=28,d().then((function(e){return void 0!==p.chunks[i]?p.log("chunk %d download duplicated",i):(p.chunks[i]=e,p.log("chunk %d downloaded",i),p.successCount+=1,p.updateProgress(p.chunks[i].byteLength)),p.successCount===p.chunkCount&&(p.log("chunks all download"),p.ee.emit("finished")),p.singleThread?(p.downloadChunks(),Promise.resolve()):p.postDownloadRequest(t,n,r)}));case 28:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),t}(tb()),es=function(e){function t(e,i,o,s){W(this,t);var a=r.call(this,o,"ChunkUploadManager");if(m(n(a),"chunkCount",0),m(n(a),"chunks",[]),m(n(a),"uploadedChunks",[]),m(n(a),"totalFailures",0),m(n(a),"timer",void 0),m(n(a),"initState","uninitialized"),m(n(a),"ee",void 0),m(n(a),"unit",0),m(n(a),"uploadedSize",0),m(n(a),"singleThread",!1),m(n(a),"abortController",new AbortController),m(n(a),"servers",[]),m(n(a),"aborted",!1),m(n(a),"metaInfo",void 0),m(n(a),"transHandler",void 0),a.metaInfo=e,a.transHandler=i,a.ee=void 0===s?new ea:s,0===e.file.length)throw new I("file not found or is empty",wf);return void 0!==i.cancelSignal&&i.cancelSignal.addEventListener("abort",(function(){a.abortController.abort()}),{once:!0}),a.abortController.signal.addEventListener("abort",(function(){a.aborted=!0}),{once:!0}),a}la(t,e);var r=ma(t);return Ha(t,[{key:"initChunks",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("initialized"!==this.initState&&"initializing"!==this.initState){e.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=t,n=this.sliceFile(t,this.metaInfo.file),this.chunkCount=n.length,r=[],i=function(e,t){var n=(e=ra(t[e],2))[0],i=e[1];e=bs(i).then((function(e){a.chunks[n]={payload:i,sha1:e,uploadedTo:void 0,index:n,processed:!1}})),r.push(e)},o=0,s=Array.from(n.entries());o<s.length;o++)i(o,s);return e.next=11,Promise.all(r);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var e=this;if(!this.aborted){for(var t=this.chunks.filter((function(e){return!e.processed})),n=function(n){var r=t[n],i=e.servers.filter((function(e){return!e.isUploading})).sort((function(e,t){return e.successCount-t.successCount})).sort((function(e,t){return e.failureCount-t.failureCount}))[0];if(void 0===i||1<i.failureCount)return e.log("Upload server not available, waiting"),e.ee.emit("serverUsedUp"),Om(1e3).then((function(){e.totalFailures>2*e.chunkCount&&e.ee.emit("error"),e.totalFailures+=1,void 0!==i&&(i.failureCount=0),e.uploadToServers()})).catch((function(){})),"break";r.processed=!0,i.isUploading=!0,e.log("uploading chunk %d to server %s",r.index,Dg(i.ip));var o=e.getUploadUrl(i.ip);return J(w.mark((function t(){var n;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.postChunk(r.payload,o,r.index);case 3:n=e.chunks.findIndex((function(e){return e===r})),r.uploadedTo=i.ip,e.chunks.splice(n,1),e.uploadedChunks.push(r),i.successCount+=1,i.isUploading=!1,e.updateProgress(r.payload.byteLength),e.log("upload chunk %d successfully",r.index),t.next=31;break;case 13:if(t.prev=13,t.t0=t.catch(0),i.isUploading=!1,r.processed=!1,504!==t.t0.statusCode&&!Sa(t.t0)){t.next=27;break}if(e.singleThread){t.next=24;break}return e.warn("%d upload timed out after %d, retrying use single thread",r.index,e.singleThread?12e4:3e4),e.abortController.abort(),e.singleThread=!0,e.ee.emit("multiTimeOut"),t.abrupt("return");case 24:return e.ee.emit("timedOut"),e.abortController.abort(),t.abrupt("return");case 27:return e.metaInfo.useNewDomain=!1,i.failureCount+=1,t.next=31,Om(1e3);case 31:e.uploadedChunks.length===e.chunkCount?(e.log("chunks uploaded"),e.ee.emit("finished")):(e.singleThread||1===e.chunks.filter((function(e){return!e.processed})).length)&&e.uploadToServers();case 32:case"end":return t.stop()}}),t,null,[[0,13]])})))(),e.singleThread?"break":void 0},r=0;r<t.length&&"break"!==n(r);r++);0===t.length&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var e=!0,t=[],n=G(this.uploadedChunks).sort((function(e,t){return e.index-t.index})),r=0;for(n=Array.from(n.values());r<n.length;r++){var i=n[r].uploadedTo;if(void 0===i){e=!1;break}t.push(i)}if(!e)throw new Ia("some chunks not uploaded, cannot get upload server ips");return t}},{key:"addServers",value:function(e){var t=this;e.forEach((function(e){var n=t.servers.findIndex((function(t){return t.ip===e}));-1!==n?t.servers[n].failureCount=0:(t.log("server %s added",Dg(e)),t.servers.push({successCount:0,isUploading:!1,ip:e,failureCount:0}))}))}},{key:"updateProgress",value:function(e){var t=this,n=void 0!==e?this.uploadedSize+e:this.metaInfo.file.length;n>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=n,void 0!==this.timer&&0!==e&&(clearTimeout(this.timer),this.timer=void 0),void 0===this.timer&&void 0!==e&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout((function(){t.ee.emit("timedOut"),t.abortController.abort()}),12e4)),"initialized"===this.initState&&0===e||void 0===this.transHandler.onOperationProgress||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(e,t){var n=0,r=[],i=t.length;for(e*=32768;n<i;)r.push(t.slice(n,n+e)),n+=e;return this.log("chunks split into %d",r.length),r}},{key:"postChunk",value:function(){var e=J(w.mark((function e(t,n,r){var i,o,s,a,c,l,u;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.aborted){e.next=2;break}throw new Ia("upload already aborted");case 2:if(void 0!==this.unit){e.next=4;break}throw new Ia("unit is undefined");case 4:return i=this.metaInfo,o=i.ticket,s=i.instance,a=i.loginOpt,c=i.hashStr,e.t0=r,e.t1=c,e.next=9,bs(t);case 9:return e.t2=e.sent,e.t3=this.unit,e.t4=o,e.t5=s,e.t6=a,l={index:e.t0,hash:e.t1,sha1:e.t2,unit:e.t3,ticket:e.t4,instance:e.t5,loginOpt:e.t6},(u=new FormData).append("parameter",JSON.stringify(l)),u.append("payload",new Blob([t])),e.next=20,te(n,{headers:{Accept:"application/json"},body:u,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(201===e.sent.status){e.next=24;break}throw new da("uploading chunk ".concat(r," failed"));case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(e){var t=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(e).split(".").join("-"),".edge.").concat(t,":9601/api/v1/chuck/upload")}}]),t}(tb()),fs=function(e){function t(e){W(this,t);var i=r.call(this,e,"MediaTaskManager");return m(n(i),"isProcessing",!1),m(n(i),"authInfo",void 0),m(n(i),"taskFinishers",{}),m(n(i),"mediaTasks",new Map),m(n(i),"ongoingTask",void 0),i.on("connectionStateChanged",(function(e){if(e===S.ConnectionState.ABORTED||e===S.ConnectionState.DISCONNECTED){void 0!==i.ongoingTask&&i.cancelTask(i.ongoingTask),e=0;for(var t=Array.from(i.mediaTasks.entries());e<t.length;e++){var n=ra(t[e],2)[1];i.cancelTask(n)}i.mediaTasks.clear(),i.taskFinishers={}}else e===S.ConnectionState.RECONNECTING?void 0!==i.ongoingTask&&i.ongoingTask.manager.abortController.abort():e===S.ConnectionState.CONNECTED&&void 0!==i.ongoingTask&&i.ongoingTask.manager.ee.emit("reconnected")})),i}la(t,e);var r=ma(t);return Ha(t,[{key:"setAuthInfo",value:function(e){this.authInfo=e}},{key:"waitMediaTask",value:function(e){var t=this;return new Promise((function(n,r){t.taskFinishers[e]={resolve:n,reject:r},t.isProcessing||t.processMediaTask()})).finally((function(){void 0!==t.ongoingTask&&void 0!==t.ongoingTask.manager.timer&&clearTimeout(t.ongoingTask.manager.timer),delete t.taskFinishers[e],0!==t.mediaTasks.size?t.processMediaTask():t.isProcessing=!1}))}},{key:"addUploadTask",value:function(e,n,r,i){var o=e.file;if(e=e.hash,void 0===this.authInfo)throw new Ia("session not found");if(this.mediaTasks.size>=t.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return i=new es({hashStr:as(e),file:o,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},i,this.logger),o=Ud(),this.mediaTasks.set(o,{type:"UPLOAD",manager:i,hash:e,setter:r,fetcher:n,taskId:o}),o}},{key:"addDownloadTask",value:function(e,n,r){var i=e.hashHexStr,o=e.size,s=e.unit;if(e=e.zone,void 0===this.authInfo)throw new Ia("session not found");if(this.mediaTasks.size>=t.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return r=new ds({hashHexStr:i,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:o,zone:e,unit:s},r,this.logger),i=Ud(),this.mediaTasks.set(i,{type:"DOWNLOAD",manager:r,fetcher:n,taskId:i}),i}},{key:"doDownloadTaskImpl",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,l,u,d=this,h=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=2<h.length&&void 0!==h[2]&&h[2],o=i=t.manager,r&&(i=new ds(o.metaInfo,o.transHandler,this.logger,o.ee)),s=t.fetcher,e.next=7,s();case 7:if(a=e.sent,c=a.serverList,l=a.backupList,u=a.unit,!r||u===o.retUnit){e.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:r&&(t.manager=i,i.downloadedSize=o.downloadedSize,i.successCount=o.successCount,i.timer=o.timer,i.chunks=o.chunks,i.initialized=o.initialized,i.singleThread=o.singleThread,i.updateProgress(0)),i.ee.once("reconnected",(function(){i.ee.removeAllListeners(),d.doDownloadTaskImpl(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("multiTimeOut",(function(){i.ee.removeAllListeners(),d.doDownloadTaskImpl(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("error",(function(e){i.ee.removeAllListeners(),n.reject(new da(["download file file, index %d",e.index],{code:mg,originalError:e}))})),i.ee.once("notExist",(function(){i.abortController.abort(),i.ee.removeAllListeners(),n.reject(new da("download file not found",AA))})),i.ee.once("timedOut",(function(){i.ee.removeAllListeners(),i.abortController.abort(),n.reject(new db("download timed out",zA))})),void 0!==i.transHandler.cancelSignal&&i.transHandler.cancelSignal.addEventListener("abort",(function(){n.reject(new hl("Downloading canceled",ir))}),{once:!0}),i.ee.once("finished",(function(){n.resolve({type:"DOWNLOAD",payload:i.getPayload()})})),i.setInfoByResponse({serverList:c,backupList:l,unit:u}),i.downloadChunks();case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=e.taskId;return r||(this.mediaTasks.delete(i),this.ongoingTask=e),new Promise((function(i,o){n.doDownloadTaskImpl(e,t,r).then(i).catch(o)}))}},{key:"doUploadTaskImpl",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,l,u,d=this,h=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=2<h.length&&void 0!==h[2]&&h[2],o=i=t.manager,r&&(i=new es(o.metaInfo,o.transHandler,this.logger,o.ee)),s=t.fetcher,a=new Pa,l=new Promise((function(e,l){var u=s(),d=u.ret,h=u.err,p=u.timeout;u.fin.pipe(ob(a)).subscribe({next:function(e){n.resolve({type:"UPLOAD",retUnit:e.unit,zone:e.zone})},complete:function(){e({hasExist:!0}),a.next(),a.complete()}}),d.pipe(ob(a),cb(function(){var e=J(w.mark((function e(s){var a,l;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s.servers,l=s.unit,r&&o.unit!==l?n.reject(new da("upload unit is different, reject to continue",lg)):r&&(t.manager=i,i.chunkCount=o.chunkCount,i.chunks=o.chunks,i.totalFailures=o.totalFailures,i.uploadedChunks=o.uploadedChunks,i.timer=o.timer,i.initState=o.initState,i.unit=o.unit,i.uploadedSize=o.uploadedSize,i.singleThread=o.singleThread,i.updateProgress(0)),i.addServers(a),"uninitialized"!==i.initState){e.next=7;break}return c=i.initChunks(l),e.next=7,c;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).subscribe({complete:function(){return e({hasExist:!1})},error:l}),u=function(t){"uninitialized"!==i.initState&&c?e(c.then((function(){return{hasExist:!1}}))):l(t)},h.pipe(ob(a)).subscribe({error:u}),p.pipe(ob(a)).subscribe({error:u})})),e.next=9,l;case 9:if(!e.sent.hasExist){e.next=15;break}return i.updateProgress(),this.log("file already exists, skipping upload"),e.abrupt("return");case 15:a.next(),a.complete(),this.log("chunks initialization promise resolved"),u=gb(i.ee,"serverUsedUp").pipe(Gt((function(){return i.chunkCount!==i.uploadedChunks.length})),Jt(5e3,void 0,{leading:!1}),pm((function(){return s().ret}))).subscribe((function(e){i.addServers(e.servers)})),i.ee.once("reconnected",(function(){i.ee.removeAllListeners(),d.doUploadTask(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("multiTimeOut",(function(){i.ee.removeAllListeners(),d.doUploadTask(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("timedOut",(function(){u.unsubscribe(),i.ee.removeAllListeners(),i.abortController.abort(),n.reject(new db("upload timed out",Lh))})),i.ee.once("error",(function(e){u.unsubscribe(),i.ee.removeAllListeners(),i.abortController.abort(),n.reject(e||new da("upload error",lg))})),void 0!==i.transHandler.cancelSignal&&i.transHandler.cancelSignal.addEventListener("abort",(function(){n.reject(new hl("Uploading canceled",hr))}),{once:!0}),i.ee.once("finished",J(w.mark((function e(){var r,o,s;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.unsubscribe(),e.next=3,t.setter(i.unit,i.getUploadServerIPs());case 3:r=e.sent,o=r.zone,s=r.unit,i.ee.removeAllListeners(),n.resolve({type:"UPLOAD",retUnit:s,zone:o});case 8:case"end":return e.stop()}}),e)})))),i.uploadToServers();case 26:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"doUploadTask",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=e.taskId;return r||(this.mediaTasks.delete(i),this.ongoingTask=e),new Promise((function(i,o){n.doUploadTaskImpl(e,t,r).then(i).catch(o)}))}},{key:"processMediaTask",value:function(){var e=J(w.mark((function e(){var t,n,r;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.mediaTasks.size){e.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,t=this.mediaTasks.keys().next().value,void 0!==(n=this.taskFinishers[t])){e.next=7;break}throw Error("top task not found");case 7:if(void 0!==(r=this.mediaTasks.get(t))){e.next=10;break}throw new Ia("task invalid");case 10:if("UPLOAD"!==r.type){e.next=15;break}return e.next=13,this.doUploadTask(r,n).catch((function(e){r.manager.ee.removeAllListeners(),n.reject(e)}));case 13:e.next=18;break;case 15:if("DOWNLOAD"!==r.type){e.next=18;break}return e.next=18,this.doDownloadTask(r,n).catch((function(e){r.manager.ee.removeAllListeners(),n.reject(e)}));case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancelTask",value:function(e){var t="DOWNLOAD"===e.type?ir:hr;e.manager.ee.removeAllListeners(),e.manager.abortController.abort(),void 0!==this.taskFinishers[e.taskId]&&this.taskFinishers[e.taskId].reject(new hl("User logged out or kicked off, media task canceled",t))}}]),t}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",(function(){for(var e=0,t=arguments.length,n=new(Ne(this))(t);t>e;)n[e]=arguments[e++];return n}),Dj);var gs=1/0,dD=Math.max,ju=function(e,t,n){var r=Object(e);if(!Ed(e)){var i=Te(t);e=Ad(e),t=function(e){return i(r[e],e,r)}}return-1<(t=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;if(null==n)n=0;else{var i=(n=n?(n=gl(n))===gs||n===-gs?17976931348623157e292*(0>n?-1:1):n==n?n:0:0===n?n:0)%1;n=n==n?i?n-i:n:0}return 0>n&&(n=dD(r+n,0)),Xp(e,Te(t),n)}(e,t,n))?r[i?e[t]:t]:void 0},iu=function(e,t){return e&&e.length?vk(e,void 0,"function"==typeof t?t:void 0):[]},hs=function(){function e(){W(this,e),m(this,"size",0),m(this,"fields",new Map)}return Ha(e,[{key:"define",value:function(e,t,n){if(this.size+=n,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(t={val:0,isNumber:"number"===t,isBoolean:"boolean"===t,oneof:"number"===t||"boolean"===t?void 0:t,len:n}),this.fields.set(e,t)}},{key:"set",value:function(e,t){if(!(e=this.fields.get(e)))throw Error("field not found");var n=e.oneof;if(!U.isLong(t)&&"number"!=typeof t)if("boolean"==typeof t)t=t?1:0;else{if(void 0===n)throw Error("invalid field type");if(void 0===(t=n[t]))throw Error("field type not found")}Mg(e,t),e.val=t}},{key:"toNumber",value:function(){for(var e=0,t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ra(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(e+=U.fromValue(i).shiftLeft(t).toNumber(),t+=o)}return e}},{key:"toLong",value:function(){for(var e=U.fromNumber(0,!0),t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ra(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(e=U.fromValue(i).shiftLeft(t).add(e),t+=o)}return e}},{key:"assert",value:function(e,t){function n(e){if(!U.isLong(e)&&"number"!=typeof e)if("boolean"==typeof e)e=e?1:0;else{if(void 0===i)throw Error("invalid field type");if(void 0===(e=i[e]))throw Error("field type not found")}return Mg(r,e),Lg(e,r.val)}var r=this.fields.get(e);if(!r)throw Error("field not found");var i=r.oneof;if(!Array.isArray(t))return n(t);if(1===t.length)return n(t[0]);if(t.every((function(e){return"string"==typeof e}))&&void 0!==i)return t.some((function(e){return n(e)}));throw Error("invalid valueTypes")}},{key:"from",value:function(e){e=U.fromValue(e);for(var t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ra(r[n],2)[1],o=i.len,s=U.fromNumber(Math.pow(2,o)-1,!0).shiftLeft(t);Mg(i,s=e.and(s).shiftRightUnsigned(t)),i.val=s,t+=o}}},{key:"typeOf",value:function(e){if(void 0!==(e=this.fields.get(e))){var t=e.oneof;if(e=e.val,void 0!==t){var n=0;for(t=Object.entries(t);n<t.length;n++){var r=ra(t[n],2),i=r[0];if(Lg(e,r[1]))return i}}}throw new TypeError("can only get type of oneof type")}}]),e}(),is=function(e){function t(e){W(this,t);var r=n.call(this);return r.define("Rejoin","boolean",1),r.define("Unused","number",31),r.define("Platform","number",8),r.define("Version","number",12),r.define("Subversion","number",12),r.set("Platform",7),r.set("Version",4),r.set("Subversion",203),r.set("Rejoin",e),r}la(t,e);var n=ma(t);return t}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(e){function t(e){W(this,t);var r=n.call(this);if(r.define("MessageType",fD,8),r.define("BroadcastJumps","number",2),r.define("ToCache","boolean",1),r.define("FromCache","boolean",1),r.define("CompressionMethod",gD,2),r.define("IterationNumber","number",4),r.define("BufferedMessage","boolean",1),r.define("ToArchive","boolean",1),r.define("FromArchive","boolean",1),"number"==typeof e||U.isLong(e))r.from(e);else if(void 0!==e){var i=0;for(e=Hg(e);i<e.length;i++){var o=ra(e[i],2);r.set(o[0],o[1])}}return r}la(t,e);var n=ma(t);return Ha(t,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(e){var t=this;return void 0!==e?this.assert("MessageType",e):xf(js).some((function(e){return t.assert("MessageType",e)}))}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),t}(hs),hD=function(e){function t(e){return W(this,t),m(n(e=r.call(this,e,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),e}la(t,e);var r=ma(t);return Ha(t,[{key:"getChatInfo",value:function(e){var t=this.dialogueLru.get(e);if(this.dialogueLru.prune(),t){var n=t.dialogue,r={dialogue:n,sequence:t=t.sequence.add(1)};return this.dialogueLru.set(e,{dialogue:n,sequence:t}),r}return n={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(e,n),n}}]),t}(tb()),v={};"object"==X(module)&&(module.exports=v),v.parse=function(e,t){var n,r=v.bin.readUshort,i=v.bin.readUint,o={};for(n=(e=new Uint8Array(e)).length-4;101010256!=i(e,n);)n--;var s=r(e,n=n+4+4);r(e,n+=2),i(e,n+=2),n=i(e,n+=4);for(var a=0;a<s;a++){i(e,n),n+=4,n+=4,n+=4,i(e,n+=4);var c=i(e,n+=4),l=i(e,n+=4),u=r(e,n+=4),d=r(e,n+2),h=r(e,n+4);n+=6;var p=i(e,n+=8);n+=4,n+=u+d+h,v._readLocal(e,p,o,c,l,t)}return o},v._readLocal=function(e,t,n,r,i,o){var s=v.bin.readUshort,a=v.bin.readUint;a(e,t),s(e,t+=4),s(e,t+=2);var c=s(e,t+=2);a(e,t+=2),a(e,t+=4),a=s(e,t=t+4+8);var l=s(e,t+=2);if(t+=2,s=v.bin.readUTF8(e,t,a),t=t+a+l,o)n[s]={size:i,csize:r};else if(e=new Uint8Array(e.buffer,t),0==c)n[s]=new Uint8Array(e.buffer.slice(t,t+r));else{if(8!=c)throw"unknown compression method: "+c;t=new Uint8Array(i),v.inflateRaw(e,t),n[s]=t}},v.inflateRaw=function(e,t){return v.F.inflate(e,t)},v.inflate=function(e,t){return e[0],e[1],v.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-2),t)},v.deflate=function(e,t){null==t&&(t={level:6});var n=0,r=new Uint8Array(50+Math.floor(1.1*e.length));return r[n]=120,r[n+1]=156,n=v.F.deflateRaw(e,r,n+2,t.level),e=v.adler(e,0,e.length),r[n+0]=e>>>24&255,r[n+1]=e>>>16&255,r[n+2]=e>>>8&255,r[n+3]=e>>>0&255,new Uint8Array(r.buffer,0,n+4)},v.deflateRaw=function(e,t){null==t&&(t={level:6});var n=new Uint8Array(50+Math.floor(1.1*e.length)),r=v.F.deflateRaw(e,n,r,t.level);return new Uint8Array(n.buffer,0,r)},v.encode=function(e,t){null==t&&(t=!1);var n,r=0,i=v.bin.writeUint,o=v.bin.writeUshort,s={};for(n in e){var a=!v._noNeed(n)&&!t,c=e[n],l=v.crc.crc(c,0,c.length);s[n]={cpr:a,usize:c.length,crc:l,file:a?v.deflateRaw(c):c}}for(n in s)r+=s[n].file.length+30+46+2*v.bin.sizeUTF8(n);for(n in e=new Uint8Array(r+22),t=0,c=[],s)l=s[n],c.push(t),t=v._writeHeader(e,t,n,l,0);for(n in r=0,a=t,s)l=s[n],c.push(t),t=v._writeHeader(e,t,n,l,1,c[r++]);return s=t-a,i(e,t,101010256),o(e,t=t+4+4,r),o(e,t+=2,r),i(e,t+=2,s),i(e,t+4,a),e.buffer},v._noNeed=function(e){return e=e.split(".").pop().toLowerCase(),-1!="png,jpg,jpeg,zip".indexOf(e)},v._writeHeader=function(e,t,n,r,i,o){var s=v.bin.writeUint,a=v.bin.writeUshort,c=r.file;return s(e,t,0==i?67324752:33639248),t+=4,1==i&&(t+=2),a(e,t,20),a(e,t+=2,0),a(e,t+=2,r.cpr?8:0),s(e,t+=2,0),s(e,t+=4,r.crc),s(e,t+=4,c.length),s(e,t+=4,r.usize),a(e,t+=4,v.bin.sizeUTF8(n)),a(e,t+=2,0),t+=2,1==i&&(s(e,t=t+2+2+6,o),t+=4),t+=n=v.bin.writeUTF8(e,t,n),0==i&&(e.set(c,t),t+=c.length),t},v.crc={table:function(){for(var e=new Uint32Array(256),t=0;256>t;t++){for(var n=t,r=0;8>r;r++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}(),update:function(e,t,n,r){for(var i=0;i<r;i++)e=v.crc.table[255&(e^t[n+i])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^v.crc.update(4294967295,e,t,n)}},v.adler=function(e,t,n){var r=1,i=0,o=t;for(t+=n;o<t;){for(n=Math.min(o+5552,t);o<n;)i+=r+=e[o++];r%=65521,i%=65521}return i<<16|r},v.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},readASCII:function(e,t,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},pad:function(e){return 2>e.length?"0"+e:e},readUTF8:function(e,t,n){for(var r,i="",o=0;o<n;o++)i+="%"+v.bin.pad(e[t+o].toString(16));try{r=decodeURIComponent(i)}catch(r){return v.bin.readASCII(e,t,n)}return r},writeUTF8:function(e,t,n){for(var r=n.length,i=0,o=0;o<r;o++){var s=n.charCodeAt(o);if(0==(4294967168&s))e[t+i]=s,i++;else if(0==(4294965248&s))e[t+i]=192|s>>6,e[t+i+1]=128|s>>0&63,i+=2;else if(0==(4294901760&s))e[t+i]=224|s>>12,e[t+i+1]=128|s>>6&63,e[t+i+2]=128|s>>0&63,i+=3;else{if(0!=(4292870144&s))throw"e";e[t+i]=240|s>>18,e[t+i+1]=128|s>>12&63,e[t+i+2]=128|s>>6&63,e[t+i+3]=128|s>>0&63,i+=4}}return i},sizeUTF8:function(e){for(var t=e.length,n=0,r=0;r<t;r++){var i=e.charCodeAt(r);if(0==(4294967168&i))n++;else if(0==(4294965248&i))n+=2;else if(0==(4294901760&i))n+=3;else{if(0!=(4292870144&i))throw"e";n+=4}}return n}},v.F={},v.F.deflateRaw=function(e,t,n,r){var i=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][r],o=v.F.U,s=v.F._goodIndex;v.F._hash;var a=v.F._putsE,c=0;n<<=3;var l=0,u=e.length;if(0==r){for(;c<u;){var d=Math.min(65535,u-c);a(t,n,c+d==u?1:0),n=v.F._copyExact(e,c,d,t,n+8),c+=d}return n>>>3}a=o.lits,r=o.strt;var h=o.prev,p=0,f=0,m=0,g=0,_=0;for(2<u&&(r[_=v.F._hash(e,0)]=0),c=0;c<u;c++){if(d=_,c+1<u-2){_=v.F._hash(e,c+1);var E=c+1&32767;h[E]=r[_],r[_]=E}if(l<=c){if((14e3<p||26697<f)&&100<u-c&&(l<c&&(a[p]=c-l,p+=2,l=c),n=v.F._writeBlock(c==u-1||l==u?1:0,a,p,g,e,m,c-m,t,n),p=f=g=0,m=c),E=0,c<u-2&&(E=v.F._bestMatch(e,c,h,d,Math.min(i[2],u-c),i[3])),0!=E){d=E>>>16,E&=65535;var y=s(d,o.of0);o.lhst[257+y]++;var b=s(E,o.df0);o.dhst[b]++,g+=o.exb[y]+o.dxb[b],a[p]=d<<23|c-l,a[p+1]=E<<16|y<<8|b,p+=2,l=c+d}else o.lhst[e[c]]++;f++}}for(m==c&&0!=e.length||(l<c&&(a[p]=c-l,p+=2),n=v.F._writeBlock(1,a,p,g,e,m,c-m,t,n));0!=(7&n);)n++;return n>>>3},v.F._bestMatch=function(e,t,n,r,i,o){var s=32767&t,a=n[s],c=s-a+32768&32767;if(a==s||r!=v.F._hash(e,t-c))return 0;for(var l=r=0,u=Math.min(32767,t);c<=u&&0!=--o&&a!=s;){if((0==r||e[t+r]==e[t+r-c])&&(s=v.F._howLong(e,t,c))>r){if(l=c,(r=s)>=i)break;c+2<s&&(s=c+2);for(var d=0,h=0;h<s-2;h++){var p=t-c+h+32768&32767,f=p-n[p]+32768&32767;f>d&&(d=f,a=p)}}c+=(s=a)-(a=n[s])+32768&32767}return r<<16|l},v.F._howLong=function(e,t,n){if(e[t]!=e[t-n]||e[t+1]!=e[t+1-n]||e[t+2]!=e[t+2-n])return 0;var r=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]==e[t-n];)t++;return t-r},v.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(e,t,n,r,i,o,s,a,c){var l=v.F.U,u=v.F._putsF,d=v.F._putsE;l.lhst[256]++;var h=v.F.getTrees(),p=h[0],f=h[1],m=h[2],g=h[3],_=h[4],E=h[5],y=h[6];h=h[7];var b=32+(0==(c+3&7)?0:8-(c+3&7))+(s<<3),S=r+v.F.contSize(l.fltree,l.lhst)+v.F.contSize(l.fdtree,l.dhst);r=r+v.F.contSize(l.ltree,l.lhst)+v.F.contSize(l.dtree,l.dhst),r+=14+3*E+v.F.contSize(l.itree,l.ihst)+(2*l.ihst[16]+3*l.ihst[17]+7*l.ihst[18]);for(var T=0;286>T;T++)l.lhst[T]=0;for(T=0;30>T;T++)l.dhst[T]=0;for(T=0;19>T;T++)l.ihst[T]=0;if(b=b<S&&b<r?0:S<r?1:2,u(a,c,e),u(a,c+1,b),c+=3,0==b){for(;0!=(7&c);)c++;c=v.F._copyExact(i,o,s,a,c)}else{if(1==b)var w=l.fltree,C=l.fdtree;if(2==b){for(v.F.makeCodes(l.ltree,p),v.F.revCodes(l.ltree,p),v.F.makeCodes(l.dtree,f),v.F.revCodes(l.dtree,f),v.F.makeCodes(l.itree,m),v.F.revCodes(l.itree,m),w=l.ltree,C=l.dtree,d(a,c,g-257),d(a,c+=5,_-1),d(a,c+=5,E-4),c+=4,e=0;e<E;e++)d(a,c+3*e,l.itree[1+(l.ordr[e]<<1)]);c=v.F._codeTiny(y,l.itree,a,c+3*E),c=v.F._codeTiny(h,l.itree,a,c)}for(E=0;E<n;E+=2){for(y=(e=t[E])>>>23,e=o+(8388607&e);o<e;)c=v.F._writeLit(i[o++],w,a,c);0!=y&&(e=(p=t[E+1])>>16,s=p>>8&255,p&=255,d(a,c=v.F._writeLit(257+s,w,a,c),y-l.of0[s]),c+=l.exb[s],u(a,c=v.F._writeLit(p,C,a,c),e-l.df0[p]),c+=l.dxb[p],o+=y)}c=v.F._writeLit(256,w,a,c)}return c},v.F._copyExact=function(e,t,n,r,i){var o=i>>>3;return r[o]=n,r[o+1]=n>>>8,r[o+2]=255-r[o],r[o+3]=255-r[o+1],o+=4,r.set(new Uint8Array(e.buffer,t,n),o),i+(n+4<<3)},v.F.getTrees=function(){for(var e=v.F.U,t=v.F._hufTree(e.lhst,e.ltree,15),n=v.F._hufTree(e.dhst,e.dtree,15),r=[],i=v.F._lenCodes(e.ltree,r),o=[],s=v.F._lenCodes(e.dtree,o),a=0;a<r.length;a+=2)e.ihst[r[a]]++;for(a=0;a<o.length;a+=2)e.ihst[o[a]]++;a=v.F._hufTree(e.ihst,e.itree,7);for(var c=19;4<c&&0==e.itree[1+(e.ordr[c-1]<<1)];)c--;return[t,n,a,i,s,c,r,o]},v.F.getSecond=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(e[n+1]);return t},v.F.nonZero=function(e){for(var t="",n=0;n<e.length;n+=2)0!=e[n+1]&&(t+=(n>>1)+",");return t},v.F.contSize=function(e,t){for(var n=0,r=0;r<t.length;r++)n+=t[r]*e[1+(r<<1)];return n},v.F._codeTiny=function(e,t,n,r){for(var i=0;i<e.length;i+=2){var o=e[i],s=e[i+1];r=v.F._writeLit(o,t,n,r);var a=16==o?2:17==o?3:7;15<o&&(v.F._putsE(n,r,s,a),r+=a)}return r},v.F._lenCodes=function(e,t){for(var n=e.length;2!=n&&0==e[n-1];)n-=2;for(var r=0;r<n;r+=2){var i=e[r+1],o=r+3<n?e[r+3]:-1,s=r+5<n?e[r+5]:-1,a=0==r?-1:e[r-1];if(0==i&&o==i&&s==i){for(o=r+5;o+2<n&&e[o+2]==i;)o+=2;11>(i=Math.min(o+1-r>>>1,138))?t.push(17,i-3):t.push(18,i-11),r+=2*i-2}else if(i==a&&o==i&&s==i){for(o=r+5;o+2<n&&e[o+2]==i;)o+=2;i=Math.min(o+1-r>>>1,6),t.push(16,i-3),r+=2*i-2}else t.push(i,0)}return n>>>1},v.F._hufTree=function(e,t,n){var r=[],i=e.length,o=t.length,s=0;for(s=0;s<o;s+=2)t[s]=0,t[s+1]=0;for(s=0;s<i;s++)0!=e[s]&&r.push({lit:s,f:e[s]});if(e=r.length,i=r.slice(0),0==e)return 0;if(1==e)return t[1+((n=r[0].lit)<<1)]=1,t[1+((0==n?1:0)<<1)]=1;r.sort((function(e,t){return e.f-t.f})),s=r[0],o=r[1];var a=0,c=1,l=2;for(r[0]={lit:-1,f:s.f+o.f,l:s,r:o,d:0};c!=e-1;)s=a!=c&&(l==e||r[a].f<r[l].f)?r[a++]:r[l++],o=a!=c&&(l==e||r[a].f<r[l].f)?r[a++]:r[l++],r[c++]={lit:-1,f:s.f+o.f,l:s,r:o};for((r=v.F.setDepth(r[c-1],0))>n&&(v.F.restrictDepth(i,n,r),r=n),s=0;s<e;s++)t[1+(i[s].lit<<1)]=i[s].d;return r},v.F.setDepth=function(e,t){return-1!=e.lit?e.d=t:Math.max(v.F.setDepth(e.l,t+1),v.F.setDepth(e.r,t+1))},v.F.restrictDepth=function(e,t,n){var r=0,i=1<<n-t,o=0;for(e.sort((function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d})),r=0;r<e.length&&e[r].d>t;r++){var s=e[r].d;e[r].d=t,o+=i-(1<<n-s)}for(o>>>=n-t;0<o;)(s=e[r].d)<t?(e[r].d++,o-=1<<t-s-1):r++;for(;0<=r;r--)e[r].d==t&&0>o&&(e[r].d--,o++);0!=o&&console.log("debt left")},v.F._goodIndex=function(e,t){var n=0;return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n},v.F._writeLit=function(e,t,n,r){return v.F._putsF(n,r,t[e<<1]),r+t[1+(e<<1)]},v.F.inflate=function(e,t){var n=Uint8Array;if(3==e[0]&&0==e[1])return t||new n(0);var r=v.F,i=r._bitsF,o=r._bitsE,s=r._decodeTiny,a=r.makeCodes,c=r.codes2map,l=r._get17,u=r.U,d=null==t;d&&(t=new n(e.length>>>2<<3));for(var h,p,f,m,g=0,_=0,E=p=0,y=0;0==g;)if(g=i(e,y,1),h=i(e,y+1,2),y+=3,0==h)0!=(7&y)&&(y+=8-(7&y)),h=e[(y=4+(y>>>3))-4]|e[y-3]<<8,d&&(t=v.F._check(t,E+h)),t.set(new n(e.buffer,e.byteOffset+y,h),E),y=y+h<<3,E+=h;else{if(d&&(t=v.F._check(t,E+131072)),1==h&&(f=u.flmap,m=u.fdmap,_=511,p=31),2==h){for(p=o(e,y,5)+257,h=o(e,y+5,5)+1,f=o(e,y+10,4)+4,y+=14,m=0;38>m;m+=2)u.itree[m]=0,u.itree[m+1]=0;for(_=1,m=0;m<f;m++){var b=o(e,y+3*m,3);u.itree[1+(u.ordr[m]<<1)]=b,b>_&&(_=b)}y+=3*f,a(u.itree,_),c(u.itree,_,u.imap),f=u.lmap,m=u.dmap,y=s(u.imap,(1<<_)-1,p+h,e,y,u.ttree),_=(1<<(b=r._copyOut(u.ttree,0,p,u.ltree)))-1,p=(1<<(h=r._copyOut(u.ttree,p,h,u.dtree)))-1,a(u.ltree,b),c(u.ltree,b,f),a(u.dtree,h),c(u.dtree,h,m)}for(;;)if(y+=15&(h=f[l(e,y)&_]),0==(b=h>>>4)>>>8)t[E++]=b;else{if(256==b)break;h=E+b-254,264<b&&(h=E+((b=u.ldef[b-257])>>>3)+o(e,y,7&b),y+=7&b),y+=15&(b=m[l(e,y)&p]);var S=((b=u.ddef[b>>>4])>>>4)+i(e,y,15&b);for(y+=15&b,d&&(t=v.F._check(t,E+131072));E<h;)t[E]=t[E++-S],t[E]=t[E++-S],t[E]=t[E++-S],t[E]=t[E++-S];E=h}}return t.length==E?t:t.slice(0,E)},v.F._check=function(e,t){var n=e.length;return t<=n?e:((t=new Uint8Array(Math.max(n<<1,t))).set(e,0),t)},v.F._decodeTiny=function(e,t,n,r,i,o){for(var s=v.F._bitsE,a=v.F._get17,c=0;c<n;){var l=e[a(r,i)&t];i+=15&l;var u=l>>>4;if(15>=u)o[c]=u,c++;else{var d=l=0;for(16==u?(d=3+s(r,i,2),i+=2,l=o[c-1]):17==u?(d=3+s(r,i,3),i+=3):18==u&&(d=11+s(r,i,7),i+=7),u=c+d;c<u;)o[c]=l,c++}}return i},v.F._copyOut=function(e,t,n,r){for(var i=0,o=0,s=r.length>>>1;o<n;){var a=e[o+t];r[o<<1]=0,r[1+(o<<1)]=a,a>i&&(i=a),o++}for(;o<s;)r[o<<1]=0,r[1+(o<<1)]=0,o++;return i},v.F.makeCodes=function(e,t){var n,r,i=v.F.U,o=e.length,s=i.bl_count;for(n=0;n<=t;n++)s[n]=0;for(n=1;n<o;n+=2)s[e[n]]++;for(i=i.next_code,n=0,s[0]=0,r=1;r<=t;r++)n=n+s[r-1]<<1,i[r]=n;for(t=0;t<o;t+=2)0!=(s=e[t+1])&&(e[t]=i[s],i[s]++)},v.F.codes2map=function(e,t,n){for(var r=e.length,i=v.F.U.rev15,o=0;o<r;o+=2)if(0!=e[o+1]){var s=e[o+1],a=o>>1<<4|s,c=t-s;for(c=(s=e[o]<<c)+(1<<c);s!=c;)n[i[s]>>>15-t]=a,s++}},v.F.revCodes=function(e,t){for(var n=v.F.U.rev15,r=15-t,i=0;i<e.length;i+=2)e[i]=n[e[i]<<t-e[i+1]]>>>r},v.F._putsE=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8},v.F._putsF=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8,e[t+2]|=n>>>16},v.F._bitsE=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},v.F._bitsF=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},v.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},v.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},v.F.U=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}(),function(){function e(e,t,n){for(;0!=t--;)e.push(0,n)}for(var t=v.F.U,n=0;32768>n;n++){var r=n;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,t.rev15[n]=(r>>>16|r<<16)>>>17}for(n=0;32>n;n++)t.ldef[n]=t.of0[n]<<3|t.exb[n],t.ddef[n]=t.df0[n]<<4|t.dxb[n];e(t.fltree,144,8),e(t.fltree,112,9),e(t.fltree,24,7),e(t.fltree,8,8),v.F.makeCodes(t.fltree,9),v.F.codes2map(t.fltree,9,t.flmap),v.F.revCodes(t.fltree,9),e(t.fdtree,32,5),v.F.makeCodes(t.fdtree,5),v.F.codes2map(t.fdtree,5,t.fdmap),v.F.revCodes(t.fdtree,5),e(t.itree,19,0),e(t.ltree,286,0),e(t.dtree,30,0),e(t.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(e){function t(e,i,o,s){W(this,t);var a=r.call(this,s,"Session");return m(n(a),"chatManager",void 0),m(n(a),"joinedChannels",new Set),m(n(a),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(a),"startTime",Date.now()),m(n(a),"seq",U.fromNumber(1,!0)),m(n(a),"userJoinOptions",new is(!1)),m(n(a),"seqSentStatuses",[!1,!1]),m(n(a),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(a),"loggedOut",!1),m(n(a),"messageSentTimes",[]),m(n(a),"curLoginSockets",[void 0,void 0]),m(n(a),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(a),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(a),"dialPendingMsgSubjectMap",new Map),m(n(a),"context",void 0),m(n(a),"connection",void 0),m(n(a),"instanceId",void 0),m(n(a),"registerSocketsFailureListener",(function(){a.connection.once("socketsFailure",(function(){a.log("socketsFailure, creating a new connection"),ad((function(){return a.connection.removeAllListeners(),a.connection=new Yr(a.context,a.logger,!0),a.loginHandler(15e3,!0)})).pipe(oe((function(e){return e.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))})),ob(a.connection.apClient.apFinish$)).subscribe((function(){a.log("new connection connected")}))})),0===a.connection.listenerCount("tokenExpired")&&a.connection.on("tokenExpired",(function(){a.emit("tokenExpired")}))})),a.context=e,a.connection=i,a.instanceId=o,a.chatManager=new hD(s),a.log("The instanceId is %s",a.instanceId.toString()),a}la(t,e);var r=ma(t);return Ha(t,[{key:"fetchFileUploadIndexGet",value:function(e){var n=e.hash,r=e.size;if(0===(e=this.getLoginSockets()).length)throw new K("Client is not logged in");var i=this.incGetSeq();return e.forEach((function(e){e.sendPacket("FileUploadIndexGet",{seq:i,hash:n,size:r})})),{ret:Ca.apply(void 0,G(e.map((function(e){return e.fromReceived("FileUploadIndexRet").pipe(aa((function(e){return i.eq(e.seq)})))})))),fin:Ca.apply(void 0,G(e.map((function(e){return e.fromReceived("FileUploadIndexFin").pipe(aa((function(e){return i.eq(e.seq)})))})))),err:Xb.apply(void 0,G(e.map((function(e){return e.fromReceived("FileUploadIndexErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The media message upload failure, code %d",e.code],lg)})))})))),timeout:t.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(e){var n=e.hash,r=e.unit,i=e.servers;if(0===(e=this.getLoginSockets()).length)throw new K("Client is not logged in");var o=this.incGetSeq();return e.forEach((function(e){e.sendPacket("FileUploadIndexSet",{seq:o,servers:i,hash:n,unit:r})})),Ca.apply(void 0,[t.genTimeoutError(Lh)].concat(G(e.map((function(e){return e.fromReceived("FileUploadIndexErr").pipe(aa((function(e){return o.eq(e.seq)})),ba((function(e){throw new da(["FileUploadIndexSet failure, code %d",e.code],lg)})))}))),G(e.map((function(e){return e.fromReceived("FileUploadIndexFin").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestFileDownloadIndexGet",value:function(e){var n=e.size,r=e.zone,i=e.unit,o=e.hash,s=this.getLoginSockets();if(0===s.length)throw new K("Client is not logged in");var a=this.incGetSeq();return s.forEach((function(e){e.sendPacket("FileDownloadIndexGet",{seq:a,size:n,zone:r,unit:i,hash:o})})),e=Ca.apply(void 0,G(s.map((function(e){return e.fromReceived("FileDownloadIndexRet").pipe(aa((function(e){return a.eq(e.seq)})))})))).pipe(ba((function(e){var t=e.backups,n=e.servers;return e=ff(e,iD),ua({backupList:t.map((function(e){return[e]})),serverList:n.map((function(e){return[e]}))},e)})),cd(500)),s=jm(s.map((function(e){return e.fromReceived("FileDownloadIndexRet").pipe(aa((function(e){return a.eq(e.seq)})))}))),Ca(e,s.pipe(ba((function(e){return e.reduce((function(e,t){var n=e.backupList,r=e.serverList;e=t.backups;var i=t.servers;return t=ff(t,jD),ua({backupList:e.map((function(e,t){return[e].concat(G(void 0!==n&&Array.isArray(n[t])?n[t]:[]))})),serverList:i.map((function(e,t){return[e].concat(G(void 0!==n&&Array.isArray(r[t])?r[t]:[]))}))},t)}),{})}))),t.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2e4,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this.loggedOut&&n)throw new K("Already logged out, request ignored");n&&this.registerSocketsFailureListener(),this.connection.initConnection();var r=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),i=Date.now();return r.forEach((function(t,r){var o=e.loginSocketSubs[r].login;void 0!==o&&o.unsubscribe(),e.loginSocketSubs[r].login=t.pipe(ca((function(t){var o;e.curLoginSockets[r]=t;var s=Date.now();eb("Link",{ackedServerIp:t.address,destServerIp:t.ip,ec:0,sc:0,elapse:fb(e.startTime),lts:U.fromNumber(s),responseTime:i-s,sid:Xa(e.instanceId),userId:e.context.uid},null!==(o=e.context.config.enableCloudProxy)&&void 0!==o&&o),e.emit("userJoined",t.env),n&&e.connection.apClient.apFinish$.next(void 0)}))).subscribe(e.lastLoginSockets[r])})),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(r).concat([gb(this.connection,"connectionInitFailure").pipe(ca((function(e){if(sa(e)||Sa(e))throw e;throw new da("Login failure",{code:Zq,originalError:e})})))])).pipe(Ka(1),hb(t),Ga((function(t){return t instanceof pb&&e.warn("Client login timeout"),t&&t.code===Kh&&(e.connection.emit("tokenExpired"),e.connection.apClient.apFinish$.next(void 0)),e.clearSockets(0,n),Z(t)})),ca((function(){n||e.registerSocketsFailureListener()})),wg((function(){n||e.connection.apClient.apFinish$.next(void 0)})))}},{key:"logoutHandler",value:function(){var e=J(w.mark((function e(){var t,n,r,i=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),t=this.getLoginSockets(),n=t.map((function(e){return e.sendPacket("UserQuit",{}),i.connection.waitClosing(e)})),this.clearSockets(5e3),r=t.map((function(e){return e.env})),[0,1].filter((function(e){return!r.includes(e)})).forEach((function(e){i.connection.closeSocket(e,0)})),e.abrupt("return",Xb.apply(void 0,G(n)).toPromise());case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.getLoginSockets().length){e.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return r=gb(this,"channelLeft").pipe(wb((function(e){return e===t})),Ka(1)),i=this.incGetSeq(),(o=this.lastLoginSockets.map((function(e){return e.pipe(Cc((function(e,t){0!==t&&s.incSeqIfNeeded(e.env);var r=0===t?i:s.seq;return e.sendPacket("GroupEnter",{account:n,seq:r}),e.fromReceived("GroupReply").pipe(aa((function(e){return r.eq(e.seq)})),ca((function(e){if(0!==(e=e.code))throw new da(["Channel join failure. The response code is %d",e],Rq)})))})),ob(r),pe())}))).forEach((function(e,n){var r=function(){return s.loginSocketSubs[n].channels.delete(t.channelId)};s.loginSocketSubs[n].channels.set(t.channelId,e.subscribe({error:r,complete:r}))})),e.next=8,Xb.apply(void 0,G(o)).pipe(Ka(1),hb(1e4),Ga((function(e){return e instanceof pb&&s.warn("Channel join timeout"),Z(e)}))).toPromise();case 8:this.joinedChannels.add(t);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(e,t){this.emit("channelLeft",e),this.joinedChannels.delete(e),this.getLoginSockets().forEach((function(e){e.sendPacket("GroupLeave",{account:t})}))}},{key:"requestChannelMemberList",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in. Cannot get the channel members",cA);var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupAllUsersList",{group:e,pageNumber:0,pageSize:200,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(Pq)].concat(G(n.map((function(t){return t.fromReceived("GroupAllUsersResult").pipe(aa((function(t){var n=t.seq;return t.group===e&&r.eq(n)})))})))))}},{key:"requestPeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserStatusList",{users:e,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(oA)].concat(G(n.map((function(e){return e.fromReceived("UserStatusResult").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestSetLocalUserAttributes",value:function(e,n){var r=this,i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t,i){void 0!==n&&i!==n||t.sendPacket("UserAttributeSet",{account:r.context.uid,attributeInfos:Object.entries(e).map((function(e){return{key:(e=ra(e,2))[0],value:e[1]}})),seq:o})})),Ca.apply(void 0,G(i.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return o.eq(e.seq)})),ba((function(e){throw new da(["The user attributes set failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(i.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestSetChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeSet",{broadcast:r,group:e,attributeInfos:Object.entries(n).map((function(e){return{key:(e=ra(e,2))[0],value:e[1]}})),seq:o})})),Ca.apply(void 0,G(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return o.eq(e.seq)})),ba((function(e){throw new da(["The group attributes set failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeMod",{account:n.context.uid,attributeInfos:Object.entries(e).map((function(e){return{key:(e=ra(e,2))[0],value:e[1]}})),seq:i})})),Ca.apply(void 0,G(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The user attributes add or update failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(r.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeMod",{broadcast:r,group:e,attributeInfos:Object.entries(n).map((function(e){return{key:(e=ra(e,2))[0],value:e[1]}})),seq:o})})),Ca.apply(void 0,G(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return o.eq(e.seq)})),ba((function(e){throw new da(["The group attributes add or update failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeDel",{account:n.context.uid,attributes:e,seq:i})})),Ca.apply(void 0,G(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The user attributes delete failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(r.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeDel",{group:e,broadcast:r,attributes:n,seq:o})})),Ca.apply(void 0,G(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return o.eq(e.seq)})),ba((function(e){throw new da(["The channel attributes delete failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestClearLocalUserAttributes",value:function(){var e=this,n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserAttributeSet",{account:e.context.uid,seq:r,attributeInfos:[]})})),Ca.apply(void 0,G(n.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return r.eq(e.seq)})),ba((function(e){throw new da(["The user attributes clear failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(n.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestClearChannelAttributes",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("GroupAttributeSet",{group:e,seq:i,attributeInfos:[],broadcast:n})})),Ca.apply(void 0,G(r.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The channel attributes clear failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(r.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetUserAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeGet",{account:e,seq:i,attributes:n})})),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){if(10008===(e=e.code))throw new da("The user requested is not online",Lq);throw new Wc(["User attribute operation unknown error code: %d",e],Sb)})))}))),G(r.map((function(e){return e.fromReceived("UserAttributeRet").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetChannelAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("GroupAttributeGet",{group:e,seq:i,attributes:n})})),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(r.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The channel attributes get failure, code %d",e.code],Sb)})))}))),G(r.map((function(e){return e.fromReceived("GroupAttributeRet").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetUserAttributeKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserAttributeKeysGet",{account:e,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(n.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return r.eq(e.seq)})),ba((function(e){if(10008===(e=e.code))throw new da("The user requested is not online",Lq);throw new Wc(["User attribute operation unknown error code: %d",e],Sb)})))}))),G(n.map((function(e){return e.fromReceived("UserAttributeKeysRet").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestGetChannelAttributesKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupAttributeKeysGet",{group:e,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(n.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return r.eq(e.seq)})),ba((function(e){throw new Wc(["Channel attribute operation unknown error code: %d",e.code],Sb)})))}))),G(n.map((function(e){return e.fromReceived("GroupAttributeKeysRet").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestGetChannelMemberCount",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupStatusList",{groups:e,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(Pq)].concat(G(n.map((function(e){return e.fromReceived("GroupStatusResult").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestSubscribePeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("SubscribeUserStatus",{seq:r,users:e})})),Ca.apply(void 0,[t.genTimeoutError(vA)].concat(G(n.map((function(e){return e.fromReceived("SubscribeResponse").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(e){var t=this.getLoginSockets();if(0===t.length)throw new K("Client is not logged in");var n=this.incGetSeq();t.forEach((function(t){t.sendPacket("UnsubscribeUserStatus",{seq:n,users:e})}))}},{key:"sendInvitationMessage",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a,c,l,u,d,h,p,f=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.peerId,r=t.callId,i=t.extra,o=t.isAcceptAck,s=t.channelId,a=t.type,c={callId:r},void 0===o){e.next=6;break}if("CallAccept"===a){e.next=5;break}throw Error("invalid invitation type");case 5:c.type=o?"ack":"request";case 6:return c.channel=s,("CallInvite"===a||"CallCancel"===a||"CallReject"===a||"CallAccept"===a&&!1===o)&&void 0!==i&&(c.extra=i),l=Bg(),this.log("The sent invitation body is %o",c),u=function(e){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:l,instance:f.instanceId,dst:n,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,MessageType:a}).toLong(),payload:(new TextEncoder).encode(JSON.stringify(c)),src:f.context.uid}},e.next=14,Kb(this.sendMessageToRetry(u,!0)).pipe(hb(1e4),Ga((function(e){return e instanceof pb&&f.warn("Send invitation timeout"),Z(e)}))).toPromise();case 14:return d=e.sent,h=d.code,p=d.retryTimes,e.abrupt("return",{hasPeerReceived:0===h,hasReSent:0!==p});case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var e=J(w.mark((function e(t,n,r,i,o,s){var a,c,l,u,d,h,p,f,g,_,E,v,y,b,S,T,C,R,O,A,N,k,P,D,L,x,M,F,j,V=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n.width,l=void 0===c?0:c,u=n.height,d=void 0===u?0:u,h=n.fileName,p=void 0===h?"":h,f=n.description,g=void 0===f?"":f,_=n.thumbnail,E=void 0===_?new Blob:_,v=n.thumbnailHeight,y=void 0===v?0:v,b=n.thumbnailWidth,S=void 0===b?0:b,T=n.size,C=void 0===T?0:T,R=n.mediaId,O=o.enableOfflineMessaging,A=o.enableHistoricalMessaging,za(r)){e.next=4;break}throw new I("The send message arguments are not valid",i?$k:hg);case 4:if(!(32768<new Blob([p,E,g]).size)){e.next=6;break}throw new I("The size of message overflowed ",i?ve:Hh);case 6:return N=this.chatManager.getChatInfo(r),k=N.dialogue,P=N.sequence,D=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(D,"-").concat(k,"#").concat(P,'"'),i?" peer":" channel",oa(r)),m(a={},"media_description",g),m(a,"media_width",l),m(a,"media_height",d),m(a,"media_thumbnailwidth",S),m(a,"media_thumbnailheight",y),m(a,"media_size",C),m(a,"media_id",R),m(a,"media_filename",p),L=uc(a,(function(e){return(new TextEncoder).encode(e.toString())})),e.t0=Uint8Array,e.next=14,Ji(E);case 14:return e.t1=e.sent,L.media_thumbnail=new e.t0(e.t1),x=i&&"IMAGE"===t?"PeerImageMessage":i&&"FILE"===t?"PeerFileMessage":i||"IMAGE"!==t?"ChannelFileMessage":"ChannelImageMessage",M=function(e){return{MiscMap:L,sequence:P,dialogue:k,instance:D,dst:r,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,CompressionMethod:"Uncompressed",MessageType:x,ToCache:O,ToArchive:A}).toLong(),payload:new Uint8Array,src:V.context.uid}},e.next=20,Kb(this.sendMessageToRetry(M,!0)).pipe(hb(void 0===s?1e4:s),Ga((function(e){return e instanceof pb&&V.warn("Send message timeout"),Z(e)}))).toPromise();case 20:if(F=e.sent,2!==(j=F.code)){e.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return e.abrupt("return",{hasPeerReceived:0===j});case 25:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,s){return e.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var e=J(w.mark((function e(t,n,r,i,o,s){var a,c,l,u,d,h,p,f,m,g,_=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=o.enableOfflineMessaging,c=o.enableHistoricalMessaging,za(r)&&t instanceof Uint8Array&&"string"==typeof n){e.next=3;break}throw new I("The send message arguments are not valid",i?$k:hg);case 3:if(!(32768<t.byteLength+new Blob([n]).size)){e.next=5;break}throw new ib("The message size is over the 32KB limit",i?ve:Hh);case 5:return l=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=t.byteLength,u=this.chatManager.getChatInfo(r),d=u.dialogue,h=u.sequence,p=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(p,"-").concat(d,"#").concat(h,'"'),l?" compressed":"",i?"peer":"channel",oa(r)),f=function(e){return{MiscMap:{description:(new TextEncoder).encode(n)},sequence:h,dialogue:d,instance:p,dst:r,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,CompressionMethod:l?"Zlib":"Uncompressed",MessageType:i?"PeerRawMessage":"ChannelRawMessage",ToCache:a,ToArchive:c}).toLong(),payload:l?ks(t):t,src:_.context.uid}},e.next=12,Kb(this.sendMessageToRetry(f,!0)).pipe(hb(void 0===s?1e4:s),Ga((function(e){return e instanceof pb&&_.warn("Send message timeout"),Z(e)}))).toPromise();case 12:return m=e.sent,g=m.code,e.abrupt("return",{hasPeerReceived:0===g});case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,s){return e.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var e=J(w.mark((function e(t,n,r,i,o){var s,a,c,l,u,d,h,p,f,m,g,_=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=i.enableOfflineMessaging,a=i.enableHistoricalMessaging,za(n)){e.next=3;break}throw new I("The send message arguments are not valid",r?$k:hg);case 3:if(!(32768<new Blob([t]).size)){e.next=5;break}throw new ib("The message size is over the 32KB limit",r?ve:Hh);case 5:return c=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([t]).size,l=this.chatManager.getChatInfo(n),u=l.dialogue,d=l.sequence,h=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(h,"-").concat(u,"#").concat(d,'"'),c?" compressed":"",r?"peer":"channel",oa(n)),p=(new TextEncoder).encode(t),f=function(e){return{MiscMap:{},sequence:d,dialogue:u,instance:h,dst:n,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,CompressionMethod:c?"Zlib":"Uncompressed",MessageType:r?"PeerTextMessage":"ChannelTextMessage",ToCache:s,ToArchive:a}).toLong(),payload:c?ks(p):p,src:_.context.uid}},e.next=13,Kb(this.sendMessageToRetry(f,!0)).pipe(hb(void 0===o?1e4:o),Ga((function(e){return e instanceof pb&&_.warn("Send message timeout"),Z(e)}))).toPromise();case 13:return m=e.sent,g=m.code,e.abrupt("return",{hasPeerReceived:0===g});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(e,t){Object.entries(this.loginSocketSubs[e]).forEach((function(e){var n=(e=ra(e,2))[1];"channels"===e[0]&&t||(Array.isArray(n)||n instanceof Map?n.forEach((function(e){return e.unsubscribe()})):n&&n.unsubscribe())})),this.loginSocketSubs[e]={channels:t?this.loginSocketSubs[e].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,l,u,d,h=this,p=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<p.length&&void 0!==p[2]?p[2]:0,this.log("Attempt to send the message ".concat(n?" with retrying, %o":"without retrying"),{retryTimes:r}),0!==(i=this.getLoginSockets()).length){e.next=5;break}throw Error("no logged-in sockets");case 5:return o=t(r),i.forEach((function(e){e.sendPacket("Message",o)})),s=o.dialogue,a=o.sequence,c=o.instance,l=i.map((function(e){return e.fromReceived("Ack").pipe(wb((function(e){return s.eq(e.dialogue)&&a.eq(e.sequence)&&c.eq(e.instance)})))})),e.prev=9,e.next=12,Xb.apply(void 0,G(l)).pipe(hb(6e3),Ga((function(e){return Sa(e)&&h.warn("Message send timeout, retry times %d",r),Z(e)})),Ka(1)).toPromise();case 12:return u=e.sent,d=u.code,this.log("The message has been acked, %o",{code:d}),e.abrupt("return",{code:d,retryTimes:r});case 18:if(e.prev=18,e.t0=e.catch(9),!(e.t0 instanceof pb&&n)){e.next=22;break}return e.abrupt("return",this.sendMessageToRetry(t,!1,r+1));case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[9,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var e=this;this.lastLoginSockets.map((function(t){return t.pipe(Cc((function(t){return Bc(0,2750).pipe(ca((function(){e.incSeqIfNeeded(t.env),t.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:e.seq})})))})))})).forEach((function(t,n){var r=e.loginSocketSubs[n].keepAlive;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAlive=t.subscribe({error:function(){}})}))}},{key:"initKeepAliveReconnector",value:function(){var e=this;this.lastLoginSockets.map((function(e){return e.pipe(Cc((function(e){var t,n=!1,r=e.userJoin$.pipe(ca((function(){n=!0}))),i=e.input$.pipe(ca((function(e){"Ping"!==Li[e.uri].slice(0,-3)&&(n=!1)})));return Xb(Bc(15e3,1e4).pipe(Pt(e.receivedPacket),ca((function(r){r=ra(r,2),r=ra(r[1],2)[1],t!==r||n||e.forceReconnect(),t=r}))),r,i)})))})).forEach((function(t,n){var r=e.loginSocketSubs[n].keepAliveReconnector;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAliveReconnector=t.subscribe({error:function(){}})}))}},{key:"initLoginReceiver",value:function(){var e=this;this.lastLoginSockets.map((function(t){return t.pipe(Cc((function(t){return Xb(gb(t,"reconnect").pipe(ca(e.onSocketReconnect(t))),t.fromReceived("Message").pipe(ca(e.onMessage(t))),t.fromReceived("GroupEnterNotice").pipe(ca(e.onGroupEnterNotice())),t.fromReceived("GroupLeaveNotice").pipe(ca(e.onGroupLeaveNotice())),t.fromReceived("GroupCountNotice").pipe(ca(e.onGroupCountNotice())),t.fromReceived("GroupAttributeAlt").pipe(ca(e.onGroupAttributeAlt())),t.fromReceived("UserJoinNotice").pipe(ca(e.onUserNotice(S.PeerOnlineState.ONLINE))),t.fromReceived("UserQuitNotice").pipe(ca(e.onUserNotice(S.PeerOnlineState.OFFLINE))),t.fromReceived("UserWaitNotice").pipe(ca(e.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))})))})).forEach((function(t,n){e.loginSocketSubs[n].receivers.push(t.subscribe({error:function(){}}))}))}},{key:"requestSocketLogin",value:function(e,t,n){var r=this;return im(ad((function(){r.userJoinOptions=new is(t),e.sendPacket("UserJoin",{account:r.context.uid,instance:r.instanceId,opt:r.userJoinOptions.toLong(),seq:n,ticket:e.ticket})})),e.fromReceived("UserResp").pipe(aa((function(e){return n.eq(e.seq)})),ca((function(t){if(0!==(t=t.code))throw r.clearSockets(),r.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",t],jg);r.log("ENV_%d logged in",e.env)})),qf(e),hb(15e3))).pipe(wb((function(e){return void 0!==e})),Ga((function(e){return e instanceof pb&&r.warn("Login response timeout, rejoin: %s",t),Z(e)})))}},{key:"getSocketLoginObservables",value:function(e,t){var n=this;return e.map((function(e){return e.pipe(ca((function(e){0===e.listenerCount("socketUserDrop")&&e.on("socketUserDrop",(function(t){return n.onUserDrop(t,e)}))})),Cc((function(e,r){return n.incSeqIfNeeded(e.env),n.requestSocketLogin(e,0!==r,0===r?t:n.seq)})),pe())}))}},{key:"incSeqIfNeeded",value:function(e){if(![0,1].includes(e))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[e]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[e]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var e=this.curLoginSockets,t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i}},{key:"emitMessage",value:function(e,n){var r=e.options,i=e.payload,o=e.src,s=e.dst,a=e.instance,c=e.dialogue,l=e.sequence,u=e.ms,d=e.MiscMap;this.dialogueSequenceLru.set(c.toString(),l),a="".concat(a,"-").concat(c,"#").concat(l),this.msgDedupLru.has(a)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",n,a):(this.msgDedupLru.set(a,void 0),n=new ae(r),this.lastLoginSockets.forEach(function(){var n=J(w.mark((function n(r){var i;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.pipe(Ka(1)).toPromise();case 2:i=n.sent,t.sendMessageAck(e,i);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),r=n.isZlibCompressed(),n.isInvitation()?(s=pa(r?nl(Xm(i,Uint8Array.of(0,0,0,0))):i),s=JSON.parse(s),this.log("The received invitation body is %o",s),this.emit("invitationMessage",{body:s,type:n.getInvitationType(),peerId:o,serverReceivedTs:u.toNumber()})):n.isTextMessage()?(d=n.isPeerTextMessage(),i=pa(r?nl(Xm(i,Uint8Array.of(0,0,0,0))):i),this.info("Received a %s %s text message from %s to %s, %s",r?" compressed":"",d?"peer":"channel",oa(o),oa(s),a),d?(o={text:i,peerId:o,properties:{serverReceivedTs:u.toNumber(),isOfflineMessage:n.isFromCache()}},this.emit("peerTextMessage",o)):this.emit("channelTextMessage",{channelId:s,memberId:o,text:i,properties:{serverReceivedTs:u.toNumber(),isOfflineMessage:!1}})):n.isRawMessage()?(c=n.isRawPeerMessage(),d=void 0===(d=d.description)?"":pa(d),i=r?nl(i):i,this.info("Received a %s %s raw message from %s to %s, %s",r?" compressed":"",c?"peer":"channel",oa(o),oa(s),a),c?(o={desc:d,raw:i,peerId:o,properties:{serverReceivedTs:u.toNumber(),isOfflineMessage:n.isFromCache()}},this.emit("peerRawMessage",o)):this.emit("channelRawMessage",{desc:d,raw:i,channelId:s,memberId:o,properties:{serverReceivedTs:u.toNumber(),isOfflineMessage:!1}})):(n.isImageMessage()||n.isFileMessage())&&(i=n.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",i?"peer":"channel",oa(o),oa(s),a),i?this.emit("peerMediaMessage",{messageType:n.isImageMessage()?"IMAGE":"FILE",details:d,peerId:o,properties:{serverReceivedTs:u.toNumber(),isOfflineMessage:n.isFromCache()}}):this.emit("channelMediaMessage",{messageType:n.isImageMessage()?"IMAGE":"FILE",details:d,memberId:o,channelId:s,properties:{serverReceivedTs:u.toNumber(),isOfflineMessage:n.isFromCache()}})))}},{key:"onSocketReconnect",value:function(e){var t=this;return function(){var n=[0,1].filter((function(t){return t!==e.env}))[0];(n=t.connection.curOpenSockets[n])&&!n.loggedIn&&t.emit("connectionLost")}}},{key:"onUserDrop",value:function(e,t){var n;e=e.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(t.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:t.address,serverCode:e,sid:Xa(this.instanceId),userId:this.context.uid},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n),10006===e||10001===e?this.warn("Login too often and kicked off, reconnect and login"):10009===e?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(e)&&(this.emit("userDrop",e),this.clearSockets())}},{key:"clearSockets",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];[0,1].forEach((function(r){e.cleanLoginSubs(r,n),e.connection.closeSocket(r,t)}))}},{key:"onMessage",value:function(e){var t=this;return function(n){var r=n.dialogue,i=n.instance,o=n.sequence,s=n.options;if(n.src===t.context.uid)t.log("The message is from the local account, ignored");else{var a=r.toString(),c=t.dialPendingMsgSubjectMap.get(a);if(r="".concat(i,"-").concat(r,"#").concat(o),c)c.next(n),t.log("Env_%d: The dialogue has pending messages, next: %s",e.env,r);else{var l=t.dialogueSequenceLru.get(a);if(c=!l&&o.eq(1),i=void 0!==l&&o.sub(l).eq(1),c||i)t.emitMessage(n,e.env);else{if(l){if(o.lte(l))return;t.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",e.env,r)}else t.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",e.env,r);o=new Pa,t.dialPendingMsgSubjectMap.set(a,o);var u=o.pipe(Qs(Pk),xg((function(e,t){return[].concat(G(e),[t])}),[]),ba((function(e){return G(e).sort((function(e,t){return e=e.sequence,t=t.sequence,e.eq(t)?0:e.gt(t)?1:-1}))})),sm(1));s=!(s=new ae(s)).isFromCache()&&!s.isBufferedMessage(),u.pipe(ob(Bc(s?750:1500)),aa((function(e){if(2>e.length)return!1;for(var t=void 0===l?U.fromNumber(1,!0):l.add(1),n=0;n<e.length;t=t.add(1),n++)if(!e[n].sequence.eq(t))return!1;return!0})),wg((function(){t.dialPendingMsgSubjectMap.delete(a)}))).subscribe((function(n){n.forEach((function(n){t.emitMessage(n,e.env),t.log("Env_%d: The message queue has fully ordered, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence))}))}),(function(n){n instanceof vg&&u.pipe(Ka(1)).subscribe((function(n){return n.forEach((function(n){t.log("Env_%d: The message pending queue expired, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence)),t.emitMessage(n,e.env)}))}))})),o.next(n)}}}}}},{key:"onGroupEnterNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberJoined",size:t.size})}}},{key:"onGroupLeaveNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberLeft",size:t.size})}}},{key:"onGroupCountNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,type:"MemberCountUpdated",size:t.size})}}},{key:"onGroupAttributeAlt",value:function(){var e=this;return function(t){var n=t.group;t=ff(t,kD),e.emit("channelAttributesUpdated",ua({channelId:n},t))}}},{key:"onUserNotice",value:function(e){var t=this;return function(n){t.emit("peerOnlineStatusChanged",{peerId:n.user,instance:n.instance,seq:n.seq,state:e})}}}],[{key:"sendMessageAck",value:function(e,t){var n=new ae(e.options);(n.isInvitation()||n.isPeerMessage())&&t.sendPacket("Ack",{code:0,dialogue:e.dialogue,instance:e.instance,sequence:e.sequence})}}]),t}(tb());m(ls,"genTimeoutError",(function(e,t){return bb(void 0).pipe(cd(void 0===t?1e4:t),ba((function(){throw new db(["Request timed out after %ds",void 0===t?1e4:t],e)})))}));var ms,ol,pl=0,ql=0;Ud.v1=function(e,t,n){n=t&&n||0;var r=t||[],i=(e=e||{}).node||ms,o=void 0!==e.clockseq?e.clockseq:ol;if(null==i||null==o){var s=Jq();null==i&&(i=ms=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==o&&(o=ol=16383&(s[6]<<8|s[7]))}s=void 0!==e.msecs?e.msecs:(new Date).getTime();var a=void 0!==e.nsecs?e.nsecs:ql+1,c=s-pl+(a-ql)/1e4;if(0>c&&void 0===e.clockseq&&(o=o+1&16383),(0>c||s>pl)&&void 0===e.nsecs&&(a=0),1e4<=a)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=s,ql=a,ol=o,e=(1e4*(268435455&(s+=122192928e5))+a)%4294967296,r[n++]=e>>>24&255,r[n++]=e>>>16&255,r[n++]=e>>>8&255,r[n++]=255&e,e=s/4294967296*1e4&268435455,r[n++]=e>>>8&255,r[n++]=255&e,r[n++]=e>>>24&15|16,r[n++]=e>>>16&255,r[n++]=o>>>8|128,r[n++]=255&o,o=0;6>o;++o)r[n+o]=i[o];return t||Kq(r)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(e){function t(e,i,o){W(this,t);var s=r.call(this,o,"RtmLocalInvitation",!0);return m(n(s),"state",Ba.IDLE),m(n(s),"localInvitationEnd$",Ca(gb(n(s),"LocalInvitationAccepted"),gb(n(s),"LocalInvitationRefused"),gb(n(s),"LocalInvitationFailure"),gb(n(s),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(s),"callId",Ud.v4()),m(n(s),"_content",""),m(n(s),"_channelId",""),m(n(s),"_response",""),m(n(s),"calleeId",void 0),m(n(s),"logger",void 0),m(n(s),"getSession",void 0),s.calleeId=e,s.getSession=i,s.logger=o,s}la(t,e);var r=ma(t);return Ha(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=e)}},{key:"content",get:function(){return this._content},set:function(e){this.log("set content for %s",this.callId),this._content=e}},{key:"response",get:function(){return this._response},set:function(e){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var e,t=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark((function n(){var r,i,o;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getSession().sendInvitationMessage({peerId:t.calleeId,callId:t.callId,extra:t._content,type:"CallInvite",channelId:t._channelId});case 2:if(r=n.sent,i=r.hasPeerReceived,o=r.hasReSent,!t.isLocalInvitationEnd()){n.next=7;break}throw new db("send invitation timeout");case 7:if(t.log("The local invitation has sent to the callee"),i||o){n.next=11;break}throw e=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(i){n.next=14;break}throw e=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return n.stop()}}),n)})))).pipe(oe((function(e){return e.pipe(ca((function(e){if(!(e instanceof rl))throw e})),cd(2e3))})),hb(3e4),Ga((function(e){return Sa(e)&&t.warn("local invitation ack timed out"),Z(e)})),ob(this.localInvitationEnd$)).subscribe({next:function(){t.state===Ba.RECEIVED_BY_REMOTE?t.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):t.state!==Ba.SENT_TO_REMOTE?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(t.info("The peer received the local invitation %s.",t.callId),t.state=Ba.RECEIVED_BY_REMOTE,t.emit("LocalInvitationReceivedByPeer"),t.localInvitationEnd$.pipe(hb(6e4),Ga((function(e){return Sa(e)&&t.warn("local invitation expired"),Z(e)}))).subscribe({error:function(){t.state=Ba.FAILURE,t.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(n){t.isLocalInvitationEnd()?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(t.state=Ba.FAILURE,Sa(n)&&e?"PEER_NOT_ONLINE"===e.code?t.emit("LocalInvitationFailure",bf.PEER_OFFLINE):"RESENT_AND_OFFLINE"===e.code&&t.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(n)?t.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):"RtmInvalidStatusError"===n.name?t.emit("LocalInvitationFailure",bf.NOT_LOGGEDIN):t.emit("LocalInvitationFailure",bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(e){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=e,this.emit("LocalInvitationAccepted",e))}}},{key:"onRefuseReceived",value:function(e){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=e,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",e)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),t}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(e){function t(e){var i=e.invitationChannel,o=e.extraContent,s=e.callId,a=e.callerId,c=e.logger;e=e.getSession,W(this,t);var l=r.call(this,c,"RtmRemoteInvitation",!0);return m(n(l),"state",kb.INVITATION_RECEIVED),m(n(l),"remoteInvitationEnd$",Ca(gb(n(l),"RemoteInvitationCanceled"),gb(n(l),"RemoteInvitationRefused"),gb(n(l),"RemoteInvitationAccepted"),gb(n(l),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(l),"callerId",void 0),m(n(l),"callId",void 0),m(n(l),"_getSession",void 0),m(n(l),"logger",void 0),m(n(l),"_content",void 0),m(n(l),"_channelId",void 0),m(n(l),"_response",""),l._channelId=i,l._content=o,l.callId=s,l.callerId=a,l._getSession=e,l.logger=c,l.remoteInvitationEnd$.pipe(hb(6e4),Ga((function(e){return Sa(e)&&l.warn("Remote invitation expired"),Z(e)}))).subscribe({error:function(){l.state=kb.FAILURE,l.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),l}la(t,e);var r=ma(t);return Ha(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(e){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(e){this._response=e}},{key:"accept",value:function(){var e,t=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb((function(){return ad(J(w.mark((function e(){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._getSession().sendInvitationMessage({peerId:t.callerId,callId:t.callId,extra:t.response,type:"CallAccept",isAcceptAck:!1,channelId:t.channelId}));case 1:case"end":return e.stop()}}),e)}))))})),wb((function(t){return e=t.hasPeerReceived})),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(n){if(t.logError(n),t.state=kb.FAILURE,Sa(n))switch(e){case void 0:case!0:return void t.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void t.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}t.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(e){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=e,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",e))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),t}(tb()),nD=function(e){function t(e,i){W(this,t);var o=r.call(this,i,"InvitationManager");return m(n(o),"getSession",void 0),m(n(o),"invitationDispatcher",new ea.EventEmitter),m(n(o),"outgoingLocalInvitations",new Map),m(n(o),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(o),"logger",void 0),o.getSession=cn(e),o.logger=i,o.invitationDispatcher.on("remoteInvitationToManager",(function(e){var t=e.callId,n=e.extra,r=e.callerId;e=e.channelId,o.receivedRemoteInvitations.has(t)||((n=new mD({callerId:r,callId:t,getSession:o.getSession,logger:i,extraContent:n,invitationChannel:e})).remoteInvitationEnd$.subscribe((function(){o.receivedRemoteInvitations.delete(t)})),o.receivedRemoteInvitations.set(t,n),o.emit("remoteInvitationInstance",n))})),o.invitationDispatcher.on("acceptAckToRemoteInvitation",(function(e){(e=o.receivedRemoteInvitations.get(e.callId))&&e.onAcceptAckReceived()})),o.invitationDispatcher.on("cancelToRemoteInvitation",(function(e){var t=e.extra;(e=o.receivedRemoteInvitations.get(e.callId))&&e.onCancelReceived(t)})),o.invitationDispatcher.on("acceptToLocalInvitation",(function(e){var t=e.extra;(e=o.outgoingLocalInvitations.get(e.callId))&&e.onAcceptReceived(t)})),o.invitationDispatcher.on("refuseToLocalInvitation",(function(e){var t=e.extra;(e=o.outgoingLocalInvitations.get(e.callId))&&e.onRefuseReceived(t)})),o}la(t,e);var r=ma(t);return Ha(t,[{key:"invitationMessageHandler",value:function(e){var t=e.body,n=t.callId,r=t.extra;r=void 0===r?"":r;var i=t.type,o=void 0===(t=t.channel)?"":t,s=e.type;switch(t=e.peerId,e=e.serverReceivedTs,s){case"CallAccept":"ack"===i?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:n}):"request"===i&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:n,extra:r});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:n,callerId:t,extra:r,channelId:o});break;case"CallCancel":if("0"===n){n="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(o,"_").concat(r),this.getSession().emit("peerTextMessage",{peerId:t,properties:{serverReceivedTs:e,isOfflineMessage:!1},text:n});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:n,extra:r});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:n,extra:r});break;default:throw Im("invitationType",s)}}},{key:"genLocalInvitation",value:function(e){var t=this,n=new lD(e,this.getSession,this.logger);return n.localInvitationEnd$.subscribe((function(){t.outgoingLocalInvitations.delete(n.callId)})),this.outgoingLocalInvitations.set(n.callId,n),n}}]),t}(tb()),oD=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return lb(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),qC(e,t,{leading:r,maxWait:t,trailing:i})},ub,cf;!function(e){e[e.JOINED=0]="JOINED",e[e.LEFT=1]="LEFT"}(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(e){function t(e,i,o,s){W(this,t);var a=r.call(this,s,"RtmChannel",!0);return m(n(a),"onMemberCountUpdated",oD((function(e){e!==a.memberCount&&(a.memberCount=e,a.emit("MemberCountUpdated",e))}),1e3)),m(n(a),"getSession",void 0),m(n(a),"memberCount",0),m(n(a),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(a),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(a),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(a),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(a),"channelId",void 0),m(n(a),"client",void 0),m(n(a),"onAttributesUpdated",(function(e){var t=e.channelId,n=e.attributeMaps,r=e.seq;e=e.instance.toString();var i=a.attributesSeqLru.get(e);if((!i||r.greaterThan(i))&&(a.attributesSeqLru.set(e,r),t===a.channelId)){for(t={},r=0;r<n.length;r++){var o=n[r];e=o.key,i=o.ms;var s=o.value;if(o=o.origin,"string"!=typeof e||!U.isLong(i)||"string"!=typeof s||!za(o))break;t[e]={value:s,lastUpdateUserId:o,lastUpdateTs:i.toNumber()}}a.emit("AttributesUpdated",t)}})),m(n(a),"onChannelTextMessage",(function(e){var t=e.memberId,n=e.text,r=e.properties;e.channelId===a.channelId&&a.emit("ChannelMessage",{text:n,messageType:S.MessageType.TEXT},t,r)})),m(n(a),"onChannelMediaMessage",(function(e){var t=e.memberId,n=e.properties,r=e.details,i=e.messageType;e.channelId===a.channelId&&("FILE"===i?a.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(r.media_size),10),description:pa(r.media_description),fileName:pa(r.media_filename),mediaId:pa(r.media_id),thumbnail:new Blob([r.media_thumbnail])},t,n):"IMAGE"===i&&a.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(r.media_size),10),description:pa(r.media_description),fileName:pa(r.media_filename),mediaId:pa(r.media_id),thumbnail:new Blob([r.media_thumbnail]),height:parseInt(pa(r.media_height),10),width:parseInt(pa(r.media_width),10),thumbnailHeight:parseInt(pa(r.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(r.media_thumbnailwidth),10)},t,n))})),m(n(a),"onChannelRawMessage",(function(e){var t=e.desc,n=e.raw,r=e.memberId,i=e.properties;e.channelId===a.channelId&&a.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:n,description:t},r,i)})),m(n(a),"onMemberNotice",(function(e){var t=e.memberId,n=e.type,r=e.size;if(e.channelId===a.channelId){var i=e.instance.toString();e=e.seq.toString();var o={MemberLeft:a.memberLeftLru,MemberJoined:a.memberJoinedLru,MemberCountUpdated:void 0}[n];if(o){if(o.has(i+e))return void a.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",n,e,oa(a.channelId),oa(t||""));if(o.set(i+e,void 0),"string"!=typeof t)return;if(t!==a.getSession().context.uid){if((i=a.memberJoinStateLru.get(t))===cf.JOINED&&"MemberJoined"===n)return void a.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,oa(a.channelId),oa(t||""));if(i===cf.LEFT&&"MemberLeft"===n)return void a.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,oa(a.channelId),oa(t||""))}a.memberJoinStateLru.set(t,"MemberJoined"===n?cf.JOINED:cf.LEFT)}a.info("Channel %s - %s, memberId: %s",n,oa(a.channelId),"MemberCountUpdated"===n?"[unknown]":oa(t||"")),i=t===a.getSession().context.uid,"MemberLeft"===n&&za(t)||"MemberJoined"===n&&za(t)?(i||a.emit(n,t),a.onMemberCountUpdated(r)):"MemberCountUpdated"===n&&"number"==typeof r&&a.onMemberCountUpdated(r)}})),a.getSession=cn(i),a.channelId=e,a.client=o,a.info("A channel created, id %s",oa(e)),a}la(t,e);var r=ma(t);return Ha(t,[{key:"join",value:function(){var e=J(w.mark((function e(){var t,n,r,i,o,s,a;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(za(this.channelId)){e.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:e.prev=2,t=this.getSession(),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!t.joinedChannels.has(this)){e.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:Uq,sid:Xa(t.instanceId)},null!==(n=this.client.context.config.enableCloudProxy)&&void 0!==n&&n),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(e.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){e.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:Wq,sid:Xa(t.instanceId)},null!==(o=this.client.context.config.enableCloudProxy)&&void 0!==o&&o),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(20!==t.joinedChannels.size){e.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:Tq,sid:Xa(t.instanceId)},null!==(s=this.client.context.config.enableCloudProxy)&&void 0!==s&&s),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:0,sid:Xa(t.instanceId)},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),e.next=23,t.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(t.startTime),errCode:0,sid:Xa(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),this.info("The channel %s joined successfully",oa(this.channelId)),t.on("channelTextMessage",this.onChannelTextMessage),t.on("channelRawMessage",this.onChannelRawMessage),t.on("channelMediaMessage",this.onChannelMediaMessage),t.on("memberNotice",this.onMemberNotice),t.on("channelAttributesUpdated",this.onAttributesUpdated),e.next=41;break;case 32:if(e.prev=32,e.t1=e.catch(12),this.logError(e.t1),!sa(e.t1)){e.next=37;break}throw e.t1;case 37:if(!Sa(e.t1)){e.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(t.startTime),errCode:Sq,sid:Xa(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(a=this.client.context.config.enableCloudProxy)&&void 0!==a&&a),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:e.t1});case 41:case"end":return e.stop()}}),e,this,[[2,6],[12,32]])})));return function(){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=J(w.mark((function e(){var t,n,r,i;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=this.getSession(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(n.joinedChannels.has(this)){e.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:e.prev=9,n.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,n.removeListener("channelTextMessage",this.onChannelTextMessage),n.removeListener("channelRawMessage",this.onChannelRawMessage),n.removeListener("channelMediaMessage",this.onChannelMediaMessage),n.removeListener("memberNotice",this.onMemberNotice),n.removeListener("channelAttributesUpdated",this.onAttributesUpdated),e.next=32;break;case 23:if(e.prev=23,e.t1=e.catch(9),this.logError(e.t1),!sa(e.t1)){e.next=30;break}throw void 0===e.t1.code&&(e.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(n.startTime),errCode:Yq,sid:Xa(n.instanceId),userId:n.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),e.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(n.startTime),errCode:Xq,sid:Xa(n.instanceId),userId:n.context.uid},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),new Wc("The channel leave failure",{code:Xq,originalError:e.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(n.startTime),errCode:0,sid:Xa(n.instanceId),userId:n.context.uid},null!==(t=this.client.context.config.enableCloudProxy)&&void 0!==t&&t);case 33:case"end":return e.stop()}}),e,this,[[0,4],[9,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s=this,a=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(1<a.length&&void 0!==a[1]?a[1]:{}).enableHistoricalMessaging,r=void 0!==n&&n,Tm(t,Hh),e.prev=2,i=this.getSession(),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(i.joinedChannels.has(this)){e.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){e.next=16;break}return o=Date.now(),e.next=15,new Promise((function(e,n){var i=function(){var i=J(w.mark((function i(){var c;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return c=Date.now()-o,i.prev=1,i.next=4,Gg({message:t,peerId:s.channelId,toPeer:!1,session:s.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:c,logger:s.logger,options:{enableHistoricalMessaging:r,enableOfflineMessaging:!1}});case 4:e(),i.next=12;break;case 7:i.prev=7,i.t0=i.catch(1),Sa(i.t0)&&n(new db(Yd(s.name,"sendMessageToPeer",1e4),Yk)),sa(i.t0)&&n(i.t0),n(new da("Channel message send failure",{code:hg,originalError:i.t0}));case 12:return i.prev=12,clearTimeout(a),i.finish(12);case 15:case"end":return i.stop()}}),i,null,[[1,7,12,15]])})));return function(){return i.apply(this,arguments)}}();s.client.internalEmitter.once("RECONNECTED",i);var a=setTimeout((function(){s.client.internalEmitter.off("RECONNECTED",i),n(new db(Yd(s.name,"sendMessageToPeer",1e4),Yk))}),9e3)}));case 15:return e.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){e.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return e.prev=18,e.next=21,Gg({message:t,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:r,enableOfflineMessaging:!1}});case 21:e.next=31;break;case 23:if(e.prev=23,e.t1=e.catch(18),!Sa(e.t1)){e.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(e.t1)){e.next=30;break}throw this.logError(e.t1),e.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return e.stop()}}),e,this,[[2,6],[18,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getMembers",value:function(){var e=J(w.mark((function e(){var t,n,r;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,e.prev=1,t=this.getSession(),e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(t.joinedChannels.has(this)){e.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return n=this.getSession().requestChannelMemberList(this.channelId),e.next=13,n.pipe(ba((function(e){return e.memberInfos.map((function(e){return e.account}))}))).toPromise();case 13:return r=e.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),r.map(oa)),e.abrupt("return",r);case 18:if(e.prev=18,e.t1=e.catch(0),!sa(e.t1)){e.next=23;break}throw this.logError(e.t1),e.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return e.stop()}}),e,this,[[0,18],[1,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var e=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some((function(t){return t.channelId===e.channelId}))}}]),t}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(e){function t(e,i,o,s){W(this,t);var a=r.call(this,i,"RtmClient",!0);return m(n(a),"connectionState",T.DISCONNECTED),m(n(a),"internalEmitter",new ea),m(n(a),"context",void 0),m(n(a),"attributes",{}),m(n(a),"loginPromise",void 0),m(n(a),"attributeDrafts",new Set),m(n(a),"session",void 0),m(n(a),"lastLoginTime",void 0),m(n(a),"reconnId",0),m(n(a),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(a),"invitationManager",void 0),m(n(a),"subscribedPeerStatusCache",{}),m(n(a),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(a),"peerUnreachableTimers",{}),m(n(a),"mediaTaskManager",void 0),m(n(a),"setParameters",void 0),m(n(a),"updateConfig",void 0),m(n(a),"userDropHandler",(function(e){if(a.connectionState!==T.ABORTED)switch(e){case 11:a.logError("Kicked off by remote session"),a.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:a.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[e])),a.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:a.logError("User kicked off for unknown code: ".concat(e)),a.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}})),a.context=new ZC(e,o,i),a.mediaTaskManager=new fs(i),a.context.config=o,a.internalEmitter.setMaxListeners(512),a.setParameters=s.bind(n(a)),a.updateConfig=s.bind(n(a)),a.invitationManager=new nD((function(){return a.session}),i),a.invitationManager.on("remoteInvitationInstance",(function(e){a.emit("RemoteInvitationReceived",e)})),a}la(t,e);var r=ma(t);return Ha(t,[{key:"renewToken",value:function(){var e=J(w.mark((function e(t){var n,r,i,o=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&0!==t.length){e.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){e.next=5;break}return e.next=5,new Promise((function(){}));case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){e.next=7;break}throw new K("The client is not logged in",uA);case 7:if(void 0!==this.session){e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,n=this.context.token,this.context.token=t,e.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd((function(){return Error("No available edge address to connect")})),oe((function(e){return e.pipe(ca((function(e){if(sa(e))throw e})),cd(2500),Ka(4))})),Ka(1),hb(2e4),Ga((function(e){return Sa(e)&&o.warn("renewToken timed out"),Z(e)}))).toPromise();case 14:r=e.sent,i=r.ticket,e.next=27;break;case 18:if(e.prev=18,e.t0=e.catch(9),this.context.token=n,e.t0.code!==$q&&e.t0.code!==ar){e.next=23;break}throw new Ye("Invalid token",tA);case 23:if(e.t0.code!==Kh){e.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(e.t0)){e.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter((function(e){return void 0!==e})).forEach((function(e){return e.ticket=i}));case 28:case"end":return e.stop()}}),e,this,[[9,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var e=J(w.mark((function e(t){var n,r,i=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",pA);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(t)||0===t.length||t.some((function(e){return!za(e)}))||256<t.length)){e.next=6;break}throw new I("invalid arguments",er);case 6:return e.next=8,this.session.requestPeersOnlineStatus(t).toPromise();case 8:return n=e.sent,r=uc(Jk(n.userInfos,"account"),(function(e){return!!e.ts})),Object.keys(r).forEach((function(e){if(e in i.subscribedPeerStatusCache&&i.subscribedPeerStatusCache[e]!==S.PeerOnlineState.UNREACHABLE){var t=r[e]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;i.emit("PeersOnlineStatusChanged",m({},e,t)),i.subscribedPeerStatusCache[e]=t}})),e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a,c,l=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",aA);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&t.every((function(e){return"string"==typeof e}))&&0!==t.length){e.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<t.length)){e.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:n=0;case 9:if(!(n<t.length)){e.next=16;break}if(za(r=t[n])){e.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",r],Oq);case 13:n++,e.next=9;break;case 16:return e.next=18,this.session.requestGetChannelMemberCount(t).toPromise();case 18:for(i=e.sent,o=i.groupInfos,s={},a=function(e){var t=(e=o[e]).group,n=e.memberCount;za(t)&&"number"==typeof n&&(l.session.joinedChannels.forEach((function(e){e.channelId===t&&e.onMemberCountUpdated(n)})),s[t]=n)},c=0;c<o.length;c++)a(c);return e.abrupt("return",s);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var e=J(w.mark((function e(t){var n,r;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(uf({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){e.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(void 0!==this.session){e.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return n=this.session.requestSetLocalUserAttributes(t).toPromise(),r={attribute:t,promise:n},this.attributeDrafts.add(r),e.prev=8,e.next=11,n;case 11:this.attributes=t,e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(8),!sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return e.prev=19,this.attributeDrafts.delete(r),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[8,14,19,22]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(2<a.length&&void 0!==a[2]?a[2]:{}).enableNotificationToChannelMembers,i=void 0!==r&&r,uf({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return o=this.session.requestSetChannelAttributes(t,n,i).toPromise(),e.prev=7,e.next=10,o;case 10:s=uc(n,(function(e){return new Blob([e]).size})),this.channelAttributesCacheLru.set(t,s),e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(7),!sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return e.stop()}}),e,this,[[7,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var e=J(w.mark((function e(t){var n,r,i;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ua(ua({},this.attributes),t),uf({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){e.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(void 0!==this.session){e.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return r=this.session.requestAddOrUpdateLocalUserAttributes(t).toPromise(),i={attribute:n,promise:r},this.attributeDrafts.add(i),e.prev=10,e.next=13,r;case 13:this.attributes=n,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new I("arguments is not valid",er);case 21:return e.prev=21,this.attributeDrafts.delete(i),e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[10,16,21,24]])})));return function(t){return e.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,l=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(2<l.length&&void 0!==l[2]?l[2]:{}).enableNotificationToChannelMembers,i=void 0!==r&&r,o=this.channelAttributesCacheLru.get(t,{}),s=uc(n,(function(e){return new Blob([e]).size})),a=ua(ua({},o),s),uf({attributes:n,attrSizeMap:a,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){e.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(void 0!==this.session){e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return c=this.session.requestAddOrUpdateChannelAttributes(t,n,i).toPromise(),e.prev=10,e.next=13,c;case 13:this.channelAttributesCacheLru.set(t,a),e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return e.stop()}}),e,this,[[10,16]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var e=J(w.mark((function e(t){var n,r,i,o;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&0!==t.length&&!t.some((function(e){return 0===e.length}))){e.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return n=this.session.requestDeleteLocalUserAttributesByKeys(t).toPromise(),r={attribute:Gk(this.attributes,t),promise:n},this.attributeDrafts.add(r),e.prev=9,e.next=12,n;case 12:for(i=0;i<t.length;i++)o=t[i],delete this.attributes[o];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(9),!sa(e.t0)){e.next=19;break}throw e.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return e.prev=20,this.attributeDrafts.delete(r),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[9,15,20,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,l=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(2<l.length&&void 0!==l[2]?l[2]:{}).enableNotificationToChannelMembers,i=void 0!==r&&r,Array.isArray(n)&&0!==n.length&&za(t)&&!n.some((function(e){return 0===e.length||512<e.length}))){e.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){e.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(void 0!==this.session){e.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return o=this.session.requestDeleteChannelAttributesByKeys(t,n,i).toPromise(),e.prev=8,e.next=11,o;case 11:if(s=this.channelAttributesCacheLru.get(t))for(a=0;a<n.length;a++)c=n[a],delete s[c];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(8),!sa(e.t0)){e.next=19;break}throw e.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return e.stop()}}),e,this,[[8,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var e=J(w.mark((function e(){var t,n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return t=this.session.requestClearLocalUserAttributes().toPromise(),n={attribute:{},promise:t},this.attributeDrafts.add(n),e.prev=7,e.next=10,t;case 10:this.attributes={},e.next=18;break;case 13:if(e.prev=13,e.t0=e.catch(7),!sa(e.t0)){e.next=17;break}throw e.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return e.prev=18,this.attributeDrafts.delete(n),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[7,13,18,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var e=J(w.mark((function e(t){var n,r,i,o=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(1<o.length&&void 0!==o[1]?o[1]:{}).enableNotificationToChannelMembers,r=void 0!==n&&n,this.connectionState===T.CONNECTED){e.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(void 0!==this.session){e.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return i=this.session.requestClearChannelAttributes(t,r).toPromise(),e.prev=6,e.next=9,i;case 9:this.channelAttributesCacheLru.delete(t),e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(6),!sa(e.t0)){e.next=16;break}throw e.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var e=J(w.mark((function e(t){var n,r,i;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(za(t)){e.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetUserAttributeKeys(t).toPromise();case 9:return n=e.sent,r=n.keys,e.next=13,this.session.requestGetUserAttributesByKeys(t,r.slice(0,512)).toPromise();case 13:i=e.sent,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(6),!sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return e.abrupt("return",Yp(i.attributeInfos.map((function(e){return[e.key,e.value]}))));case 22:case"end":return e.stop()}}),e,this,[[6,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a,c,l,u,d,h;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(za(t)){e.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetChannelAttributesKeys(t).toPromise();case 9:return n=e.sent,r=n.keys,e.next=13,this.session.requestGetChannelAttributesByKeys(t,r).toPromise();case 13:i=e.sent,o=i.attributeMaps,e.next=22;break;case 17:if(e.prev=17,e.t0=e.catch(6),!sa(e.t0)){e.next=21;break}throw e.t0;case 21:throw new I("arguments is not valid",Ja);case 22:s={},a=0;case 24:if(!(a<o.length)){e.next=32;break}if(c=o[a],l=c.key,u=c.ms,d=c.value,h=c.origin,"string"==typeof l&&U.isLong(u)&&"string"==typeof d&&za(h)){e.next=28;break}return e.abrupt("break",32);case 28:s[l]={value:d,lastUpdateUserId:h,lastUpdateTs:u.toNumber()};case 29:a++,e.next=24;break;case 32:return this.channelAttributesCacheLru.set(t,uc(s,(function(e){return new Blob([e.value]).size}))),e.abrupt("return",s);case 34:case"end":return e.stop()}}),e,this,[[6,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,l,u,d,h;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(t,n),e.prev=5,e.next=8,this.session.requestGetChannelAttributesByKeys(t,n).toPromise();case 8:r=e.sent,i=r.attributeMaps,e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(5),!sa(e.t0)){e.next=16;break}throw e.t0;case 16:throw new I("arguments is not valid",Ja);case 17:o={},s=this.channelAttributesCacheLru.get(t,{}),a=0;case 20:if(!(a<i.length)){e.next=29;break}if(c=i[a],l=c.key,u=c.ms,d=c.value,h=c.origin,"string"==typeof l&&U.isLong(u)&&"string"==typeof d&&za(h)){e.next=24;break}return e.abrupt("break",29);case 24:s[l]=new Blob([d]).size,o[l]={value:d,lastUpdateUserId:h,lastUpdateTs:u.toNumber()};case 26:a++,e.next=20;break;case 29:return this.channelAttributesCacheLru.set(t,s),e.abrupt("return",o);case 31:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var e=J(w.mark((function e(t,n){var r;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(t,n),e.prev=5,e.next=8,this.session.requestGetUserAttributesByKeys(t,n).toPromise();case 8:r=e.sent,e.next=16;break;case 11:if(e.prev=11,e.t0=e.catch(5),!sa(e.t0)){e.next=15;break}throw e.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return e.abrupt("return",Yp(r.attributeInfos.map((function(e){return[e.key,e.value]}))));case 17:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Uk=!0,n=Bg(),r=t.token,t.token===this.context.appId&&(r=void 0),setTimeout((function(){var e;eb("Session",{appId:s.context.appId,did:navigator.userAgent,elapse:fb(s.session&&s.session.startTime),index:{index1:t.uid,index2:s.context.appId,index3:"enableLogUpload=".concat(s.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(n),token:r||"",userId:t.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},null!==(e=s.context.config.enableCloudProxy)&&void 0!==e&&e)}),1e4),yd(t)&&za(t.uid)){e.next=7;break}throw new I("not a valid user id",Jh);case 7:if("string"!=typeof r||!r){e.next=11;break}this.context.token=r,e.next=13;break;case 11:if("string"==typeof r||null==r){e.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return i=Date.now(),this.context.sid=Xa(n),this.loginPromise=this.loginImpl({uid:t.uid,instanceId:n}),this.info("RTM Client logging in as ".concat(oa(t.uid))),e.prev=17,e.next=20,this.loginPromise;case 20:e.next=27;break;case 22:throw e.prev=22,e.t0=e.catch(17),sa(e.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:e.t0.code||1,sc:e.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-i,sid:Xa(n),userId:t.uid},null!==(o=this.context.config.enableCloudProxy)&&void 0!==o&&o),this.context.token=void 0,e.t0;case 27:return e.prev=27,this.loginPromise=void 0,e.finish(27);case 30:Uk=!1;case 31:case"end":return e.stop()}}),e,this,[[17,22,27,30]])})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=J(w.mark((function e(){var t;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loginPromise){e.next=3;break}return e.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){e.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){e.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),e.abrupt("return");case 10:if(void 0!==this.session){e.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),e.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},null!==(t=this.context.config.enableCloudProxy)&&void 0!==t&&t),e.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var e,t=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):void 0!==this.session&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},null!==(e=this.context.config.enableCloudProxy)&&void 0!==e&&e),this.session.logoutHandler().then((function(){t.log("Log out success")}))),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,l=this,u=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=2<u.length&&void 0!==u[2]?u[2]:{}).enableOfflineMessaging,o=void 0!==i&&i,s=r.enableHistoricalMessaging,a=void 0!==s&&s,Tm(t,ve),this.connectionState!==T.RECONNECTING){e.next=5;break}return c=Date.now(),e.abrupt("return",new Promise((function(e,r){var i=function(){var i=J(w.mark((function i(){var u;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0!==l.session){i.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return u=Date.now()-c,i.prev=3,i.t0=e,i.next=7,Gg({message:t,peerId:n,toPeer:!0,session:l.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:u,logger:l.logger,options:{enableHistoricalMessaging:a,enableOfflineMessaging:o}});case 7:i.t1=i.sent,(0,i.t0)(i.t1),i.next=16;break;case 11:i.prev=11,i.t2=i.catch(3),Sa(i.t2)&&r(new db(Yd(l.name,"sendMessageToPeer",1e4),Zk)),sa(i.t2)&&r(i.t2),r(new da("Peer-to-peer message send failure",{code:cr,originalError:i.t2}));case 16:return i.prev=16,clearTimeout(s),i.finish(16);case 19:case"end":return i.stop()}}),i,null,[[3,11,16,19]])})));return function(){return i.apply(this,arguments)}}();l.internalEmitter.once("RECONNECTED",i);var s=setTimeout((function(){l.internalEmitter.off("RECONNECTED",i),r(new db(Yd(l.name,"sendMessageToPeer",1e4),Zk))}),9e3)})));case 5:if(this.connectionState===T.CONNECTED){e.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(void 0!==this.session){e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,e.next=12,Gg({message:t,peerId:n,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:a,enableOfflineMessaging:o}});case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(9),!Sa(e.t0)){e.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(e.t0)){e.next=21;break}throw e.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:e.t0});case 22:case"end":return e.stop()}}),e,this,[[9,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createChannel",value:function(e){var t=this;if(!za(e))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:e})[0]],Zz);return new pD(e,(function(){return t.session}),this,this.logger)}},{key:"createLocalInvitation",value:function(e){if(!za(e))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:e})[0]],xc);return this.invitationManager.genLocalInvitation(e)}},{key:"subscribePeersOnlineStatus",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a,c,l,u,d,h,p,f,m=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(za(r=t[n])){e.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",r],kg);case 11:n++,e.next=7;break;case 14:if(!(512<(i=t&&t.length?vk(t):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){e.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return e.next=19,this.session.requestSubscribePeersOnlineStatus(i).toPromise();case 19:o=e.sent,s=o.errors,a=[],c=[],l=0;case 24:if(!(l<s.length)){e.next=32;break}if(u=s[l],d=u.code,"string"==typeof(h=u.account)){e.next=28;break}throw new da("Returned account is invalid",fr);case 28:0!==d&&a.push(h);case 29:l++,e.next=24;break;case 32:for(p=0;p<i.length;p++)f=i[p],a.includes(f)||(c.push(f),this.subscribedPeerStatusCache[f]=void 0);if(this.session.requestPeersOnlineStatus(c).pipe(ba((function(e){return uc(Jk(e.userInfos,"account"),(function(e){return!!e.ts}))}))).subscribe((function(e){e=uc(e,(function(e,t){return e=e?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,m.subscribedPeerStatusCache[t]=e})),m.emit("PeersOnlineStatusChanged",e)})),0===a.length){e.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(za(r=t[n])){e.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",r],kg);case 11:n++,e.next=7;break;case 14:if(!(512<t.length)){e.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(i=t&&t.length?vk(t):[],this.session.requestUnsubscribePeersOnlineStatus(i),o=0;o<i.length;o++)s=i[o],delete this.subscribedPeerStatusCache[s];case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var e=J(w.mark((function e(t){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(t!==S.PeerSubscriptionOption.ONLINE_STATUS){e.next=4;break}return e.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createMessage",value:function(e){return"IMAGE"===e.messageType?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},e):"FILE"===e.messageType?ua({fileName:"",description:"",thumbnail:new Blob,size:0},e):e}},{key:"downloadMedia",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a,c,l,u,d,h,p,f,m,g=this,_=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=1<_.length&&void 0!==_[1]?_[1]:{},"string"==typeof t){e.next=3;break}throw new I("invalid mediaId format",cl);case 3:if(e.prev=3,r=t.split("z"),i=ra(r,3),o=i[0],s=i[1],a=i[2],c=o.slice(1,65),l=bD(c),u=parseInt(o.slice(65),10),d=parseInt(s,10),h=parseInt(a,10),!(Number.isNaN(u)||Number.isNaN(d)||Number.isNaN(h))){e.next=12;break}throw new I("Invalid mediaId content",cl);case 12:e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(3),!sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:e.t0});case 19:if(this.connectionState===T.CONNECTED){e.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(void 0!==this.session){e.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return p=this.mediaTaskManager.addDownloadTask({unit:d,zone:u,hashHexStr:c,size:h},(function(){if(void 0===g.session)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return g.session.requestFileDownloadIndexGet({hash:l,zone:u,unit:d,size:h}).toPromise()}),n),e.next=26,this.mediaTaskManager.waitMediaTask(p);case 26:return f=e.sent,m=f.payload,e.abrupt("return",m);case 29:case"end":return e.stop()}}),e,this,[[3,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a,c,l,u,d,h,p,f,m,g,_,E,v,y,b,S,C,R,O,A=this,N=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<N.length&&void 0!==N[2]?N[2]:{},yd(n=1<N.length&&void 0!==N[1]?N[1]:{})){e.next=4;break}throw new I("Invalid params",wf);case 4:if(i="thumbnailWidth"in n||"thumbnailHeight"in n||"width"in n||"height"in n,o=n.messageType,s=void 0===o?i?"IMAGE":"FILE":o,a=n.description,c=void 0===a?"":a,l=n.fileName,u=void 0===l?"":l,d=n.thumbnail,"string"==typeof n.messageType&&"string"==typeof c&&"string"==typeof u&&(Pm(d)||void 0===d)&&Pm(t)){e.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!i||"FILE"!==s){e.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(h=t.size))){e.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return e.next=15,Ji(t);case 15:return p=e.sent,e.next=18,aD(p);case 18:if(f=e.sent,this.connectionState===T.CONNECTED){e.next=21;break}throw new K("The client is not logged in",yA);case 21:if("IMAGE"!==s){e.next=29;break}return e.next=24,Xt(n,p);case 24:m=e.sent,g=m.height,_=m.width,E=m.thumbnailWidth,v=m.thumbnailHeight;case 29:return y=this.mediaTaskManager.addUploadTask({file:new Uint8Array(p),hash:f},(function(){if(void 0===A.session)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return A.session.fetchFileUploadIndexGet({hash:f,size:h})}),(function(e,t){if(void 0===A.session)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return A.session.requestFileUploadIndexSet({hash:f,unit:e,servers:t}).toPromise()}),r),e.next=32,this.mediaTaskManager.waitMediaTask(y);case 32:if(b=e.sent,S=b.zone,C=b.retUnit,"IMAGE"!==s){e.next=38;break}return R={height:g,width:_,fileName:u,size:h,description:c,thumbnail:d,messageType:s,thumbnailWidth:E,thumbnailHeight:v,mediaId:"0".concat($r(f)).concat(S,"z").concat(C,"z").concat(h,"z").concat(g,"z").concat(_)},e.abrupt("return",R);case 38:return O={fileName:u,size:h,description:c,mediaId:"0".concat($r(f)).concat(S,"z").concat(C,"z").concat(h),thumbnail:d,messageType:s},e.abrupt("return",O);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.uid,r=t.instanceId,!(void 0!==this.lastLoginTime&&500>Date.now()-this.lastLoginTime)){e.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){e.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:e.prev=6,this.context.uid=n,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:n})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=i=new ls(this.context,new Yr(this.context,this.logger,!1),r,this.logger),o=function(){s.connectionState===T.CONNECTED&&(s.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),s.session)&&s.session.once("userJoined",(function(){s.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)}))},i.on("connectionLost",o),i.on("tokenExpired",(function(){s.emit("TokenExpired")})),i.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",(function(e){s.emit("MessageFromPeer",{text:e.text,messageType:S.MessageType.TEXT},e.peerId,e.properties)})),this.session.on("peerMediaMessage",(function(e){var t=e.peerId,n=e.properties,r=e.messageType;e=e.details,"FILE"===r?s.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(e.media_size),10),description:pa(e.media_description),fileName:pa(e.media_filename),mediaId:pa(e.media_id),thumbnail:new Blob([e.media_thumbnail])},t,n):"IMAGE"===r&&s.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(e.media_size),10),description:pa(e.media_description),fileName:pa(e.media_filename),mediaId:pa(e.media_id),thumbnail:new Blob([e.media_thumbnail]),height:parseInt(pa(e.media_height),10),width:parseInt(pa(e.media_width),10),thumbnailHeight:parseInt(pa(e.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(e.media_thumbnailwidth),10)},t,n)})),this.session.on("peerRawMessage",(function(e){s.emit("MessageFromPeer",{rawMessage:e.raw,description:e.desc,messageType:S.MessageType.RAW},e.peerId,e.properties)})),i.on("instanceChanged",(function(e){return r=e})),i.on("peerOnlineStatusChanged",(function(e){var t=e.instance.toString()+e.state,n=s.peerStatusSeqLru.get(t);!n||e.seq.greaterThan(n)?(s.peerStatusSeqLru.set(t,e.seq),e.state!==s.subscribedPeerStatusCache[e.peerId]&&s.emit("PeersOnlineStatusChanged",m({},e.peerId,e.state)),s.subscribedPeerStatusCache[e.peerId]=e.state,clearTimeout(s.peerUnreachableTimers[t]),e.state===S.PeerOnlineState.UNREACHABLE&&(s.peerUnreachableTimers[t]=setTimeout((function(){s.subscribedPeerStatusCache[e.peerId]===S.PeerOnlineState.UNREACHABLE&&(s.subscribedPeerStatusCache[e.peerId]=S.PeerOnlineState.ONLINE,s.emit("PeersOnlineStatusChanged",m({},e.peerId,S.PeerOnlineState.ONLINE)))}),3e4))):s.log("peerOnlineStatusChanged dedup for %s, %d",t,e.seq.toNumber())})),i.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),i.on("channelAttributesUpdated",(function(e){var t=e.channelId;e=e.attributeMaps;for(var n={},r=0;r<e.length;r++){var i=e[r],o=i.key,a=i.ms,c=i.value;if(i=i.origin,"string"!=typeof o||!U.isLong(a)||"string"!=typeof c||!za(i))break;n[o]=new Blob([c]).size}s.channelAttributesCacheLru.set(t,n)})),i.on("userJoined",(function(e){if(0!==Object.keys(s.attributes).length){if(void 0===s.session)return;s.session.requestSetLocalUserAttributes(s.attributes,e).toPromise()}if(0!==s.attributeDrafts.size)for(var t=function(t,n){var r=(t=n[t]).attribute;t.promise.then((function(){void 0!==s.session&&s.session.requestSetLocalUserAttributes(r,e).toPromise()}))},n=0,r=Array.from(s.attributeDrafts);n<r.length;n++)t(n,r);0!==Object.keys(s.subscribedPeerStatusCache).length&&i.requestSubscribePeersOnlineStatus(Object.keys(s.subscribedPeerStatusCache))})),this.lastLoginTime=Date.now(),e.prev=29,e.next=32,i.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:i.connection.curOpenSockets.filter((function(e){return void 0!==e}))[0].ticket,instance:i.instanceId,useNewDomain:.5<=Math.random(),loginOpt:i.userJoinOptions.toLong()}),e.next=44;break;case 35:if(e.prev=35,e.t1=e.catch(29),!Sa(e.t1)){e.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(e.t1)){e.next=43;break}throw e.t1;case 43:throw new da("Login failure",{code:Zq,originalError:e.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return e.stop()}}),e,this,[[6,10],[29,35]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(e,t){var n,r=this;e===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[e],oldState:os[this.connectionState],reason:qD[t],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n),this.connectionState===T.RECONNECTING&&e===T.CONNECTED&&(0!==Object.keys(this.subscribedPeerStatusCache).length&&void 0!==this.session&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba((function(e){return uc(Jk(e.userInfos,"account"),(function(e){return!!e.ts}))}))).subscribe((function(e){e=uc(e,(function(e,t){return e=e?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,r.subscribedPeerStatusCache[t]=e})),r.emit("PeersOnlineStatusChanged",e)})),this.internalEmitter.emit("RECONNECTED")),this.connectionState=e,e!==T.ABORTED&&e!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",e),this.emit("ConnectionStateChanged",e,t)}}]),t}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(e))throw new I(["The %s in the arguments is invalid",Object.keys({appId:e})[0]],Nq);var r=Object.keys(t).filter((function(e){return!(e in qs)}));if(0!==r.length)throw new I("Invalid RTM config: ".concat(r.join(", ")),Nq);var i=ua(ua({},qs),t);if(void 0!==n&&(!Array.isArray(n)||0===n.length))throw new I("Invalid area config");if(null!=n){if(!n.every((function(e){return e in S.LegacyAreaCode})))throw new I("Invalid area codes: ".concat(n.filter((function(e){return!(e in S)})).join(", ")));M=xe(n.map((function(e){return zC[e]})))}n=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var o=DC(i);r=EC(i);var s=FC(i),a=GC(n,i),c=Tr(n,i),l=c("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=i,o("The Agora RTM Web SDK version is %s","1.4.3-203"),t.enableCloudProxy&&o("RTM cloud proxy enabled"),t.enableLogUpload&&o("Log upload enabled"),M&&l("Area is set to %s",Array.from(M.CODES).map((function(e){return xf(F).find((function(t){return F[t]===e}))})).join(", ")),l("Creating an RtmClient instance"),l('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),l("The App ID is %s",Um(e,4,10,"*".repeat(6))),o("The process ID is %s",gg),l("The build is %s","v1.4.3-17-g1e27aa38"),l("NODE_ENV is %s","production"),new rD(e,{genLogger:c,genTracker:a,info:o,warn:r,logError:s,loggerId:n},i,(function(e){for(var t=0,n=xf(e);t<n.length;t++){var r=n[t];try{var s=e[r];null!=s&&(e.enableCloudProxy&&o("RTM cloud proxy enabled"),e.enableLogUpload&&o("Log upload enabled"),i[r]=s)}catch(e){throw new I(["The %s in the arguments is invalid",r],void 0)}}}))},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(e,t){Object.keys(Nc).includes(e)&&(Nc[e]=t)},getParameter:function(e){return Nc[e]},setArea:function(e){var t=e.areaCodes;if(e=e.excludedArea,!Array.isArray(t)||0===t.length||!t.every((function(e){return e in S.AreaCode})))throw new I("Invalid area config");if(void 0!==e&&e===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(void 0===e)M=xe(t.map((function(e){return F[e]})));else{if(t.includes(e))throw new I("Excluded area cannot be in areaCodes");if(!(e in F))throw new I("Invalid excludedArea:",e);M=bu({areas:t.map((function(e){return F[e]})),excludedArea:F[e]})}}});return Zd},module.exports=t()},2110:(e,t,n)=>{"use strict";var r=n(8309),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function c(e){return r.isMemo(e)?s:a[e.$$typeof]||i}a[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[r.Memo]=s;var l=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,h=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,n,r){if("string"!==typeof n){if(f){var i=p(n);i&&i!==f&&e(t,i,r)}var s=u(n);d&&(s=s.concat(d(n)));for(var a=c(t),m=c(n),g=0;g<s.length;++g){var _=s[g];if(!o[_]&&(!r||!r[_])&&(!m||!m[_])&&(!a||!a[_])){var E=h(n,_);try{l(t,_,E)}catch(v){}}}}return t}},746:(e,t)=>{"use strict";var n="function"===typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,a=n?Symbol.for("react.profiler"):60114,c=n?Symbol.for("react.provider"):60109,l=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,h=n?Symbol.for("react.forward_ref"):60112,p=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,g=n?Symbol.for("react.lazy"):60116,_=n?Symbol.for("react.block"):60121,E=n?Symbol.for("react.fundamental"):60117,v=n?Symbol.for("react.responder"):60118,y=n?Symbol.for("react.scope"):60119;function b(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case u:case d:case o:case a:case s:case p:return e;default:switch(e=e&&e.$$typeof){case l:case h:case g:case m:case c:return e;default:return t}}case i:return t}}}function S(e){return b(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=l,t.ContextProvider=c,t.Element=r,t.ForwardRef=h,t.Fragment=o,t.Lazy=g,t.Memo=m,t.Portal=i,t.Profiler=a,t.StrictMode=s,t.Suspense=p,t.isAsyncMode=function(e){return S(e)||b(e)===u},t.isConcurrentMode=S,t.isContextConsumer=function(e){return b(e)===l},t.isContextProvider=function(e){return b(e)===c},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return b(e)===h},t.isFragment=function(e){return b(e)===o},t.isLazy=function(e){return b(e)===g},t.isMemo=function(e){return b(e)===m},t.isPortal=function(e){return b(e)===i},t.isProfiler=function(e){return b(e)===a},t.isStrictMode=function(e){return b(e)===s},t.isSuspense=function(e){return b(e)===p},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===o||e===d||e===a||e===s||e===p||e===f||"object"===typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===m||e.$$typeof===c||e.$$typeof===l||e.$$typeof===h||e.$$typeof===E||e.$$typeof===v||e.$$typeof===y||e.$$typeof===_)},t.typeOf=b},8309:(e,t,n)=>{"use strict";e.exports=n(746)},4463:(e,t,n)=>{"use strict";var r=n(2791),i=n(5296);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(a[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,r,i,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var _=/[\-:]([a-z])/g;function E(e){return e[1].toUpperCase()}function v(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(f,e)||!d.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(_,E);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(_,E);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(_,E);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var y=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),S=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),I=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function x(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=L&&e[L]||e["@@iterator"])?e:null}var M,U=Object.assign;function F(e){if(void 0===M)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var j=!1;function V(e,t){if(!e||j)return"";j=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var i=l.stack.split("\n"),o=r.stack.split("\n"),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||i[s]!==o[a]){var c="\n"+i[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=s&&0<=a);break}}}finally{j=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function B(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case T:return"Fragment";case S:return"Portal";case C:return"Profiler";case w:return"StrictMode";case A:return"Suspense";case N:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case R:return(e._context.displayName||"Context")+".Provider";case O:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return G(e(t))}catch(n){}}return null}function q(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===w?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function W(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function z(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function H(e){e._valueTracker||(e._valueTracker=function(e){var t=z(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=z(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Z(e,t){var n=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=W(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function X(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function Q(e,t){X(e,t);var n=W(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,W(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+W(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:W(n)}}function oe(e,t){var n=W(t.value),r=W(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var _e=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ee(e,t){if(t){if(_e[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ye=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,Te=null,we=null;function Ce(e){if(e=vi(e)){if("function"!==typeof Se)throw Error(o(280));var t=e.stateNode;t&&(t=bi(t),Se(e.stateNode,e.type,t))}}function Re(e){Te?we?we.push(e):we=[e]:Te=e}function Ie(){if(Te){var e=Te,t=we;if(we=Te=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Oe(e,t){return e(t)}function Ae(){}var Ne=!1;function ke(e,t,n){if(Ne)return e(t,n);Ne=!0;try{return Oe(e,t,n)}finally{Ne=!1,(null!==Te||null!==we)&&(Ae(),Ie())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var r=bi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var De=!1;if(u)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){De=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(ue){De=!1}function xe(e,t,n,r,i,o,s,a,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(u){this.onError(u)}}var Me=!1,Ue=null,Fe=!1,je=null,Ve={onError:function(e){Me=!0,Ue=e}};function Be(e,t,n,r,i,o,s,a,c){Me=!1,Ue=null,xe.apply(Ve,arguments)}function Ge(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function We(e){if(Ge(e)!==e)throw Error(o(188))}function ze(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return We(i),e;if(s===r)return We(i),t;s=s.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=s;else{for(var a=!1,c=i.child;c;){if(c===n){a=!0,n=i,r=s;break}if(c===r){a=!0,r=i,n=s;break}c=c.sibling}if(!a){for(c=s.child;c;){if(c===n){a=!0,n=s,r=i;break}if(c===r){a=!0,r=s,n=i;break}c=c.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?He(e):null}function He(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=He(e);if(null!==t)return t;e=e.sibling}return null}var Ke=i.unstable_scheduleCallback,Ye=i.unstable_cancelCallback,Ze=i.unstable_shouldYield,Je=i.unstable_requestPaint,Xe=i.unstable_now,Qe=i.unstable_getCurrentPriorityLevel,$e=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,ot=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/ct|0)|0},at=Math.log,ct=Math.LN2;var lt=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~i;0!==a?r=dt(a):0!==(o&=s)&&(r=dt(o))}else 0!==(s=n&~i)?r=dt(s):0!==o&&(r=dt(o));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(o=t&-t)||16===i&&0!==(4194240&o)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-st(t)),r|=e[n],t&=~i;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function _t(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function Et(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var vt=0;function yt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,St,Tt,wt,Ct,Rt=!1,It=[],Ot=null,At=null,Nt=null,kt=new Map,Pt=new Map,Dt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function xt(e,t){switch(e){case"focusin":case"focusout":Ot=null;break;case"dragenter":case"dragleave":At=null;break;case"mouseover":case"mouseout":Nt=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function Mt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=vi(t))&&St(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Ut(e){var t=Ei(e.target);if(null!==t){var n=Ge(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=qe(n)))return e.blockedOn=t,void Ct(e.priority,(function(){Tt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=vi(n))&&St(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);ye=r,n.target.dispatchEvent(r),ye=null,t.shift()}return!0}function jt(e,t,n){Ft(e)&&n.delete(t)}function Vt(){Rt=!1,null!==Ot&&Ft(Ot)&&(Ot=null),null!==At&&Ft(At)&&(At=null),null!==Nt&&Ft(Nt)&&(Nt=null),kt.forEach(jt),Pt.forEach(jt)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,Rt||(Rt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Vt)))}function Gt(e){function t(t){return Bt(t,e)}if(0<It.length){Bt(It[0],e);for(var n=1;n<It.length;n++){var r=It[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Ot&&Bt(Ot,e),null!==At&&Bt(At,e),null!==Nt&&Bt(Nt,e),kt.forEach(t),Pt.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Ut(n),null===n.blockedOn&&Dt.shift()}var qt=y.ReactCurrentBatchConfig,Wt=!0;function zt(e,t,n,r){var i=vt,o=qt.transition;qt.transition=null;try{vt=1,Kt(e,t,n,r)}finally{vt=i,qt.transition=o}}function Ht(e,t,n,r){var i=vt,o=qt.transition;qt.transition=null;try{vt=4,Kt(e,t,n,r)}finally{vt=i,qt.transition=o}}function Kt(e,t,n,r){if(Wt){var i=Zt(e,t,n,r);if(null===i)Wr(e,t,r,Yt,n),xt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Ot=Mt(Ot,e,t,n,r,i),!0;case"dragenter":return At=Mt(At,e,t,n,r,i),!0;case"mouseover":return Nt=Mt(Nt,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return kt.set(o,Mt(kt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Pt.set(o,Mt(Pt.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(xt(e,r),4&t&&-1<Lt.indexOf(e)){for(;null!==i;){var o=vi(i);if(null!==o&&bt(o),null===(o=Zt(e,t,n,r))&&Wr(e,t,r,Yt,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else Wr(e,t,r,null,n)}}var Yt=null;function Zt(e,t,n,r){if(Yt=null,null!==(e=Ei(e=be(r))))if(null===(t=Ge(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=qe(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Xt=null,Qt=null,$t=null;function en(){if($t)return $t;var e,t,n=Qt,r=n.length,i="value"in Xt?Xt.value:Xt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return $t=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,an,cn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(ln),dn=U({},ln,{view:0,detail:0}),hn=on(dn),pn=U({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(sn=e.screenX-cn.screenX,an=e.screenY-cn.screenY):an=sn=0,cn=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),fn=on(pn),mn=on(U({},pn,{dataTransfer:0})),gn=on(U({},dn,{relatedTarget:0})),_n=on(U({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),En=U({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vn=on(En),yn=on(U({},ln,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function Cn(){return wn}var Rn=U({},dn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=on(Rn),On=on(U({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),An=on(U({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),Nn=on(U({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=U({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=on(kn),Dn=[9,13,27,32],Ln=u&&"CompositionEvent"in window,xn=null;u&&"documentMode"in document&&(xn=document.documentMode);var Mn=u&&"TextEvent"in window&&!xn,Un=u&&(!Ln||xn&&8<xn&&11>=xn),Fn=String.fromCharCode(32),jn=!1;function Vn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1;var qn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!qn[e.type]:"textarea"===t}function zn(e,t,n,r){Re(r),0<(t=Hr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Hn=null,Kn=null;function Yn(e){Fr(e,0)}function Zn(e){if(K(yi(e)))return e}function Jn(e,t){if("change"===e)return t}var Xn=!1;if(u){var Qn;if(u){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Qn=$n}else Qn=!1;Xn=Qn&&(!document.documentMode||9<document.documentMode)}function tr(){Hn&&(Hn.detachEvent("onpropertychange",nr),Kn=Hn=null)}function nr(e){if("value"===e.propertyName&&Zn(Kn)){var t=[];zn(t,Kn,e,be(e)),ke(Yn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(Hn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Zn(Kn)}function or(e,t){if("click"===e)return Zn(t)}function sr(e,t){if("input"===e||"change"===e)return Zn(t)}var ar="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function cr(e,t){if(ar(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!ar(e[i],t[i]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=ur(n,o);var s=ur(n,r);i&&s&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=u&&"documentMode"in document&&11>=document.documentMode,gr=null,_r=null,Er=null,vr=!1;function yr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vr||null==gr||gr!==Y(r)||("selectionStart"in(r=gr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},Er&&cr(Er,r)||(Er=r,0<(r=Hr(_r,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function br(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Sr={animationend:br("Animation","AnimationEnd"),animationiteration:br("Animation","AnimationIteration"),animationstart:br("Animation","AnimationStart"),transitionend:br("Transition","TransitionEnd")},Tr={},wr={};function Cr(e){if(Tr[e])return Tr[e];if(!Sr[e])return e;var t,n=Sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in wr)return Tr[e]=n[t];return e}u&&(wr=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);var Rr=Cr("animationend"),Ir=Cr("animationiteration"),Or=Cr("animationstart"),Ar=Cr("transitionend"),Nr=new Map,kr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pr(e,t){Nr.set(e,t),c(t,[e])}for(var Dr=0;Dr<kr.length;Dr++){var Lr=kr[Dr];Pr(Lr.toLowerCase(),"on"+(Lr[0].toUpperCase()+Lr.slice(1)))}Pr(Rr,"onAnimationEnd"),Pr(Ir,"onAnimationIteration"),Pr(Or,"onAnimationStart"),Pr("dblclick","onDoubleClick"),Pr("focusin","onFocus"),Pr("focusout","onBlur"),Pr(Ar,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(xr));function Ur(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,s,a,c,l){if(Be.apply(this,arguments),Me){if(!Me)throw Error(o(198));var u=Ue;Me=!1,Ue=null,Fe||(Fe=!0,je=u)}}(r,t,void 0,e),e.currentTarget=null}function Fr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==o&&i.isPropagationStopped())break e;Ur(i,a,l),o=c}else for(s=0;s<r.length;s++){if(c=(a=r[s]).instance,l=a.currentTarget,a=a.listener,c!==o&&i.isPropagationStopped())break e;Ur(i,a,l),o=c}}}if(Fe)throw e=je,Fe=!1,je=null,e}function jr(e,t){var n=t[mi];void 0===n&&(n=t[mi]=new Set);var r=e+"__bubble";n.has(r)||(qr(t,e,2,!1),n.add(r))}function Vr(e,t,n){var r=0;t&&(r|=4),qr(n,e,r,t)}var Br="_reactListening"+Math.random().toString(36).slice(2);function Gr(e){if(!e[Br]){e[Br]=!0,s.forEach((function(t){"selectionchange"!==t&&(Mr.has(t)||Vr(t,!1,e),Vr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Br]||(t[Br]=!0,Vr("selectionchange",!1,t))}}function qr(e,t,n,r){switch(Jt(t)){case 1:var i=zt;break;case 4:i=Ht;break;default:i=Kt}n=i.bind(null,t,n,e),i=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Wr(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var c=s.tag;if((3===c||4===c)&&((c=s.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;s=s.return}for(;null!==a;){if(null===(s=Ei(a)))return;if(5===(c=s.tag)||6===c){r=o=s;continue e}a=a.parentNode}}r=r.return}ke((function(){var r=o,i=be(n),s=[];e:{var a=Nr.get(e);if(void 0!==a){var c=un,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=In;break;case"focusin":l="focus",c=gn;break;case"focusout":l="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=An;break;case Rr:case Ir:case Or:c=_n;break;case Ar:c=Nn;break;case"scroll":c=hn;break;case"wheel":c=Pn;break;case"copy":case"cut":case"paste":c=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=On}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=Pe(f,h))&&u.push(zr(f,m,p)))),d)break;f=f.return}0<u.length&&(a=new c(a,l,null,n,i),s.push({event:a,listeners:u}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===ye||!(l=n.relatedTarget||n.fromElement)||!Ei(l)&&!l[fi])&&(c||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,c?(c=r,null!==(l=(l=n.relatedTarget||n.toElement)?Ei(l):null)&&(l!==(d=Ge(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=r),c!==l)){if(u=fn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=On,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==c?a:yi(c),p=null==l?a:yi(l),(a=new u(m,f+"leave",c,n,i)).target=d,a.relatedTarget=p,m=null,Ei(i)===r&&((u=new u(h,f+"enter",l,n,i)).target=p,u.relatedTarget=d,m=u),d=m,c&&l)e:{for(h=l,f=0,p=u=c;p;p=Kr(p))f++;for(p=0,m=h;m;m=Kr(m))p++;for(;0<f-p;)u=Kr(u),f--;for(;0<p-f;)h=Kr(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=Kr(u),h=Kr(h)}u=null}else u=null;null!==c&&Yr(s,a,c,u,!1),null!==l&&null!==d&&Yr(s,d,l,u,!0)}if("select"===(c=(a=r?yi(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===c&&"file"===a.type)var g=Jn;else if(Wn(a))if(Xn)g=sr;else{g=ir;var _=rr}else(c=a.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=or);switch(g&&(g=g(e,r))?zn(s,g,n,i):(_&&_(e,a,r),"focusout"===e&&(_=a._wrapperState)&&_.controlled&&"number"===a.type&&ee(a,"number",a.value)),_=r?yi(r):window,e){case"focusin":(Wn(_)||"true"===_.contentEditable)&&(gr=_,_r=r,Er=null);break;case"focusout":Er=_r=gr=null;break;case"mousedown":vr=!0;break;case"contextmenu":case"mouseup":case"dragend":vr=!1,yr(s,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":yr(s,n,i)}var E;if(Ln)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Gn?Vn(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(Un&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==v?"onCompositionEnd"===v&&Gn&&(E=en()):(Qt="value"in(Xt=i)?Xt.value:Xt.textContent,Gn=!0)),0<(_=Hr(r,v)).length&&(v=new yn(v,e,null,n,i),s.push({event:v,listeners:_}),E?v.data=E:null!==(E=Bn(n))&&(v.data=E))),(E=Mn?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(jn=!0,Fn);case"textInput":return(e=t.data)===Fn&&jn?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Ln&&Vn(e,t)?(e=en(),$t=Qt=Xt=null,Gn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Un&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Hr(r,"onBeforeInput")).length&&(i=new yn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=E))}Fr(s,t)}))}function zr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Pe(e,n))&&r.unshift(zr(e,o,i)),null!=(o=Pe(e,t))&&r.push(zr(e,o,i))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yr(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,c=a.alternate,l=a.stateNode;if(null!==c&&c===r)break;5===a.tag&&null!==l&&(a=l,i?null!=(c=Pe(n,o))&&s.unshift(zr(n,c,a)):i||null!=(c=Pe(n,o))&&s.push(zr(n,c,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Zr=/\r\n?/g,Jr=/\u0000|\uFFFD/g;function Xr(e){return("string"===typeof e?e:""+e).replace(Zr,"\n").replace(Jr,"")}function Qr(e,t,n){if(t=Xr(t),Xr(e)!==t&&n)throw Error(o(425))}function $r(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,oi="function"===typeof Promise?Promise:void 0,si="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof oi?function(e){return oi.resolve(null).then(e).catch(ai)}:ri;function ai(e){setTimeout((function(){throw e}))}function ci(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Gt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Gt(t)}function li(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),hi="__reactFiber$"+di,pi="__reactProps$"+di,fi="__reactContainer$"+di,mi="__reactEvents$"+di,gi="__reactListeners$"+di,_i="__reactHandles$"+di;function Ei(e){var t=e[hi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fi]||n[hi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[hi])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function vi(e){return!(e=e[hi]||e[fi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function yi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function bi(e){return e[pi]||null}var Si=[],Ti=-1;function wi(e){return{current:e}}function Ci(e){0>Ti||(e.current=Si[Ti],Si[Ti]=null,Ti--)}function Ri(e,t){Ti++,Si[Ti]=e.current,e.current=t}var Ii={},Oi=wi(Ii),Ai=wi(!1),Ni=Ii;function ki(e,t){var n=e.type.contextTypes;if(!n)return Ii;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Pi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Di(){Ci(Ai),Ci(Oi)}function Li(e,t,n){if(Oi.current!==Ii)throw Error(o(168));Ri(Oi,t),Ri(Ai,n)}function xi(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(o(108,q(e)||"Unknown",i));return U({},n,r)}function Mi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ii,Ni=Oi.current,Ri(Oi,e),Ri(Ai,Ai.current),!0}function Ui(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=xi(e,t,Ni),r.__reactInternalMemoizedMergedChildContext=e,Ci(Ai),Ci(Oi),Ri(Oi,e)):Ci(Ai),Ri(Ai,n)}var Fi=null,ji=!1,Vi=!1;function Bi(e){null===Fi?Fi=[e]:Fi.push(e)}function Gi(){if(!Vi&&null!==Fi){Vi=!0;var e=0,t=vt;try{var n=Fi;for(vt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Fi=null,ji=!1}catch(i){throw null!==Fi&&(Fi=Fi.slice(e+1)),Ke($e,Gi),i}finally{vt=t,Vi=!1}}return null}var qi=[],Wi=0,zi=null,Hi=0,Ki=[],Yi=0,Zi=null,Ji=1,Xi="";function Qi(e,t){qi[Wi++]=Hi,qi[Wi++]=zi,zi=e,Hi=t}function $i(e,t,n){Ki[Yi++]=Ji,Ki[Yi++]=Xi,Ki[Yi++]=Zi,Zi=e;var r=Ji;e=Xi;var i=32-st(r)-1;r&=~(1<<i),n+=1;var o=32-st(t)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Ji=1<<32-st(t)+i|n<<i|r,Xi=o+e}else Ji=1<<o|n<<i|r,Xi=e}function eo(e){null!==e.return&&(Qi(e,1),$i(e,1,0))}function to(e){for(;e===zi;)zi=qi[--Wi],qi[Wi]=null,Hi=qi[--Wi],qi[Wi]=null;for(;e===Zi;)Zi=Ki[--Yi],Ki[Yi]=null,Xi=Ki[--Yi],Ki[Yi]=null,Ji=Ki[--Yi],Ki[Yi]=null}var no=null,ro=null,io=!1,oo=null;function so(e,t){var n=Pl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,ro=li(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Zi?{id:Ji,overflow:Xi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Pl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,ro=null,!0);default:return!1}}function co(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function lo(e){if(io){var t=ro;if(t){var n=t;if(!ao(e,t)){if(co(e))throw Error(o(418));t=li(n.nextSibling);var r=no;t&&ao(e,t)?so(r,n):(e.flags=-4097&e.flags|2,io=!1,no=e)}}else{if(co(e))throw Error(o(418));e.flags=-4097&e.flags|2,io=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!io)return uo(e),io=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ro)){if(co(e))throw po(),Error(o(418));for(;t;)so(e,t),t=li(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ro=li(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ro=null}}else ro=no?li(e.stateNode.nextSibling):null;return!0}function po(){for(var e=ro;e;)e=li(e.nextSibling)}function fo(){ro=no=null,io=!1}function mo(e){null===oo?oo=[e]:oo.push(e)}var go=y.ReactCurrentBatchConfig;function _o(e,t){if(e&&e.defaultProps){for(var n in t=U({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var Eo=wi(null),vo=null,yo=null,bo=null;function So(){bo=yo=vo=null}function To(e){var t=Eo.current;Ci(Eo),e._currentValue=t}function wo(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Co(e,t){vo=e,bo=yo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ya=!0),e.firstContext=null)}function Ro(e){var t=e._currentValue;if(bo!==e)if(e={context:e,memoizedValue:t,next:null},null===yo){if(null===vo)throw Error(o(308));yo=e,vo.dependencies={lanes:0,firstContext:e}}else yo=yo.next=e;return t}var Io=null;function Oo(e){null===Io?Io=[e]:Io.push(e)}function Ao(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Oo(t)):(n.next=i.next,i.next=n),t.interleaved=n,No(e,r)}function No(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var ko=!1;function Po(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Do(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Lo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function xo(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Ac)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,No(e,n)}return null===(i=r.interleaved)?(t.next=t,Oo(r)):(t.next=i.next,i.next=t),r.interleaved=t,No(e,n)}function Mo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Et(e,n)}}function Uo(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Fo(e,t,n,r){var i=e.updateQueue;ko=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var c=a,l=c.next;c.next=null,null===s?o=l:s.next=l,s=c;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(null!==o){var d=i.baseState;for(s=0,u=l=c=null,a=o;;){var h=a.lane,p=a.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(h=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=m.payload)?f.call(p,d,h):f)||void 0===h)break e;d=U({},d,h);break e;case 2:ko=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(l=u=p,c=d):u=u.next=p,s|=h;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(h=a).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===u&&(c=d),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);Uc|=s,e.lanes=s,e.memoizedState=d}}function jo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(o(191,i));i.call(r)}}}var Vo=(new r.Component).refs;function Bo(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:U({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Go={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tl(),i=nl(e),o=Lo(r,i);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=xo(e,o,i))&&(rl(t,e,i,r),Mo(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tl(),i=nl(e),o=Lo(r,i);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=xo(e,o,i))&&(rl(t,e,i,r),Mo(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tl(),r=nl(e),i=Lo(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=xo(e,i,r))&&(rl(t,e,r,n),Mo(t,e,r))}};function qo(e,t,n,r,i,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!cr(n,r)||!cr(i,o))}function Wo(e,t,n){var r=!1,i=Ii,o=t.contextType;return"object"===typeof o&&null!==o?o=Ro(o):(i=Pi(t)?Ni:Oi.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?ki(e,i):Ii),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Go,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function zo(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Go.enqueueReplaceState(t,t.state,null)}function Ho(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Vo,Po(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=Ro(o):(o=Pi(t)?Ni:Oi.current,i.context=ki(e,o)),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(Bo(e,t,o,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Go.enqueueReplaceState(i,i.state,null),Fo(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function Ko(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=r,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;t===Vo&&(t=i.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Yo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Zo(e){return(0,e._init)(e._payload)}function Jo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Ll(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=Fl(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){var o=n.type;return o===T?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===P&&Zo(o)===t.type)?((r=i(t,n.props)).ref=Ko(e,t,n),r.return=e,r):((r=xl(n.type,n.key,n.props,null,e.mode,r)).ref=Ko(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=jl(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Ml(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=xl(t.type,t.key,t.props,null,e.mode,n)).ref=Ko(e,null,t),n.return=e,n;case S:return(t=jl(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||x(t))return(t=Ml(t,e.mode,n,null)).return=e,t;Yo(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===i?l(e,t,n,r):null;case S:return n.key===i?u(e,t,n,r):null;case P:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||x(n))return null!==i?null:d(e,t,n,r,null);Yo(e,n)}return null}function f(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case b:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case S:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case P:return f(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||x(r))return d(t,e=e.get(n)||null,r,i,null);Yo(t,r)}return null}function m(i,o,a,c){for(var l=null,u=null,d=o,m=o=0,g=null;null!==d&&m<a.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var _=p(i,d,a[m],c);if(null===_){null===d&&(d=g);break}e&&d&&null===_.alternate&&t(i,d),o=s(_,o,m),null===u?l=_:u.sibling=_,u=_,d=g}if(m===a.length)return n(i,d),io&&Qi(i,m),l;if(null===d){for(;m<a.length;m++)null!==(d=h(i,a[m],c))&&(o=s(d,o,m),null===u?l=d:u.sibling=d,u=d);return io&&Qi(i,m),l}for(d=r(i,d);m<a.length;m++)null!==(g=f(d,i,m,a[m],c))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),o=s(g,o,m),null===u?l=g:u.sibling=g,u=g);return e&&d.forEach((function(e){return t(i,e)})),io&&Qi(i,m),l}function g(i,a,c,l){var u=x(c);if("function"!==typeof u)throw Error(o(150));if(null==(c=u.call(c)))throw Error(o(151));for(var d=u=null,m=a,g=a=0,_=null,E=c.next();null!==m&&!E.done;g++,E=c.next()){m.index>g?(_=m,m=null):_=m.sibling;var v=p(i,m,E.value,l);if(null===v){null===m&&(m=_);break}e&&m&&null===v.alternate&&t(i,m),a=s(v,a,g),null===d?u=v:d.sibling=v,d=v,m=_}if(E.done)return n(i,m),io&&Qi(i,g),u;if(null===m){for(;!E.done;g++,E=c.next())null!==(E=h(i,E.value,l))&&(a=s(E,a,g),null===d?u=E:d.sibling=E,d=E);return io&&Qi(i,g),u}for(m=r(i,m);!E.done;g++,E=c.next())null!==(E=f(m,i,g,E.value,l))&&(e&&null!==E.alternate&&m.delete(null===E.key?g:E.key),a=s(E,a,g),null===d?u=E:d.sibling=E,d=E);return e&&m.forEach((function(e){return t(i,e)})),io&&Qi(i,g),u}return function e(r,o,s,c){if("object"===typeof s&&null!==s&&s.type===T&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case b:e:{for(var l=s.key,u=o;null!==u;){if(u.key===l){if((l=s.type)===T){if(7===u.tag){n(r,u.sibling),(o=i(u,s.props.children)).return=r,r=o;break e}}else if(u.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===P&&Zo(l)===u.type){n(r,u.sibling),(o=i(u,s.props)).ref=Ko(r,u,s),o.return=r,r=o;break e}n(r,u);break}t(r,u),u=u.sibling}s.type===T?((o=Ml(s.props.children,r.mode,c,s.key)).return=r,r=o):((c=xl(s.type,s.key,s.props,null,r.mode,c)).ref=Ko(r,o,s),c.return=r,r=c)}return a(r);case S:e:{for(u=s.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(r,o.sibling),(o=i(o,s.children||[])).return=r,r=o;break e}n(r,o);break}t(r,o),o=o.sibling}(o=jl(s,r.mode,c)).return=r,r=o}return a(r);case P:return e(r,o,(u=s._init)(s._payload),c)}if(te(s))return m(r,o,s,c);if(x(s))return g(r,o,s,c);Yo(r,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==o&&6===o.tag?(n(r,o.sibling),(o=i(o,s)).return=r,r=o):(n(r,o),(o=Fl(s,r.mode,c)).return=r,r=o),a(r)):n(r,o)}}var Xo=Jo(!0),Qo=Jo(!1),$o={},es=wi($o),ts=wi($o),ns=wi($o);function rs(e){if(e===$o)throw Error(o(174));return e}function is(e,t){switch(Ri(ns,t),Ri(ts,e),Ri(es,$o),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ci(es),Ri(es,t)}function os(){Ci(es),Ci(ts),Ci(ns)}function ss(e){rs(ns.current);var t=rs(es.current),n=ce(t,e.type);t!==n&&(Ri(ts,e),Ri(es,n))}function as(e){ts.current===e&&(Ci(es),Ci(ts))}var cs=wi(0);function ls(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var us=[];function ds(){for(var e=0;e<us.length;e++)us[e]._workInProgressVersionPrimary=null;us.length=0}var hs=y.ReactCurrentDispatcher,ps=y.ReactCurrentBatchConfig,fs=0,ms=null,gs=null,_s=null,Es=!1,vs=!1,ys=0,bs=0;function Ss(){throw Error(o(321))}function Ts(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function ws(e,t,n,r,i,s){if(fs=s,ms=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,hs.current=null===e||null===e.memoizedState?aa:ca,e=n(r,i),vs){s=0;do{if(vs=!1,ys=0,25<=s)throw Error(o(301));s+=1,_s=gs=null,t.updateQueue=null,hs.current=la,e=n(r,i)}while(vs)}if(hs.current=sa,t=null!==gs&&null!==gs.next,fs=0,_s=gs=ms=null,Es=!1,t)throw Error(o(300));return e}function Cs(){var e=0!==ys;return ys=0,e}function Rs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===_s?ms.memoizedState=_s=e:_s=_s.next=e,_s}function Is(){if(null===gs){var e=ms.alternate;e=null!==e?e.memoizedState:null}else e=gs.next;var t=null===_s?ms.memoizedState:_s.next;if(null!==t)_s=t,gs=e;else{if(null===e)throw Error(o(310));e={memoizedState:(gs=e).memoizedState,baseState:gs.baseState,baseQueue:gs.baseQueue,queue:gs.queue,next:null},null===_s?ms.memoizedState=_s=e:_s=_s.next=e}return _s}function Os(e,t){return"function"===typeof t?t(e):t}function As(e){var t=Is(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=gs,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,r=r.baseState;var c=a=null,l=null,u=s;do{var d=u.lane;if((fs&d)===d)null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===l?(c=l=h,a=r):l=l.next=h,ms.lanes|=d,Uc|=d}u=u.next}while(null!==u&&u!==s);null===l?a=r:l.next=c,ar(r,t.memoizedState)||(ya=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,ms.lanes|=s,Uc|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ns(e){var t=Is(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{s=e(s,a.action),a=a.next}while(a!==i);ar(s,t.memoizedState)||(ya=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function ks(){}function Ps(e,t){var n=ms,r=Is(),i=t(),s=!ar(r.memoizedState,i);if(s&&(r.memoizedState=i,ya=!0),r=r.queue,Ws(xs.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==_s&&1&_s.memoizedState.tag){if(n.flags|=2048,js(9,Ls.bind(null,n,r,i,t),void 0,null),null===Nc)throw Error(o(349));0!==(30&fs)||Ds(n,t,i)}return i}function Ds(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ms.updateQueue)?(t={lastEffect:null,stores:null},ms.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ls(e,t,n,r){t.value=n,t.getSnapshot=r,Ms(t)&&Us(e)}function xs(e,t,n){return n((function(){Ms(t)&&Us(e)}))}function Ms(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ar(e,n)}catch(r){return!0}}function Us(e){var t=No(e,1);null!==t&&rl(t,e,1,-1)}function Fs(e){var t=Rs();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Os,lastRenderedState:e},t.queue=e,e=e.dispatch=na.bind(null,ms,e),[t.memoizedState,e]}function js(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=ms.updateQueue)?(t={lastEffect:null,stores:null},ms.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Vs(){return Is().memoizedState}function Bs(e,t,n,r){var i=Rs();ms.flags|=e,i.memoizedState=js(1|t,n,void 0,void 0===r?null:r)}function Gs(e,t,n,r){var i=Is();r=void 0===r?null:r;var o=void 0;if(null!==gs){var s=gs.memoizedState;if(o=s.destroy,null!==r&&Ts(r,s.deps))return void(i.memoizedState=js(t,n,o,r))}ms.flags|=e,i.memoizedState=js(1|t,n,o,r)}function qs(e,t){return Bs(8390656,8,e,t)}function Ws(e,t){return Gs(2048,8,e,t)}function zs(e,t){return Gs(4,2,e,t)}function Hs(e,t){return Gs(4,4,e,t)}function Ks(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ys(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Gs(4,4,Ks.bind(null,t,e),n)}function Zs(){}function Js(e,t){var n=Is();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ts(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Xs(e,t){var n=Is();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ts(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Qs(e,t,n){return 0===(21&fs)?(e.baseState&&(e.baseState=!1,ya=!0),e.memoizedState=n):(ar(n,t)||(n=mt(),ms.lanes|=n,Uc|=n,e.baseState=!0),t)}function $s(e,t){var n=vt;vt=0!==n&&4>n?n:4,e(!0);var r=ps.transition;ps.transition={};try{e(!1),t()}finally{vt=n,ps.transition=r}}function ea(){return Is().memoizedState}function ta(e,t,n){var r=nl(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ra(e))ia(t,n);else if(null!==(n=Ao(e,t,n,r))){rl(n,e,r,tl()),oa(n,t,r)}}function na(e,t,n){var r=nl(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ra(e))ia(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,ar(a,s)){var c=t.interleaved;return null===c?(i.next=i,Oo(t)):(i.next=c.next,c.next=i),void(t.interleaved=i)}}catch(l){}null!==(n=Ao(e,t,i,r))&&(rl(n,e,r,i=tl()),oa(n,t,r))}}function ra(e){var t=e.alternate;return e===ms||null!==t&&t===ms}function ia(e,t){vs=Es=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function oa(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Et(e,n)}}var sa={readContext:Ro,useCallback:Ss,useContext:Ss,useEffect:Ss,useImperativeHandle:Ss,useInsertionEffect:Ss,useLayoutEffect:Ss,useMemo:Ss,useReducer:Ss,useRef:Ss,useState:Ss,useDebugValue:Ss,useDeferredValue:Ss,useTransition:Ss,useMutableSource:Ss,useSyncExternalStore:Ss,useId:Ss,unstable_isNewReconciler:!1},aa={readContext:Ro,useCallback:function(e,t){return Rs().memoizedState=[e,void 0===t?null:t],e},useContext:Ro,useEffect:qs,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Bs(4194308,4,Ks.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Bs(4194308,4,e,t)},useInsertionEffect:function(e,t){return Bs(4,2,e,t)},useMemo:function(e,t){var n=Rs();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Rs();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ta.bind(null,ms,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Rs().memoizedState=e},useState:Fs,useDebugValue:Zs,useDeferredValue:function(e){return Rs().memoizedState=e},useTransition:function(){var e=Fs(!1),t=e[0];return e=$s.bind(null,e[1]),Rs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ms,i=Rs();if(io){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Nc)throw Error(o(349));0!==(30&fs)||Ds(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,qs(xs.bind(null,r,s,e),[e]),r.flags|=2048,js(9,Ls.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=Rs(),t=Nc.identifierPrefix;if(io){var n=Xi;t=":"+t+"R"+(n=(Ji&~(1<<32-st(Ji)-1)).toString(32)+n),0<(n=ys++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=bs++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ca={readContext:Ro,useCallback:Js,useContext:Ro,useEffect:Ws,useImperativeHandle:Ys,useInsertionEffect:zs,useLayoutEffect:Hs,useMemo:Xs,useReducer:As,useRef:Vs,useState:function(){return As(Os)},useDebugValue:Zs,useDeferredValue:function(e){return Qs(Is(),gs.memoizedState,e)},useTransition:function(){return[As(Os)[0],Is().memoizedState]},useMutableSource:ks,useSyncExternalStore:Ps,useId:ea,unstable_isNewReconciler:!1},la={readContext:Ro,useCallback:Js,useContext:Ro,useEffect:Ws,useImperativeHandle:Ys,useInsertionEffect:zs,useLayoutEffect:Hs,useMemo:Xs,useReducer:Ns,useRef:Vs,useState:function(){return Ns(Os)},useDebugValue:Zs,useDeferredValue:function(e){var t=Is();return null===gs?t.memoizedState=e:Qs(t,gs.memoizedState,e)},useTransition:function(){return[Ns(Os)[0],Is().memoizedState]},useMutableSource:ks,useSyncExternalStore:Ps,useId:ea,unstable_isNewReconciler:!1};function ua(e,t){try{var n="",r=t;do{n+=B(r),r=r.return}while(r);var i=n}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i,digest:null}}function da(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ha(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var pa="function"===typeof WeakMap?WeakMap:Map;function fa(e,t,n){(n=Lo(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){zc||(zc=!0,Hc=r),ha(0,t)},n}function ma(e,t,n){(n=Lo(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){ha(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){ha(0,t),"function"!==typeof r&&(null===Kc?Kc=new Set([this]):Kc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ga(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new pa;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Rl.bind(null,e,t,n),t.then(e,e))}function _a(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Ea(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Lo(-1,1)).tag=2,xo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var va=y.ReactCurrentOwner,ya=!1;function ba(e,t,n,r){t.child=null===e?Qo(t,null,n,r):Xo(t,e.child,n,r)}function Sa(e,t,n,r,i){n=n.render;var o=t.ref;return Co(t,i),r=ws(e,t,n,r,o,i),n=Cs(),null===e||ya?(io&&n&&eo(t),t.flags|=1,ba(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,za(e,t,i))}function Ta(e,t,n,r,i){if(null===e){var o=n.type;return"function"!==typeof o||Dl(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=xl(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,wa(e,t,o,r,i))}if(o=e.child,0===(e.lanes&i)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:cr)(s,r)&&e.ref===t.ref)return za(e,t,i)}return t.flags|=1,(e=Ll(o,r)).ref=t.ref,e.return=t,t.child=e}function wa(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(cr(o,r)&&e.ref===t.ref){if(ya=!1,t.pendingProps=r=o,0===(e.lanes&i))return t.lanes=e.lanes,za(e,t,i);0!==(131072&e.flags)&&(ya=!0)}}return Ia(e,t,n,r,i)}function Ca(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ri(Lc,Dc),Dc|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ri(Lc,Dc),Dc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,Ri(Lc,Dc),Dc|=r}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,Ri(Lc,Dc),Dc|=r;return ba(e,t,i,n),t.child}function Ra(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ia(e,t,n,r,i){var o=Pi(n)?Ni:Oi.current;return o=ki(t,o),Co(t,i),n=ws(e,t,n,r,o,i),r=Cs(),null===e||ya?(io&&r&&eo(t),t.flags|=1,ba(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,za(e,t,i))}function Oa(e,t,n,r,i){if(Pi(n)){var o=!0;Mi(t)}else o=!1;if(Co(t,i),null===t.stateNode)Wa(e,t),Wo(t,n,r),Ho(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var c=s.context,l=n.contextType;"object"===typeof l&&null!==l?l=Ro(l):l=ki(t,l=Pi(n)?Ni:Oi.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;d||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==r||c!==l)&&zo(t,s,r,l),ko=!1;var h=t.memoizedState;s.state=h,Fo(t,r,s,i),c=t.memoizedState,a!==r||h!==c||Ai.current||ko?("function"===typeof u&&(Bo(t,n,u,r),c=t.memoizedState),(a=ko||qo(t,n,a,r,h,c,l))?(d||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),s.props=r,s.state=c,s.context=l,r=a):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,Do(e,t),a=t.memoizedProps,l=t.type===t.elementType?a:_o(t.type,a),s.props=l,d=t.pendingProps,h=s.context,"object"===typeof(c=n.contextType)&&null!==c?c=Ro(c):c=ki(t,c=Pi(n)?Ni:Oi.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==d||h!==c)&&zo(t,s,r,c),ko=!1,h=t.memoizedState,s.state=h,Fo(t,r,s,i);var f=t.memoizedState;a!==d||h!==f||Ai.current||ko?("function"===typeof p&&(Bo(t,n,p,r),f=t.memoizedState),(l=ko||qo(t,n,l,r,h,f,c)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,f,c),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,f,c)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),s.props=r,s.state=f,s.context=c,r=l):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Aa(e,t,n,r,o,i)}function Aa(e,t,n,r,i,o){Ra(e,t);var s=0!==(128&t.flags);if(!r&&!s)return i&&Ui(t,n,!1),za(e,t,o);r=t.stateNode,va.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=Xo(t,e.child,null,o),t.child=Xo(t,null,a,o)):ba(e,t,a,o),t.memoizedState=r.state,i&&Ui(t,n,!0),t.child}function Na(e){var t=e.stateNode;t.pendingContext?Li(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Li(0,t.context,!1),is(e,t.containerInfo)}function ka(e,t,n,r,i){return fo(),mo(i),t.flags|=256,ba(e,t,n,r),t.child}var Pa,Da,La,xa,Ma={dehydrated:null,treeContext:null,retryLane:0};function Ua(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fa(e,t,n){var r,i=t.pendingProps,s=cs.current,a=!1,c=0!==(128&t.flags);if((r=c)||(r=(null===e||null!==e.memoizedState)&&0!==(2&s)),r?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Ri(cs,1&s),null===e)return lo(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=i.children,e=i.fallback,a?(i=t.mode,a=t.child,c={mode:"hidden",children:c},0===(1&i)&&null!==a?(a.childLanes=0,a.pendingProps=c):a=Ul(c,i,0,null),e=Ml(e,i,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Ua(n),t.memoizedState=Ma,e):ja(t,c));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,n,r,i,s,a){if(n)return 256&t.flags?(t.flags&=-257,Va(e,t,a,r=da(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,i=t.mode,r=Ul({mode:"visible",children:r.children},i,0,null),(s=Ml(s,i,a,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!==(1&t.mode)&&Xo(t,e.child,null,a),t.child.memoizedState=Ua(a),t.memoizedState=Ma,s);if(0===(1&t.mode))return Va(e,t,a,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var c=r.dgst;return r=c,Va(e,t,a,r=da(s=Error(o(419)),r,void 0))}if(c=0!==(a&e.childLanes),ya||c){if(null!==(r=Nc)){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|a))?0:i)&&i!==s.retryLane&&(s.retryLane=i,No(e,i),rl(r,e,i,-1))}return gl(),Va(e,t,a,r=da(Error(o(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Ol.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,ro=li(i.nextSibling),no=t,io=!0,oo=null,null!==e&&(Ki[Yi++]=Ji,Ki[Yi++]=Xi,Ki[Yi++]=Zi,Ji=e.id,Xi=e.overflow,Zi=t),t=ja(t,r.children),t.flags|=4096,t)}(e,t,c,i,r,s,n);if(a){a=i.fallback,c=t.mode,r=(s=e.child).sibling;var l={mode:"hidden",children:i.children};return 0===(1&c)&&t.child!==s?((i=t.child).childLanes=0,i.pendingProps=l,t.deletions=null):(i=Ll(s,l)).subtreeFlags=14680064&s.subtreeFlags,null!==r?a=Ll(r,a):(a=Ml(a,c,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,c=null===(c=e.child.memoizedState)?Ua(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},a.memoizedState=c,a.childLanes=e.childLanes&~n,t.memoizedState=Ma,i}return e=(a=e.child).sibling,i=Ll(a,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function ja(e,t){return(t=Ul({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Va(e,t,n,r){return null!==r&&mo(r),Xo(t,e.child,null,n),(e=ja(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ba(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),wo(e.return,t,n)}function Ga(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function qa(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(ba(e,t,r.children,n),0!==(2&(r=cs.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ba(e,n,t);else if(19===e.tag)Ba(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ri(cs,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ls(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Ga(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ls(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Ga(t,!0,n,null,o);break;case"together":Ga(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Wa(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function za(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Uc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Ll(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ll(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ha(e,t){if(!io)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ka(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ya(e,t,n){var r=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ka(t),null;case 1:case 17:return Pi(t.type)&&Di(),Ka(t),null;case 3:return r=t.stateNode,os(),Ci(Ai),Ci(Oi),ds(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(al(oo),oo=null))),Da(e,t),Ka(t),null;case 5:as(t);var i=rs(ns.current);if(n=t.type,null!==e&&null!=t.stateNode)La(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return Ka(t),null}if(e=rs(es.current),ho(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[hi]=t,r[pi]=s,e=0!==(1&t.mode),n){case"dialog":jr("cancel",r),jr("close",r);break;case"iframe":case"object":case"embed":jr("load",r);break;case"video":case"audio":for(i=0;i<xr.length;i++)jr(xr[i],r);break;case"source":jr("error",r);break;case"img":case"image":case"link":jr("error",r),jr("load",r);break;case"details":jr("toggle",r);break;case"input":J(r,s),jr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},jr("invalid",r);break;case"textarea":ie(r,s),jr("invalid",r)}for(var c in Ee(n,s),i=null,s)if(s.hasOwnProperty(c)){var l=s[c];"children"===c?"string"===typeof l?r.textContent!==l&&(!0!==s.suppressHydrationWarning&&Qr(r.textContent,l,e),i=["children",l]):"number"===typeof l&&r.textContent!==""+l&&(!0!==s.suppressHydrationWarning&&Qr(r.textContent,l,e),i=["children",""+l]):a.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&jr("scroll",r)}switch(n){case"input":H(r),$(r,s,!0);break;case"textarea":H(r),se(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=$r)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{c=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[hi]=t,e[pi]=r,Pa(e,t,!1,!1),t.stateNode=e;e:{switch(c=ve(n,r),n){case"dialog":jr("cancel",e),jr("close",e),i=r;break;case"iframe":case"object":case"embed":jr("load",e),i=r;break;case"video":case"audio":for(i=0;i<xr.length;i++)jr(xr[i],e);i=r;break;case"source":jr("error",e),i=r;break;case"img":case"image":case"link":jr("error",e),jr("load",e),i=r;break;case"details":jr("toggle",e),i=r;break;case"input":J(e,r),i=Z(e,r),jr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=U({},r,{value:void 0}),jr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),jr("invalid",e)}for(s in Ee(n,i),l=i)if(l.hasOwnProperty(s)){var u=l[s];"style"===s?ge(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===s?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(a.hasOwnProperty(s)?null!=u&&"onScroll"===s&&jr("scroll",e):null!=u&&v(e,s,u,c))}switch(n){case"input":H(e),$(e,r,!1);break;case"textarea":H(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+W(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ka(t),null;case 6:if(e&&null!=t.stateNode)xa(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));if(n=rs(ns.current),rs(es.current),ho(t)){if(r=t.stateNode,n=t.memoizedProps,r[hi]=t,(s=r.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Qr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qr(r.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hi]=t,t.stateNode=r}return Ka(t),null;case 13:if(Ci(cs),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(io&&null!==ro&&0!==(1&t.mode)&&0===(128&t.flags))po(),fo(),t.flags|=98560,s=!1;else if(s=ho(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(o(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(o(317));s[hi]=t}else fo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ka(t),s=!1}else null!==oo&&(al(oo),oo=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&cs.current)?0===xc&&(xc=3):gl())),null!==t.updateQueue&&(t.flags|=4),Ka(t),null);case 4:return os(),Da(e,t),null===e&&Gr(t.stateNode.containerInfo),Ka(t),null;case 10:return To(t.type._context),Ka(t),null;case 19:if(Ci(cs),null===(s=t.memoizedState))return Ka(t),null;if(r=0!==(128&t.flags),null===(c=s.rendering))if(r)Ha(s,!1);else{if(0!==xc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=ls(e))){for(t.flags|=128,Ha(s,!1),null!==(r=c.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(c=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,e=c.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ri(cs,1&cs.current|2),t.child}e=e.sibling}null!==s.tail&&Xe()>qc&&(t.flags|=128,r=!0,Ha(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ls(c))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ha(s,!0),null===s.tail&&"hidden"===s.tailMode&&!c.alternate&&!io)return Ka(t),null}else 2*Xe()-s.renderingStartTime>qc&&1073741824!==n&&(t.flags|=128,r=!0,Ha(s,!1),t.lanes=4194304);s.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=s.last)?n.sibling=c:t.child=c,s.last=c)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Xe(),t.sibling=null,n=cs.current,Ri(cs,r?1&n|2:1&n),t):(Ka(t),null);case 22:case 23:return hl(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Dc)&&(Ka(t),6&t.subtreeFlags&&(t.flags|=8192)):Ka(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Za(e,t){switch(to(t),t.tag){case 1:return Pi(t.type)&&Di(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return os(),Ci(Ai),Ci(Oi),ds(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return as(t),null;case 13:if(Ci(cs),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ci(cs),null;case 4:return os(),null;case 10:return To(t.type._context),null;case 22:case 23:return hl(),null;default:return null}}Pa=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Da=function(){},La=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,rs(es.current);var o,s=null;switch(n){case"input":i=Z(e,i),r=Z(e,r),s=[];break;case"select":i=U({},i,{value:void 0}),r=U({},r,{value:void 0}),s=[];break;case"textarea":i=re(e,i),r=re(e,r),s=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(u in Ee(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var c=i[u];for(o in c)c.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(c=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&l!==c&&(null!=l||null!=c))if("style"===u)if(c){for(o in c)!c.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&c[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(u,n)),n=l;else"dangerouslySetInnerHTML"===u?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(s=s||[]).push(u,l)):"children"===u?"string"!==typeof l&&"number"!==typeof l||(s=s||[]).push(u,""+l):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=l&&"onScroll"===u&&jr("scroll",e),s||c===l||(s=[])):(s=s||[]).push(u,l))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},xa=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ja=!1,Xa=!1,Qa="function"===typeof WeakSet?WeakSet:Set,$a=null;function ec(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Cl(e,t,r)}else n.current=null}function tc(e,t,n){try{n()}catch(r){Cl(e,t,r)}}var nc=!1;function rc(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&tc(t,n,o)}i=i.next}while(i!==r)}}function ic(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function oc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sc(e){var t=e.alternate;null!==t&&(e.alternate=null,sc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[pi],delete t[mi],delete t[gi],delete t[_i])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ac(e){return 5===e.tag||3===e.tag||4===e.tag}function cc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ac(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function lc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}function uc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(uc(e,t,n),e=e.sibling;null!==e;)uc(e,t,n),e=e.sibling}var dc=null,hc=!1;function pc(e,t,n){for(n=n.child;null!==n;)fc(e,t,n),n=n.sibling}function fc(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(it,n)}catch(a){}switch(n.tag){case 5:Xa||ec(n,t);case 6:var r=dc,i=hc;dc=null,pc(e,t,n),hc=i,null!==(dc=r)&&(hc?(e=dc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dc.removeChild(n.stateNode));break;case 18:null!==dc&&(hc?(e=dc,n=n.stateNode,8===e.nodeType?ci(e.parentNode,n):1===e.nodeType&&ci(e,n),Gt(e)):ci(dc,n.stateNode));break;case 4:r=dc,i=hc,dc=n.stateNode.containerInfo,hc=!0,pc(e,t,n),dc=r,hc=i;break;case 0:case 11:case 14:case 15:if(!Xa&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,void 0!==s&&(0!==(2&o)||0!==(4&o))&&tc(n,t,s),i=i.next}while(i!==r)}pc(e,t,n);break;case 1:if(!Xa&&(ec(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Cl(n,t,a)}pc(e,t,n);break;case 21:pc(e,t,n);break;case 22:1&n.mode?(Xa=(r=Xa)||null!==n.memoizedState,pc(e,t,n),Xa=r):pc(e,t,n);break;default:pc(e,t,n)}}function mc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qa),t.forEach((function(t){var r=Al.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function gc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e,a=t,c=a;e:for(;null!==c;){switch(c.tag){case 5:dc=c.stateNode,hc=!1;break e;case 3:case 4:dc=c.stateNode.containerInfo,hc=!0;break e}c=c.return}if(null===dc)throw Error(o(160));fc(s,a,i),dc=null,hc=!1;var l=i.alternate;null!==l&&(l.return=null),i.return=null}catch(u){Cl(i,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)_c(t,e),t=t.sibling}function _c(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gc(t,e),Ec(e),4&r){try{rc(3,e,e.return),ic(3,e)}catch(g){Cl(e,e.return,g)}try{rc(5,e,e.return)}catch(g){Cl(e,e.return,g)}}break;case 1:gc(t,e),Ec(e),512&r&&null!==n&&ec(n,n.return);break;case 5:if(gc(t,e),Ec(e),512&r&&null!==n&&ec(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(g){Cl(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var s=e.memoizedProps,a=null!==n?n.memoizedProps:s,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===s.type&&null!=s.name&&X(i,s),ve(c,a);var u=ve(c,s);for(a=0;a<l.length;a+=2){var d=l[a],h=l[a+1];"style"===d?ge(i,h):"dangerouslySetInnerHTML"===d?de(i,h):"children"===d?he(i,h):v(i,d,h,u)}switch(c){case"input":Q(i,s);break;case"textarea":oe(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?ne(i,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ne(i,!!s.multiple,s.defaultValue,!0):ne(i,!!s.multiple,s.multiple?[]:"",!1))}i[pi]=s}catch(g){Cl(e,e.return,g)}}break;case 6:if(gc(t,e),Ec(e),4&r){if(null===e.stateNode)throw Error(o(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(g){Cl(e,e.return,g)}}break;case 3:if(gc(t,e),Ec(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(g){Cl(e,e.return,g)}break;case 4:default:gc(t,e),Ec(e);break;case 13:gc(t,e),Ec(e),8192&(i=e.child).flags&&(s=null!==i.memoizedState,i.stateNode.isHidden=s,!s||null!==i.alternate&&null!==i.alternate.memoizedState||(Gc=Xe())),4&r&&mc(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Xa=(u=Xa)||d,gc(t,e),Xa=u):gc(t,e),Ec(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for($a=e,d=e.child;null!==d;){for(h=$a=d;null!==$a;){switch(f=(p=$a).child,p.tag){case 0:case 11:case 14:case 15:rc(4,p,p.return);break;case 1:ec(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){r=p,n=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Cl(r,n,g)}}break;case 5:ec(p,p.return);break;case 22:if(null!==p.memoizedState){Sc(h);continue}}null!==f?(f.return=p,$a=f):Sc(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{i=h.stateNode,u?"function"===typeof(s=i.style).setProperty?s.setProperty("display","none","important"):s.display="none":(c=h.stateNode,a=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=me("display",a))}catch(g){Cl(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){Cl(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gc(t,e),Ec(e),4&r&&mc(e);case 21:}}function Ec(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ac(n)){var r=n;break e}n=n.return}throw Error(o(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(he(i,""),r.flags&=-33),uc(e,cc(e),i);break;case 3:case 4:var s=r.stateNode.containerInfo;lc(e,cc(e),s);break;default:throw Error(o(161))}}catch(a){Cl(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vc(e,t,n){$a=e,yc(e,t,n)}function yc(e,t,n){for(var r=0!==(1&e.mode);null!==$a;){var i=$a,o=i.child;if(22===i.tag&&r){var s=null!==i.memoizedState||Ja;if(!s){var a=i.alternate,c=null!==a&&null!==a.memoizedState||Xa;a=Ja;var l=Xa;if(Ja=s,(Xa=c)&&!l)for($a=i;null!==$a;)c=(s=$a).child,22===s.tag&&null!==s.memoizedState?Tc(i):null!==c?(c.return=s,$a=c):Tc(i);for(;null!==o;)$a=o,yc(o,t,n),o=o.sibling;$a=i,Ja=a,Xa=l}bc(e)}else 0!==(8772&i.subtreeFlags)&&null!==o?(o.return=i,$a=o):bc(e)}}function bc(e){for(;null!==$a;){var t=$a;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Xa||ic(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Xa)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:_o(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&jo(t,s,r);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}jo(t,a,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Gt(h)}}}break;default:throw Error(o(163))}Xa||512&t.flags&&oc(t)}catch(p){Cl(t,t.return,p)}}if(t===e){$a=null;break}if(null!==(n=t.sibling)){n.return=t.return,$a=n;break}$a=t.return}}function Sc(e){for(;null!==$a;){var t=$a;if(t===e){$a=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$a=n;break}$a=t.return}}function Tc(e){for(;null!==$a;){var t=$a;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ic(4,t)}catch(c){Cl(t,n,c)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(c){Cl(t,i,c)}}var o=t.return;try{oc(t)}catch(c){Cl(t,o,c)}break;case 5:var s=t.return;try{oc(t)}catch(c){Cl(t,s,c)}}}catch(c){Cl(t,t.return,c)}if(t===e){$a=null;break}var a=t.sibling;if(null!==a){a.return=t.return,$a=a;break}$a=t.return}}var wc,Cc=Math.ceil,Rc=y.ReactCurrentDispatcher,Ic=y.ReactCurrentOwner,Oc=y.ReactCurrentBatchConfig,Ac=0,Nc=null,kc=null,Pc=0,Dc=0,Lc=wi(0),xc=0,Mc=null,Uc=0,Fc=0,jc=0,Vc=null,Bc=null,Gc=0,qc=1/0,Wc=null,zc=!1,Hc=null,Kc=null,Yc=!1,Zc=null,Jc=0,Xc=0,Qc=null,$c=-1,el=0;function tl(){return 0!==(6&Ac)?Xe():-1!==$c?$c:$c=Xe()}function nl(e){return 0===(1&e.mode)?1:0!==(2&Ac)&&0!==Pc?Pc&-Pc:null!==go.transition?(0===el&&(el=mt()),el):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function rl(e,t,n,r){if(50<Xc)throw Xc=0,Qc=null,Error(o(185));_t(e,n,r),0!==(2&Ac)&&e===Nc||(e===Nc&&(0===(2&Ac)&&(Fc|=n),4===xc&&cl(e,Pc)),il(e,r),1===n&&0===Ac&&0===(1&t.mode)&&(qc=Xe()+500,ji&&Gi()))}function il(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-st(o),a=1<<s,c=i[s];-1===c?0!==(a&n)&&0===(a&r)||(i[s]=pt(a,t)):c<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var r=ht(e,e===Nc?Pc:0);if(0===r)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){ji=!0,Bi(e)}(ll.bind(null,e)):Bi(ll.bind(null,e)),si((function(){0===(6&Ac)&&Gi()})),n=null;else{switch(yt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Nl(n,ol.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ol(e,t){if($c=-1,el=0,0!==(6&Ac))throw Error(o(327));var n=e.callbackNode;if(Tl()&&e.callbackNode!==n)return null;var r=ht(e,e===Nc?Pc:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=_l(e,r);else{t=r;var i=Ac;Ac|=2;var s=ml();for(Nc===e&&Pc===t||(Wc=null,qc=Xe()+500,pl(e,t));;)try{vl();break}catch(c){fl(e,c)}So(),Rc.current=s,Ac=i,null!==kc?t=0:(Nc=null,Pc=0,t=xc)}if(0!==t){if(2===t&&(0!==(i=ft(e))&&(r=i,t=sl(e,i))),1===t)throw n=Mc,pl(e,0),cl(e,r),il(e,Xe()),n;if(6===t)cl(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!ar(o(),i))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=_l(e,r))&&(0!==(s=ft(e))&&(r=s,t=sl(e,s))),1===t))throw n=Mc,pl(e,0),cl(e,r),il(e,Xe()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:Sl(e,Bc,Wc);break;case 3:if(cl(e,r),(130023424&r)===r&&10<(t=Gc+500-Xe())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&r)!==r){tl(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(Sl.bind(null,e,Bc,Wc),t);break}Sl(e,Bc,Wc);break;case 4:if(cl(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var a=31-st(r);s=1<<a,(a=t[a])>i&&(i=a),r&=~s}if(r=i,10<(r=(120>(r=Xe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Cc(r/1960))-r)){e.timeoutHandle=ri(Sl.bind(null,e,Bc,Wc),r);break}Sl(e,Bc,Wc);break;default:throw Error(o(329))}}}return il(e,Xe()),e.callbackNode===n?ol.bind(null,e):null}function sl(e,t){var n=Vc;return e.current.memoizedState.isDehydrated&&(pl(e,t).flags|=256),2!==(e=_l(e,t))&&(t=Bc,Bc=n,null!==t&&al(t)),e}function al(e){null===Bc?Bc=e:Bc.push.apply(Bc,e)}function cl(e,t){for(t&=~jc,t&=~Fc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function ll(e){if(0!==(6&Ac))throw Error(o(327));Tl();var t=ht(e,0);if(0===(1&t))return il(e,Xe()),null;var n=_l(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=sl(e,r))}if(1===n)throw n=Mc,pl(e,0),cl(e,t),il(e,Xe()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sl(e,Bc,Wc),il(e,Xe()),null}function ul(e,t){var n=Ac;Ac|=1;try{return e(t)}finally{0===(Ac=n)&&(qc=Xe()+500,ji&&Gi())}}function dl(e){null!==Zc&&0===Zc.tag&&0===(6&Ac)&&Tl();var t=Ac;Ac|=1;var n=Oc.transition,r=vt;try{if(Oc.transition=null,vt=1,e)return e()}finally{vt=r,Oc.transition=n,0===(6&(Ac=t))&&Gi()}}function hl(){Dc=Lc.current,Ci(Lc)}function pl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==kc)for(n=kc.return;null!==n;){var r=n;switch(to(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Di();break;case 3:os(),Ci(Ai),Ci(Oi),ds();break;case 5:as(r);break;case 4:os();break;case 13:case 19:Ci(cs);break;case 10:To(r.type._context);break;case 22:case 23:hl()}n=n.return}if(Nc=e,kc=e=Ll(e.current,null),Pc=Dc=t,xc=0,Mc=null,jc=Fc=Uc=0,Bc=Vc=null,null!==Io){for(t=0;t<Io.length;t++)if(null!==(r=(n=Io[t]).interleaved)){n.interleaved=null;var i=r.next,o=n.pending;if(null!==o){var s=o.next;o.next=i,r.next=s}n.pending=r}Io=null}return e}function fl(e,t){for(;;){var n=kc;try{if(So(),hs.current=sa,Es){for(var r=ms.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}Es=!1}if(fs=0,_s=gs=ms=null,vs=!1,ys=0,Ic.current=null,null===n||null===n.return){xc=1,Mc=t,kc=null;break}e:{var s=e,a=n.return,c=n,l=t;if(t=Pc,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var u=l,d=c,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=_a(a);if(null!==f){f.flags&=-257,Ea(f,a,c,0,t),1&f.mode&&ga(s,u,t),l=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(l),t.updateQueue=g}else m.add(l);break e}if(0===(1&t)){ga(s,u,t),gl();break e}l=Error(o(426))}else if(io&&1&c.mode){var _=_a(a);if(null!==_){0===(65536&_.flags)&&(_.flags|=256),Ea(_,a,c,0,t),mo(ua(l,c));break e}}s=l=ua(l,c),4!==xc&&(xc=2),null===Vc?Vc=[s]:Vc.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Uo(s,fa(0,l,t));break e;case 1:c=l;var E=s.type,v=s.stateNode;if(0===(128&s.flags)&&("function"===typeof E.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===Kc||!Kc.has(v)))){s.flags|=65536,t&=-t,s.lanes|=t,Uo(s,ma(s,c,t));break e}}s=s.return}while(null!==s)}bl(n)}catch(y){t=y,kc===n&&null!==n&&(kc=n=n.return);continue}break}}function ml(){var e=Rc.current;return Rc.current=sa,null===e?sa:e}function gl(){0!==xc&&3!==xc&&2!==xc||(xc=4),null===Nc||0===(268435455&Uc)&&0===(268435455&Fc)||cl(Nc,Pc)}function _l(e,t){var n=Ac;Ac|=2;var r=ml();for(Nc===e&&Pc===t||(Wc=null,pl(e,t));;)try{El();break}catch(i){fl(e,i)}if(So(),Ac=n,Rc.current=r,null!==kc)throw Error(o(261));return Nc=null,Pc=0,xc}function El(){for(;null!==kc;)yl(kc)}function vl(){for(;null!==kc&&!Ze();)yl(kc)}function yl(e){var t=wc(e.alternate,e,Dc);e.memoizedProps=e.pendingProps,null===t?bl(e):kc=t,Ic.current=null}function bl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ya(n,t,Dc)))return void(kc=n)}else{if(null!==(n=Za(n,t)))return n.flags&=32767,void(kc=n);if(null===e)return xc=6,void(kc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(kc=t);kc=t=e}while(null!==t);0===xc&&(xc=5)}function Sl(e,t,n){var r=vt,i=Oc.transition;try{Oc.transition=null,vt=1,function(e,t,n,r){do{Tl()}while(null!==Zc);if(0!==(6&Ac))throw Error(o(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-st(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}(e,s),e===Nc&&(kc=Nc=null,Pc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Yc||(Yc=!0,Nl(tt,(function(){return Tl(),null}))),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=Oc.transition,Oc.transition=null;var a=vt;vt=1;var c=Ac;Ac|=4,Ic.current=null,function(e,t){if(ei=Wt,pr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(b){n=null;break e}var a=0,c=-1,l=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==i&&3!==h.nodeType||(c=a+i),h!==s||0!==r&&3!==h.nodeType||(l=a+r),3===h.nodeType&&(a+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++u===i&&(c=a),p===s&&++d===r&&(l=a),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Wt=!1,$a=t;null!==$a;)if(e=(t=$a).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$a=e;else for(;null!==$a;){t=$a;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,_=m.memoizedState,E=t.stateNode,v=E.getSnapshotBeforeUpdate(t.elementType===t.type?g:_o(t.type,g),_);E.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=t.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(o(163))}}catch(b){Cl(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,$a=e;break}$a=t.return}m=nc,nc=!1}(e,n),_c(n,e),fr(ti),Wt=!!ei,ti=ei=null,e.current=n,vc(n,e,i),Je(),Ac=c,vt=a,Oc.transition=s}else e.current=n;if(Yc&&(Yc=!1,Zc=e,Jc=i),s=e.pendingLanes,0===s&&(Kc=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),il(e,Xe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(zc)throw zc=!1,e=Hc,Hc=null,e;0!==(1&Jc)&&0!==e.tag&&Tl(),s=e.pendingLanes,0!==(1&s)?e===Qc?Xc++:(Xc=0,Qc=e):Xc=0,Gi()}(e,t,n,r)}finally{Oc.transition=i,vt=r}return null}function Tl(){if(null!==Zc){var e=yt(Jc),t=Oc.transition,n=vt;try{if(Oc.transition=null,vt=16>e?16:e,null===Zc)var r=!1;else{if(e=Zc,Zc=null,Jc=0,0!==(6&Ac))throw Error(o(331));var i=Ac;for(Ac|=4,$a=e.current;null!==$a;){var s=$a,a=s.child;if(0!==(16&$a.flags)){var c=s.deletions;if(null!==c){for(var l=0;l<c.length;l++){var u=c[l];for($a=u;null!==$a;){var d=$a;switch(d.tag){case 0:case 11:case 15:rc(8,d,s)}var h=d.child;if(null!==h)h.return=d,$a=h;else for(;null!==$a;){var p=(d=$a).sibling,f=d.return;if(sc(d),d===u){$a=null;break}if(null!==p){p.return=f,$a=p;break}$a=f}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var _=g.sibling;g.sibling=null,g=_}while(null!==g)}}$a=s}}if(0!==(2064&s.subtreeFlags)&&null!==a)a.return=s,$a=a;else e:for(;null!==$a;){if(0!==(2048&(s=$a).flags))switch(s.tag){case 0:case 11:case 15:rc(9,s,s.return)}var E=s.sibling;if(null!==E){E.return=s.return,$a=E;break e}$a=s.return}}var v=e.current;for($a=v;null!==$a;){var y=(a=$a).child;if(0!==(2064&a.subtreeFlags)&&null!==y)y.return=a,$a=y;else e:for(a=v;null!==$a;){if(0!==(2048&(c=$a).flags))try{switch(c.tag){case 0:case 11:case 15:ic(9,c)}}catch(S){Cl(c,c.return,S)}if(c===a){$a=null;break e}var b=c.sibling;if(null!==b){b.return=c.return,$a=b;break e}$a=c.return}}if(Ac=i,Gi(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(it,e)}catch(S){}r=!0}return r}finally{vt=n,Oc.transition=t}}return!1}function wl(e,t,n){e=xo(e,t=fa(0,t=ua(n,t),1),1),t=tl(),null!==e&&(_t(e,1,t),il(e,t))}function Cl(e,t,n){if(3===e.tag)wl(e,e,n);else for(;null!==t;){if(3===t.tag){wl(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Kc||!Kc.has(r))){t=xo(t,e=ma(t,e=ua(n,e),1),1),e=tl(),null!==t&&(_t(t,1,e),il(t,e));break}}t=t.return}}function Rl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tl(),e.pingedLanes|=e.suspendedLanes&n,Nc===e&&(Pc&n)===n&&(4===xc||3===xc&&(130023424&Pc)===Pc&&500>Xe()-Gc?pl(e,0):jc|=n),il(e,t)}function Il(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=tl();null!==(e=No(e,t))&&(_t(e,t,n),il(e,n))}function Ol(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Il(e,n)}function Al(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),Il(e,n)}function Nl(e,t){return Ke(e,t)}function kl(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pl(e,t,n,r){return new kl(e,t,n,r)}function Dl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ll(e,t){var n=e.alternate;return null===n?((n=Pl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function xl(e,t,n,r,i,s){var a=2;if(r=e,"function"===typeof e)Dl(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case T:return Ml(n.children,i,s,t);case w:a=8,i|=8;break;case C:return(e=Pl(12,n,t,2|i)).elementType=C,e.lanes=s,e;case A:return(e=Pl(13,n,t,i)).elementType=A,e.lanes=s,e;case N:return(e=Pl(19,n,t,i)).elementType=N,e.lanes=s,e;case D:return Ul(n,i,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case R:a=10;break e;case I:a=9;break e;case O:a=11;break e;case k:a=14;break e;case P:a=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Pl(a,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function Ml(e,t,n,r){return(e=Pl(7,e,r,t)).lanes=n,e}function Ul(e,t,n,r){return(e=Pl(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Fl(e,t,n){return(e=Pl(6,e,null,t)).lanes=n,e}function jl(e,t,n){return(t=Pl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Vl(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Bl(e,t,n,r,i,o,s,a,c){return e=new Vl(e,t,n,a,c),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Pl(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Po(o),e}function Gl(e){if(!e)return Ii;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Pi(n))return xi(e,n,t)}return t}function ql(e,t,n,r,i,o,s,a,c){return(e=Bl(n,r,!0,e,0,o,0,a,c)).context=Gl(null),n=e.current,(o=Lo(r=tl(),i=nl(n))).callback=void 0!==t&&null!==t?t:null,xo(n,o,i),e.current.lanes=i,_t(e,i,r),il(e,r),e}function Wl(e,t,n,r){var i=t.current,o=tl(),s=nl(i);return n=Gl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Lo(o,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=xo(i,t,s))&&(rl(e,i,s,o),Mo(e,i,s)),s}function zl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Kl(e,t){Hl(e,t),(e=e.alternate)&&Hl(e,t)}wc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ai.current)ya=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ya=!1,function(e,t,n){switch(t.tag){case 3:Na(t),fo();break;case 5:ss(t);break;case 1:Pi(t.type)&&Mi(t);break;case 4:is(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ri(Eo,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ri(cs,1&cs.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fa(e,t,n):(Ri(cs,1&cs.current),null!==(e=za(e,t,n))?e.sibling:null);Ri(cs,1&cs.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return qa(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ri(cs,cs.current),r)break;return null;case 22:case 23:return t.lanes=0,Ca(e,t,n)}return za(e,t,n)}(e,t,n);ya=0!==(131072&e.flags)}else ya=!1,io&&0!==(1048576&t.flags)&&$i(t,Hi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Wa(e,t),e=t.pendingProps;var i=ki(t,Oi.current);Co(t,n),i=ws(null,t,r,e,i,n);var s=Cs();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pi(r)?(s=!0,Mi(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Po(t),i.updater=Go,t.stateNode=i,i._reactInternals=t,Ho(t,r,e,n),t=Aa(null,t,r,!0,s,n)):(t.tag=0,io&&s&&eo(t),ba(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Wa(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Dl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===O)return 11;if(e===k)return 14}return 2}(r),e=_o(r,e),i){case 0:t=Ia(null,t,r,e,n);break e;case 1:t=Oa(null,t,r,e,n);break e;case 11:t=Sa(null,t,r,e,n);break e;case 14:t=Ta(null,t,r,_o(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ia(e,t,r,i=t.elementType===r?i:_o(r,i),n);case 1:return r=t.type,i=t.pendingProps,Oa(e,t,r,i=t.elementType===r?i:_o(r,i),n);case 3:e:{if(Na(t),null===e)throw Error(o(387));r=t.pendingProps,i=(s=t.memoizedState).element,Do(e,t),Fo(t,r,null,n);var a=t.memoizedState;if(r=a.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=ka(e,t,r,n,i=ua(Error(o(423)),t));break e}if(r!==i){t=ka(e,t,r,n,i=ua(Error(o(424)),t));break e}for(ro=li(t.stateNode.containerInfo.firstChild),no=t,io=!0,oo=null,n=Qo(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fo(),r===i){t=za(e,t,n);break e}ba(e,t,r,n)}t=t.child}return t;case 5:return ss(t),null===e&&lo(t),r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,a=i.children,ni(r,i)?a=null:null!==s&&ni(r,s)&&(t.flags|=32),Ra(e,t),ba(e,t,a,n),t.child;case 6:return null===e&&lo(t),null;case 13:return Fa(e,t,n);case 4:return is(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Xo(t,null,r,n):ba(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Sa(e,t,r,i=t.elementType===r?i:_o(r,i),n);case 7:return ba(e,t,t.pendingProps,n),t.child;case 8:case 12:return ba(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value,Ri(Eo,r._currentValue),r._currentValue=a,null!==s)if(ar(s.value,a)){if(s.children===i.children&&!Ai.current){t=za(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var c=s.dependencies;if(null!==c){a=s.child;for(var l=c.firstContext;null!==l;){if(l.context===r){if(1===s.tag){(l=Lo(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),wo(s.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),wo(a,n,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}ba(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Co(t,n),r=r(i=Ro(i)),t.flags|=1,ba(e,t,r,n),t.child;case 14:return i=_o(r=t.type,t.pendingProps),Ta(e,t,r,i=_o(r.type,i),n);case 15:return wa(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:_o(r,i),Wa(e,t),t.tag=1,Pi(r)?(e=!0,Mi(t)):e=!1,Co(t,n),Wo(t,r,i),Ho(t,r,i,n),Aa(null,t,r,!0,e,n);case 19:return qa(e,t,n);case 22:return Ca(e,t,n)}throw Error(o(156,t.tag))};var Yl="function"===typeof reportError?reportError:function(e){console.error(e)};function Zl(e){this._internalRoot=e}function Jl(e){this._internalRoot=e}function Xl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Ql(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $l(){}function eu(e,t,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if("function"===typeof i){var a=i;i=function(){var e=zl(s);a.call(e)}}Wl(t,s,e,i)}else s=function(e,t,n,r,i){if(i){if("function"===typeof r){var o=r;r=function(){var e=zl(s);o.call(e)}}var s=ql(t,r,e,0,null,!1,0,"",$l);return e._reactRootContainer=s,e[fi]=s.current,Gr(8===e.nodeType?e.parentNode:e),dl(),s}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var a=r;r=function(){var e=zl(c);a.call(e)}}var c=Bl(e,0,!1,null,0,!1,0,"",$l);return e._reactRootContainer=c,e[fi]=c.current,Gr(8===e.nodeType?e.parentNode:e),dl((function(){Wl(t,c,n,r)})),c}(n,t,e,i,r);return zl(s)}Jl.prototype.render=Zl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Wl(e,t,null,null)},Jl.prototype.unmount=Zl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dl((function(){Wl(null,e,null,null)})),t[fi]=null}},Jl.prototype.unstable_scheduleHydration=function(e){if(e){var t=wt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Ut(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(Et(t,1|n),il(t,Xe()),0===(6&Ac)&&(qc=Xe()+500,Gi()))}break;case 13:dl((function(){var t=No(e,1);if(null!==t){var n=tl();rl(t,e,1,n)}})),Kl(e,1)}},St=function(e){if(13===e.tag){var t=No(e,134217728);if(null!==t)rl(t,e,134217728,tl());Kl(e,134217728)}},Tt=function(e){if(13===e.tag){var t=nl(e),n=No(e,t);if(null!==n)rl(n,e,t,tl());Kl(e,t)}},wt=function(){return vt},Ct=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}},Se=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=bi(r);if(!i)throw Error(o(90));K(r),Q(r,i)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Oe=ul,Ae=dl;var tu={usingClientEntryPoint:!1,Events:[vi,yi,bi,Re,Ie,ul]},nu={findFiberByHostInstance:Ei,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ru={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=ze(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{it=iu.inject(ru),ot=iu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xl(t))throw Error(o(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Xl(e))throw Error(o(299));var n=!1,r="",i=Yl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Bl(e,1,!1,null,0,n,0,r,i),e[fi]=t.current,Gr(8===e.nodeType?e.parentNode:e),new Zl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=ze(t))?null:e.stateNode},t.flushSync=function(e){return dl(e)},t.hydrate=function(e,t,n){if(!Ql(t))throw Error(o(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Xl(e))throw Error(o(405));var r=null!=n&&n.hydratedSources||null,i=!1,s="",a=Yl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=ql(t,null,e,1,null!=n?n:null,i,0,s,a),e[fi]=t.current,Gr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Jl(t)},t.render=function(e,t,n){if(!Ql(t))throw Error(o(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Ql(e))throw Error(o(40));return!!e._reactRootContainer&&(dl((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[fi]=null}))})),!0)},t.unstable_batchedUpdates=ul,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Ql(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return eu(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},1250:(e,t,n)=>{"use strict";var r=n(4164);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},4164:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4463)},7211:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isNative=void 0;var n="undefined"!==typeof window&&(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition);t.isNative=function(e){return e===n};var r=n;t.default=r},4019:(e,t,n)=>{"use strict";var r=n(4687);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,o=(i=n(7833))&&i.__esModule?i:{default:i},s=n(1081),a=n(7211);function c(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(l){return void n(l)}a.done?t(c):Promise.resolve(c).then(r,i)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function s(e){c(o,r,i,s,a,"next",e)}function a(e){c(o,r,i,s,a,"throw",e)}s(void 0)}))}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.recognition=null,this.pauseAfterDisconnect=!1,this.interimTranscript="",this.finalTranscript="",this.listening=!1,this.isMicrophoneAvailable=!0,this.subscribers={},this.onStopListening=function(){},this.previousResultWasFinalOnly=!1,this.resetTranscript=this.resetTranscript.bind(this),this.startListening=this.startListening.bind(this),this.stopListening=this.stopListening.bind(this),this.abortListening=this.abortListening.bind(this),this.setSpeechRecognition=this.setSpeechRecognition.bind(this),this.disableRecognition=this.disableRecognition.bind(this),this.setSpeechRecognition(t),(0,o.default)()&&(this.updateFinalTranscript=(0,s.debounce)(this.updateFinalTranscript,250,!0))}var t,n,i;return t=e,n=[{key:"setSpeechRecognition",value:function(e){var t=!!e&&((0,a.isNative)(e)||(0,s.browserSupportsPolyfills)());t&&(this.disableRecognition(),this.recognition=new e,this.recognition.continuous=!1,this.recognition.interimResults=!0,this.recognition.onresult=this.updateTranscript.bind(this),this.recognition.onend=this.onRecognitionDisconnect.bind(this),this.recognition.onerror=this.onError.bind(this)),this.emitBrowserSupportsSpeechRecognitionChange(t)}},{key:"subscribe",value:function(e,t){this.subscribers[e]=t}},{key:"unsubscribe",value:function(e){delete this.subscribers[e]}},{key:"emitListeningChange",value:function(e){var t=this;this.listening=e,Object.keys(this.subscribers).forEach((function(n){(0,t.subscribers[n].onListeningChange)(e)}))}},{key:"emitMicrophoneAvailabilityChange",value:function(e){var t=this;this.isMicrophoneAvailable=e,Object.keys(this.subscribers).forEach((function(n){(0,t.subscribers[n].onMicrophoneAvailabilityChange)(e)}))}},{key:"emitTranscriptChange",value:function(e,t){var n=this;Object.keys(this.subscribers).forEach((function(r){(0,n.subscribers[r].onTranscriptChange)(e,t)}))}},{key:"emitClearTranscript",value:function(){var e=this;Object.keys(this.subscribers).forEach((function(t){(0,e.subscribers[t].onClearTranscript)()}))}},{key:"emitBrowserSupportsSpeechRecognitionChange",value:function(e){var t=this;Object.keys(this.subscribers).forEach((function(n){var r=t.subscribers[n],i=r.onBrowserSupportsSpeechRecognitionChange,o=r.onBrowserSupportsContinuousListeningChange;i(e),o(e)}))}},{key:"disconnect",value:function(e){if(this.recognition&&this.listening)switch(e){case"ABORT":this.pauseAfterDisconnect=!0,this.abort();break;case"RESET":this.pauseAfterDisconnect=!1,this.abort();break;default:this.pauseAfterDisconnect=!0,this.stop()}}},{key:"disableRecognition",value:function(){this.recognition&&(this.recognition.onresult=function(){},this.recognition.onend=function(){},this.recognition.onerror=function(){},this.listening&&this.stopListening())}},{key:"onError",value:function(e){e&&e.error&&"not-allowed"===e.error&&(this.emitMicrophoneAvailabilityChange(!1),this.disableRecognition())}},{key:"onRecognitionDisconnect",value:function(){this.onStopListening(),this.listening=!1,this.pauseAfterDisconnect?this.emitListeningChange(!1):this.recognition&&(this.recognition.continuous?this.startListening({continuous:this.recognition.continuous}):this.emitListeningChange(!1)),this.pauseAfterDisconnect=!1}},{key:"updateTranscript",value:function(e){var t=e.results,n=e.resultIndex,r=void 0===n?t.length-1:n;this.interimTranscript="",this.finalTranscript="";for(var i=r;i<t.length;++i)t[i].isFinal&&(!(0,o.default)()||t[i][0].confidence>0)?this.updateFinalTranscript(t[i][0].transcript):this.interimTranscript=(0,s.concatTranscripts)(this.interimTranscript,t[i][0].transcript);var a=!1;""===this.interimTranscript&&""!==this.finalTranscript?(this.previousResultWasFinalOnly&&(a=!0),this.previousResultWasFinalOnly=!0):this.previousResultWasFinalOnly=!1,a||this.emitTranscriptChange(this.interimTranscript,this.finalTranscript)}},{key:"updateFinalTranscript",value:function(e){this.finalTranscript=(0,s.concatTranscripts)(this.finalTranscript,e)}},{key:"resetTranscript",value:function(){this.disconnect("RESET")}},{key:"startListening",value:function(){var e=l(r.mark((function e(){var t,n,i,o,s,a,c=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=c.length>0&&void 0!==c[0]?c[0]:{}).continuous,i=void 0!==n&&n,o=t.language,this.recognition){e.next=3;break}return e.abrupt("return");case 3:if(s=i!==this.recognition.continuous,a=o&&o!==this.recognition.lang,!s&&!a){e.next=11;break}if(!this.listening){e.next=9;break}return e.next=9,this.stopListening();case 9:this.recognition.continuous=s?i:this.recognition.continuous,this.recognition.lang=a?o:this.recognition.lang;case 11:if(this.listening){e.next=22;break}return this.recognition.continuous||(this.resetTranscript(),this.emitClearTranscript()),e.prev=13,e.next=16,this.start();case 16:this.emitListeningChange(!0),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(13),e.t0 instanceof DOMException||this.emitMicrophoneAvailabilityChange(!1);case 22:case"end":return e.stop()}}),e,this,[[13,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"abortListening",value:function(){var e=l(r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.disconnect("ABORT"),this.emitListeningChange(!1),e.next=4,new Promise((function(e){t.onStopListening=e}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopListening",value:function(){var e=l(r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.disconnect("STOP"),this.emitListeningChange(!1),e.next=4,new Promise((function(e){t.onStopListening=e}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRecognition",value:function(){return this.recognition}},{key:"start",value:function(){var e=l(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.recognition||this.listening){e.next=4;break}return e.next=3,this.recognition.start();case 3:this.listening=!0;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.recognition&&this.listening&&(this.recognition.stop(),this.listening=!1)}},{key:"abort",value:function(){this.recognition&&this.listening&&(this.recognition.abort(),this.listening=!1)}}],n&&u(t.prototype,n),i&&u(t,i),e}();t.default=d},6212:(e,t,n)=>{"use strict";var r=n(4687);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.useSpeechRecognition=void 0;var i=n(2791),o=n(1081),s=n(2550),a=n(5453),c=d(n(4019)),l=d(n(7833)),u=d(n(7211));function d(e){return e&&e.__esModule?e:{default:e}}function h(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(l){return void n(l)}a.done?t(c):Promise.resolve(c).then(r,i)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function s(e){h(o,r,i,s,a,"next",e)}function a(e){h(o,r,i,s,a,"throw",e)}s(void 0)}))}}function f(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||_(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){return m="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(c){i=!0,o=c}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(e,t)||_(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){if(e){if("string"===typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var v,y=!!u.default,b=y&&!(0,l.default)();t.useSpeechRecognition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.transcribing,n=void 0===t||t,r=e.clearTranscriptOnListen,c=void 0===r||r,l=e.commands,u=void 0===l?[]:l,d=g((0,i.useState)(S.getRecognitionManager()),1)[0],h=g((0,i.useState)(y),2),p=h[0],_=h[1],E=g((0,i.useState)(b),2),v=E[0],T=E[1],w=g((0,i.useReducer)(a.transcriptReducer,{interimTranscript:d.interimTranscript,finalTranscript:""}),2),C=w[0],R=C.interimTranscript,I=C.finalTranscript,O=w[1],A=g((0,i.useState)(d.listening),2),N=A[0],k=A[1],P=g((0,i.useState)(d.isMicrophoneAvailable),2),D=P[0],L=P[1],x=(0,i.useRef)(u);x.current=u;var M=function(){O((0,s.clearTranscript)())},U=(0,i.useCallback)((function(){d.resetTranscript(),M()}),[d]),F=(0,i.useCallback)((function(e,t){x.current.forEach((function(n){var r=n.command,i=n.callback,s=n.matchInterim,a=void 0!==s&&s,c=n.isFuzzyMatch,l=void 0!==c&&c,u=n.fuzzyMatchingThreshold,d=void 0===u?.8:u,h=n.bestMatchOnly,p=void 0!==h&&h,g=!t&&a?e.trim():t.trim(),_=(Array.isArray(r)?r:[r]).map((function(e){return l?function(e,t,n){var r=("object"===m(e)?e.toString():e).replace(/[&/\\#,+()!$~%.'":*?<>{}]/g,"").replace(/  +/g," ").trim(),i=(0,o.compareTwoStringsUsingDiceCoefficient)(r,t);return i>=n?{command:e,commandWithoutSpecials:r,howSimilar:i,isFuzzyMatch:!0}:null}(e,g,d):function(e,t){var n=(0,o.commandToRegExp)(e).exec(t);return n?{command:e,parameters:n.slice(1)}:null}(e,g)})).filter((function(e){return e}));if(l&&p&&_.length>=2){_.sort((function(e,t){return t.howSimilar-e.howSimilar}));var E=_[0],v=E.command,y=E.commandWithoutSpecials,b=E.howSimilar;i(y,g,b,{command:v,resetTranscript:U})}else _.forEach((function(e){if(e.isFuzzyMatch){var t=e.command,n=e.commandWithoutSpecials,r=e.howSimilar;i(n,g,r,{command:t,resetTranscript:U})}else{var o=e.command,s=e.parameters;i.apply(void 0,f(s).concat([{command:o,resetTranscript:U}]))}}))}))}),[U]),j=(0,i.useCallback)((function(e,t){n&&O((0,s.appendTranscript)(e,t)),F(e,t)}),[F,n]),V=(0,i.useCallback)((function(){c&&M()}),[c]);return(0,i.useEffect)((function(){var e=S.counter;S.counter+=1;var t={onListeningChange:k,onMicrophoneAvailabilityChange:L,onTranscriptChange:j,onClearTranscript:V,onBrowserSupportsSpeechRecognitionChange:_,onBrowserSupportsContinuousListeningChange:T};return d.subscribe(e,t),function(){d.unsubscribe(e)}}),[n,c,d,j,V]),{transcript:(0,o.concatTranscripts)(I,R),interimTranscript:R,finalTranscript:I,listening:N,isMicrophoneAvailable:D,resetTranscript:U,browserSupportsSpeechRecognition:p,browserSupportsContinuousListening:v}};var S={counter:0,applyPolyfill:function(e){v?v.setSpeechRecognition(e):v=new c.default(e);var t=!!e&&(0,o.browserSupportsPolyfills)();y=t,b=t},removePolyfill:function(){v?v.setSpeechRecognition(u.default):v=new c.default(u.default),y=!!u.default,b=y&&!(0,l.default)()},getRecognitionManager:function(){return v||(v=new c.default(u.default)),v},getRecognition:function(){return S.getRecognitionManager().getRecognition()},startListening:function(){var e=p(r.mark((function e(){var t,n,i,o,s=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t=s.length>0&&void 0!==s[0]?s[0]:{}).continuous,i=t.language,o=S.getRecognitionManager(),e.next=4,o.startListening({continuous:n,language:i});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),stopListening:function(){var e=p(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S.getRecognitionManager(),e.next=3,t.stopListening();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),abortListening:function(){var e=p(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S.getRecognitionManager(),e.next=3,t.abortListening();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),browserSupportsSpeechRecognition:function(){return y},browserSupportsContinuousListening:function(){return b}},T=S;t.default=T},2550:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendTranscript=t.clearTranscript=void 0;var r=n(695);t.clearTranscript=function(){return{type:r.CLEAR_TRANSCRIPT}};t.appendTranscript=function(e,t){return{type:r.APPEND_TRANSCRIPT,payload:{interimTranscript:e,finalTranscript:t}}}},695:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APPEND_TRANSCRIPT=t.CLEAR_TRANSCRIPT=void 0;t.CLEAR_TRANSCRIPT="CLEAR_TRANSCRIPT";t.APPEND_TRANSCRIPT="APPEND_TRANSCRIPT"},5801:(e,t,n)=>{"use strict";function r(e){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"x6",{enumerable:!0,get:function(){return i.useSpeechRecognition}}),t.ZP=void 0;var i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=e[s]}n.default=e,t&&t.set(e,n);return n}(n(6212));function o(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}var s=i.default;t.ZP=s},7833:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(){return/(android)/i.test("undefined"!==typeof navigator?navigator.userAgent:"")}},5453:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transcriptReducer=void 0;var r=n(695),i=n(1081);t.transcriptReducer=function(e,t){switch(t.type){case r.CLEAR_TRANSCRIPT:return{interimTranscript:"",finalTranscript:""};case r.APPEND_TRANSCRIPT:return{interimTranscript:t.payload.interimTranscript,finalTranscript:(0,i.concatTranscripts)(e.finalTranscript,t.payload.finalTranscript)};default:throw new Error}}},1081:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.browserSupportsPolyfills=t.compareTwoStringsUsingDiceCoefficient=t.commandToRegExp=t.concatTranscripts=t.debounce=void 0;t.debounce=function(e,t,n){var r;return function(){var i=this,o=arguments,s=n&&!r;clearTimeout(r),r=setTimeout((function(){r=null,n||e.apply(i,o)}),t),s&&e.apply(i,o)}};t.concatTranscripts=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return e.trim()})).join(" ").trim()};var n=/\s*\((.*?)\)\s*/g,r=/(\(\?:[^)]+\))\?/g,i=/(\(\?)?:\w+/g,o=/\*/g,s=/[-{}[\]+?.,\\^$|#]/g;t.commandToRegExp=function(e){return e instanceof RegExp?new RegExp(e.source,"i"):(e=e.replace(s,"\\$&").replace(n,"(?:$1)?").replace(i,(function(e,t){return t?e:"([^\\s]+)"})).replace(o,"(.*?)").replace(r,"\\s*$1?\\s*"),new RegExp("^"+e+"$","i"))};t.compareTwoStringsUsingDiceCoefficient=function(e,t){if(e=e.replace(/\s+/g,"").toLowerCase(),t=t.replace(/\s+/g,"").toLowerCase(),!e.length&&!t.length)return 1;if(!e.length||!t.length)return 0;if(e===t)return 1;if(1===e.length&&1===t.length)return 0;if(e.length<2||t.length<2)return 0;for(var n=new Map,r=0;r<e.length-1;r++){var i=e.substring(r,r+2),o=n.has(i)?n.get(i)+1:1;n.set(i,o)}for(var s=0,a=0;a<t.length-1;a++){var c=t.substring(a,a+2),l=n.has(c)?n.get(c):0;l>0&&(n.set(c,l-1),s++)}return 2*s/(e.length+t.length-2)};t.browserSupportsPolyfills=function(){return"undefined"!==typeof window&&void 0!==window.navigator&&void 0!==window.navigator.mediaDevices&&void 0!==window.navigator.mediaDevices.getUserMedia&&(void 0!==window.AudioContext||void 0!==window.webkitAudioContext)}},6374:(e,t,n)=>{"use strict";var r=n(2791),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,o={},l=null,u=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,r)&&!c.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:l,ref:u,props:o,_owner:a.current}}t.Fragment=o,t.jsx=l,t.jsxs=l},9117:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function E(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},E.prototype=_.prototype;var y=v.prototype=new E;y.constructor=v,m(y,_.prototype),y.isPureReactComponent=!0;var b=Array.isArray,S=Object.prototype.hasOwnProperty,T={current:null},w={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var i,o={},s=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)S.call(t,i)&&!w.hasOwnProperty(i)&&(o[i]=t[i]);var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];o.children=l}if(e&&e.defaultProps)for(i in c=e.defaultProps)void 0===o[i]&&(o[i]=c[i]);return{$$typeof:n,type:e,key:s,ref:a,props:o,_owner:T.current}}function R(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function O(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function A(e,t,i,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return s=s(c=e),e=""===o?"."+O(c,0):o,b(s)?(i="",null!=e&&(i=e.replace(I,"$&/")+"/"),A(s,t,i,"",(function(e){return e}))):null!=s&&(R(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(I,"$&/")+"/")+e)),t.push(s)),1;if(c=0,o=""===o?".":o+":",b(e))for(var l=0;l<e.length;l++){var u=o+O(a=e[l],l);c+=A(a,t,i,u,s)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),l=0;!(a=e.next()).done;)c+=A(a=a.value,t,i,u=o+O(a,l++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function N(e,t,n){if(null==e)return e;var r=[],i=0;return A(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function k(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},D={transition:null},L={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:D,ReactCurrentOwner:T};t.Children={map:N,forEach:function(e,t,n){N(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return N(e,(function(){t++})),t},toArray:function(e){return N(e,(function(e){return e}))||[]},only:function(e){if(!R(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=i,t.Profiler=s,t.PureComponent=v,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=T.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)S.call(t,l)&&!w.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}return{$$typeof:n,type:e.type,key:o,ref:s,props:i,_owner:a}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=R,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.2.0"},2791:(e,t,n)=>{"use strict";e.exports=n(9117)},184:(e,t,n)=>{"use strict";e.exports=n(6374)},6813:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var a=2*(r+1)-1,c=e[a],l=a+1,u=e[l];if(0>o(c,n))l<i&&0>o(u,c)?(e[r]=u,e[l]=n,r=l):(e[r]=c,e[a]=n,r=a);else{if(!(l<i&&0>o(u,n)))break e;e[r]=u,e[l]=n,r=l}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,c=a.now();t.unstable_now=function(){return a.now()-c}}var l=[],u=[],d=1,h=null,p=3,f=!1,m=!1,g=!1,_="function"===typeof setTimeout?setTimeout:null,E="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function y(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(l,t)}t=r(u)}}function b(e){if(g=!1,y(e),!m)if(null!==r(l))m=!0,D(S);else{var t=r(u);null!==t&&L(b,t.startTime-e)}}function S(e,n){m=!1,g&&(g=!1,E(R),R=-1),f=!0;var o=p;try{for(y(n),h=r(l);null!==h&&(!(h.expirationTime>n)||e&&!A());){var s=h.callback;if("function"===typeof s){h.callback=null,p=h.priorityLevel;var a=s(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?h.callback=a:h===r(l)&&i(l),y(n)}else i(l);h=r(l)}if(null!==h)var c=!0;else{var d=r(u);null!==d&&L(b,d.startTime-n),c=!1}return c}finally{h=null,p=o,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,w=!1,C=null,R=-1,I=5,O=-1;function A(){return!(t.unstable_now()-O<I)}function N(){if(null!==C){var e=t.unstable_now();O=e;var n=!0;try{n=C(!0,e)}finally{n?T():(w=!1,C=null)}}else w=!1}if("function"===typeof v)T=function(){v(N)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,P=k.port2;k.port1.onmessage=N,T=function(){P.postMessage(null)}}else T=function(){_(N,0)};function D(e){C=e,w||(w=!0,T())}function L(e,n){R=_((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,D(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===r(l)&&e===r(u)&&(g?(E(R),R=-1):g=!0,L(b,o-s))):(e.sortIndex=a,n(l,e),m||f||(m=!0,D(S))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},5296:(e,t,n)=>{"use strict";e.exports=n(6813)},4836:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},7061:(e,t,n)=>{var r=n(8698).default;function i(){"use strict";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},o=Object.prototype,s=o.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",d=c.toStringTag||"@@toStringTag";function h(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(t){h=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var i=t&&t.prototype instanceof y?t:y,o=Object.create(i.prototype),s=new D(r||[]);return a(o,"_invoke",{value:A(e,n,s)}),o}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=p;var m="suspendedStart",g="suspendedYield",_="executing",E="completed",v={};function y(){}function b(){}function S(){}var T={};h(T,l,(function(){return this}));var w=Object.getPrototypeOf,C=w&&w(w(L([])));C&&C!==o&&s.call(C,l)&&(T=C);var R=S.prototype=y.prototype=Object.create(T);function I(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function n(i,o,a,c){var l=f(e[i],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==r(d)&&s.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,c)}))}c(l.arg)}var i;a(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}})}function A(e,n,r){var i=m;return function(o,s){if(i===_)throw new Error("Generator is already running");if(i===E){if("throw"===o)throw s;return{value:t,done:!0}}for(r.method=o,r.arg=s;;){var a=r.delegate;if(a){var c=N(a,r);if(c){if(c===v)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===m)throw i=E,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=_;var l=f(e,n,r);if("normal"===l.type){if(i=r.done?E:g,l.arg===v)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=E,r.method="throw",r.arg=l.arg)}}}function N(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,N(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var s=o.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function L(e){if(e||""===e){var n=e[l];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(s.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(r(e)+" is not iterable")}return b.prototype=S,a(R,"constructor",{value:S,configurable:!0}),a(S,"constructor",{value:b,configurable:!0}),b.displayName=h(S,d,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,h(e,d,"GeneratorFunction")),e.prototype=Object.create(R),e},n.awrap=function(e){return{__await:e}},I(O.prototype),h(O.prototype,u,(function(){return this})),n.AsyncIterator=O,n.async=function(e,t,r,i,o){void 0===o&&(o=Promise);var s=new O(p(e,t,r,i),o);return n.isGeneratorFunction(t)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},I(R),h(R,d,"Generator"),h(R,l,(function(){return this})),h(R,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=L,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&s.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=s.call(o,"catchLoc"),l=s.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:L(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},8698:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4687:(e,t,n)=>{var r=n(7061)();e.exports=r;try{regeneratorRuntime=r}catch(i){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},7462:(e,t,n)=>{"use strict";function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}n.d(t,{Z:()=>r})},3366:(e,t,n)=>{"use strict";function r(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}n.d(t,{Z:()=>r})},3733:(e,t,n)=>{"use strict";function r(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=r(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}n.d(t,{Z:()=>i});const i=function(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=r(e))&&(i&&(i+=" "),i+=t);return i}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;__webpack_require__.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"===typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"===typeof n.then)return n}var i=Object.create(null);__webpack_require__.r(i);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&r&&n;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>o[e]=()=>n[e]));return o.default=()=>n,__webpack_require__.d(i,o),i}})(),__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,n)=>(__webpack_require__.f[n](e,t),t)),[])),__webpack_require__.u=e=>"static/js/"+e+".beb4f20b.chunk.js",__webpack_require__.miniCssF=e=>{},__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="video-call:";__webpack_require__.l=(n,r,i,o)=>{if(e[n])e[n].push(r);else{var s,a;if(void 0!==i)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var u=c[l];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+i){s=u;break}}s||(a=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,__webpack_require__.nc&&s.setAttribute("nonce",__webpack_require__.nc),s.setAttribute("data-webpack",t+i),s.src=n),e[n]=[r];var d=(t,r)=>{s.onerror=s.onload=null,clearTimeout(h);var i=e[n];if(delete e[n],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(r))),t)return t(r)},h=setTimeout(d.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=d.bind(null,s.onerror),s.onload=d.bind(null,s.onload),a&&document.head.appendChild(s)}}})(),__webpack_require__.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),__webpack_require__.p="/",(()=>{var e={179:0};__webpack_require__.f.j=(t,n)=>{var r=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise(((n,i)=>r=e[t]=[n,i]));n.push(r[2]=i);var o=__webpack_require__.p+__webpack_require__.u(t),s=new Error;__webpack_require__.l(o,(n=>{if(__webpack_require__.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",s.name="ChunkLoadError",s.type=i,s.request=o,r[1](s)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,i,o=n[0],s=n[1],a=n[2],c=0;if(o.some((t=>0!==e[t]))){for(r in s)__webpack_require__.o(s,r)&&(__webpack_require__.m[r]=s[r]);if(a)a(__webpack_require__)}for(t&&t(n);c<o.length;c++)i=o[c],__webpack_require__.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunkvideo_call=self.webpackChunkvideo_call||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var __webpack_exports__={};(()=>{"use strict";var e={};__webpack_require__.r(e),__webpack_require__.d(e,{hasBrowserEnv:()=>wt,hasStandardBrowserEnv:()=>Ct,hasStandardBrowserWebWorkerEnv:()=>It});var t,n=__webpack_require__(2791),r=__webpack_require__(1250),i=__webpack_require__(3322),o=__webpack_require__.n(i);!function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"}(t||(t={}));var s=function(e){var t=(0,n.useRef)(null),r=e.videoTrack,i=e.config,o=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,["videoTrack","config"]);return(0,n.useLayoutEffect)((function(){return null!==t.current&&r.play(t.current,i),function(){r.stop()}}),[r]),n.createElement("div",Object.assign({},o,{ref:t}))};const a=o();var c,l=__webpack_require__(1197),u=__webpack_require__.n(l);!function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"}(c||(c={}));const d=u();function h(){return h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},h.apply(this,arguments)}"undefined"!==typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!==typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function p(e,t){try{var n=e()}catch(r){return t(r)}return n&&n.then?n.then(void 0,t):n}var f,m,g,_=n.createContext({}),E=_.Provider;_.Consumer;!function(e){e[e.yes=0]="yes",e[e.subbed=1]="subbed",e[e.no=2]="no"}(f||(f={})),function(e){e[e.grid=0]="grid",e[e.pin=1]="pin"}(m||(m={})),function(e){e[e.disabled=0]="disabled",e[e.enabled=1]="enabled",e[e.disabling=2]="disabling",e[e.enabling=3]="enabling"}(g||(g={}));var v=n.createContext({rtcProps:{appId:"",channel:"",role:"host"},rtmProps:{}}),y=v.Provider,b=n.createContext([]),S=b.Provider,T=b.Consumer,w=n.createContext([]),C=w.Provider,R=w.Consumer,I=n.createContext({}),O=I.Provider,A={max:[{uid:0,hasAudio:f.no,hasVideo:f.no}],min:[],isScreensharing:!1},N=function(e,t){var n=A,r=[].concat(e.max,e.min).map((function(e){return e.uid}));switch(t.type){case"Screensharing":n=h({},e,{isScreensharing:t.value[0]}),console.log("!Screensharingstate",e,n);break;case"update-user-video":n={min:e.min.map((function(e){return 0===e.uid?{uid:0,hasAudio:f.subbed,hasVideo:f.subbed}:e})),max:e.max.map((function(e){return 0===e.uid?{uid:0,hasAudio:f.subbed,hasVideo:f.subbed}:e})),isScreensharing:e.isScreensharing};break;case"user-joined":if(-1===r.indexOf(t.value[0].uid)){var i=[].concat(e.min,[{uid:t.value[0].uid,hasAudio:f.no,hasVideo:f.no}]);n=1===i.length&&0===e.max[0].uid?{max:i,min:e.max,isScreensharing:e.isScreensharing}:{min:i,max:e.max,isScreensharing:e.isScreensharing}}break;case"user-unpublished":if(e.max[0].uid===t.value[0].uid)n={max:[{uid:t.value[0].uid,hasAudio:"audio"===t.value[1]?f.no:e.max[0].hasAudio,hasVideo:"video"===t.value[1]?f.no:e.max[0].hasVideo}],min:e.min,isScreensharing:e.isScreensharing};else{var o=e.min.find((function(e){return e.uid===t.value[0].uid}));if(o)n={min:[].concat(e.min.filter((function(e){return e.uid!==t.value[0].uid})),[{uid:t.value[0].uid,hasAudio:"audio"===t.value[1]?f.no:o.hasAudio,hasVideo:"video"===t.value[1]?f.no:o.hasVideo}]),max:e.max,isScreensharing:e.isScreensharing}}break;case"user-published":n=e.max[0].uid===t.value[0].uid?{max:[{uid:t.value[0].uid,hasAudio:"audio"===t.value[1]?f.subbed:e.max[0].hasAudio,hasVideo:"video"===t.value[1]?f.subbed:e.max[0].hasVideo}],min:e.min,isScreensharing:e.isScreensharing}:{min:e.min.map((function(e){return e.uid!==t.value[0].uid?e:{uid:e.uid,hasAudio:"audio"===t.value[1]?f.subbed:e.hasAudio,hasVideo:"video"===t.value[1]?f.subbed:e.hasVideo}})),max:e.max,isScreensharing:e.isScreensharing};break;case"user-left":if(e.max[0].uid===t.value[0].uid){var s=[].concat(e.min);n={max:[s.pop()],min:s,isScreensharing:e.isScreensharing}}else n={min:e.min.filter((function(e){return e.uid!==t.value[0].uid})),max:e.max,isScreensharing:e.isScreensharing};break;case"user-swap":e.max[0].uid===t.value[0].uid||(n={max:[t.value[0]],min:[].concat(e.min.filter((function(e){return e.uid!==t.value[0].uid})),[e.max[0]]),isScreensharing:e.isScreensharing});break;case"local-user-mute-video":n={min:e.min.map((function(e){return 0===e.uid?{uid:0,hasAudio:e.hasAudio,hasVideo:t.value[0]}:e})),max:e.max.map((function(e){return 0===e.uid?{uid:0,hasAudio:e.hasAudio,hasVideo:t.value[0]}:e})),isScreensharing:e.isScreensharing};break;case"local-user-mute-audio":n={min:e.min.map((function(e){return 0===e.uid?{uid:0,hasAudio:t.value[0],hasVideo:e.hasVideo}:e})),max:e.max.map((function(e){return 0===e.uid?{uid:0,hasAudio:t.value[0],hasVideo:e.hasVideo}:e})),isScreensharing:e.isScreensharing};break;case"remote-user-mute-video":n={min:e.min.map((function(e){return e.uid===t.value[0].uid?{uid:e.uid,hasVideo:t.value[1],hasAudio:e.hasAudio}:e})),max:e.max.map((function(e){return e.uid===t.value[0].uid?{uid:e.uid,hasVideo:t.value[1],hasAudio:e.hasAudio}:e})),isScreensharing:e.isScreensharing};break;case"remote-user-mute-audio":n={min:e.min.map((function(e){return e.uid===t.value[0].uid?{uid:e.uid,hasAudio:t.value[1],hasVideo:e.hasVideo}:e})),max:e.max.map((function(e){return e.uid===t.value[0].uid?{uid:e.uid,hasAudio:t.value[1],hasVideo:e.hasVideo}:e})),isScreensharing:e.isScreensharing};break;case"leave-channel":n=A;break;case"ActiveSpeaker":n=e.max[0].uid===t.value[0]?h({},e):{max:[e.min.find((function(e){return e.uid===t.value[0]}))],min:[].concat(e.min.filter((function(e){return e.uid!==t.value[0]})),[e.max[0]]),isScreensharing:e.isScreensharing}}return console.log("!state-update",h({},e,n),n),h({},e,n)},k=function(e,t,n,r,i,o,s){try{var c=a.createClient({mode:"live",role:"host",codec:"vp8"}),l=0,u=i||1,d=!1;return P=function(){try{var e=p((function(){return n.close(),Promise.resolve(c.leave()).then((function(){c.removeAllListeners()}))}),(function(e){console.log(e)}));return Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(t){return Promise.reject(t)}},Promise.resolve(function(){try{try{console.log(c),o&&(c.on("token-privilege-will-expire",(function(){try{return console.log("token will expire"),Promise.resolve(fetch(o+"/rtc/"+t+"/publisher/uid/"+u+"/")).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtcToken;c.renewToken(t)}))}))}catch(e){return Promise.reject(e)}})),c.on("token-privilege-did-expire",(function(){try{return Promise.resolve(fetch(o+"/rtc/"+t+"/publisher/uid/"+u+"/")).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtcToken;c.renewToken(t)}))}))}catch(e){return Promise.reject(e)}}))),n.on("track-ended",(function(){c.leave(),c.removeAllListeners()}))}catch(e){console.log(e)}return Promise.resolve()}catch(e){return Promise.reject(e)}}()).then((function(){return Promise.resolve(function(){try{c.setClientRole("host");var n=function(){if(!o)return Promise.resolve(c.join(e,t,r||null,u||0)).then((function(e){l=e}));var n=p((function(){return Promise.resolve(fetch(o+"/rtc/"+t+"/publisher/uid/"+u+"/")).then((function(n){return Promise.resolve(n.json()).then((function(n){var r=n.rtcToken;return Promise.resolve(c.join(e,t,r,u)).then((function(e){l=e}))}))}))}),(function(e){console.log(e)}));return n&&n.then?n.then((function(){})):void 0}();return Promise.resolve(n&&n.then?n.then((function(){})):void 0)}catch(i){return Promise.reject(i)}}()).then((function(){return Promise.resolve(function(){try{var e=function(){var e=function(){if(n.enabled){var e=function(){if(!d)return Promise.resolve(c.publish([n]).then((function(){d=!0}))).then((function(){}))}();if(e&&e.then)return e.then((function(){}))}}();if(e&&e.then)return e.then((function(){}))},t=function(){if(s)return Promise.resolve(c.enableDualStream()).then((function(){}))}();return Promise.resolve(t&&t.then?t.then(e):e())}catch(r){return Promise.reject(r)}}()).then((function(){l&&console.log(l)}))}))}))}catch(h){return Promise.reject(h)}},P=function(){},D=function(e){var t;return function(){return t||(t=o().createClient(e)),t}}({codec:"vp8",mode:"live"}),L=function(e){var t=(0,n.useRef)(),r=(0,n.useRef)(),i=(0,n.useRef)(!1),o=(0,n.useContext)(I),s=o.localVideoTrack,c=o.localAudioTrack,l=(0,n.useContext)(v),u=l.callbacks,d=l.rtcProps,h=(0,n.useState)(!1),f=h[0],g=h[1],_=(0,n.useState)(!1),y=_[0],b=_[1],T=null,w=(0,n.useRef)(new Promise((function(e,t){T=e,console.log(t)}))),R=D();d.customRtcClient&&(R.removeAllListeners(),R=d.customRtcClient);var O=!1,L=!1,x=(0,n.useRef)({}),M=e.callActive;void 0===M&&(M=!0);var U=(0,n.useReducer)(N,A),F=U[0],j=U[1];(0,n.useEffect)((function(){return T?(function(){try{try{if(console.log(R),R.on("user-joined",(function(){try{for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return o.uid===e.screenshareUid&&i.current||1===o.uid&&i.current||(x.current[o.uid]={}),j({type:"user-joined",value:n}),Promise.resolve()}catch(s){return Promise.reject(s)}})),R.on("user-published",(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];try{var o=n[0],s=n[1];return console.log("user-published",o.uid),o.uid===e.screenshareUid&&i.current||1===o.uid&&i.current?j({type:"user-published",value:n}):R.subscribe(o,s).then((function(e){var t;x.current[o.uid][s+"Track"]=o[s+"Track"],"audio"===s?null===(t=o.audioTrack)||void 0===t||t.play():d.enableDualStream&&d.dualStreamMode&&R.setStreamFallbackOption(o.uid,d.dualStreamMode),j({type:"user-published",value:n})})).catch((function(e){return console.log(e)})),Promise.resolve()}catch(a){return Promise.reject(a)}})),R.on("user-unpublished",(function(){try{for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,i=t[0],o=t[1];return console.log("user-unpublished",i.uid),"audio"===o&&(null===(r=i.audioTrack)||void 0===r||r.stop()),j({type:"user-unpublished",value:t}),Promise.resolve()}catch(s){return Promise.reject(s)}})),R.on("connection-state-change",(function(){try{for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],o=t[1],s=t[2];if(console.log("connection",o,r,s),"CONNECTED"===r)b(!0);else if("DISCONNECTED"===r){try{P(),i.current=!1}catch(a){console.log("stopscreenshare",a)}j({type:"leave-channel",value:null})}else b(!1);return Promise.resolve()}catch(a){return Promise.reject(a)}})),R.on("user-left",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];j({type:"user-left",value:t})})),d.tokenUrl){var t=d.tokenUrl,n=d.channel,r=d.uid;R.on("token-privilege-will-expire",(function(){try{return console.log("token will expire"),Promise.resolve(fetch(t+"/rtc/"+n+"/publisher/uid/"+(r||0)+"/")).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtcToken;R.renewToken(t)}))}))}catch(e){return Promise.reject(e)}})),R.on("token-privilege-did-expire",(function(){try{return Promise.resolve(fetch(t+"/rtc/"+n+"/publisher/uid/"+(r||0)+"/")).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtcToken;R.renewToken(t)}))}))}catch(e){return Promise.reject(e)}}))}u&&Object.keys(u).map((function(e){try{R.on(e,(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];u[e].apply(null,n)}))}catch(e){console.log(e)}})),T(!0),g(!0)}catch(o){console.log("!!!",o)}return Promise.resolve()}catch(o){return Promise.reject(o)}}(),function(){try{R.removeAllListeners()}catch(e){console.log(e)}}):function(){}}),[d.appId]),(0,n.useEffect)((function(){var e=!1;return M?(!function(){try{return Promise.resolve(w.current).then((function(){var n=d.tokenUrl,r=d.channel,i=d.uid,o=d.appId,s=d.token,a=function(){if(R&&!e){"audience"===d.role?R.setClientRole(d.role):R.setClientRole("host");var a=function(){if(!n)return Promise.resolve(R.join(o,r,s||null,i||0)).then((function(e){t.current=e}));var e=p((function(){return Promise.resolve(fetch(n+"/rtc/"+r+"/publisher/uid/"+(i||0)+"/")).then((function(e){return Promise.resolve(e.json()).then((function(e){var n=e.rtcToken;return Promise.resolve(R.join(o,r,n,i||0)).then((function(e){t.current=e}))}))}))}),(function(e){console.log(e)}));return e&&e.then?e.then((function(){})):void 0}();if(a&&a.then)return a.then((function(){}))}else console.error("trying to join before RTC Engine was initialized")}();if(a&&a.then)return a.then((function(){}))}))}catch(n){return Promise.reject(n)}}(),console.log("Attempted join: ",d.channel)):console.log("In precall - waiting to join"),function(){if(e=!0,M){console.log("Leaving channel");try{P(),i.current=!1}catch(t){console.log(t)}w.current=R.leave().catch((function(e){return console.log(e)}))}}}),[d.channel,d.uid,M,d.tokenUrl]),(0,n.useEffect)((function(){console.log("Publish",s,c,M),M&&function(){try{var e=function(){function e(){var e=function(){if(null!==s&&void 0!==s&&s.enabled&&y){var e=function(){if(!O)return Promise.resolve(R.publish([s]).then((function(){O=!0}))).then((function(){}))}();if(e&&e.then)return e.then((function(){}))}}();if(e&&e.then)return e.then((function(){}))}var t=function(){if(null!==c&&void 0!==c&&c.enabled&&y){var e=function(){if(!L)return Promise.resolve(R.publish([c]).then((function(){L=!0}))).then((function(){}))}();if(e&&e.then)return e.then((function(){}))}}();return t&&t.then?t.then(e):e()},t=function(){if(d.enableDualStream)return Promise.resolve(R.enableDualStream()).then((function(){}))}();return Promise.resolve(t&&t.then?t.then(e):e())}catch(n){return Promise.reject(n)}}()}),[M,null===s||void 0===s?void 0:s.enabled,null===c||void 0===c?void 0:c.enabled,y]),(0,n.useEffect)((function(){s&&null!==c&&(x.current[0]={audioTrack:c,videoTrack:s},j({type:"update-user-video",value:[c,s]}))}),[d.channel,y]),(0,n.useEffect)((function(){y&&d.token&&R.renewToken(d.token).then((function(e){return console.log("renewed token",e)}))}),[d.token,y]),(0,n.useEffect)((function(){d.role&&R.setClientRole(d.role).then((function(e){return console.log("changed role",e)}))}),[d.role,y]),(0,n.useEffect)((function(){return M&&function(){try{var e=function(){if(d.activeSpeaker&&d.layout!==m.grid)return R.on("volume-indicator",(function(e){var n=e.reduce((function(e,t){return null===e||t.level>e.level?t:e}),null),r=n?n.uid:void 0,i=r===t.current?0:r;void 0!==r&&j({type:"ActiveSpeaker",value:[i]})})),Promise.resolve(R.enableAudioVolumeIndicator()).then((function(){}))}();return Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(n){return Promise.reject(n)}}(),function(){R.removeAllListeners("volume-indicator")}}),[d.activeSpeaker,d.layout]);return n.createElement(E,{value:{client:R,mediaStore:x.current,localVideoTrack:s,localAudioTrack:c,dispatch:j,localUid:t,channelJoined:y,toggleScreensharing:function(){try{return i.current?(P(),i.current=!1):function(){try{return j({type:"Screensharing",value:[!0]}),Promise.resolve(a.createScreenVideoTrack({},"disable")).then((function(e){r.current=e;var t=d.screenshareUid||1;return x.current[t]={videoTrack:r.current},r.current.on("track-ended",(function(){i.current=!1,j({type:"Screensharing",value:[!1]})})),i.current=!0,Promise.resolve(k(d.appId,d.channel,r.current,d.screenshareToken,d.screenshareUid,d.tokenUrl,d.enableDualStream)).then((function(){}))}))}catch(e){return Promise.reject(e)}}(),Promise.resolve()}catch(e){return Promise.reject(e)}},isScreensharing:i.current}},n.createElement(S,{value:F.max},n.createElement(C,{value:F.min},f?e.children:null)))},x={videocam:n.createElement(n.Fragment,null,n.createElement("polygon",{points:"23 7 16 12 23 17 23 7"}),n.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),videocamOff:n.createElement(n.Fragment,null,n.createElement("path",{d:"M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10"}),n.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),remoteSwap:n.createElement(n.Fragment,null,n.createElement("polyline",{points:"15 3 21 3 21 9"}),n.createElement("polyline",{points:"9 21 3 21 3 15"}),n.createElement("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),n.createElement("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),callEnd:n.createElement(n.Fragment,null,n.createElement("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),n.createElement("line",{x1:"23",y1:"1",x2:"1",y2:"23"})),mic:n.createElement(n.Fragment,null,n.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),n.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),n.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),n.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),micOff:n.createElement(n.Fragment,null,n.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),n.createElement("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),n.createElement("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),n.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),n.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),screen:n.createElement(n.Fragment,null,n.createElement("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),n.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),n.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})),stop:n.createElement(n.Fragment,null,n.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),n.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},M=function(e){var t=e.onClick,r=e.name,i=e.disabled,o=e.style,s=(0,n.useContext)(v).styleProps||{},a=s.theme,c=s.BtnTemplateStyles,l=s.iconSize,u=s.customIcon;return n.createElement("div",{style:h({},{width:35,height:35,borderRadius:"100%",borderWidth:2,borderStyle:"solid",borderColor:"#fff",backgroundColor:"rgba(0,80,180,0.2)",alignItems:"center",justifyContent:"center",display:"flex",cursor:i?"auto":"pointer",margin:4},c,o),onClick:t},u?n.createElement("img",{src:u[r],alt:r}):n.createElement("svg",{style:{width:l||24,height:l||24},xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",opacity:i?"0.5":"1",stroke:a||"#fff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},x[r]))};function U(){var e=(0,n.useContext)(v),t=e.styleProps,r=e.callbacks,i=((t||{}).localBtnStyles||{}).endCall;return n.createElement(M,{style:i||{backgroundColor:"#ef5588",borderColor:"#f00"},name:"callEnd",onClick:function(){return(null===r||void 0===r?void 0:r.EndCall)&&r.EndCall()}})}var F=(0,n.createContext)({}),j=function(e){var t,r=(0,n.useContext)(b),i=(0,n.useContext)(w);return t=0===r[0].uid?r[0]:i.find((function(e){return 0===e.uid})),n.createElement(F.Provider,{value:t},e.children)},V=function(e,t,n,r){try{var i=function(){if(0===e.uid){var i=e.hasAudio,o=function(){if(i===g.enabled||i===g.disabled){var e=i===g.enabled?g.disabling:g.enabling;t({type:"local-user-mute-audio",value:[e]}),r&&r["local-user-mute-audio"]&&r["local-user-mute-audio"](e);var o=p((function(){return Promise.resolve(null===n||void 0===n?void 0:n.setEnabled(i!==g.enabled)).then((function(){e=i===g.enabled?g.disabled:g.enabled,r&&r["local-user-mute-audio"]&&r["local-user-mute-audio"](e),t({type:"local-user-mute-audio",value:[i===g.enabled?g.disabled:g.enabled]})}))}),(function(){t({type:"local-user-mute-audio",value:[i]})}));if(o&&o.then)return o.then((function(){}))}}();if(o&&o.then)return o.then((function(){}))}}();return Promise.resolve(i&&i.then?i.then((function(){})):void 0)}catch(o){return Promise.reject(o)}};function B(){var e=(0,n.useContext)(v),t=e.styleProps,r=e.callbacks,i=((t||{}).localBtnStyles||{}).muteLocalAudio,o=(0,n.useContext)(_),s=o.dispatch,a=o.localAudioTrack,c=(0,n.useContext)(F);return n.createElement("div",null,n.createElement(M,{style:i,name:c.hasAudio===g.enabled?"mic":"micOff",onClick:function(){return a&&V(c,s,a,r)}}))}function G(){var e=(((0,n.useContext)(v).styleProps||{}).localBtnStyles||{}).screenshare,t=(0,n.useContext)(_),r=t.toggleScreensharing,i=t.isScreensharing;return n.createElement("div",null,n.createElement(M,{style:e,name:i?"stop":"screen",onClick:function(){return r()}}))}var q,W,z,H,K=function(e,t,n,r){try{var i=function(){if(0===e.uid){var i=e.hasVideo,o=function(){if(i===g.enabled||i===g.disabled){var e=i===g.enabled?g.disabling:g.enabling;t({type:"local-user-mute-video",value:[e]}),r&&r["local-user-mute-video"]&&r["local-user-mute-video"](e);var o=p((function(){return Promise.resolve(null===n||void 0===n?void 0:n.setEnabled(i!==g.enabled)).then((function(){e=i===g.enabled?g.disabled:g.enabled,r&&r["local-user-mute-video"]&&r["local-user-mute-video"](e),t({type:"local-user-mute-video",value:[e]})}))}),(function(){t({type:"local-user-mute-video",value:[i]})}));if(o&&o.then)return o.then((function(){}))}}();if(o&&o.then)return o.then((function(){}))}}();return Promise.resolve(i&&i.then?i.then((function(){})):void 0)}catch(o){return Promise.reject(o)}};function Y(){var e=(0,n.useContext)(v),t=e.styleProps,r=e.callbacks,i=((t||{}).localBtnStyles||{}).muteLocalVideo,o=(0,n.useContext)(_),s=o.dispatch,a=o.localVideoTrack,c=(0,n.useContext)(F);return n.createElement("div",null,n.createElement(M,{style:i,name:c.hasVideo===g.enabled?"videocam":"videocamOff",onClick:function(){return a&&K(c,s,a,r)}}))}function Z(){var e=(0,n.useContext)(v),t=e.styleProps,r=e.rtcProps,i=(t||{}).localBtnContainer;return n.createElement("div",{style:h({},{backgroundColor:"#007bff",width:"100%",height:70,zIndex:10,display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center"},i)},"audience"!==r.role&&n.createElement(Y,null),"audience"!==r.role&&n.createElement(B,null),"audience"!==r.role&&r.enableScreensharing&&n.createElement(G,null),n.createElement(U,null))}!function(e){e[e.initFailed=0]="initFailed",e[e.offline=1]="offline",e[e.initialising=2]="initialising",e[e.loggingIn=3]="loggingIn",e[e.loggedIn=4]="loggedIn",e[e.connected=5]="connected",e[e.loginFailed=6]="loginFailed"}(q||(q={})),function(e){e[e.broadcaster=0]="broadcaster",e[e.audience=1]="audience"}(W||(W={})),function(e){e[e.camera=0]="camera",e[e.microphone=1]="microphone"}(z||(z={})),function(e){e[e.closed=0]="closed",e[e.muteMic=1]="muteMic",e[e.muteCamera=2]="muteCamera",e[e.unmuteMic=3]="unmuteMic",e[e.unmuteCamera=4]="unmuteCamera"}(H||(H={}));var J=(0,n.createContext)(null),X=J.Provider;J.Consumer;function Q(e){var t=(0,n.useContext)(v).styleProps,r=(0,n.useContext)(J),i=r.sendMuteRequest,o=r.uidMap,s=((t||{}).remoteBtnStyles||{}).muteRemoteVideo,a=e.UIKitUser,c=a.hasVideo===f.no;return 0!==a.uid&&o[a.uid]?n.createElement("div",null,n.createElement(M,{name:a.hasVideo===f.subbed?"videocam":"videocamOff",style:s,onClick:function(){return i(z.camera,a.uid,!c)}})):null}function $(e){var t=((0,n.useContext)(v).styleProps||{}).remoteBtnStyles,r=(0,n.useContext)(J),i=r.sendMuteRequest,o=r.uidMap,s=(t||{}).muteRemoteAudio,a=e.UIKitUser,c=a.hasAudio===f.no;return 0!==a.uid&&o[a.uid]?n.createElement("div",null,n.createElement(M,{style:s,name:a.hasAudio===f.subbed?"mic":"micOff",onClick:function(){return i(z.microphone,a.uid,!c)}})):null}function ee(e){var t=(0,n.useContext)(_).dispatch,r=e.UIKitUser;return n.createElement("div",null,n.createElement(M,{name:"remoteSwap",onClick:function(){return t({type:"user-swap",value:[r]})}}))}var te=function(e){var t=(0,n.useContext)(v),r=t.styleProps,i=t.rtcProps,o=r||{},s=o.maxViewStyles,a=o.maxViewOverlayContainer,c=e.user,l=i.CustomVideoPlaceholder;return l?l&&l(h({},e),null):n.createElement("div",{key:c.uid,style:h({},ne.max,s)},n.createElement("div",{style:ne.imgContainer},n.createElement("img",{style:ne.img,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItdXNlciI+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg=="})),e.isShown&&n.createElement("div",{style:h({},ne.btnContainer,a)},e.showButtons&&n.createElement(n.Fragment,null,!i.disableRtm&&n.createElement(Q,{UIKitUser:c}),!i.disableRtm&&n.createElement($,{UIKitUser:c}),e.showSwap&&n.createElement(ee,{UIKitUser:c}))))},ne={max:{flex:1,display:"flex",backgroundColor:"#007bff33",flexDirection:"row",position:"relative"},imgContainer:{flex:10,display:"flex",justifyContent:"center"},img:{width:100,height:100,position:"absolute",alignSelf:"center",justifySelf:"center",margin:"auto",display:"flex"},btnContainer:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},re=function(e){var t=(0,n.useContext)(J).usernames,r=(0,n.useContext)(v),i=r.rtmProps,o=r.styleProps,s=e.user;return null!==i&&void 0!==i&&i.displayUsername?n.createElement("p",{style:h({},ie.username,null===o||void 0===o?void 0:o.usernameText)},1===s.uid?"Screenshare":t[s.uid]):n.createElement(n.Fragment,null)},ie={username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},oe=function(e){var t=(0,n.useContext)(_).mediaStore,r=(0,n.useContext)(v),i=r.styleProps,o=r.rtcProps,a=i||{},c=a.maxViewStyles,l=a.videoMode,u=a.maxViewOverlayContainer,d=null===l||void 0===l?void 0:l.max,p=(0,n.useState)(!1),f=p[0],m=p[1],g=e.user;return n.createElement("div",{style:h({},se.container,e.style,c),onMouseEnter:function(){return m(!0)},onMouseLeave:function(){return m(!1)}},1===g.hasVideo?n.createElement("div",{style:se.videoContainer},!o.disableRtm&&n.createElement(re,{user:g}),n.createElement(s,{style:se.videoplayer,config:{fit:d||"cover"},videoTrack:t[g.uid].videoTrack}),f&&n.createElement("div",{style:h({},se.overlay,u)},!o.disableRtm&&n.createElement(Q,{UIKitUser:g}),!o.disableRtm&&n.createElement($,{UIKitUser:g}))):n.createElement("div",{style:se.videoContainer},!o.disableRtm&&n.createElement(re,{user:g}),n.createElement(te,{user:g,isShown:f,showButtons:!0})))},se={container:{display:"flex",flex:1},videoContainer:{display:"flex",flex:1,position:"relative"},videoplayer:{width:"100%",display:"flex",flex:1},overlay:{position:"absolute",margin:5,flexDirection:"column",display:"flex"},username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},ae=function(e){var t=(0,n.useContext)(_).mediaStore,r=(0,n.useContext)(v),i=r.styleProps,o=r.rtcProps,a=i||{},c=a.minViewStyles,l=a.videoMode,u=a.minViewOverlayContainer,d=null===l||void 0===l?void 0:l.min,p=(0,n.useState)(!1),f=p[0],m=p[1],g=e.user;return n.createElement("div",{style:h({},{display:"flex",flex:1},c),onMouseEnter:function(){return m(!0)},onMouseLeave:function(){return m(!1)}},1===g.hasVideo?n.createElement("div",{style:h({},{display:"flex",flex:1,position:"relative"})},n.createElement(s,{style:{flex:10,display:"flex"},config:{fit:void 0!==d?d:"cover"},videoTrack:t[g.uid].videoTrack}),f&&n.createElement("div",{style:h({},{margin:4,position:"absolute",flex:1,display:"flex",flexDirection:"column"},u)},!o.disableRtm&&n.createElement(Q,{UIKitUser:g}),!o.disableRtm&&n.createElement($,{UIKitUser:g}),n.createElement(ee,{UIKitUser:g}))):n.createElement(te,{user:g,isShown:f,showButtons:!0,showSwap:!0}))},ce="_3Sxu7",le=function(){var e=(0,n.useContext)(v),t=e.styleProps,r=e.rtcProps,i=t||{},o=i.minViewContainer,s=i.pinnedVideoContainer,a=i.maxViewContainer,c=i.scrollViewContainer,l=(0,n.useRef)(null),u=(0,n.useState)(0),d=u[0],p=u[1],f=(0,n.useState)(0),m=f[0],g=f[1],_=d>m;return(0,n.useEffect)((function(){var e=function(){l.current&&(p(l.current.offsetWidth),g(l.current.offsetHeight))};return window.addEventListener("resize",e),l.current&&(p(l.current.offsetWidth),g(l.current.offsetHeight)),function(){window.removeEventListener("resize",e)}}),[]),n.createElement("div",{ref:l,style:h({},{display:"flex",flex:1,flexDirection:_?"row":"column-reverse",overflow:"hidden"},s)},n.createElement("div",{style:h({},{display:"flex",flex:_?5:4},a)},n.createElement(T,null,(function(e){return"audience"===r.role&&0===e[0].uid?null:n.createElement(oe,{user:e[0]})}))),n.createElement("div",{className:ce,style:h({},{overflowY:_?"scroll":"hidden",overflowX:_?"hidden":"scroll",display:"flex",flex:1,flexDirection:_?"column":"row"},c)},n.createElement(R,null,(function(e){return e.map((function(e){return"audience"===r.role&&0===e.uid?null:n.createElement("div",{style:h({},{minHeight:_?"35vh":"99%",minWidth:_?"99%":"40vw",margin:2,display:"flex"},o),key:e.uid},n.createElement(ae,{user:e}))}))}))))},ue=function(){var e=(0,n.useContext)(v),t=e.styleProps,r=e.rtcProps,i=t||{},o=i.gridVideoCells,s=i.gridVideoContainer,a=(0,n.useContext)(b),c=(0,n.useContext)(w),l="audience"===r.role?[].concat(a,c).filter((function(e){return 0!==e.uid})):[].concat(a,c),u=(0,n.useRef)(null),d=(0,n.useState)(window.innerWidth),p=d[0],f=d[1],m=(0,n.useState)(window.innerHeight),g=m[0],_=m[1],E=p>g,y="minmax(0, 1fr) ";return(0,n.useEffect)((function(){var e=function(){u.current&&(f(u.current.offsetWidth),_(u.current.offsetHeight))};return window.addEventListener("resize",e),u.current&&(f(u.current.offsetWidth),_(u.current.offsetHeight)),function(){window.removeEventListener("resize",e)}}),[]),n.createElement("div",{ref:u,style:h({},{width:"100%",height:"100%",display:"grid",gridTemplateColumns:E?l.length>9?y.repeat(4):l.length>4?y.repeat(3):l.length>1?y.repeat(2):y:l.length>8?y.repeat(3):l.length>2?y.repeat(2):y},s)},l.map((function(e){return n.createElement(oe,{user:e,style:h({},{height:"100%",width:"100%"},o),key:e.uid})})))},de=function(e,t){var r=null;return function(){var i=(0,n.useState)(!1),s=i[0],a=i[1],c=(0,n.useState)(null),l=c[0],u=c[1],d=(0,n.useRef)(r);return(0,n.useEffect)((function(){return null===d.current?function(){try{return Promise.resolve(o().createMicrophoneAndCameraTracks(e,t)).then((function(e){return r=e}))}catch(n){return Promise.reject(n)}}().then((function(e){d.current=e,a(!0)}),(function(e){u(e)})):a(!0),function(){r=null}}),[]),{ready:s,tracks:d.current,error:l}}}({encoderConfig:{}},{encoderConfig:{}}),he=function(e){var t=(0,n.useState)(!1),r=t[0],i=t[1],o=(0,n.useState)(null),s=o[0],a=o[1],c=(0,n.useState)(null),l=c[0],u=c[1],d=de(),h=d.ready,p=d.tracks,f=d.error,m=(0,n.useRef)({});return(0,n.useEffect)((function(){return null!==p?(u(p[0]),a(p[1]),m.current[0]={audioTrack:p[0],videoTrack:p[1]},i(!0)):f&&(console.error(f),i(!1)),function(){var e,t;p&&(null===(e=p[0])||void 0===e||e.close(),null===(t=p[1])||void 0===t||t.close())}}),[h,f]),n.createElement(O,{value:{localVideoTrack:s,localAudioTrack:l}},r?e.children:null)},pe=function(){var e;return function(t,n){return function(t,n){return e||(e=t.createChannel(n)),e}(t,n)}}(),fe=function(){var e;return function(t,n,r){return function(t,n,r){return e||(e=u().createInstance(t,n,r)),e}(t,n,r)}}(),me=function(e){var t=(0,n.useContext)(v),r=t.rtcProps,i=t.rtmProps,o=(0,n.useState)(!1),s=o[0],c=o[1],l=fe(r.appId),u=pe(l,r.channel),f=(0,n.useRef)(""),m=(0,n.useRef)(5),g=(0,n.useContext)(F),E=(0,n.useContext)(v).rtmCallbacks,y=(0,n.useState)({}),b=y[0],S=y[1],T=(0,n.useState)({}),w=T[0],C=T[1],R=(0,n.useState)({}),I=R[0],O=R[1],A=(0,n.useState)(H.closed),N=A[0],k=A[1],P=(0,n.useState)(q.offline),D=P[0],L=P[1],x=(0,n.useContext)(_),M=x.localUid,U=x.localAudioTrack,j=x.localVideoTrack,B=x.dispatch,G=x.channelJoined,W=function e(){try{var t=r.tokenUrl,n=function(){if(t){var n=p((function(){return Promise.resolve(fetch(t+"/rtm/"+((null===i||void 0===i?void 0:i.uid)||f.current))).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtmToken;return Promise.resolve(l.login({uid:(null===i||void 0===i?void 0:i.uid)||f.current,token:t})).then((function(){m.current=5}))}))}))}),(function(){setTimeout((function(){try{return m.current=m.current+m.current,e(),Promise.resolve()}catch(t){return Promise.reject(t)}}),1e3*m.current)}));if(n&&n.then)return n.then((function(){}))}else{var r=p((function(){return Promise.resolve(l.login({uid:(null===i||void 0===i?void 0:i.uid)||f.current,token:(null===i||void 0===i?void 0:i.token)||void 0})).then((function(){m.current=5}))}),(function(){setTimeout((function(){try{return m.current=m.current+m.current,e(),Promise.resolve()}catch(t){return Promise.reject(t)}}),1e3*m.current)}));if(r&&r.then)return r.then((function(){}))}}();return Promise.resolve(n&&n.then?n.then((function(){})):void 0)}catch(o){return Promise.reject(o)}},Y=function e(){try{var t=p((function(){return Promise.resolve(u.join()).then((function(){m.current=5}))}),(function(){setTimeout((function(){try{return m.current=m.current+m.current,e(),Promise.resolve()}catch(t){return Promise.reject(t)}}),1e3*m.current)}));return Promise.resolve(t&&t.then?t.then((function(){})):void 0)}catch(n){return Promise.reject(n)}},Z=function(){try{if(L(q.initialising),r.uid?f.current=String(r.uid):f.current=String((new Date).getTime()),l.on("ConnectionStateChanged",(function(e,t){console.log(e,t)})),l.on("TokenExpired",(function(){try{var e=r.tokenUrl;console.log("token expired - renewing");var t=function(){if(e){var t=p((function(){return Promise.resolve(fetch(e+"/rtm/"+((null===i||void 0===i?void 0:i.uid)||f.current))).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtmToken;return Promise.resolve(l.renewToken(t)).then((function(){m.current=5}))}))}))}),(function(e){console.error("TokenExpiredError",e)}));if(t&&t.then)return t.then((function(){}))}}();return Promise.resolve(t&&t.then?t.then((function(){})):void 0)}catch(n){return Promise.reject(n)}})),l.on("MessageFromPeer",(function(e,t){Q(e,t)})),u.on("ChannelMessage",(function(e,t){Q(e,t)})),u.on("MemberJoined",(function(e){try{return Promise.resolve(ie(J(),e)).then((function(){}))}catch(t){return Promise.reject(t)}})),u.on("MemberCountUpdated",(function(e){try{return console.log("RTM-MemberCountUpdated: ",e),Promise.resolve()}catch(t){return Promise.reject(t)}})),null!==E&&void 0!==E&&E.channel?Object.keys(E.channel).map((function(e){E.channel&&u.on(e,E.channel[e])})):null!==E&&void 0!==E&&E.client&&Object.keys(E.client).map((function(e){E.client&&l.on(e,E.client[e])})),r.tokenUrl){var e=r.tokenUrl,t=r.uid;l.on("TokenExpired",(function(){try{return console.log("token expired"),Promise.resolve(fetch(e+"/rtm/"+(t||0)+"/")).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtmToken;l.renewToken(t)}))}))}catch(n){return Promise.reject(n)}}))}return L(q.loggingIn),Promise.resolve(W()).then((function(){return L(q.loggedIn),Promise.resolve(Y()).then((function(){L(q.connected),C((function(e){return h({},e,{0:null===i||void 0===i?void 0:i.username})})),re(J())}))}))}catch(n){return Promise.reject(n)}},J=function(){return{messageType:"UserData",rtmId:(null===i||void 0===i?void 0:i.uid)||f.current,rtcId:M.current,username:null===i||void 0===i?void 0:i.username,role:"audience"===r.role?1:0,uikit:{platform:"web",framework:"react",version:"1.2.0"},agora:{rtm:d.VERSION,rtc:a.VERSION}}},Q=function(e,t){var n;if("RAW"===e.messageType?n=_e(e.rawMessage):"TEXT"===e.messageType&&(n=JSON.parse(e.text)),console.log(n,t),n)switch(n.messageType){case"UserData":$(n);break;case"MuteRequest":ee(n);break;case"RtmDataRequest":switch(n.type){case"ping":te(t);break;case"userData":ne(t);break;default:console.log(t)}break;default:console.log("unknown message content")}else console.log("unknown rtm message type")},$=function(e){S((function(t){var n;return h({},t,((n={})[e.rtcId]=e.rtmId,n))})),C((function(t){var n;return h({},t,((n={})[e.rtcId]=e.username,n))})),O((function(t){var n;return h({},t,((n={})[e.rtmId]=e,n))}))},ee=function(e){M.current===e.rtcId&&(e.isForceful?e.mute?e.device===z.microphone?U&&V(g,B,U):e.device===z.camera&&j&&K(g,B,j):console.error("cannot force unmute"):e.device===z.microphone?e.mute?k(H.muteMic):k(H.unmuteMic):e.device===z.camera&&(e.mute?k(H.muteCamera):k(H.unmuteCamera)))},te=function(e){ie({messageType:"RtmDataRequest",type:"pong"},e)},ne=function(e){ie(J(),e)},re=function(e){try{var t=l.createMessage({text:JSON.stringify(e),messageType:d.MessageType.TEXT}),n=p((function(){return Promise.resolve(u.sendMessage(t)).then((function(){}))}),(function(e){console.error(e)}));return Promise.resolve(n&&n.then?n.then((function(){})):void 0)}catch(r){return Promise.reject(r)}},ie=function(e,t){try{var n=l.createMessage({text:JSON.stringify(e),messageType:d.MessageType.TEXT}),r=p((function(){return Promise.resolve(l.sendMessageToPeer(n,String(t))).then((function(){}))}),(function(e){console.error(e)}));return Promise.resolve(r&&r.then?r.then((function(){})):void 0)}catch(i){return Promise.reject(i)}};return(0,n.useEffect)((function(){return G&&(Z(),c(!0)),function(){G&&function(){try{return Promise.resolve(l.logout()).then((function(){return Promise.resolve(l.removeAllListeners()).then((function(){}))}))}catch(e){return Promise.reject(e)}}()}}),[r.channel,r.appId,G]),n.createElement(X,{value:{rtmStatus:D,sendPeerMessage:ie,sendChannelMessage:re,sendMuteRequest:function(e,t,n){var r=!1===(null===i||void 0===i?void 0:i.showPopUpBeforeRemoteMute),o={messageType:"MuteRequest",device:e,rtcId:t,mute:n,isForceful:r},s=b[t];r&&!n?console.log("cannot send force unmute request"):s?ie(o,s):console.log("peer not found")},rtmClient:l,uidMap:b,usernames:w,userDataMap:I,popUpState:N,setPopUpState:k}},s?e.children:n.createElement(n.Fragment,null))},ge=(new TextEncoder,new TextDecoder),_e=function(e){return JSON.parse(ge.decode(e))};function Ee(){var e=(0,n.useContext)(v).styleProps,t=(0,n.useContext)(J),r=t.popUpState,i=t.setPopUpState,o=(e||{}).popUpContainer,s=(0,n.useContext)(_),a=s.dispatch,c=s.localVideoTrack,l=s.localAudioTrack,u=(0,n.useContext)(F);return r!==H.closed?n.createElement("div",{style:h({},ve.container,o)},n.createElement("div",{style:{color:"#fff",fontSize:18,fontWeight:700}},r===H.muteCamera||r===H.muteMic?"Mute ":"Unmute ",r===H.muteCamera||r===H.unmuteCamera?"Camera":"Mic","?"),n.createElement("div",{style:{flexDirection:"row",display:"flex",width:"100%",justifyContent:"space-around"}},n.createElement("div",{onClick:function(){switch(r){case H.muteCamera:u.hasVideo&&c&&K(u,a,c);break;case H.muteMic:u.hasAudio&&l&&V(u,a,l);break;case H.unmuteCamera:!u.hasVideo&&c&&K(u,a,c);break;case H.unmuteMic:!u.hasAudio&&l&&V(u,a,l)}i(H.closed)},style:ve.button},"Confirm"),n.createElement("div",{style:ve.buttonClose,onClick:function(){return i(H.closed)}},"Close"))):null}var ve={button:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},buttonClose:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},container:{backgroundColor:"#007bffaa",position:"absolute",width:240,height:80,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}},ye=function(){var e=(0,n.useContext)(v).rtcProps;return n.createElement(L,{callActive:e.callActive},n.createElement(j,null,e.disableRtm?n.createElement(n.Fragment,null,(null===e||void 0===e?void 0:e.layout)===m.grid?n.createElement(ue,null):n.createElement(le,null),n.createElement(Z,null)):n.createElement(me,null,n.createElement(Ee,null),(null===e||void 0===e?void 0:e.layout)===m.grid?n.createElement(ue,null):n.createElement(le,null),n.createElement(Z,null))))},be={display:"flex",flex:1,minHeight:0,flexDirection:"column"};const Se=function(e){var t=e.styleProps,r=e.rtcProps,i=(t||{}).UIKitContainer;return n.createElement(y,{value:e},n.createElement("div",{style:h({},be,i)},"audience"===r.role?n.createElement(ye,null):n.createElement(he,null,n.createElement(ye,null))))},Te=JSON.parse('{"w":"007eJxTYFiwoXHp6U6+r9pvotVKrhz+s0HwLK/xjqVJsU8zrp/6eZ1dgcEo1dI8LcUsMcXSMsUkMTHVMtkkOdnIIs3AxNzcyNjSaP3mgtSGQEaGrKo0FkYGCATxORiSMxLz8lJzDBkYAMBrI6A="}');var we=__webpack_require__(5801);function Ce(e,t){return function(){return e.apply(t,arguments)}}const{toString:Re}=Object.prototype,{getPrototypeOf:Ie}=Object,Oe=(Ae=Object.create(null),e=>{const t=Re.call(e);return Ae[t]||(Ae[t]=t.slice(8,-1).toLowerCase())});var Ae;const Ne=e=>(e=e.toLowerCase(),t=>Oe(t)===e),ke=e=>t=>typeof t===e,{isArray:Pe}=Array,De=ke("undefined");const Le=Ne("ArrayBuffer");const xe=ke("string"),Me=ke("function"),Ue=ke("number"),Fe=e=>null!==e&&"object"===typeof e,je=e=>{if("object"!==Oe(e))return!1;const t=Ie(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Ve=Ne("Date"),Be=Ne("File"),Ge=Ne("Blob"),qe=Ne("FileList"),We=Ne("URLSearchParams");function ze(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),Pe(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const r=i?Object.getOwnPropertyNames(e):Object.keys(e),o=r.length;let s;for(n=0;n<o;n++)s=r[n],t.call(null,e[s],s,e)}}function He(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const Ke="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,Ye=e=>!De(e)&&e!==Ke;const Ze=(Je="undefined"!==typeof Uint8Array&&Ie(Uint8Array),e=>Je&&e instanceof Je);var Je;const Xe=Ne("HTMLFormElement"),Qe=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),$e=Ne("RegExp"),et=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};ze(n,((n,i)=>{let o;!1!==(o=t(n,i,e))&&(r[i]=o||n)})),Object.defineProperties(e,r)},tt="abcdefghijklmnopqrstuvwxyz",nt="0123456789",rt={DIGIT:nt,ALPHA:tt,ALPHA_DIGIT:tt+tt.toUpperCase()+nt};const it=Ne("AsyncFunction"),ot={isArray:Pe,isArrayBuffer:Le,isBuffer:function(e){return null!==e&&!De(e)&&null!==e.constructor&&!De(e.constructor)&&Me(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||Me(e.append)&&("formdata"===(t=Oe(e))||"object"===t&&Me(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Le(e.buffer),t},isString:xe,isNumber:Ue,isBoolean:e=>!0===e||!1===e,isObject:Fe,isPlainObject:je,isUndefined:De,isDate:Ve,isFile:Be,isBlob:Ge,isRegExp:$e,isFunction:Me,isStream:e=>Fe(e)&&Me(e.pipe),isURLSearchParams:We,isTypedArray:Ze,isFileList:qe,forEach:ze,merge:function e(){const{caseless:t}=Ye(this)&&this||{},n={},r=(r,i)=>{const o=t&&He(n,i)||i;je(n[o])&&je(r)?n[o]=e(n[o],r):je(r)?n[o]=e({},r):Pe(r)?n[o]=r.slice():n[o]=r};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&ze(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return ze(t,((t,r)=>{n&&Me(t)?e[r]=Ce(t,n):e[r]=t}),{allOwnKeys:r}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,o,s;const a={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)s=i[o],r&&!r(s,e,t)||a[s]||(t[s]=e[s],a[s]=!0);e=!1!==n&&Ie(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Oe,kindOfTest:Ne,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(Pe(e))return e;let t=e.length;if(!Ue(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:Xe,hasOwnProperty:Qe,hasOwnProp:Qe,reduceDescriptors:et,freezeMethods:e=>{et(e,((t,n)=>{if(Me(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];Me(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return Pe(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:He,global:Ke,isContextDefined:Ye,ALPHABET:rt,generateString:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rt.ALPHA_DIGIT,n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&Me(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(Fe(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=Pe(e)?[]:{};return ze(e,((e,t)=>{const o=n(e,r+1);!De(o)&&(i[t]=o)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:it,isThenable:e=>e&&(Fe(e)||Me(e))&&Me(e.then)&&Me(e.catch)};function st(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}ot.inherits(st,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ot.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const at=st.prototype,ct={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{ct[e]={value:e}})),Object.defineProperties(st,ct),Object.defineProperty(at,"isAxiosError",{value:!0}),st.from=(e,t,n,r,i,o)=>{const s=Object.create(at);return ot.toFlatObject(e,s,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),st.call(s,e.message,t,n,r,i),s.cause=e,s.name=e.name,o&&Object.assign(s,o),s};const lt=st;function ut(e){return ot.isPlainObject(e)||ot.isArray(e)}function dt(e){return ot.endsWith(e,"[]")?e.slice(0,-2):e}function ht(e,t,n){return e?e.concat(t).map((function(e,t){return e=dt(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const pt=ot.toFlatObject(ot,{},null,(function(e){return/^is[A-Z]/.test(e)}));const ft=function(e,t,n){if(!ot.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=ot.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!ot.isUndefined(t[e])}))).metaTokens,i=n.visitor||l,o=n.dots,s=n.indexes,a=(n.Blob||"undefined"!==typeof Blob&&Blob)&&ot.isSpecCompliantForm(t);if(!ot.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(ot.isDate(e))return e.toISOString();if(!a&&ot.isBlob(e))throw new lt("Blob is not supported. Use a Buffer instead.");return ot.isArrayBuffer(e)||ot.isTypedArray(e)?a&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let a=e;if(e&&!i&&"object"===typeof e)if(ot.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(ot.isArray(e)&&function(e){return ot.isArray(e)&&!e.some(ut)}(e)||(ot.isFileList(e)||ot.endsWith(n,"[]"))&&(a=ot.toArray(e)))return n=dt(n),a.forEach((function(e,r){!ot.isUndefined(e)&&null!==e&&t.append(!0===s?ht([n],r,o):null===s?n:n+"[]",c(e))})),!1;return!!ut(e)||(t.append(ht(i,n,o),c(e)),!1)}const u=[],d=Object.assign(pt,{defaultVisitor:l,convertValue:c,isVisitable:ut});if(!ot.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!ot.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+r.join("."));u.push(n),ot.forEach(n,(function(n,o){!0===(!(ot.isUndefined(n)||null===n)&&i.call(t,n,ot.isString(o)?o.trim():o,r,d))&&e(n,r?r.concat(o):[o])})),u.pop()}}(e),t};function mt(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function gt(e,t){this._pairs=[],e&&ft(e,this,t)}const _t=gt.prototype;_t.append=function(e,t){this._pairs.push([e,t])},_t.toString=function(e){const t=e?function(t){return e.call(this,t,mt)}:mt;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const Et=gt;function vt(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function yt(e,t,n){if(!t)return e;const r=n&&n.encode||vt,i=n&&n.serialize;let o;if(o=i?i(t,n):ot.isURLSearchParams(t)?t.toString():new Et(t,n).toString(r),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}const bt=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ot.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},St={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Tt={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Et,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},wt="undefined"!==typeof window&&"undefined"!==typeof document,Ct=(Rt="undefined"!==typeof navigator&&navigator.product,wt&&["ReactNative","NativeScript","NS"].indexOf(Rt)<0);var Rt;const It="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,Ot={...e,...Tt};const At=function(e){function t(e,n,r,i){let o=e[i++];const s=Number.isFinite(+o),a=i>=e.length;if(o=!o&&ot.isArray(r)?r.length:o,a)return ot.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!s;r[o]&&ot.isObject(r[o])||(r[o]=[]);return t(e,n,r[o],i)&&ot.isArray(r[o])&&(r[o]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let o;for(r=0;r<i;r++)o=n[r],t[o]=e[o];return t}(r[o])),!s}if(ot.isFormData(e)&&ot.isFunction(e.entries)){const n={};return ot.forEachEntry(e,((e,r)=>{t(function(e){return ot.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null};const Nt={transitional:St,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=ot.isObject(e);i&&ot.isHTMLForm(e)&&(e=new FormData(e));if(ot.isFormData(e))return r&&r?JSON.stringify(At(e)):e;if(ot.isArrayBuffer(e)||ot.isBuffer(e)||ot.isStream(e)||ot.isFile(e)||ot.isBlob(e))return e;if(ot.isArrayBufferView(e))return e.buffer;if(ot.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return ft(e,new Ot.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return Ot.isNode&&ot.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((o=ot.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return ft(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(ot.isString(e))try{return(t||JSON.parse)(e),ot.trim(e)}catch(r){if("SyntaxError"!==r.name)throw r}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Nt.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&ot.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(i){if(n){if("SyntaxError"===i.name)throw lt.from(i,lt.ERR_BAD_RESPONSE,this,null,this.response);throw i}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ot.classes.FormData,Blob:Ot.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ot.forEach(["delete","get","head","post","put","patch"],(e=>{Nt.headers[e]={}}));const kt=Nt,Pt=ot.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Dt=Symbol("internals");function Lt(e){return e&&String(e).trim().toLowerCase()}function xt(e){return!1===e||null==e?e:ot.isArray(e)?e.map(xt):String(e)}function Mt(e,t,n,r,i){return ot.isFunction(r)?r.call(this,t,n):(i&&(t=n),ot.isString(t)?ot.isString(r)?-1!==t.indexOf(r):ot.isRegExp(r)?r.test(t):void 0:void 0)}class Ut{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=Lt(t);if(!i)throw new Error("header name must be a non-empty string");const o=ot.findKey(r,i);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||t]=xt(e))}const o=(e,t)=>ot.forEach(e,((e,n)=>i(e,n,t)));return ot.isPlainObject(e)||e instanceof this.constructor?o(e,t):ot.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?o((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach((function(e){i=e.indexOf(":"),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!n||t[n]&&Pt[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t):null!=e&&i(t,e,n),this}get(e,t){if(e=Lt(e)){const n=ot.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(ot.isFunction(t))return t.call(this,e,n);if(ot.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Lt(e)){const n=ot.findKey(this,e);return!(!n||void 0===this[n]||t&&!Mt(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=Lt(e)){const i=ot.findKey(n,e);!i||t&&!Mt(0,n[i],i,t)||(delete n[i],r=!0)}}return ot.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!Mt(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return ot.forEach(this,((r,i)=>{const o=ot.findKey(n,i);if(o)return t[o]=xt(r),void delete t[i];const s=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):String(i).trim();s!==i&&delete t[i],t[s]=xt(r),n[s]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return ot.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&ot.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,n]=e;return t+": "+n})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((e=>t.set(e))),t}static accessor(e){const t=(this[Dt]=this[Dt]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=Lt(e);t[r]||(!function(e,t){const n=ot.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return ot.isArray(e)?e.forEach(r):r(e),this}}Ut.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ot.reduceDescriptors(Ut.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}})),ot.freezeMethods(Ut);const Ft=Ut;function jt(e,t){const n=this||kt,r=t||n,i=Ft.from(r.headers);let o=r.data;return ot.forEach(e,(function(e){o=e.call(n,o,i.normalize(),t?t.status:void 0)})),i.normalize(),o}function Vt(e){return!(!e||!e.__CANCEL__)}function Bt(e,t,n){lt.call(this,null==e?"canceled":e,lt.ERR_CANCELED,t,n),this.name="CanceledError"}ot.inherits(Bt,lt,{__CANCEL__:!0});const Gt=Bt;const qt=Ot.hasStandardBrowserEnv?{write(e,t,n,r,i,o){const s=[e+"="+encodeURIComponent(t)];ot.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),ot.isString(r)&&s.push("path="+r),ot.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Wt(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const zt=Ot.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=ot.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};const Ht=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,o=0,s=0;return t=void 0!==t?t:1e3,function(a){const c=Date.now(),l=r[s];i||(i=c),n[o]=a,r[o]=c;let u=s,d=0;for(;u!==o;)d+=n[u++],u%=e;if(o=(o+1)%e,o===s&&(s=(s+1)%e),c-i<t)return;const h=l&&c-l;return h?Math.round(1e3*d/h):void 0}};function Kt(e,t){let n=0;const r=Ht(50,250);return i=>{const o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-n,c=r(a);n=o;const l={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&o<=s?(s-o)/c:void 0,event:i};l[t?"download":"upload"]=!0,e(l)}}const Yt="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){let r=e.data;const i=Ft.from(e.headers).normalize();let o,s,{responseType:a,withXSRFToken:c}=e;function l(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}if(ot.isFormData(r))if(Ot.hasStandardBrowserEnv||Ot.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if(!1!==(s=i.getContentType())){const[e,...t]=s?s.split(";").map((e=>e.trim())).filter(Boolean):[];i.setContentType([e||"multipart/form-data",...t].join("; "))}let u=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.set("Authorization","Basic "+btoa(t+":"+n))}const d=Wt(e.baseURL,e.url);function h(){if(!u)return;const r=Ft.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders());!function(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new lt("Request failed with status code "+n.status,[lt.ERR_BAD_REQUEST,lt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),l()}),(function(e){n(e),l()}),{data:a&&"text"!==a&&"json"!==a?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:r,config:e,request:u}),u=null}if(u.open(e.method.toUpperCase(),yt(d,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=h:u.onreadystatechange=function(){u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&setTimeout(h)},u.onabort=function(){u&&(n(new lt("Request aborted",lt.ECONNABORTED,e,u)),u=null)},u.onerror=function(){n(new lt("Network Error",lt.ERR_NETWORK,e,u)),u=null},u.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||St;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new lt(t,r.clarifyTimeoutError?lt.ETIMEDOUT:lt.ECONNABORTED,e,u)),u=null},Ot.hasStandardBrowserEnv&&(c&&ot.isFunction(c)&&(c=c(e)),c||!1!==c&&zt(d))){const t=e.xsrfHeaderName&&e.xsrfCookieName&&qt.read(e.xsrfCookieName);t&&i.set(e.xsrfHeaderName,t)}void 0===r&&i.setContentType(null),"setRequestHeader"in u&&ot.forEach(i.toJSON(),(function(e,t){u.setRequestHeader(t,e)})),ot.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),a&&"json"!==a&&(u.responseType=e.responseType),"function"===typeof e.onDownloadProgress&&u.addEventListener("progress",Kt(e.onDownloadProgress,!0)),"function"===typeof e.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",Kt(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=t=>{u&&(n(!t||t.type?new Gt(null,e,u):t),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));const p=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(d);p&&-1===Ot.protocols.indexOf(p)?n(new lt("Unsupported protocol "+p+":",lt.ERR_BAD_REQUEST,e)):u.send(r||null)}))},Zt={http:null,xhr:Yt};ot.forEach(Zt,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(n){}Object.defineProperty(e,"adapterName",{value:t})}}));const Jt=e=>"- ".concat(e),Xt=e=>ot.isFunction(e)||null===e||!1===e,Qt=e=>{e=ot.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let o=0;o<t;o++){let t;if(n=e[o],r=n,!Xt(n)&&(r=Zt[(t=String(n)).toLowerCase()],void 0===r))throw new lt("Unknown adapter '".concat(t,"'"));if(r)break;i[t||"#"+o]=r}if(!r){const e=Object.entries(i).map((e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")}));let n=t?e.length>1?"since :\n"+e.map(Jt).join("\n"):" "+Jt(e[0]):"as no adapter specified";throw new lt("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return r};function $t(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Gt(null,e)}function en(e){$t(e),e.headers=Ft.from(e.headers),e.data=jt.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Qt(e.adapter||kt.adapter)(e).then((function(t){return $t(e),t.data=jt.call(e,e.transformResponse,t),t.headers=Ft.from(t.headers),t}),(function(t){return Vt(t)||($t(e),t&&t.response&&(t.response.data=jt.call(e,e.transformResponse,t.response),t.response.headers=Ft.from(t.response.headers))),Promise.reject(t)}))}const tn=e=>e instanceof Ft?e.toJSON():e;function nn(e,t){t=t||{};const n={};function r(e,t,n){return ot.isPlainObject(e)&&ot.isPlainObject(t)?ot.merge.call({caseless:n},e,t):ot.isPlainObject(t)?ot.merge({},t):ot.isArray(t)?t.slice():t}function i(e,t,n){return ot.isUndefined(t)?ot.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function o(e,t){if(!ot.isUndefined(t))return r(void 0,t)}function s(e,t){return ot.isUndefined(t)?ot.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function a(n,i,o){return o in t?r(n,i):o in e?r(void 0,n):void 0}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(e,t)=>i(tn(e),tn(t),!0)};return ot.forEach(Object.keys(Object.assign({},e,t)),(function(r){const o=c[r]||i,s=o(e[r],t[r],r);ot.isUndefined(s)&&o!==a||(n[r]=s)})),n}const rn="1.6.2",on={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{on[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const sn={};on.transitional=function(e,t,n){function r(e,t){return"[Axios v1.6.2] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,o)=>{if(!1===e)throw new lt(r(i," has been removed"+(t?" in "+t:"")),lt.ERR_DEPRECATED);return t&&!sn[i]&&(sn[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}};const an={assertOptions:function(e,t,n){if("object"!==typeof e)throw new lt("options must be an object",lt.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const o=r[i],s=t[o];if(s){const t=e[o],n=void 0===t||s(t,o,e);if(!0!==n)throw new lt("option "+o+" must be "+n,lt.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new lt("Unknown option "+o,lt.ERR_BAD_OPTION)}},validators:on},cn=an.validators;class ln{constructor(e){this.defaults=e,this.interceptors={request:new bt,response:new bt}}request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=nn(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&an.assertOptions(n,{silentJSONParsing:cn.transitional(cn.boolean),forcedJSONParsing:cn.transitional(cn.boolean),clarifyTimeoutError:cn.transitional(cn.boolean)},!1),null!=r&&(ot.isFunction(r)?t.paramsSerializer={serialize:r}:an.assertOptions(r,{encode:cn.function,serialize:cn.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&ot.merge(i.common,i[t.method]);i&&ot.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=Ft.concat(o,i);const s=[];let a=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));const c=[];let l;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let u,d=0;if(!a){const e=[en.bind(this),void 0];for(e.unshift.apply(e,s),e.push.apply(e,c),u=e.length,l=Promise.resolve(t);d<u;)l=l.then(e[d++],e[d++]);return l}u=s.length;let h=t;for(d=0;d<u;){const e=s[d++],t=s[d++];try{h=e(h)}catch(Io){t.call(this,Io);break}}try{l=en.call(this,h)}catch(Io){return Promise.reject(Io)}for(d=0,u=c.length;d<u;)l=l.then(c[d++],c[d++]);return l}getUri(e){return yt(Wt((e=nn(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}ot.forEach(["delete","get","head","options"],(function(e){ln.prototype[e]=function(t,n){return this.request(nn(n||{},{method:e,url:t,data:(n||{}).data}))}})),ot.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(nn(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}ln.prototype[e]=t(),ln.prototype[e+"Form"]=t(!0)}));const un=ln;class dn{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new Gt(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new dn((function(t){e=t})),cancel:e}}}const hn=dn;const pn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(pn).forEach((e=>{let[t,n]=e;pn[n]=t}));const fn=pn;const mn=function e(t){const n=new un(t),r=Ce(un.prototype.request,n);return ot.extend(r,un.prototype,n,{allOwnKeys:!0}),ot.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(nn(t,n))},r}(kt);mn.Axios=un,mn.CanceledError=Gt,mn.CancelToken=hn,mn.isCancel=Vt,mn.VERSION=rn,mn.toFormData=ft,mn.AxiosError=lt,mn.Cancel=mn.CanceledError,mn.all=function(e){return Promise.all(e)},mn.spread=function(e){return function(t){return e.apply(null,t)}},mn.isAxiosError=function(e){return ot.isObject(e)&&!0===e.isAxiosError},mn.mergeConfig=nn,mn.AxiosHeaders=Ft,mn.formToJSON=e=>At(ot.isHTMLForm(e)?new FormData(e):e),mn.getAdapter=Qt,mn.HttpStatusCode=fn,mn.default=mn;const gn=mn;var _n=__webpack_require__(3366),En=__webpack_require__(7462),vn=__webpack_require__(3733),yn=__webpack_require__(4419),bn=__webpack_require__(7630),Sn=__webpack_require__(1046),Tn=__webpack_require__(2071),wn=__webpack_require__(9683),Cn=__webpack_require__(3031);function Rn(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function In(e,t){return In=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},In(e,t)}function On(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,In(e,t)}const An=n.createContext(null);function Nn(e,t){var r=Object.create(null);return e&&n.Children.map(e,(function(e){return e})).forEach((function(e){r[e.key]=function(e){return t&&(0,n.isValidElement)(e)?t(e):e}(e)})),r}function kn(e,t,n){return null!=n[t]?n[t]:e.props[t]}function Pn(e,t,r){var i=Nn(e.children),o=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var r,i=Object.create(null),o=[];for(var s in e)s in t?o.length&&(i[s]=o,o=[]):o.push(s);var a={};for(var c in t){if(i[c])for(r=0;r<i[c].length;r++){var l=i[c][r];a[i[c][r]]=n(l)}a[c]=n(c)}for(r=0;r<o.length;r++)a[o[r]]=n(o[r]);return a}(t,i);return Object.keys(o).forEach((function(s){var a=o[s];if((0,n.isValidElement)(a)){var c=s in t,l=s in i,u=t[s],d=(0,n.isValidElement)(u)&&!u.props.in;!l||c&&!d?l||!c||d?l&&c&&(0,n.isValidElement)(u)&&(o[s]=(0,n.cloneElement)(a,{onExited:r.bind(null,a),in:u.props.in,exit:kn(a,"exit",e),enter:kn(a,"enter",e)})):o[s]=(0,n.cloneElement)(a,{in:!1}):o[s]=(0,n.cloneElement)(a,{onExited:r.bind(null,a),in:!0,exit:kn(a,"exit",e),enter:kn(a,"enter",e)})}})),o}var Dn=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},Ln=function(e){function t(t,n){var r,i=(r=e.call(this,t,n)||this).handleExited.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r));return r.state={contextValue:{isMounting:!0},handleExited:i,firstRender:!0},r}On(t,e);var r=t.prototype;return r.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},r.componentWillUnmount=function(){this.mounted=!1},t.getDerivedStateFromProps=function(e,t){var r,i,o=t.children,s=t.handleExited;return{children:t.firstRender?(r=e,i=s,Nn(r.children,(function(e){return(0,n.cloneElement)(e,{onExited:i.bind(null,e),in:!0,appear:kn(e,"appear",r),enter:kn(e,"enter",r),exit:kn(e,"exit",r)})}))):Pn(e,o,s),firstRender:!1}},r.handleExited=function(e,t){var n=Nn(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var n=(0,En.Z)({},t.children);return delete n[e.key],{children:n}})))},r.render=function(){var e=this.props,t=e.component,r=e.childFactory,i=(0,_n.Z)(e,["component","childFactory"]),o=this.state.contextValue,s=Dn(this.state.children).map(r);return delete i.appear,delete i.enter,delete i.exit,null===t?n.createElement(An.Provider,{value:o},s):n.createElement(An.Provider,{value:o},n.createElement(t,i,s))},t}(n.Component);Ln.propTypes={},Ln.defaultProps={component:"div",childFactory:function(e){return e}};const xn=Ln;var Mn=__webpack_require__(2564),Un=__webpack_require__(5438),Fn=__webpack_require__(2561),jn=__webpack_require__(9140),Vn=(__webpack_require__(3361),__webpack_require__(2110),(0,Mn.w)((function(e,t){var r=e.styles,i=(0,jn.O)([r],void 0,n.useContext(Mn.T));if(!Mn.i){for(var o,s=i.name,a=i.styles,c=i.next;void 0!==c;)s+=" "+c.name,a+=c.styles,c=c.next;var l=!0===t.compat,u=t.insert("",{name:s,styles:a},t.sheet,l);return l?null:n.createElement("style",((o={})["data-emotion"]=t.key+"-global "+s,o.dangerouslySetInnerHTML={__html:u},o.nonce=t.sheet.nonce,o))}var d=n.useRef();return(0,Fn.j)((function(){var e=t.key+"-global",n=new t.sheet.constructor({key:e,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),r=!1,o=document.querySelector('style[data-emotion="'+e+" "+i.name+'"]');return t.sheet.tags.length&&(n.before=t.sheet.tags[0]),null!==o&&(r=!0,o.setAttribute("data-emotion",e),n.hydrate([o])),d.current=[n,r],function(){n.flush()}}),[t]),(0,Fn.j)((function(){var e=d.current,n=e[0];if(e[1])e[1]=!1;else{if(void 0!==i.next&&(0,Un.My)(t,i.next,!0),n.tags.length){var r=n.tags[n.tags.length-1].nextElementSibling;n.before=r,n.flush()}t.insert("",i,n,!1)}}),[t,i.name]),null})));function Bn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,jn.O)(t)}var Gn=function(){var e=Bn.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}};var qn=__webpack_require__(184);const Wn=function(e){const{className:t,classes:r,pulsate:i=!1,rippleX:o,rippleY:s,rippleSize:a,in:c,onExited:l,timeout:u}=e,[d,h]=n.useState(!1),p=(0,vn.Z)(t,r.ripple,r.rippleVisible,i&&r.ripplePulsate),f={width:a,height:a,top:-a/2+s,left:-a/2+o},m=(0,vn.Z)(r.child,d&&r.childLeaving,i&&r.childPulsate);return c||d||h(!0),n.useEffect((()=>{if(!c&&null!=l){const e=setTimeout(l,u);return()=>{clearTimeout(e)}}}),[l,c,u]),(0,qn.jsx)("span",{className:p,style:f,children:(0,qn.jsx)("span",{className:m})})};var zn=__webpack_require__(5878);const Hn=(0,zn.Z)("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]);var Kn,Yn,Zn,Jn;const Xn=["center","classes","className"];let Qn,$n,er,tr;const nr=Gn(Qn||(Qn=Kn||(Kn=Rn(["\n  0% {\n    transform: scale(0);\n    opacity: 0.1;\n  }\n\n  100% {\n    transform: scale(1);\n    opacity: 0.3;\n  }\n"])))),rr=Gn($n||($n=Yn||(Yn=Rn(["\n  0% {\n    opacity: 1;\n  }\n\n  100% {\n    opacity: 0;\n  }\n"])))),ir=Gn(er||(er=Zn||(Zn=Rn(["\n  0% {\n    transform: scale(1);\n  }\n\n  50% {\n    transform: scale(0.92);\n  }\n\n  100% {\n    transform: scale(1);\n  }\n"])))),or=(0,bn.ZP)("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),sr=(0,bn.ZP)(Wn,{name:"MuiTouchRipple",slot:"Ripple"})(tr||(tr=Jn||(Jn=Rn(["\n  opacity: 0;\n  position: absolute;\n\n  &."," {\n    opacity: 0.3;\n    transform: scale(1);\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ",";\n  }\n\n  &."," {\n    animation-duration: ","ms;\n  }\n\n  & ."," {\n    opacity: 1;\n    display: block;\n    width: 100%;\n    height: 100%;\n    border-radius: 50%;\n    background-color: currentColor;\n  }\n\n  & ."," {\n    opacity: 0;\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ",";\n  }\n\n  & ."," {\n    position: absolute;\n    /* @noflip */\n    left: 0px;\n    top: 0;\n    animation-name: ",";\n    animation-duration: 2500ms;\n    animation-timing-function: ",";\n    animation-iteration-count: infinite;\n    animation-delay: 200ms;\n  }\n"]))),Hn.rippleVisible,nr,550,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),Hn.ripplePulsate,(e=>{let{theme:t}=e;return t.transitions.duration.shorter}),Hn.child,Hn.childLeaving,rr,550,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),Hn.childPulsate,ir,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut})),ar=n.forwardRef((function(e,t){const r=(0,Sn.Z)({props:e,name:"MuiTouchRipple"}),{center:i=!1,classes:o={},className:s}=r,a=(0,_n.Z)(r,Xn),[c,l]=n.useState([]),u=n.useRef(0),d=n.useRef(null);n.useEffect((()=>{d.current&&(d.current(),d.current=null)}),[c]);const h=n.useRef(!1),p=n.useRef(0),f=n.useRef(null),m=n.useRef(null);n.useEffect((()=>()=>{p.current&&clearTimeout(p.current)}),[]);const g=n.useCallback((e=>{const{pulsate:t,rippleX:n,rippleY:r,rippleSize:i,cb:s}=e;l((e=>[...e,(0,qn.jsx)(sr,{classes:{ripple:(0,vn.Z)(o.ripple,Hn.ripple),rippleVisible:(0,vn.Z)(o.rippleVisible,Hn.rippleVisible),ripplePulsate:(0,vn.Z)(o.ripplePulsate,Hn.ripplePulsate),child:(0,vn.Z)(o.child,Hn.child),childLeaving:(0,vn.Z)(o.childLeaving,Hn.childLeaving),childPulsate:(0,vn.Z)(o.childPulsate,Hn.childPulsate)},timeout:550,pulsate:t,rippleX:n,rippleY:r,rippleSize:i},u.current)])),u.current+=1,d.current=s}),[o]),_=n.useCallback((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const{pulsate:r=!1,center:o=i||t.pulsate,fakeElement:s=!1}=t;if("mousedown"===(null==e?void 0:e.type)&&h.current)return void(h.current=!1);"touchstart"===(null==e?void 0:e.type)&&(h.current=!0);const a=s?null:m.current,c=a?a.getBoundingClientRect():{width:0,height:0,left:0,top:0};let l,u,d;if(o||void 0===e||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)l=Math.round(c.width/2),u=Math.round(c.height/2);else{const{clientX:t,clientY:n}=e.touches&&e.touches.length>0?e.touches[0]:e;l=Math.round(t-c.left),u=Math.round(n-c.top)}if(o)d=Math.sqrt((2*c.width**2+c.height**2)/3),d%2===0&&(d+=1);else{const e=2*Math.max(Math.abs((a?a.clientWidth:0)-l),l)+2,t=2*Math.max(Math.abs((a?a.clientHeight:0)-u),u)+2;d=Math.sqrt(e**2+t**2)}null!=e&&e.touches?null===f.current&&(f.current=()=>{g({pulsate:r,rippleX:l,rippleY:u,rippleSize:d,cb:n})},p.current=setTimeout((()=>{f.current&&(f.current(),f.current=null)}),80)):g({pulsate:r,rippleX:l,rippleY:u,rippleSize:d,cb:n})}),[i,g]),E=n.useCallback((()=>{_({},{pulsate:!0})}),[_]),v=n.useCallback(((e,t)=>{if(clearTimeout(p.current),"touchend"===(null==e?void 0:e.type)&&f.current)return f.current(),f.current=null,void(p.current=setTimeout((()=>{v(e,t)})));f.current=null,l((e=>e.length>0?e.slice(1):e)),d.current=t}),[]);return n.useImperativeHandle(t,(()=>({pulsate:E,start:_,stop:v})),[E,_,v]),(0,qn.jsx)(or,(0,En.Z)({className:(0,vn.Z)(Hn.root,o.root,s),ref:m},a,{children:(0,qn.jsx)(xn,{component:null,exit:!0,children:c})}))})),cr=ar;var lr=__webpack_require__(1217);function ur(e){return(0,lr.Z)("MuiButtonBase",e)}const dr=(0,zn.Z)("MuiButtonBase",["root","disabled","focusVisible"]),hr=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],pr=(0,bn.ZP)("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},["&.".concat(dr.disabled)]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),fr=n.forwardRef((function(e,t){const r=(0,Sn.Z)({props:e,name:"MuiButtonBase"}),{action:i,centerRipple:o=!1,children:s,className:a,component:c="button",disabled:l=!1,disableRipple:u=!1,disableTouchRipple:d=!1,focusRipple:h=!1,LinkComponent:p="a",onBlur:f,onClick:m,onContextMenu:g,onDragLeave:_,onFocus:E,onFocusVisible:v,onKeyDown:y,onKeyUp:b,onMouseDown:S,onMouseLeave:T,onMouseUp:w,onTouchEnd:C,onTouchMove:R,onTouchStart:I,tabIndex:O=0,TouchRippleProps:A,touchRippleRef:N,type:k}=r,P=(0,_n.Z)(r,hr),D=n.useRef(null),L=n.useRef(null),x=(0,Tn.Z)(L,N),{isFocusVisibleRef:M,onFocus:U,onBlur:F,ref:j}=(0,Cn.Z)(),[V,B]=n.useState(!1);l&&V&&B(!1),n.useImperativeHandle(i,(()=>({focusVisible:()=>{B(!0),D.current.focus()}})),[]);const[G,q]=n.useState(!1);n.useEffect((()=>{q(!0)}),[]);const W=G&&!u&&!l;function z(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d;return(0,wn.Z)((r=>{t&&t(r);return!n&&L.current&&L.current[e](r),!0}))}n.useEffect((()=>{V&&h&&!u&&G&&L.current.pulsate()}),[u,h,V,G]);const H=z("start",S),K=z("stop",g),Y=z("stop",_),Z=z("stop",w),J=z("stop",(e=>{V&&e.preventDefault(),T&&T(e)})),X=z("start",I),Q=z("stop",C),$=z("stop",R),ee=z("stop",(e=>{F(e),!1===M.current&&B(!1),f&&f(e)}),!1),te=(0,wn.Z)((e=>{D.current||(D.current=e.currentTarget),U(e),!0===M.current&&(B(!0),v&&v(e)),E&&E(e)})),ne=()=>{const e=D.current;return c&&"button"!==c&&!("A"===e.tagName&&e.href)},re=n.useRef(!1),ie=(0,wn.Z)((e=>{h&&!re.current&&V&&L.current&&" "===e.key&&(re.current=!0,L.current.stop(e,(()=>{L.current.start(e)}))),e.target===e.currentTarget&&ne()&&" "===e.key&&e.preventDefault(),y&&y(e),e.target===e.currentTarget&&ne()&&"Enter"===e.key&&!l&&(e.preventDefault(),m&&m(e))})),oe=(0,wn.Z)((e=>{h&&" "===e.key&&L.current&&V&&!e.defaultPrevented&&(re.current=!1,L.current.stop(e,(()=>{L.current.pulsate(e)}))),b&&b(e),m&&e.target===e.currentTarget&&ne()&&" "===e.key&&!e.defaultPrevented&&m(e)}));let se=c;"button"===se&&(P.href||P.to)&&(se=p);const ae={};"button"===se?(ae.type=void 0===k?"button":k,ae.disabled=l):(P.href||P.to||(ae.role="button"),l&&(ae["aria-disabled"]=l));const ce=(0,Tn.Z)(t,j,D);const le=(0,En.Z)({},r,{centerRipple:o,component:c,disabled:l,disableRipple:u,disableTouchRipple:d,focusRipple:h,tabIndex:O,focusVisible:V}),ue=(e=>{const{disabled:t,focusVisible:n,focusVisibleClassName:r,classes:i}=e,o={root:["root",t&&"disabled",n&&"focusVisible"]},s=(0,yn.Z)(o,ur,i);return n&&r&&(s.root+=" ".concat(r)),s})(le);return(0,qn.jsxs)(pr,(0,En.Z)({as:se,className:(0,vn.Z)(ue.root,a),ownerState:le,onBlur:ee,onClick:m,onContextMenu:K,onFocus:te,onKeyDown:ie,onKeyUp:oe,onMouseDown:H,onMouseLeave:J,onMouseUp:Z,onDragLeave:Y,onTouchEnd:Q,onTouchMove:$,onTouchStart:X,ref:ce,tabIndex:l?-1:O,type:k},ae,P,{children:[s,W?(0,qn.jsx)(cr,(0,En.Z)({ref:x,center:o},A)):null]}))})),mr=fr;var gr=__webpack_require__(4036);function _r(e){return(0,lr.Z)("MuiFab",e)}const Er=(0,zn.Z)("MuiFab",["root","primary","secondary","extended","circular","focusVisible","disabled","colorInherit","sizeSmall","sizeMedium","sizeLarge","info","error","warning","success"]),vr=["children","className","color","component","disabled","disableFocusRipple","focusVisibleClassName","size","variant"],yr=(0,bn.ZP)(mr,{name:"MuiFab",slot:"Root",shouldForwardProp:e=>(0,bn.FO)(e)||"classes"===e,overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t["size".concat((0,gr.Z)(n.size))],"inherit"===n.color&&t.colorInherit,t[(0,gr.Z)(n.size)],t[n.color]]}})((e=>{let{theme:t,ownerState:n}=e;var r,i;return(0,En.Z)({},t.typography.button,{minHeight:36,transition:t.transitions.create(["background-color","box-shadow","border-color"],{duration:t.transitions.duration.short}),borderRadius:"50%",padding:0,minWidth:0,width:56,height:56,zIndex:(t.vars||t).zIndex.fab,boxShadow:(t.vars||t).shadows[6],"&:active":{boxShadow:(t.vars||t).shadows[12]},color:t.vars?t.vars.palette.text.primary:null==(r=(i=t.palette).getContrastText)?void 0:r.call(i,t.palette.grey[300]),backgroundColor:(t.vars||t).palette.grey[300],"&:hover":{backgroundColor:(t.vars||t).palette.grey.A100,"@media (hover: none)":{backgroundColor:(t.vars||t).palette.grey[300]},textDecoration:"none"},["&.".concat(Er.focusVisible)]:{boxShadow:(t.vars||t).shadows[6]}},"small"===n.size&&{width:40,height:40},"medium"===n.size&&{width:48,height:48},"extended"===n.variant&&{borderRadius:24,padding:"0 16px",width:"auto",minHeight:"auto",minWidth:48,height:48},"extended"===n.variant&&"small"===n.size&&{width:"auto",padding:"0 8px",borderRadius:17,minWidth:34,height:34},"extended"===n.variant&&"medium"===n.size&&{width:"auto",padding:"0 16px",borderRadius:20,minWidth:40,height:40},"inherit"===n.color&&{color:"inherit"})}),(e=>{let{theme:t,ownerState:n}=e;return(0,En.Z)({},"inherit"!==n.color&&"default"!==n.color&&null!=(t.vars||t).palette[n.color]&&{color:(t.vars||t).palette[n.color].contrastText,backgroundColor:(t.vars||t).palette[n.color].main,"&:hover":{backgroundColor:(t.vars||t).palette[n.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[n.color].main}}})}),(e=>{let{theme:t}=e;return{["&.".concat(Er.disabled)]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}})),br=n.forwardRef((function(e,t){const n=(0,Sn.Z)({props:e,name:"MuiFab"}),{children:r,className:i,color:o="default",component:s="button",disabled:a=!1,disableFocusRipple:c=!1,focusVisibleClassName:l,size:u="large",variant:d="circular"}=n,h=(0,_n.Z)(n,vr),p=(0,En.Z)({},n,{color:o,component:s,disabled:a,disableFocusRipple:c,size:u,variant:d}),f=(e=>{const{color:t,variant:n,classes:r,size:i}=e,o={root:["root",n,"size".concat((0,gr.Z)(i)),"inherit"===t?"colorInherit":t]},s=(0,yn.Z)(o,_r,r);return(0,En.Z)({},r,s)})(p);return(0,qn.jsx)(yr,(0,En.Z)({className:(0,vn.Z)(f.root,i),component:s,disabled:a,focusRipple:!c,focusVisibleClassName:(0,vn.Z)(f.focusVisible,l),ownerState:p,ref:t},h,{classes:f,children:r}))})),Sr=br,Tr=!1,wr=!1,Cr="${JSCORE_VERSION}",Rr=function(e,t){if(!e)throw Ir(t)},Ir=function(e){return new Error("Firebase Database ("+Cr+") INTERNAL ASSERT FAILED: "+e)},Or=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},Ar={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],o=i+1<e.length,s=o?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0,l=t>>2,u=(3&t)<<4|s>>4;let d=(15&s)<<2|c>>6,h=63&c;a||(h=64,o||(d=64)),r.push(n[l],n[u],n[d],n[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Or(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){const o=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{const o=e[n++],s=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0;++i;const s=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==o||null==s||null==a)throw new Nr;const c=t<<2|o>>4;if(r.push(c),64!==s){const e=o<<4&240|s>>2;if(r.push(e),64!==a){const e=s<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Nr extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const kr=function(e){const t=Or(e);return Ar.encodeByteArray(t,!0)},Pr=function(e){return kr(e).replace(/\./g,"")},Dr=function(e){try{return Ar.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Lr(e){return xr(void 0,e)}function xr(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=xr(e[n],t[n]));return e}const Mr=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof __webpack_require__.g)return __webpack_require__.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,Ur=()=>{try{return Mr()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&Dr(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},Fr=e=>{const t=(e=>{var t,n;return null===(n=null===(t=Ur())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},jr=()=>{var e;return null===(e=Ur())||void 0===e?void 0:e.config};class Vr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function Br(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function Gr(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Br())}function qr(){return!0===Tr||!0===wr}class Wr extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Wr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,zr.prototype.create)}}class zr{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(Hr,((e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")}))}(r,t):"Error",o="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new Wr(n,o,t)}}const Hr=/\{\$([^}]+)}/g;function Kr(e){return JSON.parse(e)}function Yr(e){return JSON.stringify(e)}const Zr=function(e){let t={},n={},r={},i="";try{const o=e.split(".");t=Kr(Dr(o[0])||""),n=Kr(Dr(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(o){}return{header:t,claims:n,data:r,signature:i}};function Jr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Xr(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function Qr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function $r(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function ei(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],o=t[i];if(ti(n)&&ti(o)){if(!ei(n,o))return!1}else if(n!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function ti(e){return null!==e&&"object"===typeof e}class ni{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"===typeof e)for(let u=0;u<16;u++)n[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)n[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const e=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=4294967295&(e<<1|e>>>31)}let r,i,o=this.chain_[0],s=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(r=c^s&(a^c),i=1518500249):(r=s^a^c,i=1859775393):u<60?(r=s&a|c&(s|a),i=2400959708):(r=s^a^c,i=3395469782);const e=(o<<5|o>>>27)+r+l+i+n[u]&4294967295;l=c,c=a,a=4294967295&(s<<30|s>>>2),s=o,o=e}this.chain_[0]=this.chain_[0]+o&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let o=this.inbuf_;for(;r<t;){if(0===o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"===typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let r=0;r<5;r++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[r]>>t&255,++n;return e}}function ri(e,t){return"".concat(e," failed: ").concat(t," argument ")}const ii=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function oi(e){return e&&e._delegate?e._delegate:e}class si{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ai="[DEFAULT]";class ci{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Vr;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:ai})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ai;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ai;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ai;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,o]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&o.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:li(t),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(i){}return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ai;return this.component?this.component.multipleInstances?e:ai:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function li(e){return e===ai?void 0:e}class ui{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new ci(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const di=[];var hi;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(hi||(hi={}));const pi={debug:hi.DEBUG,verbose:hi.VERBOSE,info:hi.INFO,warn:hi.WARN,error:hi.ERROR,silent:hi.SILENT},fi=hi.INFO,mi={[hi.DEBUG]:"log",[hi.VERBOSE]:"log",[hi.INFO]:"info",[hi.WARN]:"warn",[hi.ERROR]:"error"},gi=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=mi[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];console[r]("[".concat(n,"]  ").concat(e.name,":"),...o)};class _i{constructor(e){this.name=e,this._logLevel=fi,this._logHandler=gi,this._userLogHandler=null,di.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in hi))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?pi[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,hi.DEBUG,...t),this._logHandler(this,hi.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,hi.VERBOSE,...t),this._logHandler(this,hi.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,hi.INFO,...t),this._logHandler(this,hi.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,hi.WARN,...t),this._logHandler(this,hi.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,hi.ERROR,...t),this._logHandler(this,hi.ERROR,...t)}}const Ei=(e,t)=>t.some((t=>e instanceof t));let vi,yi;const bi=new WeakMap,Si=new WeakMap,Ti=new WeakMap,wi=new WeakMap,Ci=new WeakMap;let Ri={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Si.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Ti.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ai(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Ii(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(yi||(yi=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(Ni(this),n),Ai(bi.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ai(e.apply(Ni(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const o=e.call(Ni(this),t,...r);return Ti.set(o,t.sort?t.sort():[t]),Ai(o)}}function Oi(e){return"function"===typeof e?Ii(e):(e instanceof IDBTransaction&&function(e){if(Si.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));Si.set(e,t)}(e),Ei(e,vi||(vi=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Ri):e)}function Ai(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(Ai(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)}));return t.then((t=>{t instanceof IDBCursor&&bi.set(t,e)})).catch((()=>{})),Ci.set(t,e),t}(e);if(wi.has(e))return wi.get(e);const t=Oi(e);return t!==e&&(wi.set(e,t),Ci.set(t,e)),t}const Ni=e=>Ci.get(e);const ki=["get","getKey","getAll","getAllKeys","count"],Pi=["put","add","delete","clear"],Di=new Map;function Li(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(Di.get(t))return Di.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=Pi.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!ki.includes(n))return;const o=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let o=t.store;for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];return r&&(o=o.index(a.shift())),(await Promise.all([o[n](...a),i&&t.done]))[0]};return Di.set(t,o),o}Ri=(e=>({...e,get:(t,n,r)=>Li(t,n)||e.get(t,n,r),has:(t,n)=>!!Li(t,n)||e.has(t,n)}))(Ri);class xi{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null})).filter((e=>e)).join(" ")}}const Mi="@firebase/app",Ui="0.9.25",Fi=new _i("@firebase/app"),ji="[DEFAULT]",Vi={[Mi]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Bi=new Map,Gi=new Map;function qi(e,t){try{e.container.addComponent(t)}catch(n){Fi.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function Wi(e){const t=e.name;if(Gi.has(t))return Fi.debug("There were multiple attempts to register component ".concat(t,".")),!1;Gi.set(t,e);for(const n of Bi.values())qi(n,e);return!0}function zi(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const Hi=new zr("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Ki{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new si("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Hi.create("app-deleted",{appName:this._name})}}function Yi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const r=Object.assign({name:ji,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!==typeof i||!i)throw Hi.create("bad-app-name",{appName:String(i)});if(n||(n=jr()),!n)throw Hi.create("no-options");const o=Bi.get(i);if(o){if(ei(n,o.options)&&ei(r,o.config))return o;throw Hi.create("duplicate-app",{appName:i})}const s=new ui(i);for(const c of Gi.values())s.addComponent(c);const a=new Ki(n,r,s);return Bi.set(i,a),a}function Zi(e,t,n){var r;let i=null!==(r=Vi[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));const o=i.match(/\s|\//),s=t.match(/\s|\//);if(o||s){const e=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return o&&e.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),o&&s&&e.push("and"),s&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void Fi.warn(e.join(" "))}Wi(new si("".concat(i,"-version"),(()=>({library:i,version:t})),"VERSION"))}const Ji="firebase-heartbeat-database",Xi=1,Qi="firebase-heartbeat-store";let $i=null;function eo(){return $i||($i=function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=indexedDB.open(e,t),a=Ai(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(Ai(s.result),e.oldVersion,e.newVersion,Ai(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{o&&e.addEventListener("close",(()=>o())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(Ji,Xi,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(Qi)}}).catch((e=>{throw Hi.create("idb-open",{originalErrorMessage:e.message})}))),$i}async function to(e,t){try{const n=(await eo()).transaction(Qi,"readwrite"),r=n.objectStore(Qi);await r.put(t,no(e)),await n.done}catch(n){if(n instanceof Wr)Fi.warn(n.message);else{const e=Hi.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});Fi.warn(e.message)}}}function no(e){return"".concat(e.name,"!").concat(e.options.appId)}class ro{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new oo(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=io();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=io(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),so(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),so(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=Pr(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function io(){return(new Date).toISOString().substring(0,10)}class oo{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"===typeof indexedDB}catch(e){return!1}}()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(Io){t(Io)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=await eo();return await t.transaction(Qi).objectStore(Qi).get(no(e))}catch(t){if(t instanceof Wr)Fi.warn(t.message);else{const e=Hi.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});Fi.warn(e.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return to(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return to(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function so(e){return Pr(JSON.stringify({version:2,heartbeats:e})).length}var ao;ao="",Wi(new si("platform-logger",(e=>new xi(e)),"PRIVATE")),Wi(new si("heartbeat",(e=>new ro(e)),"PRIVATE")),Zi(Mi,Ui,ao),Zi(Mi,Ui,"esm2017"),Zi("fire-js","");Zi("firebase","10.7.1","app");const co="@firebase/database",lo="1.0.2";let uo="";function ho(e){uo=e}class po{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Yr(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Kr(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class fo{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Jr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const mo=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new po(t)}}catch(t){}return new fo},go=mo("localStorage"),_o=mo("sessionStorage"),Eo=new _i("@firebase/database"),vo=function(){let e=1;return function(){return e++}}(),yo=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,Rr(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new ni;n.update(t);const r=n.digest();return Ar.encodeByteArray(r)},bo=function(){let e="";for(let t=0;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];Array.isArray(n)||n&&"object"===typeof n&&"number"===typeof n.length?e+=bo.apply(null,n):e+="object"===typeof n?Yr(n):n,e+=" "}return e};let So=null,To=!0;const wo=function(e,t){Rr(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(Eo.logLevel=hi.VERBOSE,So=Eo.log.bind(Eo),t&&_o.set("logging_enabled",!0)):"function"===typeof e?So=e:(So=null,_o.remove("logging_enabled"))},Co=function(){if(!0===To&&(To=!1,null===So&&!0===_o.get("logging_enabled")&&wo(!0)),So){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=bo.apply(null,t);So(r)}},Ro=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];Co(e,...n)}},Io=function(){const e="FIREBASE INTERNAL ERROR: "+bo(...arguments);Eo.error(e)},Oo=function(){const e="FIREBASE FATAL ERROR: ".concat(bo(...arguments));throw Eo.error(e),new Error(e)},Ao=function(){const e="FIREBASE WARNING: "+bo(...arguments);Eo.warn(e)},No=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},ko="[MIN_NAME]",Po="[MAX_NAME]",Do=function(e,t){if(e===t)return 0;if(e===ko||t===Po)return-1;if(t===ko||e===Po)return 1;{const n=Bo(e),r=Bo(t);return null!==n?null!==r?n-r===0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},Lo=function(e,t){return e===t?0:e<t?-1:1},xo=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Yr(t))},Mo=function(e){if("object"!==typeof e||null===e)return Yr(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=Yr(t[r]),n+=":",n+=Mo(e[t[r]]);return n+="}",n},Uo=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function Fo(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const jo=function(e){Rr(!No(e),"Invalid JSON number");const t=1023;let n,r,i,o,s;0===e?(r=0,i=0,n=1/e===-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=o+t,i=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(r=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(s=52;s;s-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const c=a.join("");let l="";for(s=0;s<64;s+=8){let e=parseInt(c.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()};const Vo=new RegExp("^-?(0*)\\d{1,10}$"),Bo=function(e){if(Vo.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Go=function(e){try{e()}catch(t){setTimeout((()=>{const e=t.stack||"";throw Ao("Exception was thrown by user callback.",e),t}),Math.floor(0))}},qo=function(e,t){const n=setTimeout(e,t);return"number"===typeof n&&"undefined"!==typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"===typeof n&&n.unref&&n.unref(),n};class Wo{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null===t||void 0===t?void 0:t.getImmediate({optional:!0}),this.appCheck||null===t||void 0===t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){Ao('Provided AppCheck credentials for the app named "'.concat(this.appName_,'" ')+"are invalid. This usually indicates your app was not initialized correctly.")}}class zo{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(Co("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ao(e)}}class Ho{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ho.OWNER="owner";const Ko="5",Yo=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Zo="ac",Jo="websocket",Xo="long_polling";class Qo{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=go.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&go.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns=".concat(this.namespace):"";return"".concat(e).concat(this.host,"/").concat(t)}}function $o(e,t,n){let r;if(Rr("string"===typeof t,"typeof type must == string"),Rr("object"===typeof n,"typeof params must == object"),t===Jo)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Xo)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const i=[];return Fo(n,((e,t)=>{i.push(e+"="+t)})),r+i.join("&")}class es{constructor(){this.counters_={}}incrementCounter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Jr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Lr(this.counters_)}}const ts={},ns={};function rs(e){const t=e.toString();return ts[t]||(ts[t]=new es),ts[t]}class is{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Go((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const os="start";class ss{constructor(e,t,n,r,i,o,s){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ro(e),this.stats_=rs(t),this.urlFn=e=>(this.appCheckToken&&(e[Zo]=this.appCheckToken),$o(t,Xo,e))}open(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new is(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(qr()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new as((function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const[i,o,s,a,c]=t;if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===os)n.id=o,n.password=s;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(()=>{n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const[i,o]=t;n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,o)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[os]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=Ko,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[Zo]=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&Yo.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ss.forceAllow_=!0}static forceDisallow(){ss.forceDisallow_=!0}static isAvailable(){return!qr()&&(!!ss.forceAllow_||!ss.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Yr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=kr(t),r=Uo(n,1840);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(qr())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Yr(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class as{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,qr())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=vo(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=as.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(i){Co("frame writing exception"),i.stack&&Co(i.stack),Co(i)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Co("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(r),n()}))}addTag(e,t){qr()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{Co("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(n){}}),Math.floor(1))}}let cs=null;"undefined"!==typeof MozWebSocket?cs=MozWebSocket:"undefined"!==typeof WebSocket&&(cs=WebSocket);class ls{constructor(e,t,n,r,i,o,s){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ro(this.connId),this.stats_=rs(t),this.connURL=ls.connectionURL_(t,o,s,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const o={};return o.v=Ko,!qr()&&"undefined"!==typeof location&&location.hostname&&Yo.test(location.hostname)&&(o.r="f"),t&&(o.s=t),n&&(o.ls=n),r&&(o[Zo]=r),i&&(o.p=i),$o(e,Jo,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,go.set("previous_websocket_failure",!0);try{let e;if(qr()){const t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":"Firebase/".concat(Ko,"/").concat(uo,"/").concat(process.platform,"/").concat(t),"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization="Bearer ".concat(this.authToken)),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0},r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new cs(this.connURL,[],e)}catch(n){this.log_("Error instantiating WebSocket.");const e=n.message||n.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){ls.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==cs&&!ls.forceDisallow_}static previouslyFailed(){return go.isInMemoryStorage||!0===go.get("previous_websocket_failure")}markConnectionHealthy(){go.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Kr(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Rr(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Yr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Uo(t,16384);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ls.responsesRequiredToBeHealthy=2,ls.healthyTimeout=3e4;class us{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[ss,ls]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=ls&&ls.isAvailable();let n=t&&!ls.previouslyFailed();if(e.webSocketOnly&&(t||Ao("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ls];else{const e=this.transports_=[];for(const t of us.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);us.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}us.globalTransportInitialized_=!1;class ds{constructor(e,t,n,r,i,o,s,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ro("c:"+this.id+":"),this.transportManager_=new us(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=qo((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=xo("t",e),n=xo("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=xo("t",e),n=xo("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=xo("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?Io("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Io("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Ko!==n&&Ao("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),qo((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):qo((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(go.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class hs{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class ps{constructor(e){this.allowedEvents_=e,this.listeners_={},Rr(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(let e=0;e<i.length;e++)i[e].callback.apply(i[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){Rr(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class fs extends ps{constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||Gr()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new fs}getInitialEvent(e){return Rr("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const ms=32,gs=768;class _s{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Es(){return new _s("")}function vs(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function ys(e){return e.pieces_.length-e.pieceNum_}function bs(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new _s(e.pieces_,t)}function Ss(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Ts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.pieces_.slice(e.pieceNum_+t)}function ws(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new _s(t,0)}function Cs(e,t){const n=[];for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof _s)for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new _s(n,0)}function Rs(e){return e.pieceNum_>=e.pieces_.length}function Is(e,t){const n=vs(e),r=vs(t);if(null===n)return t;if(n===r)return Is(bs(e),bs(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Os(e,t){if(ys(e)!==ys(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function As(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(ys(e)>ys(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class Ns{constructor(e,t){this.errorPrefix_=t,this.parts_=Ts(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=ii(this.parts_[n]);ks(this)}}function ks(e){if(e.byteLength_>gs)throw new Error(e.errorPrefix_+"has a key path longer than "+gs+" bytes ("+e.byteLength_+").");if(e.parts_.length>ms)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ms+") or object contains a cycle "+Ps(e))}function Ps(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Ds extends ps{constructor(){let e,t;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(t="visibilitychange",e="hidden"):"undefined"!==typeof document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):"undefined"!==typeof document.msHidden?(t="msvisibilitychange",e="msHidden"):"undefined"!==typeof document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Ds}getInitialEvent(e){return Rr("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Ls=1e3;class xs extends hs{constructor(e,t,n,r,i,o,s,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=s,this.authOverride_=a,this.id=xs.nextPersistentConnectionId_++,this.log_=Ro("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ls,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!qr())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ds.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&fs.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(Yr(i)),Rr(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new Vr,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Rr(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Rr(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const s={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,s),this.connected_&&this.sendListen_(s)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,(i=>{const o=i.d,s=i.s;xs.warnOnListenWarnings_(o,t);(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==s&&this.removeListen_(n,r),e.onComplete&&e.onComplete(s,o))}))}static warnOnListenWarnings_(e,t){if(e&&"object"===typeof e&&Jr(e,"w")){const n=Xr(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();Ao("Using an unspecified index. Your data will be downloaded and "+"filtered on the client. Consider adding ".concat(e," at ")+"".concat(n," to your security rules for better performance."))}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=Zr(e).claims;return"object"===typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=Zr(e).claims;return!!t&&"object"===typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"===typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Rr(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(e=>{r&&setTimeout((()=>{r(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Yr(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Io("Unrecognized action received from server: "+Yr(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Rr(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ls,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ls,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Ls),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+xs.nextConnectionId_++,i=this.lastSessionId;let o=!1,s=null;const a=function(){s?s.close():(o=!0,n())},c=function(e){Rr(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(e)};this.realtime_={close:a,sendRequest:c};const l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,c]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);o?Co("getToken() completed but was canceled"):(Co("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=c&&c.token,s=new ds(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{Ao(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),i))}catch(Io){this.log_("Failed to get token: "+Io),o||(this.repoInfo_.nodeAdmin&&Ao(Io),a())}}}interrupt(e){Co("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Co("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Qr(this.interruptReasons_)&&(this.reconnectDelay_=Ls,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>Mo(e))).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new _s(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){Co("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Co("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";qr()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+uo.replace(/\./g,"-")]=1,Gr()?e["framework.cordova"]=1:"object"===typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=fs.getInstance().currentlyOnline();return Qr(this.interruptReasons_)&&e}}xs.nextPersistentConnectionId_=0,xs.nextConnectionId_=0;class Ms{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ms(e,t)}}class Us{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Ms(ko,e),r=new Ms(ko,t);return 0!==this.compare(n,r)}minPost(){return Ms.MIN}}let Fs;class js extends Us{static get __EMPTY_NODE(){return Fs}static set __EMPTY_NODE(e){Fs=e}compare(e,t){return Do(e.name,t.name)}isDefinedOn(e){throw Ir("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ms.MIN}maxPost(){return new Ms(Po,Fs)}makePost(e,t){return Rr("string"===typeof e,"KeyIndex indexValue must always be a string."),new Ms(e,Fs)}toString(){return".key"}}const Vs=new js;class Bs{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Gs{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Gs.RED,this.left=null!=r?r:qs.EMPTY_NODE,this.right=null!=i?i:qs.EMPTY_NODE}copy(e,t,n,r,i){return new Gs(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return qs.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return qs.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Gs.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Gs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Gs.RED=!0,Gs.BLACK=!1;class qs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qs.EMPTY_NODE;this.comparator_=e,this.root_=t}insert(e,t){return new qs(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Gs.BLACK,null,null))}remove(e){return new qs(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Gs.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Bs(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Bs(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Bs(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Bs(this.root_,null,this.comparator_,!0,e)}}function Ws(e,t){return Do(e.name,t.name)}function zs(e,t){return Do(e,t)}let Hs;qs.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new Gs(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Ks=function(e){return"number"===typeof e?"number:"+jo(e):"string:"+e},Ys=function(e){if(e.isLeafNode()){const t=e.val();Rr("string"===typeof t||"number"===typeof t||"object"===typeof t&&Jr(t,".sv"),"Priority must be a string or number.")}else Rr(e===Hs||e.isEmpty(),"priority of unexpected type.");Rr(e===Hs||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Zs,Js,Xs;class Qs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qs.__childrenNodeConstructor.EMPTY_NODE;this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Rr(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ys(this.priorityNode_)}static set __childrenNodeConstructor(e){Zs=e}static get __childrenNodeConstructor(){return Zs}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Qs(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Qs.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Rs(e)?this:".priority"===vs(e)?this.priorityNode_:Qs.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Qs.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=vs(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(Rr(".priority"!==n||1===ys(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Qs.__childrenNodeConstructor.EMPTY_NODE.updateChild(bs(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Ks(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?jo(this.value_):this.value_,this.lazyHash_=yo(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Qs.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Qs.__childrenNodeConstructor?-1:(Rr(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=Qs.VALUE_TYPE_ORDER.indexOf(t),i=Qs.VALUE_TYPE_ORDER.indexOf(n);return Rr(r>=0,"Unknown leaf type: "+t),Rr(i>=0,"Unknown leaf type: "+n),r===i?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Qs.VALUE_TYPE_ORDER=["object","boolean","number","string"];const $s=new class extends Us{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?Do(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ms.MIN}maxPost(){return new Ms(Po,new Qs("[PRIORITY-POST]",Xs))}makePost(e,t){const n=Js(e);return new Ms(t,new Qs("[PRIORITY-POST]",n))}toString(){return".priority"}},ea=Math.log(2);class ta{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/ea,10)),this.current_=this.count-1;const n=(r=this.count,parseInt(Array(r+1).join("1"),2));var r;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const na=function(e,t,n,r){e.sort(t);const i=function(t,r){const o=r-t;let s,a;if(0===o)return null;if(1===o)return s=e[t],a=n?n(s):s,new Gs(a,s.node,Gs.BLACK,null,null);{const c=parseInt(o/2,10)+t,l=i(t,c),u=i(c+1,r);return s=e[c],a=n?n(s):s,new Gs(a,s.node,Gs.BLACK,l,u)}},o=function(t){let r=null,o=null,s=e.length;const a=function(t,r){const o=s-t,a=s;s-=t;const l=i(o+1,a),u=e[o],d=n?n(u):u;c(new Gs(d,u.node,r,null,l))},c=function(e){r?(r.left=e,r=e):(o=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,Gs.BLACK):(a(r,Gs.BLACK),a(r,Gs.RED))}return o}(new ta(e.length));return new qs(r||t,o)};let ra;const ia={};class oa{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Rr(ia&&$s,"ChildrenNode.ts has not been loaded"),ra=ra||new oa({".priority":ia},{".priority":$s}),ra}get(e){const t=Xr(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof qs?t:null}hasIndex(e){return Jr(this.indexSet_,e.toString())}addIndex(e,t){Rr(e!==Vs,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(Ms.Wrap);let o,s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();o=r?na(n,e.getCompare()):ia;const a=e.toString(),c=Object.assign({},this.indexSet_);c[a]=e;const l=Object.assign({},this.indexes_);return l[a]=o,new oa(l,c)}addToIndexes(e,t){const n=$r(this.indexes_,((n,r)=>{const i=Xr(this.indexSet_,r);if(Rr(i,"Missing index implementation for "+r),n===ia){if(i.isDefinedOn(e.node)){const n=[],r=t.getIterator(Ms.Wrap);let o=r.getNext();for(;o;)o.name!==e.name&&n.push(o),o=r.getNext();return n.push(e),na(n,i.getCompare())}return ia}{const r=t.get(e.name);let i=n;return r&&(i=i.remove(new Ms(e.name,r))),i.insert(e,e.node)}}));return new oa(n,this.indexSet_)}removeFromIndexes(e,t){const n=$r(this.indexes_,(n=>{if(n===ia)return n;{const r=t.get(e.name);return r?n.remove(new Ms(e.name,r)):n}}));return new oa(n,this.indexSet_)}}let sa;class aa{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ys(this.priorityNode_),this.children_.isEmpty()&&Rr(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return sa||(sa=new aa(new qs(zs),null,oa.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||sa}updatePriority(e){return this.children_.isEmpty()?this:new aa(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?sa:t}}getChild(e){const t=vs(e);return null===t?this:this.getImmediateChild(t).getChild(bs(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(Rr(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new Ms(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(n,this.children_));const o=r.isEmpty()?sa:this.priorityNode_;return new aa(r,o,i)}}updateChild(e,t){const n=vs(e);if(null===n)return t;{Rr(".priority"!==vs(e)||1===ys(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(bs(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,i=!0;if(this.forEachChild($s,((o,s)=>{t[o]=s.val(e),n++,i&&aa.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1})),!e&&i&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Ks(this.getPriority().val())+":"),this.forEachChild($s,((t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":yo(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new Ms(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Ms(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Ms(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,Ms.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,Ms.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ca?-1:0}withIndex(e){if(e===Vs||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new aa(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Vs||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator($s),n=t.getIterator($s);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===Vs?null:this.indexMap_.get(e.toString())}}aa.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const ca=new class extends aa{constructor(){super(new qs(zs),aa.EMPTY_NODE,oa.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return aa.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Ms,{MIN:{value:new Ms(ko,aa.EMPTY_NODE)},MAX:{value:new Ms(Po,ca)}}),js.__EMPTY_NODE=aa.EMPTY_NODE,Qs.__childrenNodeConstructor=aa,Hs=ca,function(e){Xs=e}(ca);const la=!0;function ua(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e)return aa.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),Rr(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e){return new Qs(e,ua(t))}if(e instanceof Array||!la){let n=aa.EMPTY_NODE;return Fo(e,((t,r)=>{if(Jr(e,t)&&"."!==t.substring(0,1)){const e=ua(r);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(ua(t))}{const n=[];let r=!1;if(Fo(e,((e,t)=>{if("."!==e.substring(0,1)){const i=ua(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new Ms(e,i)))}})),0===n.length)return aa.EMPTY_NODE;const i=na(n,Ws,(e=>e.name),zs);if(r){const e=na(n,$s.getCompare());return new aa(i,ua(t),new oa({".priority":e},{".priority":$s}))}return new aa(i,ua(t),oa.Default)}}!function(e){Js=e}(ua);class da extends Us{constructor(e){super(),this.indexPath_=e,Rr(!Rs(e)&&".priority"!==vs(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?Do(e.name,t.name):i}makePost(e,t){const n=ua(e),r=aa.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ms(t,r)}maxPost(){const e=aa.EMPTY_NODE.updateChild(this.indexPath_,ca);return new Ms(Po,e)}toString(){return Ts(this.indexPath_,0).join("/")}}const ha=new class extends Us{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?Do(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ms.MIN}maxPost(){return Ms.MAX}makePost(e,t){const n=ua(e);return new Ms(t,n)}toString(){return".value"}};function pa(e){return{type:"value",snapshotNode:e}}function fa(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function ma(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function ga(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class _a{constructor(e){this.index_=e}updateChild(e,t,n,r,i,o){Rr(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const s=e.getImmediateChild(t);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(ma(t,s)):Rr(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(fa(t,n)):o.trackChildChange(ga(t,n,s))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild($s,((e,r)=>{t.hasChild(e)||n.trackChildChange(ma(e,r))})),t.isLeafNode()||t.forEachChild($s,((t,r)=>{if(e.hasChild(t)){const i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(ga(t,r,i))}else n.trackChildChange(fa(t,r))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?aa.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Ea{constructor(e){this.indexedFilter_=new _a(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Ea.getStartPost_(e),this.endPost_=Ea.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,i,o){return this.matches(new Ms(t,n))||(n=aa.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=aa.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(aa.EMPTY_NODE);const i=this;return t.forEachChild($s,((e,t)=>{i.matches(new Ms(e,t))||(r=r.updateImmediateChild(e,aa.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class va{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Ea(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,o){return this.rangedFilter_.matches(new Ms(t,n))||(n=aa.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=aa.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=aa.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;r=r.updateImmediateChild(t.name,t.node),n++}}}else{let e;r=t.withIndex(this.index_),r=r.updatePriority(aa.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,aa.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const s=e;Rr(s.numChildren()===this.limit_,"");const a=new Ms(t,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),l=this.rangedFilter_.matches(a);if(s.hasChild(t)){const e=s.getImmediateChild(t);let u=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=u&&(u.name===t||s.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);const d=null==u?1:o(u,a);if(l&&!n.isEmpty()&&d>=0)return null!=i&&i.trackChildChange(ga(t,n,e)),s.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(ma(t,e));const n=s.updateImmediateChild(t,aa.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=i&&i.trackChildChange(fa(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:l&&o(c,a)>=0?(null!=i&&(i.trackChildChange(ma(c.name,c.node)),i.trackChildChange(fa(t,n))),s.updateImmediateChild(t,n).updateImmediateChild(c.name,aa.EMPTY_NODE)):e}}class ya{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=$s}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Rr(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Rr(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ko}hasEnd(){return this.endSet_}getIndexEndValue(){return Rr(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Rr(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Po}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Rr(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===$s}copy(){const e=new ya;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function ba(e){const t={};if(e.isDefault())return t;let n;if(e.index_===$s?n="$priority":e.index_===ha?n="$value":e.index_===Vs?n="$key":(Rr(e.index_ instanceof da,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Yr(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=Yr(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+Yr(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=Yr(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+Yr(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Sa(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==$s&&(t.i=e.index_.toString()),t}class Ta extends hs{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=Ro("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(Rr(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Ta.getListenId_(e,n),s={};this.listens_[o]=s;const a=ba(e._queryParams);this.restRequest_(i+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),Xr(this.listens_,o)===s){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}}))}unlisten(e,t){const n=Ta.getListenId_(e,t);delete this.listens_[n]}get(e){const t=ba(e._queryParams),n=e._path.toString(),r=new Vr;return this.restRequest_(n+".json",t,((e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))})),r.promise}refreshAuthToken(e){}restRequest_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((r=>{let[i,o]=r;i&&i.accessToken&&(t.auth=i.accessToken),o&&o.token&&(t.ac=o.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+s);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+s+" received. status:",a.status,"response:",a.responseText);let t=null;if(a.status>=200&&a.status<300){try{t=Kr(a.responseText)}catch(e){Ao("Failed to parse JSON response for "+s+": "+a.responseText)}n(null,t)}else 401!==a.status&&404!==a.status&&Ao("Got unsuccessful REST response for "+s+" Status: "+a.status),n(a.status);n=null}},a.open("GET",s,!0),a.send()}))}}class wa{constructor(){this.rootNode_=aa.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Ca(){return{value:null,children:new Map}}function Ra(e,t,n){if(Rs(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=vs(t);e.children.has(r)||e.children.set(r,Ca());Ra(e.children.get(r),t=bs(t),n)}}function Ia(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,r)=>{Ia(r,new _s(t.toString()+"/"+e),n)}))}class Oa{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Fo(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Aa{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Oa(e);const n=1e4+2e4*Math.random();qo(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;Fo(e,((e,r)=>{r>0&&Jr(this.statsToReport_,e)&&(t[e]=r,n=!0)})),n&&this.server_.reportStats(t),qo(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Na;function ka(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Na||(Na={}));class Pa{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Na.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Rs(this.path)){if(null!=this.affectedTree.value)return Rr(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new _s(e));return new Pa(Es(),t,this.revert)}}return Rr(vs(this.path)===e,"operationForChild called for unrelated child."),new Pa(bs(this.path),this.affectedTree,this.revert)}}class Da{constructor(e,t){this.source=e,this.path=t,this.type=Na.LISTEN_COMPLETE}operationForChild(e){return Rs(this.path)?new Da(this.source,Es()):new Da(this.source,bs(this.path))}}class La{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Na.OVERWRITE}operationForChild(e){return Rs(this.path)?new La(this.source,Es(),this.snap.getImmediateChild(e)):new La(this.source,bs(this.path),this.snap)}}class xa{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Na.MERGE}operationForChild(e){if(Rs(this.path)){const t=this.children.subtree(new _s(e));return t.isEmpty()?null:t.value?new La(this.source,Es(),t.value):new xa(this.source,Es(),t)}return Rr(vs(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new xa(this.source,bs(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Ma{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Rs(e))return this.isFullyInitialized()&&!this.filtered_;const t=vs(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Ua{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Fa(e,t,n,r,i,o){const s=r.filter((e=>e.type===n));s.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw Ir("Should only compare child_ events.");const r=new Ms(t.childName,t.snapshotNode),i=new Ms(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n))),s.forEach((n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);i.forEach((i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}function ja(e,t){return{eventCache:e,serverCache:t}}function Va(e,t,n,r){return ja(new Ma(t,n,r),e.serverCache)}function Ba(e,t,n,r){return ja(e.eventCache,new Ma(t,n,r))}function Ga(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function qa(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Wa;class za{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(Wa||(Wa=new qs(Lo)),Wa);this.value=e,this.children=t}static fromObject(e){let t=new za(null);return Fo(e,((e,n)=>{t=t.set(new _s(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Es(),value:this.value};if(Rs(e))return null;{const n=vs(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(bs(e),t);if(null!=i){return{path:Cs(new _s(n),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Rs(e))return this;{const t=vs(e),n=this.children.get(t);return null!==n?n.subtree(bs(e)):new za(null)}}set(e,t){if(Rs(e))return new za(t,this.children);{const n=vs(e),r=(this.children.get(n)||new za(null)).set(bs(e),t),i=this.children.insert(n,r);return new za(this.value,i)}}remove(e){if(Rs(e))return this.children.isEmpty()?new za(null):new za(null,this.children);{const t=vs(e),n=this.children.get(t);if(n){const r=n.remove(bs(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new za(null):new za(this.value,i)}return this}}get(e){if(Rs(e))return this.value;{const t=vs(e),n=this.children.get(t);return n?n.get(bs(e)):null}}setTree(e,t){if(Rs(e))return t;{const n=vs(e),r=(this.children.get(n)||new za(null)).setTree(bs(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new za(this.value,i)}}fold(e){return this.fold_(Es(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((r,i)=>{n[r]=i.fold_(Cs(e,r),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Es(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(Rs(e))return null;{const r=vs(e),i=this.children.get(r);return i?i.findOnPath_(bs(e),Cs(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Es(),t)}foreachOnPath_(e,t,n){if(Rs(e))return this;{this.value&&n(t,this.value);const r=vs(e),i=this.children.get(r);return i?i.foreachOnPath_(bs(e),Cs(t,r),n):new za(null)}}foreach(e){this.foreach_(Es(),e)}foreach_(e,t){this.children.inorderTraversal(((n,r)=>{r.foreach_(Cs(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class Ha{constructor(e){this.writeTree_=e}static empty(){return new Ha(new za(null))}}function Ka(e,t,n){if(Rs(t))return new Ha(new za(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let o=r.value;const s=Is(i,t);return o=o.updateChild(s,n),new Ha(e.writeTree_.set(i,o))}{const r=new za(n),i=e.writeTree_.setTree(t,r);return new Ha(i)}}}function Ya(e,t,n){let r=e;return Fo(n,((e,n)=>{r=Ka(r,Cs(t,e),n)})),r}function Za(e,t){if(Rs(t))return Ha.empty();{const n=e.writeTree_.setTree(t,new za(null));return new Ha(n)}}function Ja(e,t){return null!=Xa(e,t)}function Xa(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Is(n.path,t)):null}function Qa(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild($s,((e,n)=>{t.push(new Ms(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new Ms(e,n.value))})),t}function $a(e,t){if(Rs(t))return e;{const n=Xa(e,t);return new Ha(null!=n?new za(n):e.writeTree_.subtree(t))}}function ec(e){return e.writeTree_.isEmpty()}function tc(e,t){return nc(Es(),e.writeTree_,t)}function nc(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,i)=>{".priority"===t?(Rr(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=nc(Cs(e,t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(Cs(e,".priority"),r)),n}}function rc(e,t){return gc(t,e)}function ic(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));Rr(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,o=!1,s=e.allWrites.length-1;for(;i&&s>=0;){const t=e.allWrites[s];t.visible&&(s>=n&&oc(t,r.path)?i=!1:As(r.path,t.path)&&(o=!0)),s--}if(i){if(o)return function(e){e.visibleWrites=ac(e.allWrites,sc,Es()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(r.snap)e.visibleWrites=Za(e.visibleWrites,r.path);else{Fo(r.children,(t=>{e.visibleWrites=Za(e.visibleWrites,Cs(r.path,t))}))}return!0}return!1}function oc(e,t){if(e.snap)return As(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&As(Cs(e.path,n),t))return!0;return!1}function sc(e){return e.visible}function ac(e,t,n){let r=Ha.empty();for(let i=0;i<e.length;++i){const o=e[i];if(t(o)){const e=o.path;let t;if(o.snap)As(n,e)?(t=Is(n,e),r=Ka(r,t,o.snap)):As(e,n)&&(t=Is(e,n),r=Ka(r,Es(),o.snap.getChild(t)));else{if(!o.children)throw Ir("WriteRecord should have .snap or .children");if(As(n,e))t=Is(n,e),r=Ya(r,t,o.children);else if(As(e,n))if(t=Is(e,n),Rs(t))r=Ya(r,Es(),o.children);else{const e=Xr(o.children,vs(t));if(e){const n=e.getChild(bs(t));r=Ka(r,Es(),n)}}}}}return r}function cc(e,t,n,r,i){if(r||i){const o=$a(e.visibleWrites,t);if(!i&&ec(o))return n;if(i||null!=n||Ja(o,Es())){const o=function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(As(e.path,t)||As(t,e.path))};return tc(ac(e.allWrites,o,t),n||aa.EMPTY_NODE)}return null}{const r=Xa(e.visibleWrites,t);if(null!=r)return r;{const r=$a(e.visibleWrites,t);if(ec(r))return n;if(null!=n||Ja(r,Es())){return tc(r,n||aa.EMPTY_NODE)}return null}}}function lc(e,t,n,r){return cc(e.writeTree,e.treePath,t,n,r)}function uc(e,t){return function(e,t,n){let r=aa.EMPTY_NODE;const i=Xa(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild($s,((e,t)=>{r=r.updateImmediateChild(e,t)})),r;if(n){const i=$a(e.visibleWrites,t);return n.forEachChild($s,((e,t)=>{const n=tc($a(i,new _s(e)),t);r=r.updateImmediateChild(e,n)})),Qa(i).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}return Qa($a(e.visibleWrites,t)).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function dc(e,t,n,r){return function(e,t,n,r,i){Rr(r||i,"Either existingEventSnap or existingServerSnap must exist");const o=Cs(t,n);if(Ja(e.visibleWrites,o))return null;{const t=$a(e.visibleWrites,o);return ec(t)?i.getChild(n):tc(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function hc(e,t){return function(e,t){return Xa(e.visibleWrites,t)}(e.writeTree,Cs(e.treePath,t))}function pc(e,t,n,r,i,o){return function(e,t,n,r,i,o,s){let a;const c=$a(e.visibleWrites,t),l=Xa(c,Es());if(null!=l)a=l;else{if(null==n)return[];a=tc(c,n)}if(a=a.withIndex(s),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=s.getCompare(),n=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s);let c=n.getNext();for(;c&&e.length<i;)0!==t(c,r)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,o)}function fc(e,t,n){return function(e,t,n,r){const i=Cs(t,n),o=Xa(e.visibleWrites,i);if(null!=o)return o;if(r.isCompleteForChild(n))return tc($a(e.visibleWrites,i),r.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function mc(e,t){return gc(Cs(e.treePath,t),e.writeTree)}function gc(e,t){return{treePath:e,writeTree:t}}class _c{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;Rr("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Rr(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,ga(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,ma(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,fa(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw Ir("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,ga(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Ec=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class vc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Ma(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return fc(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:qa(this.viewCache_),i=pc(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function yc(e,t,n,r,i){const o=new _c;let s,a;if(n.type===Na.OVERWRITE){const c=n;c.source.fromUser?s=Tc(e,t,c.path,c.snap,r,i,o):(Rr(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!Rs(c.path),s=Sc(e,t,c.path,c.snap,r,i,a,o))}else if(n.type===Na.MERGE){const c=n;c.source.fromUser?s=function(e,t,n,r,i,o,s){let a=t;return r.foreach(((r,c)=>{const l=Cs(n,r);wc(t,vs(l))&&(a=Tc(e,a,l,c,i,o,s))})),r.foreach(((r,c)=>{const l=Cs(n,r);wc(t,vs(l))||(a=Tc(e,a,l,c,i,o,s))})),a}(e,t,c.path,c.children,r,i,o):(Rr(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered(),s=Rc(e,t,c.path,c.children,r,i,a,o))}else if(n.type===Na.ACK_USER_WRITE){const a=n;s=a.revert?function(e,t,n,r,i,o){let s;if(null!=hc(r,n))return t;{const a=new vc(r,t,i),c=t.eventCache.getNode();let l;if(Rs(n)||".priority"===vs(n)){let n;if(t.serverCache.isFullyInitialized())n=lc(r,qa(t));else{const e=t.serverCache.getNode();Rr(e instanceof aa,"serverChildren would be complete if leaf node"),n=uc(r,e)}l=e.filter.updateFullNode(c,n,o)}else{const i=vs(n);let u=fc(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=c.getImmediateChild(i)),l=null!=u?e.filter.updateChild(c,i,u,bs(n),a,o):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(c,i,aa.EMPTY_NODE,bs(n),a,o):c,l.isEmpty()&&t.serverCache.isFullyInitialized()&&(s=lc(r,qa(t)),s.isLeafNode()&&(l=e.filter.updateFullNode(l,s,o)))}return s=t.serverCache.isFullyInitialized()||null!=hc(r,Es()),Va(t,l,s,e.filter.filtersNodes())}}(e,t,a.path,r,i,o):function(e,t,n,r,i,o,s){if(null!=hc(i,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=r.value){if(Rs(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Sc(e,t,n,c.getNode().getChild(n),i,o,a,s);if(Rs(n)){let r=new za(null);return c.getNode().forEachChild(Vs,((e,t)=>{r=r.set(new _s(e),t)})),Rc(e,t,n,r,i,o,a,s)}return t}{let l=new za(null);return r.foreach(((e,t)=>{const r=Cs(n,e);c.isCompleteForPath(r)&&(l=l.set(e,c.getNode().getChild(r)))})),Rc(e,t,n,l,i,o,a,s)}}(e,t,a.path,a.affectedTree,r,i,o)}else{if(n.type!==Na.LISTEN_COMPLETE)throw Ir("Unknown operation type: "+n.type);s=function(e,t,n,r,i){const o=t.serverCache,s=Ba(t,o.getNode(),o.isFullyInitialized()||Rs(n),o.isFiltered());return bc(e,s,n,r,Ec,i)}(e,t,n.path,r,o)}const c=o.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=Ga(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(pa(Ga(t)))}}(t,s,c),{viewCache:s,changes:c}}function bc(e,t,n,r,i,o){const s=t.eventCache;if(null!=hc(r,n))return t;{let a,c;if(Rs(n))if(Rr(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=qa(t),i=uc(r,n instanceof aa?n:aa.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,o)}else{const n=lc(r,qa(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const l=vs(n);if(".priority"===l){Rr(1===ys(n),"Can't have a priority with additional path components");const i=s.getNode();c=t.serverCache.getNode();const o=dc(r,n,i,c);a=null!=o?e.filter.updatePriority(i,o):s.getNode()}else{const u=bs(n);let d;if(s.isCompleteForChild(l)){c=t.serverCache.getNode();const e=dc(r,n,s.getNode(),c);d=null!=e?s.getNode().getImmediateChild(l).updateChild(u,e):s.getNode().getImmediateChild(l)}else d=fc(r,l,t.serverCache);a=null!=d?e.filter.updateChild(s.getNode(),l,d,u,i,o):s.getNode()}}return Va(t,a,s.isFullyInitialized()||Rs(n),e.filter.filtersNodes())}}function Sc(e,t,n,r,i,o,s,a){const c=t.serverCache;let l;const u=s?e.filter:e.filter.getIndexedFilter();if(Rs(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),e,null)}else{const e=vs(n);if(!c.isCompleteForPath(n)&&ys(n)>1)return t;const i=bs(n),o=c.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?u.updatePriority(c.getNode(),o):u.updateChild(c.getNode(),e,o,i,Ec,null)}const d=Ba(t,l,c.isFullyInitialized()||Rs(n),u.filtersNodes());return bc(e,d,n,i,new vc(i,d,o),a)}function Tc(e,t,n,r,i,o,s){const a=t.eventCache;let c,l;const u=new vc(i,t,o);if(Rs(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,s),c=Va(t,l,!0,e.filter.filtersNodes());else{const i=vs(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),c=Va(t,l,a.isFullyInitialized(),a.isFiltered());else{const o=bs(n),l=a.getNode().getImmediateChild(i);let d;if(Rs(o))d=r;else{const e=u.getCompleteChild(i);d=null!=e?".priority"===Ss(o)&&e.getChild(ws(o)).isEmpty()?e:e.updateChild(o,r):aa.EMPTY_NODE}if(l.equals(d))c=t;else{c=Va(t,e.filter.updateChild(a.getNode(),i,d,o,u,s),a.isFullyInitialized(),e.filter.filtersNodes())}}}return c}function wc(e,t){return e.eventCache.isCompleteForChild(t)}function Cc(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Rc(e,t,n,r,i,o,s,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=Rs(n)?r:new za(null).setTree(n,r);const u=t.serverCache.getNode();return c.children.inorderTraversal(((n,r)=>{if(u.hasChild(n)){const c=Cc(0,t.serverCache.getNode().getImmediateChild(n),r);l=Sc(e,l,new _s(n),c,i,o,s,a)}})),c.children.inorderTraversal(((n,r)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!u.hasChild(n)&&!c){const c=Cc(0,t.serverCache.getNode().getImmediateChild(n),r);l=Sc(e,l,new _s(n),c,i,o,s,a)}})),l}class Ic{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new _a(n.getIndex()),i=(o=n).loadsAllData()?new _a(o.getIndex()):o.hasLimit()?new va(o):new Ea(o);var o;this.processor_=function(e){return{filter:e}}(i);const s=t.serverCache,a=t.eventCache,c=r.updateFullNode(aa.EMPTY_NODE,s.getNode(),null),l=i.updateFullNode(aa.EMPTY_NODE,a.getNode(),null),u=new Ma(c,s.isFullyInitialized(),r.filtersNodes()),d=new Ma(l,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=ja(d,u),this.eventGenerator_=new Ua(this.query_)}get query(){return this.query_}}function Oc(e,t){const n=qa(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Rs(t)&&!n.getImmediateChild(vs(t)).isEmpty())?n.getChild(t):null}function Ac(e){return 0===e.eventRegistrations_.length}function Nc(e,t,n){const r=[];if(n){Rr(null==t,"A cancel should cancel all event registrations.");const i=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(n,i);t&&r.push(t)}))}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){const i=e.eventRegistrations_[r];if(i.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}else n.push(i)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function kc(e,t,n,r){t.type===Na.MERGE&&null!==t.source.queryId&&(Rr(qa(e.viewCache_),"We should always have a full cache before handling merges"),Rr(Ga(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,o=yc(e.processor_,i,t,n,r);var s,a;return s=e.processor_,a=o.viewCache,Rr(a.eventCache.getNode().isIndexed(s.filter.getIndex()),"Event snap not indexed"),Rr(a.serverCache.getNode().isIndexed(s.filter.getIndex()),"Server snap not indexed"),Rr(o.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,Pc(e,o.changes,o.viewCache.eventCache.getNode(),null)}function Pc(e,t,n,r){const i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){const i=[],o=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Fa(e,i,"child_removed",t,r,n),Fa(e,i,"child_added",t,r,n),Fa(e,i,"child_moved",o,r,n),Fa(e,i,"child_changed",t,r,n),Fa(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}let Dc,Lc;class xc{constructor(){this.views=new Map}}function Mc(e,t,n,r){const i=t.source.queryId;if(null!==i){const o=e.views.get(i);return Rr(null!=o,"SyncTree gave us an op for an invalid query."),kc(o,t,n,r)}{let i=[];for(const o of e.views.values())i=i.concat(kc(o,t,n,r));return i}}function Uc(e,t,n,r,i){const o=t._queryIdentifier,s=e.views.get(o);if(!s){let e=lc(n,i?r:null),o=!1;e?o=!0:r instanceof aa?(e=uc(n,r),o=!1):(e=aa.EMPTY_NODE,o=!1);const s=ja(new Ma(e,o,!1),new Ma(r,i,!1));return new Ic(t,s)}return s}function Fc(e,t,n,r,i,o){const s=Uc(e,t,r,i,o);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,s),function(e,t){e.eventRegistrations_.push(t)}(s,n),function(e,t){const n=e.viewCache_.eventCache,r=[];n.getNode().isLeafNode()||n.getNode().forEachChild($s,((e,t)=>{r.push(fa(e,t))}));return n.isFullyInitialized()&&r.push(pa(n.getNode())),Pc(e,r,n.getNode(),t)}(s,n)}function jc(e,t,n,r){const i=t._queryIdentifier,o=[];let s=[];const a=Wc(e);if("default"===i)for(const[c,l]of e.views.entries())s=s.concat(Nc(l,n,r)),Ac(l)&&(e.views.delete(c),l.query._queryParams.loadsAllData()||o.push(l.query));else{const t=e.views.get(i);t&&(s=s.concat(Nc(t,n,r)),Ac(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||o.push(t.query)))}return a&&!Wc(e)&&o.push(new(Rr(Dc,"Reference.ts has not been loaded"),Dc)(t._repo,t._path)),{removed:o,events:s}}function Vc(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function Bc(e,t){let n=null;for(const r of e.views.values())n=n||Oc(r,t);return n}function Gc(e,t){if(t._queryParams.loadsAllData())return zc(e);{const n=t._queryIdentifier;return e.views.get(n)}}function qc(e,t){return null!=Gc(e,t)}function Wc(e){return null!=zc(e)}function zc(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Hc=1;class Kc{constructor(e){this.listenProvider_=e,this.syncPointTree_=new za(null),this.pendingWriteTree_={visibleWrites:Ha.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Yc(e,t,n,r,i){return function(e,t,n,r,i){Rr(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=Ka(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?tl(e,new La({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Zc(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(ic(e.pendingWriteTree_,t)){let t=new za(null);return null!=r.snap?t=t.set(Es(),!0):Fo(r.children,(e=>{t=t.set(new _s(e),!0)})),tl(e,new Pa(r.path,t,n))}return[]}function Jc(e,t,n){return tl(e,new La({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Xc(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=t._path,s=e.syncPointTree_.get(o);let a=[];if(s&&("default"===t._queryIdentifier||qc(s,t))){const c=jc(s,t,n,r);0===s.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(o));const l=c.removed;if(a=c.events,!i){const n=-1!==l.findIndex((e=>e._queryParams.loadsAllData())),i=e.syncPointTree_.findOnPath(o,((e,t)=>Wc(t)));if(n&&!i){const t=e.syncPointTree_.subtree(o);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&Wc(t)){return[zc(t)]}{let e=[];return t&&(e=Vc(t)),Fo(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const r=n[t],i=r.query,o=il(e,r);e.listenProvider_.startListening(ul(i),ol(e,i),o.hashFn,o.onComplete)}}}if(!i&&l.length>0&&!r)if(n){const n=null;e.listenProvider_.stopListening(ul(t),n)}else l.forEach((t=>{const n=e.queryToTagMap.get(sl(t));e.listenProvider_.stopListening(ul(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const r=t[n];if(!r._queryParams.loadsAllData()){const t=sl(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,l)}return a}function Qc(e,t,n,r){const i=al(e,r);if(null!=i){const r=cl(i),o=r.path,s=r.queryId,a=Is(o,t);return ll(e,o,new La(ka(s),a,n))}return[]}function $c(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=t._path;let o=null,s=!1;e.syncPointTree_.foreachOnPath(i,((e,t)=>{const n=Is(e,i);o=o||Bc(t,n),s=s||Wc(t)}));let a,c=e.syncPointTree_.get(i);if(c?(s=s||Wc(c),o=o||Bc(c,Es())):(c=new xc,e.syncPointTree_=e.syncPointTree_.set(i,c)),null!=o)a=!0;else{a=!1,o=aa.EMPTY_NODE;e.syncPointTree_.subtree(i).foreachChild(((e,t)=>{const n=Bc(t,Es());n&&(o=o.updateImmediateChild(e,n))}))}const l=qc(c,t);if(!l&&!t._queryParams.loadsAllData()){const n=sl(t);Rr(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const r=Hc++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let u=Fc(c,t,n,rc(e.pendingWriteTree_,i),o,a);if(!l&&!s&&!r){const n=Gc(c,t);u=u.concat(function(e,t,n){const r=t._path,i=ol(e,t),o=il(e,n),s=e.listenProvider_.startListening(ul(t),i,o.hashFn,o.onComplete),a=e.syncPointTree_.subtree(r);if(i)Rr(!Wc(a.value),"If we're adding a query, it shouldn't be shadowed");else{const t=a.fold(((e,t,n)=>{if(!Rs(e)&&t&&Wc(t))return[zc(t).query];{let e=[];return t&&(e=e.concat(Vc(t).map((e=>e.query)))),Fo(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const r=t[n];e.listenProvider_.stopListening(ul(r),ol(e,r))}}return s}(e,t,n))}return u}function el(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,((e,n)=>{const r=Bc(n,Is(e,t));if(r)return r}));return cc(r,t,i,n,!0)}function tl(e,t){return nl(t,e.syncPointTree_,null,rc(e.pendingWriteTree_,Es()))}function nl(e,t,n,r){if(Rs(e.path))return rl(e,t,n,r);{const i=t.get(Es());null==n&&null!=i&&(n=Bc(i,Es()));let o=[];const s=vs(e.path),a=e.operationForChild(s),c=t.children.get(s);if(c&&a){const e=n?n.getImmediateChild(s):null,t=mc(r,s);o=o.concat(nl(a,c,e,t))}return i&&(o=o.concat(Mc(i,e,r,n))),o}}function rl(e,t,n,r){const i=t.get(Es());null==n&&null!=i&&(n=Bc(i,Es()));let o=[];return t.children.inorderTraversal(((t,i)=>{const s=n?n.getImmediateChild(t):null,a=mc(r,t),c=e.operationForChild(t);c&&(o=o.concat(rl(c,i,s,a)))})),i&&(o=o.concat(Mc(i,e,r,n))),o}function il(e,t){const n=t.query,r=ol(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||aa.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return r?function(e,t,n){const r=al(e,n);if(r){const n=cl(r),i=n.path,o=n.queryId,s=Is(i,t);return ll(e,i,new Da(ka(o),s))}return[]}(e,n._path,r):function(e,t){return tl(e,new Da({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return Xc(e,n,null,r)}}}}function ol(e,t){const n=sl(t);return e.queryToTagMap.get(n)}function sl(e){return e._path.toString()+"$"+e._queryIdentifier}function al(e,t){return e.tagToQueryMap.get(t)}function cl(e){const t=e.indexOf("$");return Rr(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new _s(e.substr(0,t))}}function ll(e,t,n){const r=e.syncPointTree_.get(t);Rr(r,"Missing sync point for query tag that we're tracking");return Mc(r,n,rc(e.pendingWriteTree_,t),null)}function ul(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(Rr(Lc,"Reference.ts has not been loaded"),Lc)(e._repo,e._path):e}class dl{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new dl(t)}node(){return this.node_}}class hl{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Cs(this.path_,e);return new hl(this.syncTree_,t)}node(){return el(this.syncTree_,this.path_)}}const pl=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},fl=function(e,t,n){return e&&"object"===typeof e?(Rr(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?ml(e[".sv"],t,n):"object"===typeof e[".sv"]?gl(e[".sv"],t):void Rr(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},ml=function(e,t,n){if("timestamp"===e)return n.timestamp;Rr(!1,"Unexpected server value: "+e)},gl=function(e,t,n){e.hasOwnProperty("increment")||Rr(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!==typeof r&&Rr(!1,"Unexpected increment value: "+r);const i=t.node();if(Rr(null!==i&&"undefined"!==typeof i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const o=i.getValue();return"number"!==typeof o?r:o+r},_l=function(e,t,n,r){return vl(t,new hl(n,e),r)},El=function(e,t,n){return vl(e,new dl(t),n)};function vl(e,t,n){const r=e.getPriority().val(),i=fl(r,t.getImmediateChild(".priority"),n);let o;if(e.isLeafNode()){const r=e,o=fl(r.getValue(),t,n);return o!==r.getValue()||i!==r.getPriority().val()?new Qs(o,ua(i)):e}{const r=e;return o=r,i!==r.getPriority().val()&&(o=o.updatePriority(new Qs(i))),r.forEachChild($s,((e,r)=>{const i=vl(r,t.getImmediateChild(e),n);i!==r&&(o=o.updateImmediateChild(e,i))})),o}}class yl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{children:{},childCount:0};this.name=e,this.parent=t,this.node=n}}function bl(e,t){let n=t instanceof _s?t:new _s(t),r=e,i=vs(n);for(;null!==i;){const e=Xr(r.node.children,i)||{children:{},childCount:0};r=new yl(i,r,e),n=bs(n),i=vs(n)}return r}function Sl(e){return e.node.value}function Tl(e,t){e.node.value=t,Ol(e)}function wl(e){return e.node.childCount>0}function Cl(e,t){Fo(e.node.children,((n,r)=>{t(new yl(n,e,r))}))}function Rl(e,t,n,r){n&&!r&&t(e),Cl(e,(e=>{Rl(e,t,!0,r)})),n&&r&&t(e)}function Il(e){return new _s(null===e.parent?e.name:Il(e.parent)+"/"+e.name)}function Ol(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===Sl(e)&&!wl(e)}(n),i=Jr(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,Ol(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,Ol(e))}(e.parent,e.name,e)}const Al=/[\[\].#$\/\u0000-\u001F\u007F]/,Nl=/[\[\].#$\u0000-\u001F\u007F]/,kl=10485760,Pl=function(e){return"string"===typeof e&&0!==e.length&&!Al.test(e)},Dl=function(e){return"string"===typeof e&&0!==e.length&&!Nl.test(e)},Ll=function(e,t,n,r){r&&void 0===t||xl(ri(e,"value"),t,n)},xl=function(e,t,n){const r=n instanceof _s?new Ns(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Ps(r));if("function"===typeof t)throw new Error(e+"contains a function "+Ps(r)+" with contents = "+t.toString());if(No(t))throw new Error(e+"contains "+t.toString()+" "+Ps(r));if("string"===typeof t&&t.length>kl/3&&ii(t)>kl)throw new Error(e+"contains a string greater than "+kl+" utf8 bytes "+Ps(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"===typeof t){let n=!1,i=!1;if(Fo(t,((t,o)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!Pl(t)))throw new Error(e+" contains an invalid key ("+t+") "+Ps(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=ii(t),ks(e)}(r,t),xl(e,o,r),function(e){const t=e.parts_.pop();e.byteLength_-=ii(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)})),n&&i)throw new Error(e+' contains ".value" child '+Ps(r)+" in addition to actual children.")}},Ml=function(e,t,n,r){if((!r||void 0!==n)&&!Dl(n))throw new Error(ri(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Ul=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Ml(e,t,n,r)},Fl=function(e,t){if(".info"===vs(t))throw new Error(e+" failed = Can't modify data under /.info/")},jl=function(e,t){const n=t.path.toString();if("string"!==typeof t.repoInfo.host||0===t.repoInfo.host.length||!Pl(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Dl(e)}(n))throw new Error(ri(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Vl{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Bl(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],o=i.getPath();null===n||Os(o,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&e.eventLists_.push(n)}function Gl(e,t,n){Bl(e,n),Wl(e,(e=>Os(e,t)))}function ql(e,t,n){Bl(e,n),Wl(e,(e=>As(e,t)||As(t,e)))}function Wl(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];if(i){t(i.path)?(zl(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function zl(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();So&&Co("event: "+n.toString()),Go(r)}}}const Hl="repo_interrupt",Kl=25;class Yl{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Vl,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ca(),this.transactionQueueTree_=new yl,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Zl(e,t,n){if(e.stats_=rs(e.repoInfo_),e.forceRestClient_||("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Ta(e.repoInfo_,((t,n,r,i)=>{Ql(e,t,n,r,i)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>$l(e,!0)),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Yr(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new xs(e.repoInfo_,t,((t,n,r,i)=>{Ql(e,t,n,r,i)}),(t=>{$l(e,t)}),(t=>{!function(e,t){Fo(t,((t,n)=>{eu(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return ns[n]||(ns[n]=t()),ns[n]}(e.repoInfo_,(()=>new Aa(e.stats_,e.server_))),e.infoData_=new wa,e.infoSyncTree_=new Kc({startListening:(t,n,r,i)=>{let o=[];const s=e.infoData_.getNode(t._path);return s.isEmpty()||(o=Jc(e.infoSyncTree_,t._path,s),setTimeout((()=>{i("ok")}),0)),o},stopListening:()=>{}}),eu(e,"connected",!1),e.serverSyncTree_=new Kc({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,((n,r)=>{const o=i(n,r);ql(e.eventQueue_,t._path,o)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function Jl(e){const t=e.infoData_.getNode(new _s(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Xl(e){return pl({timestamp:Jl(e)})}function Ql(e,t,n,r,i){e.dataUpdateCount++;const o=new _s(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let s=[];if(i)if(r){const t=$r(n,(e=>ua(e)));s=function(e,t,n,r){const i=al(e,r);if(i){const r=cl(i),o=r.path,s=r.queryId,a=Is(o,t),c=za.fromObject(n);return ll(e,o,new xa(ka(s),a,c))}return[]}(e.serverSyncTree_,o,t,i)}else{const t=ua(n);s=Qc(e.serverSyncTree_,o,t,i)}else if(r){const t=$r(n,(e=>ua(e)));s=function(e,t,n){const r=za.fromObject(n);return tl(e,new xa({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,o,t)}else{const t=ua(n);s=Jc(e.serverSyncTree_,o,t)}let a=o;s.length>0&&(a=lu(e,o)),ql(e.eventQueue_,a,s)}function $l(e,t){eu(e,"connected",t),!1===t&&function(e){ou(e,"onDisconnectEvents");const t=Xl(e),n=Ca();Ia(e.onDisconnect_,Es(),((r,i)=>{const o=_l(r,i,e.serverSyncTree_,t);Ra(n,r,o)}));let r=[];Ia(n,Es(),((t,n)=>{r=r.concat(Jc(e.serverSyncTree_,t,n));const i=fu(e,t);lu(e,i)})),e.onDisconnect_=Ca(),ql(e.eventQueue_,Es(),r)}(e)}function eu(e,t,n){const r=new _s("/.info/"+t),i=ua(n);e.infoData_.updateSnapshot(r,i);const o=Jc(e.infoSyncTree_,r,i);ql(e.eventQueue_,r,o)}function tu(e){return e.nextWriteId_++}function nu(e,t,n,r,i){ou(e,"set",{path:t.toString(),value:n,priority:r});const o=Xl(e),s=ua(n,r),a=el(e.serverSyncTree_,t),c=El(s,a,o),l=tu(e),u=Yc(e.serverSyncTree_,t,c,l,!0);Bl(e.eventQueue_,u),e.server_.put(t.toString(),s.val(!0),((n,r)=>{const o="ok"===n;o||Ao("set at "+t+" failed: "+n);const s=Zc(e.serverSyncTree_,l,!o);ql(e.eventQueue_,t,s),su(e,i,n,r)}));const d=fu(e,t);lu(e,d),ql(e.eventQueue_,d,[])}function ru(e,t,n){let r;r=".info"===vs(t._path)?Xc(e.infoSyncTree_,t,n):Xc(e.serverSyncTree_,t,n),Gl(e.eventQueue_,t._path,r)}function iu(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Hl)}function ou(e){let t="";e.persistentConnection_&&(t=e.persistentConnection_.id+":");for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];Co(t,...r)}function su(e,t,n,r){t&&Go((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const o=new Error(i);o.code=e,t(o)}}))}function au(e,t,n){return el(e.serverSyncTree_,t,n)||aa.EMPTY_NODE}function cu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transactionQueueTree_;if(t||pu(e,t),Sl(t)){const n=du(e,t);Rr(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,t,n){const r=n.map((e=>e.currentWriteId)),i=au(e,t,r);let o=i;const s=i.hash();for(let l=0;l<n.length;l++){const e=n[l];Rr(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const r=Is(t,e.path);o=o.updateChild(r,e.currentOutputSnapshotRaw)}const a=o.val(!0),c=t;e.server_.put(c.toString(),a,(r=>{ou(e,"transaction put response",{path:c.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(Zc(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();pu(e,bl(e.transactionQueueTree_,t)),cu(e,e.transactionQueueTree_),ql(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)Go(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{Ao("transaction at "+c.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}lu(e,t)}}),s)}(e,Il(t),n)}else wl(t)&&Cl(t,(t=>{cu(e,t)}))}function lu(e,t){const n=uu(e,t),r=Il(n);return function(e,t,n){if(0===t.length)return;const r=[];let i=[];const o=t.filter((e=>0===e.status)),s=o.map((e=>e.currentWriteId));for(let c=0;c<t.length;c++){const o=t[c],l=Is(n,o.path);let u,d=!1;if(Rr(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===o.status)d=!0,u=o.abortReason,i=i.concat(Zc(e.serverSyncTree_,o.currentWriteId,!0));else if(0===o.status)if(o.retryCount>=Kl)d=!0,u="maxretry",i=i.concat(Zc(e.serverSyncTree_,o.currentWriteId,!0));else{const n=au(e,o.path,s);o.currentInputSnapshot=n;const r=t[c].update(n.val());if(void 0!==r){xl("transaction failed: Data returned ",r,o.path);let t=ua(r);"object"===typeof r&&null!=r&&Jr(r,".priority")||(t=t.updatePriority(n.getPriority()));const a=o.currentWriteId,c=Xl(e),l=El(t,n,c);o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=l,o.currentWriteId=tu(e),s.splice(s.indexOf(a),1),i=i.concat(Yc(e.serverSyncTree_,o.path,l,o.currentWriteId,o.applyLocally)),i=i.concat(Zc(e.serverSyncTree_,a,!0))}else d=!0,u="nodata",i=i.concat(Zc(e.serverSyncTree_,o.currentWriteId,!0))}ql(e.eventQueue_,n,i),i=[],d&&(t[c].status=2,a=t[c].unwatcher,setTimeout(a,Math.floor(0)),t[c].onComplete&&("nodata"===u?r.push((()=>t[c].onComplete(null,!1,t[c].currentInputSnapshot))):r.push((()=>t[c].onComplete(new Error(u),!1,null)))))}var a;pu(e,e.transactionQueueTree_);for(let c=0;c<r.length;c++)Go(r[c]);cu(e,e.transactionQueueTree_)}(e,du(e,n),r),r}function uu(e,t){let n,r=e.transactionQueueTree_;for(n=vs(t);null!==n&&void 0===Sl(r);)r=bl(r,n),n=vs(t=bs(t));return r}function du(e,t){const n=[];return hu(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function hu(e,t,n){const r=Sl(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);Cl(t,(t=>{hu(e,t,n)}))}function pu(e,t){const n=Sl(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Tl(t,n.length>0?n:void 0)}Cl(t,(t=>{pu(e,t)}))}function fu(e,t){const n=Il(uu(e,t)),r=bl(e.transactionQueueTree_,t);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,(t=>{mu(e,t)})),mu(e,r),Rl(r,(t=>{mu(e,t)})),n}function mu(e,t){const n=Sl(t);if(n){const r=[];let i=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(Rr(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):(Rr(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(Zc(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Tl(t,void 0):n.length=o+1,ql(e.eventQueue_,Il(t),i);for(let e=0;e<r.length;e++)Go(r[e])}}const gu=function(e,t){const n=_u(e),r=n.namespace;"firebase.com"===n.domain&&Oo(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||Oo("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Ao("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Qo(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new _s(n.pathString)}},_u=function(e){let t="",n="",r="",i="",o="",s=!0,a="https",c=443;if("string"===typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let u=e.indexOf("/");-1===u&&(u=e.length);let d=e.indexOf("?");-1===d&&(d=e.length),t=e.substring(0,Math.min(u,d)),u<d&&(i=function(e){let t="";const n=e.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let e=n[i];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(r){}t+="/"+e}return t}(e.substring(u,d)));const h=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Ao("Invalid query segment '".concat(n,"' in query '").concat(e,"'"))}return t}(e.substring(Math.min(e.length,d)));l=t.indexOf(":"),l>=0?(s="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),o=r}"ns"in h&&(o=h.ns)}return{host:t,port:c,domain:n,subdomain:r,secure:s,scheme:a,pathString:i,namespace:o}},Eu="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";!function(){let e=0;const t=[]}();class vu{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Yr(this.snapshot.exportVal())}}class yu{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class bu{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Rr(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Su{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return Rs(this._path)?null:Ss(this._path)}get ref(){return new Tu(this._repo,this._path)}get _queryIdentifier(){const e=Sa(this._queryParams),t=Mo(e);return"{}"===t?"default":t}get _queryObject(){return Sa(this._queryParams)}isEqual(e){if(!((e=oi(e))instanceof Su))return!1;const t=this._repo===e._repo,n=Os(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class Tu extends Su{constructor(e,t){super(e,t,new ya,!1)}get parent(){const e=ws(this._path);return null===e?null:new Tu(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class wu{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new _s(e),n=Ru(this.ref,e);return new wu(this._node.getChild(t),n,$s)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new wu(n,Ru(this.ref,t),$s))))}hasChild(e){const t=new _s(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Cu(e,t){return(e=oi(e))._checkNotDeleted("ref"),void 0!==t?Ru(e._root,t):e._root}function Ru(e,t){return null===vs((e=oi(e))._path)?Ul("child","path",t,!1):Ml("child","path",t,!1),new Tu(e._repo,Cs(e._path,t))}function Iu(e,t){e=oi(e),Fl("set",e._path),Ll("set",t,e._path,!1);const n=new Vr;return nu(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}class Ou{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new vu("value",this,new wu(e.snapshotNode,new Tu(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new yu(this,e,t):null}matches(e){return e instanceof Ou&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Au{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new yu(this,e,t):null}createEvent(e,t){Rr(null!=e.childName,"Child events should have a childName.");const n=Ru(new Tu(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new vu(e.type,this,new wu(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Au&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function Nu(e,t,n,r,i){let o;if("object"===typeof r&&(o=void 0,i=r),"function"===typeof r&&(o=r),i&&i.onlyOnce){const t=n,r=(n,r)=>{ru(e._repo,e,a),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}const s=new bu(n,o||void 0),a="value"===t?new Ou(s):new Au(t,s);return function(e,t,n){let r;r=".info"===vs(t._path)?$c(e.infoSyncTree_,t,n):$c(e.serverSyncTree_,t,n),Gl(e.eventQueue_,t._path,r)}(e._repo,e,a),()=>ru(e._repo,e,a)}function ku(e,t,n,r){return Nu(e,"value",t,n,r)}!function(e){Rr(!Dc,"__referenceConstructor has already been defined"),Dc=e}(Tu),function(e){Rr(!Lc,"__referenceConstructor has already been defined"),Lc=e}(Tu);const Pu="FIREBASE_DATABASE_EMULATOR_HOST",Du={};let Lu=!1;function xu(e,t,n,r,i){let o=r||e.options.databaseURL;void 0===o&&(e.options.projectId||Oo("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Co("Using default host for project ",e.options.projectId),o="".concat(e.options.projectId,"-default-rtdb.firebaseio.com"));let s,a,c=gu(o,i),l=c.repoInfo;"undefined"!==typeof process&&(a={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}[Pu]),a?(s=!0,o="http://".concat(a,"?ns=").concat(l.namespace),c=gu(o,i),l=c.repoInfo):s=!c.repoInfo.secure;const u=i&&s?new Ho(Ho.OWNER):new zo(e.name,e.options,t);jl("Invalid Firebase Database URL",c),Rs(c.path)||Oo("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function(e,t,n,r){let i=Du[t.name];i||(i={},Du[t.name]=i);let o=i[e.toURLString()];o&&Oo("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return o=new Yl(e,Lu,n,r),i[e.toURLString()]=o,o}(l,e,u,new Wo(e.name,n));return new Mu(d,e)}class Mu{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Zl(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Tu(this._repo,Es())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=Du[t];n&&n[e.key]===e||Oo("Database ".concat(t,"(").concat(e.repoInfo_,") has already been deleted.")),iu(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Oo("Cannot call "+e+" on a deleted database.")}}xs.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},xs.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};!function(e){ho("10.7.1"),Wi(new si("database",((e,t)=>{let{instanceIdentifier:n}=t;return xu(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),n)}),"PUBLIC").setMultipleInstances(!0)),Zi(co,lo,e),Zi(co,lo,"esm2017")}();const Uu=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ji;const t=Bi.get(e);if(!t&&e===ji&&jr())return Yi();if(!t)throw Hi.create("no-app",{appName:e});return t}(),t=arguments.length>1?arguments[1]:void 0;const n=zi(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=Fr("database");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=oi(e),e._checkNotDeleted("useEmulator"),e._instanceStarted&&Oo("Cannot call useEmulator() after instance has already been initialized.");const i=e._repoInternal;let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Oo('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Ho(Ho.OWNER);else if(r.mockUserToken){const t="string"===typeof r.mockUserToken?r.mockUserToken:function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Pr(JSON.stringify({alg:"none",type:"JWT"})),Pr(JSON.stringify(o)),""].join(".")}(r.mockUserToken,e.app.options.projectId);o=new Ho(t)}!function(e,t,n,r){e.repoInfo_=new Qo("".concat(t,":").concat(n),!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),r&&(e.authTokenProvider_=r)}(i,t,n,o)}(n,...e)}return n}(Yi({apiKey:"AIzaSyAiARl-FXANAm89c_ptt3ss2vhue9Do78o",authDomain:"video-call-77eb8.firebaseapp.com",projectId:"video-call-77eb8",storageBucket:"video-call-77eb8.appspot.com",messagingSenderId:"894239961219",appId:"1:894239961219:web:4677b6198c016f00342bb6",measurementId:"G-D3HY9ZKWQ5",databaseURL:"https://video-call-77eb8-default-rtdb.firebaseio.com/"}));__webpack_require__(8457);var Fu=__webpack_require__(6117);function ju(e){return"string"===typeof e}function Vu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(void 0===e)return{};const n={};return Object.keys(e).filter((n=>n.match(/^on[A-Z]/)&&"function"===typeof e[n]&&!t.includes(n))).forEach((t=>{n[t]=e[t]})),n}function Bu(e){if(void 0===e)return{};const t={};return Object.keys(e).filter((t=>!(t.match(/^on[A-Z]/)&&"function"===typeof e[t]))).forEach((n=>{t[n]=e[n]})),t}const Gu=["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"];function qu(e){var t;const{elementType:n,externalSlotProps:r,ownerState:i,skipResolvingSlotProps:o=!1}=e,s=(0,_n.Z)(e,Gu),a=o?{}:function(e,t,n){return"function"===typeof e?e(t,n):e}(r,i),{props:c,internalRef:l}=function(e){const{getSlotProps:t,additionalProps:n,externalSlotProps:r,externalForwardedProps:i,className:o}=e;if(!t){const e=(0,vn.Z)(null==n?void 0:n.className,o,null==i?void 0:i.className,null==r?void 0:r.className),t=(0,En.Z)({},null==n?void 0:n.style,null==i?void 0:i.style,null==r?void 0:r.style),s=(0,En.Z)({},n,i,r);return e.length>0&&(s.className=e),Object.keys(t).length>0&&(s.style=t),{props:s,internalRef:void 0}}const s=Vu((0,En.Z)({},i,r)),a=Bu(r),c=Bu(i),l=t(s),u=(0,vn.Z)(null==l?void 0:l.className,null==n?void 0:n.className,o,null==i?void 0:i.className,null==r?void 0:r.className),d=(0,En.Z)({},null==l?void 0:l.style,null==n?void 0:n.style,null==i?void 0:i.style,null==r?void 0:r.style),h=(0,En.Z)({},l,n,c,a);return u.length>0&&(h.className=u),Object.keys(d).length>0&&(h.style=d),{props:h,internalRef:l.ref}}((0,En.Z)({},s,{externalSlotProps:a})),u=(0,Fu.Z)(l,null==a?void 0:a.ref,null==(t=e.additionalProps)?void 0:t.ref),d=function(e,t,n){return void 0===e||ju(e)?t:(0,En.Z)({},t,{ownerState:(0,En.Z)({},t.ownerState,n)})}(n,(0,En.Z)({},c,{ref:u}),i);return d}var Wu=__webpack_require__(3459),zu=__webpack_require__(6482),Hu=__webpack_require__(988);function Ku(){const e=(0,Wu.Z)(zu.Z);return e[Hu.Z]||e}var Yu=__webpack_require__(3199);let Zu;function Ju(){if(Zu)return Zu;const e=document.createElement("div"),t=document.createElement("div");return t.style.width="10px",t.style.height="1px",e.appendChild(t),e.dir="rtl",e.style.fontSize="14px",e.style.width="4px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.overflow="scroll",document.body.appendChild(e),Zu="reverse",e.scrollLeft>0?Zu="default":(e.scrollLeft=1,0===e.scrollLeft&&(Zu="negative")),document.body.removeChild(e),Zu}function Xu(e,t){const n=e.scrollLeft;if("rtl"!==t)return n;switch(Ju()){case"negative":return e.scrollWidth-e.clientWidth+n;case"reverse":return e.scrollWidth-e.clientWidth-n;default:return n}}function Qu(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2}var $u=__webpack_require__(162),ed=__webpack_require__(7602);const td=["onChange"],nd={width:99,height:99,position:"absolute",top:-9999,overflow:"scroll"};var rd=__webpack_require__(9201);const id=(0,rd.Z)((0,qn.jsx)("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"}),"KeyboardArrowLeft"),od=(0,rd.Z)((0,qn.jsx)("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}),"KeyboardArrowRight");function sd(e){return(0,lr.Z)("MuiTabScrollButton",e)}const ad=(0,zn.Z)("MuiTabScrollButton",["root","vertical","horizontal","disabled"]),cd=["className","slots","slotProps","direction","orientation","disabled"],ld=(0,bn.ZP)(mr,{name:"MuiTabScrollButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.orientation&&t[n.orientation]]}})((e=>{let{ownerState:t}=e;return(0,En.Z)({width:40,flexShrink:0,opacity:.8,["&.".concat(ad.disabled)]:{opacity:0}},"vertical"===t.orientation&&{width:"100%",height:40,"& svg":{transform:"rotate(".concat(t.isRtl?-90:90,"deg)")}})})),ud=n.forwardRef((function(e,t){var n,r;const i=(0,Sn.Z)({props:e,name:"MuiTabScrollButton"}),{className:o,slots:s={},slotProps:a={},direction:c}=i,l=(0,_n.Z)(i,cd),u="rtl"===Ku().direction,d=(0,En.Z)({isRtl:u},i),h=(e=>{const{classes:t,orientation:n,disabled:r}=e,i={root:["root",n,r&&"disabled"]};return(0,yn.Z)(i,sd,t)})(d),p=null!=(n=s.StartScrollButtonIcon)?n:id,f=null!=(r=s.EndScrollButtonIcon)?r:od,m=qu({elementType:p,externalSlotProps:a.startScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:d}),g=qu({elementType:f,externalSlotProps:a.endScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:d});return(0,qn.jsx)(ld,(0,En.Z)({component:"div",className:(0,vn.Z)(h.root,o),ref:t,role:null,ownerState:d,tabIndex:null},l,{children:"left"===c?(0,qn.jsx)(p,(0,En.Z)({},m)):(0,qn.jsx)(f,(0,En.Z)({},g))}))})),dd=ud;function hd(e){return(0,lr.Z)("MuiTabs",e)}const pd=(0,zn.Z)("MuiTabs",["root","vertical","flexContainer","flexContainerVertical","centered","scroller","fixed","scrollableX","scrollableY","hideScrollbar","scrollButtons","scrollButtonsHideMobile","indicator"]);var fd=__webpack_require__(8301);const md=["aria-label","aria-labelledby","action","centered","children","className","component","allowScrollButtonsMobile","indicatorColor","onChange","orientation","ScrollButtonComponent","scrollButtons","selectionFollowsFocus","slots","slotProps","TabIndicatorProps","TabScrollButtonProps","textColor","value","variant","visibleScrollbar"],gd=(e,t)=>e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:e.firstChild,_d=(e,t)=>e===t?e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:e.lastChild,Ed=(e,t,n)=>{let r=!1,i=n(e,t);for(;i;){if(i===e.firstChild){if(r)return;r=!0}const t=i.disabled||"true"===i.getAttribute("aria-disabled");if(i.hasAttribute("tabindex")&&!t)return void i.focus();i=n(e,i)}},vd=(0,bn.ZP)("div",{name:"MuiTabs",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{["& .".concat(pd.scrollButtons)]:t.scrollButtons},{["& .".concat(pd.scrollButtons)]:n.scrollButtonsHideMobile&&t.scrollButtonsHideMobile},t.root,n.vertical&&t.vertical]}})((e=>{let{ownerState:t,theme:n}=e;return(0,En.Z)({overflow:"hidden",minHeight:48,WebkitOverflowScrolling:"touch",display:"flex"},t.vertical&&{flexDirection:"column"},t.scrollButtonsHideMobile&&{["& .".concat(pd.scrollButtons)]:{[n.breakpoints.down("sm")]:{display:"none"}}})})),yd=(0,bn.ZP)("div",{name:"MuiTabs",slot:"Scroller",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.scroller,n.fixed&&t.fixed,n.hideScrollbar&&t.hideScrollbar,n.scrollableX&&t.scrollableX,n.scrollableY&&t.scrollableY]}})((e=>{let{ownerState:t}=e;return(0,En.Z)({position:"relative",display:"inline-block",flex:"1 1 auto",whiteSpace:"nowrap"},t.fixed&&{overflowX:"hidden",width:"100%"},t.hideScrollbar&&{scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},t.scrollableX&&{overflowX:"auto",overflowY:"hidden"},t.scrollableY&&{overflowY:"auto",overflowX:"hidden"})})),bd=(0,bn.ZP)("div",{name:"MuiTabs",slot:"FlexContainer",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.flexContainer,n.vertical&&t.flexContainerVertical,n.centered&&t.centered]}})((e=>{let{ownerState:t}=e;return(0,En.Z)({display:"flex"},t.vertical&&{flexDirection:"column"},t.centered&&{justifyContent:"center"})})),Sd=(0,bn.ZP)("span",{name:"MuiTabs",slot:"Indicator",overridesResolver:(e,t)=>t.indicator})((e=>{let{ownerState:t,theme:n}=e;return(0,En.Z)({position:"absolute",height:2,bottom:0,width:"100%",transition:n.transitions.create()},"primary"===t.indicatorColor&&{backgroundColor:(n.vars||n).palette.primary.main},"secondary"===t.indicatorColor&&{backgroundColor:(n.vars||n).palette.secondary.main},t.vertical&&{height:"100%",width:2,right:0})})),Td=(0,bn.ZP)((function(e){const{onChange:t}=e,r=(0,_n.Z)(e,td),i=n.useRef(),o=n.useRef(null),s=()=>{i.current=o.current.offsetHeight-o.current.clientHeight};return(0,$u.Z)((()=>{const e=(0,Yu.Z)((()=>{const e=i.current;s(),e!==i.current&&t(i.current)})),n=(0,ed.Z)(o.current);return n.addEventListener("resize",e),()=>{e.clear(),n.removeEventListener("resize",e)}}),[t]),n.useEffect((()=>{s(),t(i.current)}),[t]),(0,qn.jsx)("div",(0,En.Z)({style:nd,ref:o},r))}))({overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),wd={};const Cd=n.forwardRef((function(e,t){const r=(0,Sn.Z)({props:e,name:"MuiTabs"}),i=Ku(),o="rtl"===i.direction,{"aria-label":s,"aria-labelledby":a,action:c,centered:l=!1,children:u,className:d,component:h="div",allowScrollButtonsMobile:p=!1,indicatorColor:f="primary",onChange:m,orientation:g="horizontal",ScrollButtonComponent:_=dd,scrollButtons:E="auto",selectionFollowsFocus:v,slots:y={},slotProps:b={},TabIndicatorProps:S={},TabScrollButtonProps:T={},textColor:w="primary",value:C,variant:R="standard",visibleScrollbar:I=!1}=r,O=(0,_n.Z)(r,md),A="scrollable"===R,N="vertical"===g,k=N?"scrollTop":"scrollLeft",P=N?"top":"left",D=N?"bottom":"right",L=N?"clientHeight":"clientWidth",x=N?"height":"width",M=(0,En.Z)({},r,{component:h,allowScrollButtonsMobile:p,indicatorColor:f,orientation:g,vertical:N,scrollButtons:E,textColor:w,variant:R,visibleScrollbar:I,fixed:!A,hideScrollbar:A&&!I,scrollableX:A&&!N,scrollableY:A&&N,centered:l&&!A,scrollButtonsHideMobile:!p}),U=(e=>{const{vertical:t,fixed:n,hideScrollbar:r,scrollableX:i,scrollableY:o,centered:s,scrollButtonsHideMobile:a,classes:c}=e,l={root:["root",t&&"vertical"],scroller:["scroller",n&&"fixed",r&&"hideScrollbar",i&&"scrollableX",o&&"scrollableY"],flexContainer:["flexContainer",t&&"flexContainerVertical",s&&"centered"],indicator:["indicator"],scrollButtons:["scrollButtons",a&&"scrollButtonsHideMobile"],scrollableX:[i&&"scrollableX"],hideScrollbar:[r&&"hideScrollbar"]};return(0,yn.Z)(l,hd,c)})(M),F=qu({elementType:y.StartScrollButtonIcon,externalSlotProps:b.startScrollButtonIcon,ownerState:M}),j=qu({elementType:y.EndScrollButtonIcon,externalSlotProps:b.endScrollButtonIcon,ownerState:M});const[V,B]=n.useState(!1),[G,q]=n.useState(wd),[W,z]=n.useState(!1),[H,K]=n.useState(!1),[Y,Z]=n.useState(!1),[J,X]=n.useState({overflow:"hidden",scrollbarWidth:0}),Q=new Map,$=n.useRef(null),ee=n.useRef(null),te=()=>{const e=$.current;let t,n;if(e){const n=e.getBoundingClientRect();t={clientWidth:e.clientWidth,scrollLeft:e.scrollLeft,scrollTop:e.scrollTop,scrollLeftNormalized:Xu(e,i.direction),scrollWidth:e.scrollWidth,top:n.top,bottom:n.bottom,left:n.left,right:n.right}}if(e&&!1!==C){const e=ee.current.children;if(e.length>0){const t=e[Q.get(C)];0,n=t?t.getBoundingClientRect():null}}return{tabsMeta:t,tabMeta:n}},ne=(0,wn.Z)((()=>{const{tabsMeta:e,tabMeta:t}=te();let n,r=0;if(N)n="top",t&&e&&(r=t.top-e.top+e.scrollTop);else if(n=o?"right":"left",t&&e){const i=o?e.scrollLeftNormalized+e.clientWidth-e.scrollWidth:e.scrollLeft;r=(o?-1:1)*(t[n]-e[n]+i)}const i={[n]:r,[x]:t?t[x]:0};if(isNaN(G[n])||isNaN(G[x]))q(i);else{const e=Math.abs(G[n]-i[n]),t=Math.abs(G[x]-i[x]);(e>=1||t>=1)&&q(i)}})),re=function(e){let{animation:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t?function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const{ease:o=Qu,duration:s=300}=r;let a=null;const c=t[e];let l=!1;const u=()=>{l=!0},d=r=>{if(l)return void i(new Error("Animation cancelled"));null===a&&(a=r);const u=Math.min(1,(r-a)/s);t[e]=o(u)*(n-c)+c,u>=1?requestAnimationFrame((()=>{i(null)})):requestAnimationFrame(d)};c===n?i(new Error("Element already at target position")):requestAnimationFrame(d)}(k,$.current,e,{duration:i.transitions.duration.standard}):$.current[k]=e},ie=e=>{let t=$.current[k];N?t+=e:(t+=e*(o?-1:1),t*=o&&"reverse"===Ju()?-1:1),re(t)},oe=()=>{const e=$.current[L];let t=0;const n=Array.from(ee.current.children);for(let r=0;r<n.length;r+=1){const i=n[r];if(t+i[L]>e){0===r&&(t=e);break}t+=i[L]}return t},se=()=>{ie(-1*oe())},ae=()=>{ie(oe())},ce=n.useCallback((e=>{X({overflow:null,scrollbarWidth:e})}),[]),le=(0,wn.Z)((e=>{const{tabsMeta:t,tabMeta:n}=te();if(n&&t)if(n[P]<t[P]){const r=t[k]+(n[P]-t[P]);re(r,{animation:e})}else if(n[D]>t[D]){const r=t[k]+(n[D]-t[D]);re(r,{animation:e})}})),ue=(0,wn.Z)((()=>{A&&!1!==E&&Z(!Y)}));n.useEffect((()=>{const e=(0,Yu.Z)((()=>{$.current&&ne()}));let t;const n=n=>{n.forEach((e=>{e.removedNodes.forEach((e=>{var n;null==(n=t)||n.unobserve(e)})),e.addedNodes.forEach((e=>{var n;null==(n=t)||n.observe(e)}))})),e(),ue()},r=(0,ed.Z)($.current);let i;return r.addEventListener("resize",e),"undefined"!==typeof ResizeObserver&&(t=new ResizeObserver(e),Array.from(ee.current.children).forEach((e=>{t.observe(e)}))),"undefined"!==typeof MutationObserver&&(i=new MutationObserver(n),i.observe(ee.current,{childList:!0})),()=>{var n,o;e.clear(),r.removeEventListener("resize",e),null==(n=i)||n.disconnect(),null==(o=t)||o.disconnect()}}),[ne,ue]),n.useEffect((()=>{const e=Array.from(ee.current.children),t=e.length;if("undefined"!==typeof IntersectionObserver&&t>0&&A&&!1!==E){const n=e[0],r=e[t-1],i={root:$.current,threshold:.99},o=new IntersectionObserver((e=>{z(!e[0].isIntersecting)}),i);o.observe(n);const s=new IntersectionObserver((e=>{K(!e[0].isIntersecting)}),i);return s.observe(r),()=>{o.disconnect(),s.disconnect()}}}),[A,E,Y,null==u?void 0:u.length]),n.useEffect((()=>{B(!0)}),[]),n.useEffect((()=>{ne()})),n.useEffect((()=>{le(wd!==G)}),[le,G]),n.useImperativeHandle(c,(()=>({updateIndicator:ne,updateScrollButtons:ue})),[ne,ue]);const de=(0,qn.jsx)(Sd,(0,En.Z)({},S,{className:(0,vn.Z)(U.indicator,S.className),ownerState:M,style:(0,En.Z)({},G,S.style)}));let he=0;const pe=n.Children.map(u,(e=>{if(!n.isValidElement(e))return null;const t=void 0===e.props.value?he:e.props.value;Q.set(t,he);const r=t===C;return he+=1,n.cloneElement(e,(0,En.Z)({fullWidth:"fullWidth"===R,indicator:r&&!V&&de,selected:r,selectionFollowsFocus:v,onChange:m,textColor:w,value:t},1!==he||!1!==C||e.props.tabIndex?{}:{tabIndex:0}))})),fe=(()=>{const e={};e.scrollbarSizeListener=A?(0,qn.jsx)(Td,{onChange:ce,className:(0,vn.Z)(U.scrollableX,U.hideScrollbar)}):null;const t=A&&("auto"===E&&(W||H)||!0===E);return e.scrollButtonStart=t?(0,qn.jsx)(_,(0,En.Z)({slots:{StartScrollButtonIcon:y.StartScrollButtonIcon},slotProps:{startScrollButtonIcon:F},orientation:g,direction:o?"right":"left",onClick:se,disabled:!W},T,{className:(0,vn.Z)(U.scrollButtons,T.className)})):null,e.scrollButtonEnd=t?(0,qn.jsx)(_,(0,En.Z)({slots:{EndScrollButtonIcon:y.EndScrollButtonIcon},slotProps:{endScrollButtonIcon:j},orientation:g,direction:o?"left":"right",onClick:ae,disabled:!H},T,{className:(0,vn.Z)(U.scrollButtons,T.className)})):null,e})();return(0,qn.jsxs)(vd,(0,En.Z)({className:(0,vn.Z)(U.root,d),ownerState:M,ref:t,as:h},O,{children:[fe.scrollButtonStart,fe.scrollbarSizeListener,(0,qn.jsxs)(yd,{className:U.scroller,ownerState:M,style:{overflow:J.overflow,[N?"margin".concat(o?"Left":"Right"):"marginBottom"]:I?void 0:-J.scrollbarWidth},ref:$,children:[(0,qn.jsx)(bd,{"aria-label":s,"aria-labelledby":a,"aria-orientation":"vertical"===g?"vertical":null,className:U.flexContainer,ownerState:M,onKeyDown:e=>{const t=ee.current,n=(0,fd.Z)(t).activeElement;if("tab"!==n.getAttribute("role"))return;let r="horizontal"===g?"ArrowLeft":"ArrowUp",i="horizontal"===g?"ArrowRight":"ArrowDown";switch("horizontal"===g&&o&&(r="ArrowRight",i="ArrowLeft"),e.key){case r:e.preventDefault(),Ed(t,n,_d);break;case i:e.preventDefault(),Ed(t,n,gd);break;case"Home":e.preventDefault(),Ed(t,null,gd);break;case"End":e.preventDefault(),Ed(t,null,_d)}},ref:ee,role:"tablist",children:pe}),V&&de]}),fe.scrollButtonEnd]}))})),Rd=Cd;function Id(e){return(0,lr.Z)("MuiTab",e)}const Od=(0,zn.Z)("MuiTab",["root","labelIcon","textColorInherit","textColorPrimary","textColorSecondary","selected","disabled","fullWidth","wrapped","iconWrapper"]),Ad=["className","disabled","disableFocusRipple","fullWidth","icon","iconPosition","indicator","label","onChange","onClick","onFocus","selected","selectionFollowsFocus","textColor","value","wrapped"],Nd=(0,bn.ZP)(mr,{name:"MuiTab",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.label&&n.icon&&t.labelIcon,t["textColor".concat((0,gr.Z)(n.textColor))],n.fullWidth&&t.fullWidth,n.wrapped&&t.wrapped]}})((e=>{let{theme:t,ownerState:n}=e;return(0,En.Z)({},t.typography.button,{maxWidth:360,minWidth:90,position:"relative",minHeight:48,flexShrink:0,padding:"12px 16px",overflow:"hidden",whiteSpace:"normal",textAlign:"center"},n.label&&{flexDirection:"top"===n.iconPosition||"bottom"===n.iconPosition?"column":"row"},{lineHeight:1.25},n.icon&&n.label&&{minHeight:72,paddingTop:9,paddingBottom:9,["& > .".concat(Od.iconWrapper)]:(0,En.Z)({},"top"===n.iconPosition&&{marginBottom:6},"bottom"===n.iconPosition&&{marginTop:6},"start"===n.iconPosition&&{marginRight:t.spacing(1)},"end"===n.iconPosition&&{marginLeft:t.spacing(1)})},"inherit"===n.textColor&&{color:"inherit",opacity:.6,["&.".concat(Od.selected)]:{opacity:1},["&.".concat(Od.disabled)]:{opacity:(t.vars||t).palette.action.disabledOpacity}},"primary"===n.textColor&&{color:(t.vars||t).palette.text.secondary,["&.".concat(Od.selected)]:{color:(t.vars||t).palette.primary.main},["&.".concat(Od.disabled)]:{color:(t.vars||t).palette.text.disabled}},"secondary"===n.textColor&&{color:(t.vars||t).palette.text.secondary,["&.".concat(Od.selected)]:{color:(t.vars||t).palette.secondary.main},["&.".concat(Od.disabled)]:{color:(t.vars||t).palette.text.disabled}},n.fullWidth&&{flexShrink:1,flexGrow:1,flexBasis:0,maxWidth:"none"},n.wrapped&&{fontSize:t.typography.pxToRem(12)})})),kd=n.forwardRef((function(e,t){const r=(0,Sn.Z)({props:e,name:"MuiTab"}),{className:i,disabled:o=!1,disableFocusRipple:s=!1,fullWidth:a,icon:c,iconPosition:l="top",indicator:u,label:d,onChange:h,onClick:p,onFocus:f,selected:m,selectionFollowsFocus:g,textColor:_="inherit",value:E,wrapped:v=!1}=r,y=(0,_n.Z)(r,Ad),b=(0,En.Z)({},r,{disabled:o,disableFocusRipple:s,selected:m,icon:!!c,iconPosition:l,label:!!d,fullWidth:a,textColor:_,wrapped:v}),S=(e=>{const{classes:t,textColor:n,fullWidth:r,wrapped:i,icon:o,label:s,selected:a,disabled:c}=e,l={root:["root",o&&s&&"labelIcon","textColor".concat((0,gr.Z)(n)),r&&"fullWidth",i&&"wrapped",a&&"selected",c&&"disabled"],iconWrapper:["iconWrapper"]};return(0,yn.Z)(l,Id,t)})(b),T=c&&d&&n.isValidElement(c)?n.cloneElement(c,{className:(0,vn.Z)(S.iconWrapper,c.props.className)}):c;return(0,qn.jsxs)(Nd,(0,En.Z)({focusRipple:!s,className:(0,vn.Z)(S.root,i),ref:t,role:"tab","aria-selected":m,disabled:o,onClick:e=>{!m&&h&&h(e,E),p&&p(e)},onFocus:e=>{g&&!m&&h&&h(e,E),f&&f(e)},ownerState:b,tabIndex:m?0:-1},y,{children:["top"===l||"start"===l?(0,qn.jsxs)(n.Fragment,{children:[T,d]}):(0,qn.jsxs)(n.Fragment,{children:[d,T]}),u]}))})),Pd=kd;var Dd=__webpack_require__(2421),Ld=__webpack_require__(104),xd=__webpack_require__(2466),Md=__webpack_require__(7416);const Ud=["sx"],Fd=e=>{var t,n;const r={systemProps:{},otherProps:{}},i=null!=(t=null==e||null==(n=e.theme)?void 0:n.unstable_sxConfig)?t:Md.Z;return Object.keys(e).forEach((t=>{i[t]?r.systemProps[t]=e[t]:r.otherProps[t]=e[t]})),r};function jd(e){const{sx:t}=e,n=(0,_n.Z)(e,Ud),{systemProps:r,otherProps:i}=Fd(n);let o;return o=Array.isArray(t)?[r,...t]:"function"===typeof t?function(){const e=t(...arguments);return(0,xd.P)(e)?(0,En.Z)({},r,e):r}:(0,En.Z)({},r,t),(0,En.Z)({},i,{sx:o})}const Vd=["className","component"];var Bd=__webpack_require__(5902),Gd=__webpack_require__(7107);const qd=(0,zn.Z)("MuiBox",["root"]),Wd=(0,Gd.Z)(),zd=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:r,defaultClassName:i="MuiBox-root",generateClassName:o}=e,s=(0,Dd.ZP)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(Ld.Z),a=n.forwardRef((function(e,n){const a=(0,Wu.Z)(r),c=jd(e),{className:l,component:u="div"}=c,d=(0,_n.Z)(c,Vd);return(0,qn.jsx)(s,(0,En.Z)({as:u,ref:n,className:(0,vn.Z)(l,o?o(i):i),theme:t&&a[t]||a},d))}));return a}({themeId:Hu.Z,defaultTheme:Wd,defaultClassName:qd.root,generateClassName:Bd.Z.generate}),Hd=zd;var Kd=__webpack_require__(2065);const Yd=e=>{let t;return t=e<1?5.11916*e**2:4.5*Math.log(e+1)+2,(t/100).toFixed(2)};function Zd(e){return(0,lr.Z)("MuiPaper",e)}(0,zn.Z)("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const Jd=["className","component","elevation","square","variant"],Xd=(0,bn.ZP)("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],!n.square&&t.rounded,"elevation"===n.variant&&t["elevation".concat(n.elevation)]]}})((e=>{let{theme:t,ownerState:n}=e;var r;return(0,En.Z)({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow")},!n.square&&{borderRadius:t.shape.borderRadius},"outlined"===n.variant&&{border:"1px solid ".concat((t.vars||t).palette.divider)},"elevation"===n.variant&&(0,En.Z)({boxShadow:(t.vars||t).shadows[n.elevation]},!t.vars&&"dark"===t.palette.mode&&{backgroundImage:"linear-gradient(".concat((0,Kd.Fq)("#fff",Yd(n.elevation)),", ").concat((0,Kd.Fq)("#fff",Yd(n.elevation)),")")},t.vars&&{backgroundImage:null==(r=t.vars.overlays)?void 0:r[n.elevation]}))})),Qd=n.forwardRef((function(e,t){const n=(0,Sn.Z)({props:e,name:"MuiPaper"}),{className:r,component:i="div",elevation:o=1,square:s=!1,variant:a="elevation"}=n,c=(0,_n.Z)(n,Jd),l=(0,En.Z)({},n,{component:i,elevation:o,square:s,variant:a}),u=(e=>{const{square:t,elevation:n,variant:r,classes:i}=e,o={root:["root",r,!t&&"rounded","elevation"===r&&"elevation".concat(n)]};return(0,yn.Z)(o,Zd,i)})(l);return(0,qn.jsx)(Xd,(0,En.Z)({as:i,ownerState:l,className:(0,vn.Z)(u.root,r),ref:t},c))})),$d=Qd;function eh(e){return(0,lr.Z)("MuiCard",e)}(0,zn.Z)("MuiCard",["root"]);const th=["className","raised"],nh=(0,bn.ZP)($d,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({overflow:"hidden"}))),rh=n.forwardRef((function(e,t){const n=(0,Sn.Z)({props:e,name:"MuiCard"}),{className:r,raised:i=!1}=n,o=(0,_n.Z)(n,th),s=(0,En.Z)({},n,{raised:i}),a=(e=>{const{classes:t}=e;return(0,yn.Z)({root:["root"]},eh,t)})(s);return(0,qn.jsx)(nh,(0,En.Z)({className:(0,vn.Z)(a.root,r),elevation:i?8:void 0,ref:t,ownerState:s},o))})),ih=rh;var oh=__webpack_require__(9027),sh=__webpack_require__(1598);function ah(e){return(0,lr.Z)("MuiCardContent",e)}(0,zn.Z)("MuiCardContent",["root"]);const ch=["className","component"],lh=(0,bn.ZP)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({padding:16,"&:last-child":{paddingBottom:24}}))),uh=n.forwardRef((function(e,t){const n=(0,Sn.Z)({props:e,name:"MuiCardContent"}),{className:r,component:i="div"}=n,o=(0,_n.Z)(n,ch),s=(0,En.Z)({},n,{component:i}),a=(e=>{const{classes:t}=e;return(0,yn.Z)({root:["root"]},ah,t)})(s);return(0,qn.jsx)(lh,(0,En.Z)({as:i,className:(0,vn.Z)(a.root,r),ownerState:s,ref:t},o))})),dh=uh;function hh(e){return(0,lr.Z)("MuiTypography",e)}(0,zn.Z)("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const ph=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],fh=(0,bn.ZP)("span",{name:"MuiTypography",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.variant&&t[n.variant],"inherit"!==n.align&&t["align".concat((0,gr.Z)(n.align))],n.noWrap&&t.noWrap,n.gutterBottom&&t.gutterBottom,n.paragraph&&t.paragraph]}})((e=>{let{theme:t,ownerState:n}=e;return(0,En.Z)({margin:0},"inherit"===n.variant&&{font:"inherit"},"inherit"!==n.variant&&t.typography[n.variant],"inherit"!==n.align&&{textAlign:n.align},n.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},n.gutterBottom&&{marginBottom:"0.35em"},n.paragraph&&{marginBottom:16})})),mh={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},gh={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},_h=n.forwardRef((function(e,t){const n=(0,Sn.Z)({props:e,name:"MuiTypography"}),r=(e=>gh[e]||e)(n.color),i=jd((0,En.Z)({},n,{color:r})),{align:o="inherit",className:s,component:a,gutterBottom:c=!1,noWrap:l=!1,paragraph:u=!1,variant:d="body1",variantMapping:h=mh}=i,p=(0,_n.Z)(i,ph),f=(0,En.Z)({},i,{align:o,color:r,className:s,component:a,gutterBottom:c,noWrap:l,paragraph:u,variant:d,variantMapping:h}),m=a||(u?"p":h[d]||mh[d])||"span",g=(e=>{const{align:t,gutterBottom:n,noWrap:r,paragraph:i,variant:o,classes:s}=e,a={root:["root",o,"inherit"!==e.align&&"align".concat((0,gr.Z)(t)),n&&"gutterBottom",r&&"noWrap",i&&"paragraph"]};return(0,yn.Z)(a,hh,s)})(f);return(0,qn.jsx)(fh,(0,En.Z)({as:m,ref:t,ownerState:f,className:(0,vn.Z)(g.root,s)},p))})),Eh=_h;function vh(e){let{props:t,states:n,muiFormControl:r}=e;return n.reduce(((e,n)=>(e[n]=t[n],r&&"undefined"===typeof t[n]&&(e[n]=r[n]),e)),{})}const yh=n.createContext(void 0);function bh(){return n.useContext(yh)}function Sh(e){return(0,lr.Z)("MuiFormLabel",e)}const Th=(0,zn.Z)("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),wh=["children","className","color","component","disabled","error","filled","focused","required"],Ch=(0,bn.ZP)("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return(0,En.Z)({},t.root,"secondary"===n.color&&t.colorSecondary,n.filled&&t.filled)}})((e=>{let{theme:t,ownerState:n}=e;return(0,En.Z)({color:(t.vars||t).palette.text.secondary},t.typography.body1,{lineHeight:"1.4375em",padding:0,position:"relative",["&.".concat(Th.focused)]:{color:(t.vars||t).palette[n.color].main},["&.".concat(Th.disabled)]:{color:(t.vars||t).palette.text.disabled},["&.".concat(Th.error)]:{color:(t.vars||t).palette.error.main}})})),Rh=(0,bn.ZP)("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})((e=>{let{theme:t}=e;return{["&.".concat(Th.error)]:{color:(t.vars||t).palette.error.main}}})),Ih=n.forwardRef((function(e,t){const n=(0,Sn.Z)({props:e,name:"MuiFormLabel"}),{children:r,className:i,component:o="label"}=n,s=(0,_n.Z)(n,wh),a=vh({props:n,muiFormControl:bh(),states:["color","required","focused","disabled","error","filled"]}),c=(0,En.Z)({},n,{color:a.color||"primary",component:o,disabled:a.disabled,error:a.error,filled:a.filled,focused:a.focused,required:a.required}),l=(e=>{const{classes:t,color:n,focused:r,disabled:i,error:o,filled:s,required:a}=e,c={root:["root","color".concat((0,gr.Z)(n)),i&&"disabled",o&&"error",s&&"filled",r&&"focused",a&&"required"],asterisk:["asterisk",o&&"error"]};return(0,yn.Z)(c,Sh,t)})(c);return(0,qn.jsxs)(Ch,(0,En.Z)({as:o,ownerState:c,className:(0,vn.Z)(l.root,i),ref:t},s,{children:[r,a.required&&(0,qn.jsxs)(Rh,{ownerState:c,"aria-hidden":!0,className:l.asterisk,children:["\u2009","*"]})]}))})),Oh=Ih;function Ah(e){return(0,lr.Z)("MuiInputLabel",e)}(0,zn.Z)("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const Nh=["disableAnimation","margin","shrink","variant","className"],kh=(0,bn.ZP)(Oh,{shouldForwardProp:e=>(0,bn.FO)(e)||"classes"===e,name:"MuiInputLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{["& .".concat(Th.asterisk)]:t.asterisk},t.root,n.formControl&&t.formControl,"small"===n.size&&t.sizeSmall,n.shrink&&t.shrink,!n.disableAnimation&&t.animated,n.focused&&t.focused,t[n.variant]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,En.Z)({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},n.formControl&&{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"},"small"===n.size&&{transform:"translate(0, 17px) scale(1)"},n.shrink&&{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"},!n.disableAnimation&&{transition:t.transitions.create(["color","transform","max-width"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut})},"filled"===n.variant&&(0,En.Z)({zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},"small"===n.size&&{transform:"translate(12px, 13px) scale(1)"},n.shrink&&(0,En.Z)({userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"},"small"===n.size&&{transform:"translate(12px, 4px) scale(0.75)"})),"outlined"===n.variant&&(0,En.Z)({zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},"small"===n.size&&{transform:"translate(14px, 9px) scale(1)"},n.shrink&&{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}),"standard"===n.variant&&{"&:not(label) + div":{marginTop:16}})})),Ph=n.forwardRef((function(e,t){const n=(0,Sn.Z)({name:"MuiInputLabel",props:e}),{disableAnimation:r=!1,shrink:i,className:o}=n,s=(0,_n.Z)(n,Nh),a=bh();let c=i;"undefined"===typeof c&&a&&(c=a.filled||a.focused||a.adornedStart);const l=vh({props:n,muiFormControl:a,states:["size","variant","required","focused"]}),u=(0,En.Z)({},n,{disableAnimation:r,formControl:a,shrink:c,size:l.size,variant:l.variant,required:l.required,focused:l.focused}),d=(e=>{const{classes:t,formControl:n,size:r,shrink:i,disableAnimation:o,variant:s,required:a}=e,c={root:["root",n&&"formControl",!o&&"animated",i&&"shrink",r&&"normal"!==r&&"size".concat((0,gr.Z)(r)),s],asterisk:[a&&"asterisk"]},l=(0,yn.Z)(c,Ah,t);return(0,En.Z)({},t,l)})(u);return(0,qn.jsx)(kh,(0,En.Z)({"data-shrink":c,ownerState:u,ref:t,className:(0,vn.Z)(d.root,o)},s,{classes:d}))})),Dh=Ph;const Lh=n.createContext({});const xh=(0,zn.Z)("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]);const Mh=(0,zn.Z)("MuiListItemIcon",["root","alignItemsFlexStart"]);const Uh=(0,zn.Z)("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]);function Fh(e){return(0,lr.Z)("MuiMenuItem",e)}const jh=(0,zn.Z)("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),Vh=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],Bh=(0,bn.ZP)(mr,{shouldForwardProp:e=>(0,bn.FO)(e)||"classes"===e,name:"MuiMenuItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dense&&t.dense,n.divider&&t.divider,!n.disableGutters&&t.gutters]}})((e=>{let{theme:t,ownerState:n}=e;return(0,En.Z)({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!n.disableGutters&&{paddingLeft:16,paddingRight:16},n.divider&&{borderBottom:"1px solid ".concat((t.vars||t).palette.divider),backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},["&.".concat(jh.selected)]:{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.primary.mainChannel," / ").concat(t.vars.palette.action.selectedOpacity,")"):(0,Kd.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity),["&.".concat(jh.focusVisible)]:{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.primary.mainChannel," / calc(").concat(t.vars.palette.action.selectedOpacity," + ").concat(t.vars.palette.action.focusOpacity,"))"):(0,Kd.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},["&.".concat(jh.selected,":hover")]:{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.primary.mainChannel," / calc(").concat(t.vars.palette.action.selectedOpacity," + ").concat(t.vars.palette.action.hoverOpacity,"))"):(0,Kd.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.primary.mainChannel," / ").concat(t.vars.palette.action.selectedOpacity,")"):(0,Kd.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity)}},["&.".concat(jh.focusVisible)]:{backgroundColor:(t.vars||t).palette.action.focus},["&.".concat(jh.disabled)]:{opacity:(t.vars||t).palette.action.disabledOpacity},["& + .".concat(xh.root)]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},["& + .".concat(xh.inset)]:{marginLeft:52},["& .".concat(Uh.root)]:{marginTop:0,marginBottom:0},["& .".concat(Uh.inset)]:{paddingLeft:36},["& .".concat(Mh.root)]:{minWidth:36}},!n.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},n.dense&&(0,En.Z)({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{["& .".concat(Mh.root," svg")]:{fontSize:"1.25rem"}}))})),Gh=n.forwardRef((function(e,t){const r=(0,Sn.Z)({props:e,name:"MuiMenuItem"}),{autoFocus:i=!1,component:o="li",dense:s=!1,divider:a=!1,disableGutters:c=!1,focusVisibleClassName:l,role:u="menuitem",tabIndex:d,className:h}=r,p=(0,_n.Z)(r,Vh),f=n.useContext(Lh),m=n.useMemo((()=>({dense:s||f.dense||!1,disableGutters:c})),[f.dense,s,c]),g=n.useRef(null);(0,$u.Z)((()=>{i&&g.current&&g.current.focus()}),[i]);const _=(0,En.Z)({},r,{dense:m.dense,divider:a,disableGutters:c}),E=(e=>{const{disabled:t,dense:n,divider:r,disableGutters:i,selected:o,classes:s}=e,a={root:["root",n&&"dense",t&&"disabled",!i&&"gutters",r&&"divider",o&&"selected"]},c=(0,yn.Z)(a,Fh,s);return(0,En.Z)({},s,c)})(r),v=(0,Tn.Z)(g,t);let y;return r.disabled||(y=void 0!==d?d:-1),(0,qn.jsx)(Lh.Provider,{value:m,children:(0,qn.jsx)(Bh,(0,En.Z)({ref:v,role:u,tabIndex:y,component:o,focusVisibleClassName:(0,vn.Z)(E.focusVisible,l),className:(0,vn.Z)(E.root,h)},p,{ownerState:_,classes:E}))})})),qh=Gh;function Wh(e){return null!=e&&!(Array.isArray(e)&&0===e.length)}function zh(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&(Wh(e.value)&&""!==e.value||t&&Wh(e.defaultValue)&&""!==e.defaultValue)}var Hh=__webpack_require__(9103);function Kh(e){return(0,lr.Z)("MuiFormControl",e)}(0,zn.Z)("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const Yh=["children","className","color","component","disabled","error","focused","fullWidth","hiddenLabel","margin","required","size","variant"],Zh=(0,bn.ZP)("div",{name:"MuiFormControl",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return(0,En.Z)({},t.root,t["margin".concat((0,gr.Z)(n.margin))],n.fullWidth&&t.fullWidth)}})((e=>{let{ownerState:t}=e;return(0,En.Z)({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top"},"normal"===t.margin&&{marginTop:16,marginBottom:8},"dense"===t.margin&&{marginTop:8,marginBottom:4},t.fullWidth&&{width:"100%"})})),Jh=n.forwardRef((function(e,t){const r=(0,Sn.Z)({props:e,name:"MuiFormControl"}),{children:i,className:o,color:s="primary",component:a="div",disabled:c=!1,error:l=!1,focused:u,fullWidth:d=!1,hiddenLabel:h=!1,margin:p="none",required:f=!1,size:m="medium",variant:g="outlined"}=r,_=(0,_n.Z)(r,Yh),E=(0,En.Z)({},r,{color:s,component:a,disabled:c,error:l,fullWidth:d,hiddenLabel:h,margin:p,required:f,size:m,variant:g}),v=(e=>{const{classes:t,margin:n,fullWidth:r}=e,i={root:["root","none"!==n&&"margin".concat((0,gr.Z)(n)),r&&"fullWidth"]};return(0,yn.Z)(i,Kh,t)})(E),[y,b]=n.useState((()=>{let e=!1;return i&&n.Children.forEach(i,(t=>{if(!(0,Hh.Z)(t,["Input","Select"]))return;const n=(0,Hh.Z)(t,["Select"])?t.props.input:t;n&&n.props.startAdornment&&(e=!0)})),e})),[S,T]=n.useState((()=>{let e=!1;return i&&n.Children.forEach(i,(t=>{(0,Hh.Z)(t,["Input","Select"])&&(zh(t.props,!0)||zh(t.props.inputProps,!0))&&(e=!0)})),e})),[w,C]=n.useState(!1);c&&w&&C(!1);const R=void 0===u||c?w:u;let I;const O=n.useMemo((()=>({adornedStart:y,setAdornedStart:b,color:s,disabled:c,error:l,filled:S,focused:R,fullWidth:d,hiddenLabel:h,size:m,onBlur:()=>{C(!1)},onEmpty:()=>{T(!1)},onFilled:()=>{T(!0)},onFocus:()=>{C(!0)},registerEffect:I,required:f,variant:g})),[y,s,c,l,S,R,d,h,I,f,m,g]);return(0,qn.jsx)(yh.Provider,{value:O,children:(0,qn.jsx)(Zh,(0,En.Z)({as:a,ownerState:E,className:(0,vn.Z)(v.root,o),ref:t},_,{children:i}))})})),Xh=Jh;var Qh=__webpack_require__(6189),$h=__webpack_require__(8252);function ep(e){return(0,lr.Z)("MuiList",e)}(0,zn.Z)("MuiList",["root","padding","dense","subheader"]);const tp=["children","className","component","dense","disablePadding","subheader"],np=(0,bn.ZP)("ul",{name:"MuiList",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disablePadding&&t.padding,n.dense&&t.dense,n.subheader&&t.subheader]}})((e=>{let{ownerState:t}=e;return(0,En.Z)({listStyle:"none",margin:0,padding:0,position:"relative"},!t.disablePadding&&{paddingTop:8,paddingBottom:8},t.subheader&&{paddingTop:0})})),rp=n.forwardRef((function(e,t){const r=(0,Sn.Z)({props:e,name:"MuiList"}),{children:i,className:o,component:s="ul",dense:a=!1,disablePadding:c=!1,subheader:l}=r,u=(0,_n.Z)(r,tp),d=n.useMemo((()=>({dense:a})),[a]),h=(0,En.Z)({},r,{component:s,dense:a,disablePadding:c}),p=(e=>{const{classes:t,disablePadding:n,dense:r,subheader:i}=e,o={root:["root",!n&&"padding",r&&"dense",i&&"subheader"]};return(0,yn.Z)(o,ep,t)})(h);return(0,qn.jsx)(Lh.Provider,{value:d,children:(0,qn.jsxs)(np,(0,En.Z)({as:s,className:(0,vn.Z)(p.root,o),ref:t,ownerState:h},u,{children:[l,i]}))})})),ip=rp;function op(e){const t=e.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}const sp=op,ap=["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"];function cp(e,t,n){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:n?null:e.firstChild}function lp(e,t,n){return e===t?n?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:n?null:e.lastChild}function up(e,t){if(void 0===t)return!0;let n=e.innerText;return void 0===n&&(n=e.textContent),n=n.trim().toLowerCase(),0!==n.length&&(t.repeating?n[0]===t.keys[0]:0===n.indexOf(t.keys.join("")))}function dp(e,t,n,r,i,o){let s=!1,a=i(e,t,!!t&&n);for(;a;){if(a===e.firstChild){if(s)return!1;s=!0}const t=!r&&(a.disabled||"true"===a.getAttribute("aria-disabled"));if(a.hasAttribute("tabindex")&&up(a,o)&&!t)return a.focus(),!0;a=i(e,a,n)}return!1}const hp=n.forwardRef((function(e,t){const{actions:r,autoFocus:i=!1,autoFocusItem:o=!1,children:s,className:a,disabledItemsFocusable:c=!1,disableListWrap:l=!1,onKeyDown:u,variant:d="selectedMenu"}=e,h=(0,_n.Z)(e,ap),p=n.useRef(null),f=n.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});(0,$u.Z)((()=>{i&&p.current.focus()}),[i]),n.useImperativeHandle(r,(()=>({adjustStyleForScrollbar:(e,t)=>{const n=!p.current.style.width;if(e.clientHeight<p.current.clientHeight&&n){const n="".concat(sp((0,fd.Z)(e)),"px");p.current.style["rtl"===t.direction?"paddingLeft":"paddingRight"]=n,p.current.style.width="calc(100% + ".concat(n,")")}return p.current}})),[]);const m=(0,Tn.Z)(p,t);let g=-1;n.Children.forEach(s,((e,t)=>{n.isValidElement(e)?(e.props.disabled||("selectedMenu"===d&&e.props.selected||-1===g)&&(g=t),g===t&&(e.props.disabled||e.props.muiSkipListHighlight||e.type.muiSkipListHighlight)&&(g+=1,g>=s.length&&(g=-1))):g===t&&(g+=1,g>=s.length&&(g=-1))}));const _=n.Children.map(s,((e,t)=>{if(t===g){const t={};return o&&(t.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===d&&(t.tabIndex=0),n.cloneElement(e,t)}return e}));return(0,qn.jsx)(ip,(0,En.Z)({role:"menu",ref:m,className:a,onKeyDown:e=>{const t=p.current,n=e.key,r=(0,fd.Z)(t).activeElement;if("ArrowDown"===n)e.preventDefault(),dp(t,r,l,c,cp);else if("ArrowUp"===n)e.preventDefault(),dp(t,r,l,c,lp);else if("Home"===n)e.preventDefault(),dp(t,null,l,c,cp);else if("End"===n)e.preventDefault(),dp(t,null,l,c,lp);else if(1===n.length){const i=f.current,o=n.toLowerCase(),s=performance.now();i.keys.length>0&&(s-i.lastTime>500?(i.keys=[],i.repeating=!0,i.previousKeyMatched=!0):i.repeating&&o!==i.keys[0]&&(i.repeating=!1)),i.lastTime=s,i.keys.push(o);const a=r&&!i.repeating&&up(r,i);i.previousKeyMatched&&(a||dp(t,r,!1,c,cp,i))?e.preventDefault():i.previousKeyMatched=!1}u&&u(e)},tabIndex:i?0:-1},h,{children:_}))})),pp=hp;var fp=__webpack_require__(4164);const mp=!1;var gp="unmounted",_p="exited",Ep="entering",vp="entered",yp="exiting",bp=function(e){function t(t,n){var r;r=e.call(this,t,n)||this;var i,o=n&&!n.isMounting?t.enter:t.appear;return r.appearStatus=null,t.in?o?(i=_p,r.appearStatus=Ep):i=vp:i=t.unmountOnExit||t.mountOnEnter?gp:_p,r.state={status:i},r.nextCallback=null,r}On(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===gp?{status:_p}:null};var r=t.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==Ep&&n!==vp&&(t=Ep):n!==Ep&&n!==vp||(t=yp)}this.updateStatus(!1,t)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var e,t,n,r=this.props.timeout;return e=t=n=r,null!=r&&"number"!==typeof r&&(e=r.exit,t=r.enter,n=void 0!==r.appear?r.appear:t),{exit:e,enter:t,appear:n}},r.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===Ep){if(this.props.unmountOnExit||this.props.mountOnEnter){var n=this.props.nodeRef?this.props.nodeRef.current:fp.findDOMNode(this);n&&function(e){e.scrollTop}(n)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===_p&&this.setState({status:gp})},r.performEnter=function(e){var t=this,n=this.props.enter,r=this.context?this.context.isMounting:e,i=this.props.nodeRef?[r]:[fp.findDOMNode(this),r],o=i[0],s=i[1],a=this.getTimeouts(),c=r?a.appear:a.enter;!e&&!n||mp?this.safeSetState({status:vp},(function(){t.props.onEntered(o)})):(this.props.onEnter(o,s),this.safeSetState({status:Ep},(function(){t.props.onEntering(o,s),t.onTransitionEnd(c,(function(){t.safeSetState({status:vp},(function(){t.props.onEntered(o,s)}))}))})))},r.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),r=this.props.nodeRef?void 0:fp.findDOMNode(this);t&&!mp?(this.props.onExit(r),this.safeSetState({status:yp},(function(){e.props.onExiting(r),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:_p},(function(){e.props.onExited(r)}))}))}))):this.safeSetState({status:_p},(function(){e.props.onExited(r)}))},r.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},r.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(r){n&&(n=!1,t.nextCallback=null,e(r))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},r.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:fp.findDOMNode(this),r=null==e&&!this.props.addEndListener;if(n&&!r){if(this.props.addEndListener){var i=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],o=i[0],s=i[1];this.props.addEndListener(o,s)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},r.render=function(){var e=this.state.status;if(e===gp)return null;var t=this.props,r=t.children,i=(t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef,(0,_n.Z)(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return n.createElement(An.Provider,{value:null},"function"===typeof r?r(e,i):n.cloneElement(n.Children.only(r),i))},t}(n.Component);function Sp(){}bp.contextType=An,bp.propTypes={},bp.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Sp,onEntering:Sp,onEntered:Sp,onExit:Sp,onExiting:Sp,onExited:Sp},bp.UNMOUNTED=gp,bp.EXITED=_p,bp.ENTERING=Ep,bp.ENTERED=vp,bp.EXITING=yp;const Tp=bp,wp=e=>e.scrollTop;function Cp(e,t){var n,r;const{timeout:i,easing:o,style:s={}}=e;return{duration:null!=(n=s.transitionDuration)?n:"number"===typeof i?i:i[t.mode]||0,easing:null!=(r=s.transitionTimingFunction)?r:"object"===typeof o?o[t.mode]:o,delay:s.transitionDelay}}const Rp=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function Ip(e){return"scale(".concat(e,", ").concat(e**2,")")}const Op={entering:{opacity:1,transform:Ip(1)},entered:{opacity:1,transform:"none"}},Ap="undefined"!==typeof navigator&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),Np=n.forwardRef((function(e,t){const{addEndListener:r,appear:i=!0,children:o,easing:s,in:a,onEnter:c,onEntered:l,onEntering:u,onExit:d,onExited:h,onExiting:p,style:f,timeout:m="auto",TransitionComponent:g=Tp}=e,_=(0,_n.Z)(e,Rp),E=n.useRef(),v=n.useRef(),y=Ku(),b=n.useRef(null),S=(0,Tn.Z)(b,o.ref,t),T=e=>t=>{if(e){const n=b.current;void 0===t?e(n):e(n,t)}},w=T(u),C=T(((e,t)=>{wp(e);const{duration:n,delay:r,easing:i}=Cp({style:f,timeout:m,easing:s},{mode:"enter"});let o;"auto"===m?(o=y.transitions.getAutoHeightDuration(e.clientHeight),v.current=o):o=n,e.style.transition=[y.transitions.create("opacity",{duration:o,delay:r}),y.transitions.create("transform",{duration:Ap?o:.666*o,delay:r,easing:i})].join(","),c&&c(e,t)})),R=T(l),I=T(p),O=T((e=>{const{duration:t,delay:n,easing:r}=Cp({style:f,timeout:m,easing:s},{mode:"exit"});let i;"auto"===m?(i=y.transitions.getAutoHeightDuration(e.clientHeight),v.current=i):i=t,e.style.transition=[y.transitions.create("opacity",{duration:i,delay:n}),y.transitions.create("transform",{duration:Ap?i:.666*i,delay:Ap?n:n||.333*i,easing:r})].join(","),e.style.opacity=0,e.style.transform=Ip(.75),d&&d(e)})),A=T(h);return n.useEffect((()=>()=>{clearTimeout(E.current)}),[]),(0,qn.jsx)(g,(0,En.Z)({appear:i,in:a,nodeRef:b,onEnter:C,onEntered:R,onEntering:w,onExit:O,onExited:A,onExiting:I,addEndListener:e=>{"auto"===m&&(E.current=setTimeout(e,v.current||0)),r&&r(b.current,e)},timeout:"auto"===m?null:m},_,{children:(e,t)=>n.cloneElement(o,(0,En.Z)({style:(0,En.Z)({opacity:0,transform:Ip(.75),visibility:"exited"!==e||a?void 0:"hidden"},Op[e],f,o.props.style),ref:S},t))}))}));Np.muiSupportAuto=!0;const kp=Np;var Pp=__webpack_require__(4913),Dp=__webpack_require__(7054),Lp=__webpack_require__(8949),xp=__webpack_require__(5202);function Mp(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function Up(e){return parseInt((0,xp.Z)(e).getComputedStyle(e).paddingRight,10)||0}function Fp(e,t,n,r,i){const o=[t,n,...r];[].forEach.call(e.children,(e=>{const t=-1===o.indexOf(e),n=!function(e){const t=-1!==["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(e.tagName),n="INPUT"===e.tagName&&"hidden"===e.getAttribute("type");return t||n}(e);t&&n&&Mp(e,i)}))}function jp(e,t){let n=-1;return e.some(((e,r)=>!!t(e)&&(n=r,!0))),n}function Vp(e,t){const n=[],r=e.container;if(!t.disableScrollLock){if(function(e){const t=(0,Pp.Z)(e);return t.body===e?(0,xp.Z)(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}(r)){const e=op((0,Pp.Z)(r));n.push({value:r.style.paddingRight,property:"padding-right",el:r}),r.style.paddingRight="".concat(Up(r)+e,"px");const t=(0,Pp.Z)(r).querySelectorAll(".mui-fixed");[].forEach.call(t,(t=>{n.push({value:t.style.paddingRight,property:"padding-right",el:t}),t.style.paddingRight="".concat(Up(t)+e,"px")}))}let e;if(r.parentNode instanceof DocumentFragment)e=(0,Pp.Z)(r).body;else{const t=r.parentElement,n=(0,xp.Z)(r);e="HTML"===(null==t?void 0:t.nodeName)&&"scroll"===n.getComputedStyle(t).overflowY?t:r}n.push({value:e.style.overflow,property:"overflow",el:e},{value:e.style.overflowX,property:"overflow-x",el:e},{value:e.style.overflowY,property:"overflow-y",el:e}),e.style.overflow="hidden"}return()=>{n.forEach((e=>{let{value:t,el:n,property:r}=e;t?n.style.setProperty(r,t):n.style.removeProperty(r)}))}}const Bp=new class{constructor(){this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}add(e,t){let n=this.modals.indexOf(e);if(-1!==n)return n;n=this.modals.length,this.modals.push(e),e.modalRef&&Mp(e.modalRef,!1);const r=function(e){const t=[];return[].forEach.call(e.children,(e=>{"true"===e.getAttribute("aria-hidden")&&t.push(e)})),t}(t);Fp(t,e.mount,e.modalRef,r,!0);const i=jp(this.containers,(e=>e.container===t));return-1!==i?(this.containers[i].modals.push(e),n):(this.containers.push({modals:[e],container:t,restore:null,hiddenSiblings:r}),n)}mount(e,t){const n=jp(this.containers,(t=>-1!==t.modals.indexOf(e))),r=this.containers[n];r.restore||(r.restore=Vp(r,t))}remove(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.modals.indexOf(e);if(-1===n)return n;const r=jp(this.containers,(t=>-1!==t.modals.indexOf(e))),i=this.containers[r];if(i.modals.splice(i.modals.indexOf(e),1),this.modals.splice(n,1),0===i.modals.length)i.restore&&i.restore(),e.modalRef&&Mp(e.modalRef,t),Fp(i.container,e.mount,e.modalRef,i.hiddenSiblings,!1),this.containers.splice(r,1);else{const e=i.modals[i.modals.length-1];e.modalRef&&Mp(e.modalRef,!1)}return n}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}};function Gp(e){const{container:t,disableEscapeKeyDown:r=!1,disableScrollLock:i=!1,manager:o=Bp,closeAfterTransition:s=!1,onTransitionEnter:a,onTransitionExited:c,children:l,onClose:u,open:d,rootRef:h}=e,p=n.useRef({}),f=n.useRef(null),m=n.useRef(null),g=(0,Fu.Z)(m,h),[_,E]=n.useState(!d),v=function(e){return!!e&&e.props.hasOwnProperty("in")}(l);let y=!0;"false"!==e["aria-hidden"]&&!1!==e["aria-hidden"]||(y=!1);const b=()=>(p.current.modalRef=m.current,p.current.mount=f.current,p.current),S=()=>{o.mount(b(),{disableScrollLock:i}),m.current&&(m.current.scrollTop=0)},T=(0,Dp.Z)((()=>{const e=function(e){return"function"===typeof e?e():e}(t)||(0,Pp.Z)(f.current).body;o.add(b(),e),m.current&&S()})),w=n.useCallback((()=>o.isTopModal(b())),[o]),C=(0,Dp.Z)((e=>{f.current=e,e&&(d&&w()?S():m.current&&Mp(m.current,y))})),R=n.useCallback((()=>{o.remove(b(),y)}),[y,o]);n.useEffect((()=>()=>{R()}),[R]),n.useEffect((()=>{d?T():v&&s||R()}),[d,R,v,s,T]);const I=e=>t=>{var n;null==(n=e.onKeyDown)||n.call(e,t),"Escape"===t.key&&229!==t.which&&w()&&(r||(t.stopPropagation(),u&&u(t,"escapeKeyDown")))},O=e=>t=>{var n;null==(n=e.onClick)||n.call(e,t),t.target===t.currentTarget&&u&&u(t,"backdropClick")};return{getRootProps:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=Vu(e);delete n.onTransitionEnter,delete n.onTransitionExited;const r=(0,En.Z)({},n,t);return(0,En.Z)({role:"presentation"},r,{onKeyDown:I(r),ref:g})},getBackdropProps:function(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,En.Z)({"aria-hidden":!0},e,{onClick:O(e),open:d})},getTransitionProps:()=>({onEnter:(0,Lp.Z)((()=>{E(!1),a&&a()}),null==l?void 0:l.props.onEnter),onExited:(0,Lp.Z)((()=>{E(!0),c&&c(),s&&R()}),null==l?void 0:l.props.onExited)}),rootRef:g,portalRef:C,isTopModal:w,exited:_,hasTransition:v}}const qp=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function Wp(e){const t=[],n=[];return Array.from(e.querySelectorAll(qp)).forEach(((e,r)=>{const i=function(e){const t=parseInt(e.getAttribute("tabindex")||"",10);return Number.isNaN(t)?"true"===e.contentEditable||("AUDIO"===e.nodeName||"VIDEO"===e.nodeName||"DETAILS"===e.nodeName)&&null===e.getAttribute("tabindex")?0:e.tabIndex:t}(e);-1!==i&&function(e){return!(e.disabled||"INPUT"===e.tagName&&"hidden"===e.type||function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return!1;if(!e.name)return!1;const t=t=>e.ownerDocument.querySelector('input[type="radio"]'.concat(t));let n=t('[name="'.concat(e.name,'"]:checked'));return n||(n=t('[name="'.concat(e.name,'"]'))),n!==e}(e))}(e)&&(0===i?t.push(e):n.push({documentOrder:r,tabIndex:i,node:e}))})),n.sort(((e,t)=>e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex)).map((e=>e.node)).concat(t)}function zp(){return!0}function Hp(e){const{children:t,disableAutoFocus:r=!1,disableEnforceFocus:i=!1,disableRestoreFocus:o=!1,getTabbable:s=Wp,isEnabled:a=zp,open:c}=e,l=n.useRef(!1),u=n.useRef(null),d=n.useRef(null),h=n.useRef(null),p=n.useRef(null),f=n.useRef(!1),m=n.useRef(null),g=(0,Fu.Z)(t.ref,m),_=n.useRef(null);n.useEffect((()=>{c&&m.current&&(f.current=!r)}),[r,c]),n.useEffect((()=>{if(!c||!m.current)return;const e=(0,Pp.Z)(m.current);return m.current.contains(e.activeElement)||(m.current.hasAttribute("tabIndex")||m.current.setAttribute("tabIndex","-1"),f.current&&m.current.focus()),()=>{o||(h.current&&h.current.focus&&(l.current=!0,h.current.focus()),h.current=null)}}),[c]),n.useEffect((()=>{if(!c||!m.current)return;const e=(0,Pp.Z)(m.current),t=t=>{_.current=t,!i&&a()&&"Tab"===t.key&&e.activeElement===m.current&&t.shiftKey&&(l.current=!0,d.current&&d.current.focus())},n=()=>{const t=m.current;if(null===t)return;if(!e.hasFocus()||!a()||l.current)return void(l.current=!1);if(t.contains(e.activeElement))return;if(i&&e.activeElement!==u.current&&e.activeElement!==d.current)return;if(e.activeElement!==p.current)p.current=null;else if(null!==p.current)return;if(!f.current)return;let n=[];if(e.activeElement!==u.current&&e.activeElement!==d.current||(n=s(m.current)),n.length>0){var r,o;const e=Boolean((null==(r=_.current)?void 0:r.shiftKey)&&"Tab"===(null==(o=_.current)?void 0:o.key)),t=n[0],i=n[n.length-1];"string"!==typeof t&&"string"!==typeof i&&(e?i.focus():t.focus())}else t.focus()};e.addEventListener("focusin",n),e.addEventListener("keydown",t,!0);const r=setInterval((()=>{e.activeElement&&"BODY"===e.activeElement.tagName&&n()}),50);return()=>{clearInterval(r),e.removeEventListener("focusin",n),e.removeEventListener("keydown",t,!0)}}),[r,i,o,a,c,s]);const E=e=>{null===h.current&&(h.current=e.relatedTarget),f.current=!0};return(0,qn.jsxs)(n.Fragment,{children:[(0,qn.jsx)("div",{tabIndex:c?0:-1,onFocus:E,ref:u,"data-testid":"sentinelStart"}),n.cloneElement(t,{ref:g,onFocus:e=>{null===h.current&&(h.current=e.relatedTarget),f.current=!0,p.current=e.target;const n=t.props.onFocus;n&&n(e)}}),(0,qn.jsx)("div",{tabIndex:c?0:-1,onFocus:E,ref:d,"data-testid":"sentinelEnd"})]})}var Kp=__webpack_require__(2876),Yp=__webpack_require__(2971);const Zp=n.forwardRef((function(e,t){const{children:r,container:i,disablePortal:o=!1}=e,[s,a]=n.useState(null),c=(0,Fu.Z)(n.isValidElement(r)?r.ref:null,t);if((0,Kp.Z)((()=>{o||a(function(e){return"function"===typeof e?e():e}(i)||document.body)}),[i,o]),(0,Kp.Z)((()=>{if(s&&!o)return(0,Yp.Z)(t,s),()=>{(0,Yp.Z)(t,null)}}),[t,s,o]),o){if(n.isValidElement(r)){const e={ref:c};return n.cloneElement(r,e)}return(0,qn.jsx)(n.Fragment,{children:r})}return(0,qn.jsx)(n.Fragment,{children:s?fp.createPortal(r,s):s})}));const Jp=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],Xp={entering:{opacity:1},entered:{opacity:1}},Qp=n.forwardRef((function(e,t){const r=Ku(),i={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:o,appear:s=!0,children:a,easing:c,in:l,onEnter:u,onEntered:d,onEntering:h,onExit:p,onExited:f,onExiting:m,style:g,timeout:_=i,TransitionComponent:E=Tp}=e,v=(0,_n.Z)(e,Jp),y=n.useRef(null),b=(0,Tn.Z)(y,a.ref,t),S=e=>t=>{if(e){const n=y.current;void 0===t?e(n):e(n,t)}},T=S(h),w=S(((e,t)=>{wp(e);const n=Cp({style:g,timeout:_,easing:c},{mode:"enter"});e.style.webkitTransition=r.transitions.create("opacity",n),e.style.transition=r.transitions.create("opacity",n),u&&u(e,t)})),C=S(d),R=S(m),I=S((e=>{const t=Cp({style:g,timeout:_,easing:c},{mode:"exit"});e.style.webkitTransition=r.transitions.create("opacity",t),e.style.transition=r.transitions.create("opacity",t),p&&p(e)})),O=S(f);return(0,qn.jsx)(E,(0,En.Z)({appear:s,in:l,nodeRef:y,onEnter:w,onEntered:C,onEntering:T,onExit:I,onExited:O,onExiting:R,addEndListener:e=>{o&&o(y.current,e)},timeout:_},v,{children:(e,t)=>n.cloneElement(a,(0,En.Z)({style:(0,En.Z)({opacity:0,visibility:"exited"!==e||l?void 0:"hidden"},Xp[e],g,a.props.style),ref:b},t))}))})),$p=Qp;function ef(e){return(0,lr.Z)("MuiBackdrop",e)}(0,zn.Z)("MuiBackdrop",["root","invisible"]);const tf=["children","className","component","components","componentsProps","invisible","open","slotProps","slots","TransitionComponent","transitionDuration"],nf=(0,bn.ZP)("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.invisible&&t.invisible]}})((e=>{let{ownerState:t}=e;return(0,En.Z)({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},t.invisible&&{backgroundColor:"transparent"})})),rf=n.forwardRef((function(e,t){var n,r,i;const o=(0,Sn.Z)({props:e,name:"MuiBackdrop"}),{children:s,className:a,component:c="div",components:l={},componentsProps:u={},invisible:d=!1,open:h,slotProps:p={},slots:f={},TransitionComponent:m=$p,transitionDuration:g}=o,_=(0,_n.Z)(o,tf),E=(0,En.Z)({},o,{component:c,invisible:d}),v=(e=>{const{classes:t,invisible:n}=e,r={root:["root",n&&"invisible"]};return(0,yn.Z)(r,ef,t)})(E),y=null!=(n=p.root)?n:u.root;return(0,qn.jsx)(m,(0,En.Z)({in:h,timeout:g},_,{children:(0,qn.jsx)(nf,(0,En.Z)({"aria-hidden":!0},y,{as:null!=(r=null!=(i=f.root)?i:l.Root)?r:c,className:(0,vn.Z)(v.root,a,null==y?void 0:y.className),ownerState:(0,En.Z)({},E,null==y?void 0:y.ownerState),classes:v,ref:t,children:s}))}))})),of=rf;function sf(e){return(0,lr.Z)("MuiModal",e)}(0,zn.Z)("MuiModal",["root","hidden","backdrop"]);const af=["BackdropComponent","BackdropProps","classes","className","closeAfterTransition","children","container","component","components","componentsProps","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","onBackdropClick","onClose","onTransitionEnter","onTransitionExited","open","slotProps","slots","theme"],cf=(0,bn.ZP)("div",{name:"MuiModal",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.open&&n.exited&&t.hidden]}})((e=>{let{theme:t,ownerState:n}=e;return(0,En.Z)({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0},!n.open&&n.exited&&{visibility:"hidden"})})),lf=(0,bn.ZP)(of,{name:"MuiModal",slot:"Backdrop",overridesResolver:(e,t)=>t.backdrop})({zIndex:-1}),uf=n.forwardRef((function(e,t){var r,i,o,s,a,c;const l=(0,Sn.Z)({name:"MuiModal",props:e}),{BackdropComponent:u=lf,BackdropProps:d,className:h,closeAfterTransition:p=!1,children:f,container:m,component:g,components:_={},componentsProps:E={},disableAutoFocus:v=!1,disableEnforceFocus:y=!1,disableEscapeKeyDown:b=!1,disablePortal:S=!1,disableRestoreFocus:T=!1,disableScrollLock:w=!1,hideBackdrop:C=!1,keepMounted:R=!1,onBackdropClick:I,open:O,slotProps:A,slots:N}=l,k=(0,_n.Z)(l,af),P=(0,En.Z)({},l,{closeAfterTransition:p,disableAutoFocus:v,disableEnforceFocus:y,disableEscapeKeyDown:b,disablePortal:S,disableRestoreFocus:T,disableScrollLock:w,hideBackdrop:C,keepMounted:R}),{getRootProps:D,getBackdropProps:L,getTransitionProps:x,portalRef:M,isTopModal:U,exited:F,hasTransition:j}=Gp((0,En.Z)({},P,{rootRef:t})),V=(0,En.Z)({},P,{exited:F}),B=(e=>{const{open:t,exited:n,classes:r}=e,i={root:["root",!t&&n&&"hidden"],backdrop:["backdrop"]};return(0,yn.Z)(i,sf,r)})(V),G={};if(void 0===f.props.tabIndex&&(G.tabIndex="-1"),j){const{onEnter:e,onExited:t}=x();G.onEnter=e,G.onExited=t}const q=null!=(r=null!=(i=null==N?void 0:N.root)?i:_.Root)?r:cf,W=null!=(o=null!=(s=null==N?void 0:N.backdrop)?s:_.Backdrop)?o:u,z=null!=(a=null==A?void 0:A.root)?a:E.root,H=null!=(c=null==A?void 0:A.backdrop)?c:E.backdrop,K=qu({elementType:q,externalSlotProps:z,externalForwardedProps:k,getSlotProps:D,additionalProps:{ref:t,as:g},ownerState:V,className:(0,vn.Z)(h,null==z?void 0:z.className,null==B?void 0:B.root,!V.open&&V.exited&&(null==B?void 0:B.hidden))}),Y=qu({elementType:W,externalSlotProps:H,additionalProps:d,getSlotProps:e=>L((0,En.Z)({},e,{onClick:t=>{I&&I(t),null!=e&&e.onClick&&e.onClick(t)}})),className:(0,vn.Z)(null==H?void 0:H.className,null==d?void 0:d.className,null==B?void 0:B.backdrop),ownerState:V});return R||O||j&&!F?(0,qn.jsx)(Zp,{ref:M,container:m,disablePortal:S,children:(0,qn.jsxs)(q,(0,En.Z)({},K,{children:[!C&&u?(0,qn.jsx)(W,(0,En.Z)({},Y)):null,(0,qn.jsx)(Hp,{disableEnforceFocus:y,disableAutoFocus:v,disableRestoreFocus:T,isEnabled:U,open:O,children:n.cloneElement(f,G)})]}))}):null})),df=uf;function hf(e){return(0,lr.Z)("MuiPopover",e)}(0,zn.Z)("MuiPopover",["root","paper"]);const pf=["onEntering"],ff=["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","className","container","elevation","marginThreshold","open","PaperProps","slots","slotProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps","disableScrollLock"],mf=["slotProps"];function gf(e,t){let n=0;return"number"===typeof t?n=t:"center"===t?n=e.height/2:"bottom"===t&&(n=e.height),n}function _f(e,t){let n=0;return"number"===typeof t?n=t:"center"===t?n=e.width/2:"right"===t&&(n=e.width),n}function Ef(e){return[e.horizontal,e.vertical].map((e=>"number"===typeof e?"".concat(e,"px"):e)).join(" ")}function vf(e){return"function"===typeof e?e():e}const yf=(0,bn.ZP)(df,{name:"MuiPopover",slot:"Root",overridesResolver:(e,t)=>t.root})({}),bf=(0,bn.ZP)($d,{name:"MuiPopover",slot:"Paper",overridesResolver:(e,t)=>t.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),Sf=n.forwardRef((function(e,t){var r,i,o;const s=(0,Sn.Z)({props:e,name:"MuiPopover"}),{action:a,anchorEl:c,anchorOrigin:l={vertical:"top",horizontal:"left"},anchorPosition:u,anchorReference:d="anchorEl",children:h,className:p,container:f,elevation:m=8,marginThreshold:g=16,open:_,PaperProps:E={},slots:v,slotProps:y,transformOrigin:b={vertical:"top",horizontal:"left"},TransitionComponent:S=kp,transitionDuration:T="auto",TransitionProps:{onEntering:w}={},disableScrollLock:C=!1}=s,R=(0,_n.Z)(s.TransitionProps,pf),I=(0,_n.Z)(s,ff),O=null!=(r=null==y?void 0:y.paper)?r:E,A=n.useRef(),N=(0,Tn.Z)(A,O.ref),k=(0,En.Z)({},s,{anchorOrigin:l,anchorReference:d,elevation:m,marginThreshold:g,externalPaperSlotProps:O,transformOrigin:b,TransitionComponent:S,transitionDuration:T,TransitionProps:R}),P=(e=>{const{classes:t}=e;return(0,yn.Z)({root:["root"],paper:["paper"]},hf,t)})(k),D=n.useCallback((()=>{if("anchorPosition"===d)return u;const e=vf(c),t=(e&&1===e.nodeType?e:(0,fd.Z)(A.current).body).getBoundingClientRect();return{top:t.top+gf(t,l.vertical),left:t.left+_f(t,l.horizontal)}}),[c,l.horizontal,l.vertical,u,d]),L=n.useCallback((e=>({vertical:gf(e,b.vertical),horizontal:_f(e,b.horizontal)})),[b.horizontal,b.vertical]),x=n.useCallback((e=>{const t={width:e.offsetWidth,height:e.offsetHeight},n=L(t);if("none"===d)return{top:null,left:null,transformOrigin:Ef(n)};const r=D();let i=r.top-n.vertical,o=r.left-n.horizontal;const s=i+t.height,a=o+t.width,l=(0,ed.Z)(vf(c)),u=l.innerHeight-g,h=l.innerWidth-g;if(null!==g&&i<g){const e=i-g;i-=e,n.vertical+=e}else if(null!==g&&s>u){const e=s-u;i-=e,n.vertical+=e}if(null!==g&&o<g){const e=o-g;o-=e,n.horizontal+=e}else if(a>h){const e=a-h;o-=e,n.horizontal+=e}return{top:"".concat(Math.round(i),"px"),left:"".concat(Math.round(o),"px"),transformOrigin:Ef(n)}}),[c,d,D,L,g]),[M,U]=n.useState(_),F=n.useCallback((()=>{const e=A.current;if(!e)return;const t=x(e);null!==t.top&&(e.style.top=t.top),null!==t.left&&(e.style.left=t.left),e.style.transformOrigin=t.transformOrigin,U(!0)}),[x]);n.useEffect((()=>(C&&window.addEventListener("scroll",F),()=>window.removeEventListener("scroll",F))),[c,C,F]);n.useEffect((()=>{_&&F()})),n.useImperativeHandle(a,(()=>_?{updatePosition:()=>{F()}}:null),[_,F]),n.useEffect((()=>{if(!_)return;const e=(0,Yu.Z)((()=>{F()})),t=(0,ed.Z)(c);return t.addEventListener("resize",e),()=>{e.clear(),t.removeEventListener("resize",e)}}),[c,_,F]);let j=T;"auto"!==T||S.muiSupportAuto||(j=void 0);const V=f||(c?(0,fd.Z)(vf(c)).body:void 0),B=null!=(i=null==v?void 0:v.root)?i:yf,G=null!=(o=null==v?void 0:v.paper)?o:bf,q=qu({elementType:G,externalSlotProps:(0,En.Z)({},O,{style:M?O.style:(0,En.Z)({},O.style,{opacity:0})}),additionalProps:{elevation:m,ref:N},ownerState:k,className:(0,vn.Z)(P.paper,null==O?void 0:O.className)}),W=qu({elementType:B,externalSlotProps:(null==y?void 0:y.root)||{},externalForwardedProps:I,additionalProps:{ref:t,slotProps:{backdrop:{invisible:!0}},container:V,open:_},ownerState:k,className:(0,vn.Z)(P.root,p)}),{slotProps:z}=W,H=(0,_n.Z)(W,mf);return(0,qn.jsx)(B,(0,En.Z)({},H,!ju(B)&&{slotProps:z,disableScrollLock:C},{children:(0,qn.jsx)(S,(0,En.Z)({appear:!0,in:_,onEntering:(e,t)=>{w&&w(e,t),F()},onExited:()=>{U(!1)},timeout:j},R,{children:(0,qn.jsx)(G,(0,En.Z)({},q,{children:h}))}))}))})),Tf=Sf;function wf(e){return(0,lr.Z)("MuiMenu",e)}(0,zn.Z)("MuiMenu",["root","paper","list"]);const Cf=["onEntering"],Rf=["autoFocus","children","className","disableAutoFocusItem","MenuListProps","onClose","open","PaperProps","PopoverClasses","transitionDuration","TransitionProps","variant","slots","slotProps"],If={vertical:"top",horizontal:"right"},Of={vertical:"top",horizontal:"left"},Af=(0,bn.ZP)(Tf,{shouldForwardProp:e=>(0,bn.FO)(e)||"classes"===e,name:"MuiMenu",slot:"Root",overridesResolver:(e,t)=>t.root})({}),Nf=(0,bn.ZP)(bf,{name:"MuiMenu",slot:"Paper",overridesResolver:(e,t)=>t.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),kf=(0,bn.ZP)(pp,{name:"MuiMenu",slot:"List",overridesResolver:(e,t)=>t.list})({outline:0}),Pf=n.forwardRef((function(e,t){var r,i;const o=(0,Sn.Z)({props:e,name:"MuiMenu"}),{autoFocus:s=!0,children:a,className:c,disableAutoFocusItem:l=!1,MenuListProps:u={},onClose:d,open:h,PaperProps:p={},PopoverClasses:f,transitionDuration:m="auto",TransitionProps:{onEntering:g}={},variant:_="selectedMenu",slots:E={},slotProps:v={}}=o,y=(0,_n.Z)(o.TransitionProps,Cf),b=(0,_n.Z)(o,Rf),S=Ku(),T="rtl"===S.direction,w=(0,En.Z)({},o,{autoFocus:s,disableAutoFocusItem:l,MenuListProps:u,onEntering:g,PaperProps:p,transitionDuration:m,TransitionProps:y,variant:_}),C=(e=>{const{classes:t}=e;return(0,yn.Z)({root:["root"],paper:["paper"],list:["list"]},wf,t)})(w),R=s&&!l&&h,I=n.useRef(null);let O=-1;n.Children.map(a,((e,t)=>{n.isValidElement(e)&&(e.props.disabled||("selectedMenu"===_&&e.props.selected||-1===O)&&(O=t))}));const A=null!=(r=E.paper)?r:Nf,N=null!=(i=v.paper)?i:p,k=qu({elementType:E.root,externalSlotProps:v.root,ownerState:w,className:[C.root,c]}),P=qu({elementType:A,externalSlotProps:N,ownerState:w,className:C.paper});return(0,qn.jsx)(Af,(0,En.Z)({onClose:d,anchorOrigin:{vertical:"bottom",horizontal:T?"right":"left"},transformOrigin:T?If:Of,slots:{paper:A,root:E.root},slotProps:{root:k,paper:P},open:h,ref:t,transitionDuration:m,TransitionProps:(0,En.Z)({onEntering:(e,t)=>{I.current&&I.current.adjustStyleForScrollbar(e,S),g&&g(e,t)}},y),ownerState:w},b,{classes:f,children:(0,qn.jsx)(kf,(0,En.Z)({onKeyDown:e=>{"Tab"===e.key&&(e.preventDefault(),d&&d(e,"tabKeyDown"))},actions:I,autoFocus:s&&(-1===O||l),autoFocusItem:R,variant:_},u,{className:(0,vn.Z)(C.list,u.className),children:a}))}))})),Df=Pf;function Lf(e){return(0,lr.Z)("MuiNativeSelect",e)}const xf=(0,zn.Z)("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),Mf=["className","disabled","error","IconComponent","inputRef","variant"],Uf=e=>{let{ownerState:t,theme:n}=e;return(0,En.Z)({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":(0,En.Z)({},n.vars?{backgroundColor:"rgba(".concat(n.vars.palette.common.onBackgroundChannel," / 0.05)")}:{backgroundColor:"light"===n.palette.mode?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)"},{borderRadius:0}),"&::-ms-expand":{display:"none"},["&.".concat(xf.disabled)]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(n.vars||n).palette.background.paper},"&&&":{paddingRight:24,minWidth:16}},"filled"===t.variant&&{"&&&":{paddingRight:32}},"outlined"===t.variant&&{borderRadius:(n.vars||n).shape.borderRadius,"&:focus":{borderRadius:(n.vars||n).shape.borderRadius},"&&&":{paddingRight:32}})},Ff=(0,bn.ZP)("select",{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:bn.FO,overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.select,t[n.variant],n.error&&t.error,{["&.".concat(xf.multiple)]:t.multiple}]}})(Uf),jf=e=>{let{ownerState:t,theme:n}=e;return(0,En.Z)({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(n.vars||n).palette.action.active,["&.".concat(xf.disabled)]:{color:(n.vars||n).palette.action.disabled}},t.open&&{transform:"rotate(180deg)"},"filled"===t.variant&&{right:7},"outlined"===t.variant&&{right:7})},Vf=(0,bn.ZP)("svg",{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.icon,n.variant&&t["icon".concat((0,gr.Z)(n.variant))],n.open&&t.iconOpen]}})(jf),Bf=n.forwardRef((function(e,t){const{className:r,disabled:i,error:o,IconComponent:s,inputRef:a,variant:c="standard"}=e,l=(0,_n.Z)(e,Mf),u=(0,En.Z)({},e,{disabled:i,variant:c,error:o}),d=(e=>{const{classes:t,variant:n,disabled:r,multiple:i,open:o,error:s}=e,a={select:["select",n,r&&"disabled",i&&"multiple",s&&"error"],icon:["icon","icon".concat((0,gr.Z)(n)),o&&"iconOpen",r&&"disabled"]};return(0,yn.Z)(a,Lf,t)})(u);return(0,qn.jsxs)(n.Fragment,{children:[(0,qn.jsx)(Ff,(0,En.Z)({ownerState:u,className:(0,vn.Z)(d.select,r),disabled:i,ref:a||t},l)),e.multiple?null:(0,qn.jsx)(Vf,{as:s,ownerState:u,className:d.icon})]})})),Gf=Bf;var qf=__webpack_require__(5158);function Wf(e){return(0,lr.Z)("MuiSelect",e)}const zf=(0,zn.Z)("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var Hf;const Kf=["aria-describedby","aria-label","autoFocus","autoWidth","children","className","defaultOpen","defaultValue","disabled","displayEmpty","error","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"],Yf=(0,bn.ZP)("div",{name:"MuiSelect",slot:"Select",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{["&.".concat(zf.select)]:t.select},{["&.".concat(zf.select)]:t[n.variant]},{["&.".concat(zf.error)]:t.error},{["&.".concat(zf.multiple)]:t.multiple}]}})(Uf,{["&.".concat(zf.select)]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),Zf=(0,bn.ZP)("svg",{name:"MuiSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.icon,n.variant&&t["icon".concat((0,gr.Z)(n.variant))],n.open&&t.iconOpen]}})(jf),Jf=(0,bn.ZP)("input",{shouldForwardProp:e=>(0,bn.Dz)(e)&&"classes"!==e,name:"MuiSelect",slot:"NativeInput",overridesResolver:(e,t)=>t.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function Xf(e,t){return"object"===typeof t&&null!==t?e===t:String(e)===String(t)}function Qf(e){return null==e||"string"===typeof e&&!e.trim()}const $f=n.forwardRef((function(e,t){var r;const{"aria-describedby":i,"aria-label":o,autoFocus:s,autoWidth:a,children:c,className:l,defaultOpen:u,defaultValue:d,disabled:h,displayEmpty:p,error:f=!1,IconComponent:m,inputRef:g,labelId:_,MenuProps:E={},multiple:v,name:y,onBlur:b,onChange:S,onClose:T,onFocus:w,onOpen:C,open:R,readOnly:I,renderValue:O,SelectDisplayProps:A={},tabIndex:N,value:k,variant:P="standard"}=e,D=(0,_n.Z)(e,Kf),[L,x]=(0,qf.Z)({controlled:k,default:d,name:"Select"}),[M,U]=(0,qf.Z)({controlled:R,default:u,name:"Select"}),F=n.useRef(null),j=n.useRef(null),[V,B]=n.useState(null),{current:G}=n.useRef(null!=R),[q,W]=n.useState(),z=(0,Tn.Z)(t,g),H=n.useCallback((e=>{j.current=e,e&&B(e)}),[]),K=null==V?void 0:V.parentNode;n.useImperativeHandle(z,(()=>({focus:()=>{j.current.focus()},node:F.current,value:L})),[L]),n.useEffect((()=>{u&&M&&V&&!G&&(W(a?null:K.clientWidth),j.current.focus())}),[V,a]),n.useEffect((()=>{s&&j.current.focus()}),[s]),n.useEffect((()=>{if(!_)return;const e=(0,fd.Z)(j.current).getElementById(_);if(e){const t=()=>{getSelection().isCollapsed&&j.current.focus()};return e.addEventListener("click",t),()=>{e.removeEventListener("click",t)}}}),[_]);const Y=(e,t)=>{e?C&&C(t):T&&T(t),G||(W(a?null:K.clientWidth),U(e))},Z=n.Children.toArray(c),J=e=>t=>{let n;if(t.currentTarget.hasAttribute("tabindex")){if(v){n=Array.isArray(L)?L.slice():[];const t=L.indexOf(e.props.value);-1===t?n.push(e.props.value):n.splice(t,1)}else n=e.props.value;if(e.props.onClick&&e.props.onClick(t),L!==n&&(x(n),S)){const r=t.nativeEvent||t,i=new r.constructor(r.type,r);Object.defineProperty(i,"target",{writable:!0,value:{value:n,name:y}}),S(i,e)}v||Y(!1,t)}},X=null!==V&&M;let Q,$;delete D["aria-invalid"];const ee=[];let te=!1,ne=!1;(zh({value:L})||p)&&(O?Q=O(L):te=!0);const re=Z.map((e=>{if(!n.isValidElement(e))return null;let t;if(v){if(!Array.isArray(L))throw new Error((0,Qh.Z)(2));t=L.some((t=>Xf(t,e.props.value))),t&&te&&ee.push(e.props.children)}else t=Xf(L,e.props.value),t&&te&&($=e.props.children);return t&&(ne=!0),n.cloneElement(e,{"aria-selected":t?"true":"false",onClick:J(e),onKeyUp:t=>{" "===t.key&&t.preventDefault(),e.props.onKeyUp&&e.props.onKeyUp(t)},role:"option",selected:t,value:void 0,"data-value":e.props.value})}));te&&(Q=v?0===ee.length?null:ee.reduce(((e,t,n)=>(e.push(t),n<ee.length-1&&e.push(", "),e)),[]):$);let ie,oe=q;!a&&G&&V&&(oe=K.clientWidth),ie="undefined"!==typeof N?N:h?null:0;const se=A.id||(y?"mui-component-select-".concat(y):void 0),ae=(0,En.Z)({},e,{variant:P,value:L,open:X,error:f}),ce=(e=>{const{classes:t,variant:n,disabled:r,multiple:i,open:o,error:s}=e,a={select:["select",n,r&&"disabled",i&&"multiple",s&&"error"],icon:["icon","icon".concat((0,gr.Z)(n)),o&&"iconOpen",r&&"disabled"],nativeInput:["nativeInput"]};return(0,yn.Z)(a,Wf,t)})(ae),le=(0,En.Z)({},E.PaperProps,null==(r=E.slotProps)?void 0:r.paper),ue=(0,$h.Z)(),de=(0,$h.Z)();return(0,qn.jsxs)(n.Fragment,{children:[(0,qn.jsx)(Yf,(0,En.Z)({ref:H,tabIndex:ie,role:"combobox","aria-controls":ue,"aria-disabled":h?"true":void 0,"aria-expanded":X?"true":"false","aria-haspopup":"listbox","aria-label":o,"aria-labelledby":[_,se].filter(Boolean).join(" ")||void 0,"aria-describedby":i,onKeyDown:e=>{if(!I){-1!==[" ","ArrowUp","ArrowDown","Enter"].indexOf(e.key)&&(e.preventDefault(),Y(!0,e))}},onMouseDown:h||I?null:e=>{0===e.button&&(e.preventDefault(),j.current.focus(),Y(!0,e))},onBlur:e=>{!X&&b&&(Object.defineProperty(e,"target",{writable:!0,value:{value:L,name:y}}),b(e))},onFocus:w},A,{ownerState:ae,className:(0,vn.Z)(A.className,ce.select,l),id:se,children:Qf(Q)?Hf||(Hf=(0,qn.jsx)("span",{className:"notranslate",children:"\u200b"})):Q})),(0,qn.jsx)(Jf,(0,En.Z)({"aria-invalid":f,value:Array.isArray(L)?L.join(","):L,name:null!=y?y:de,ref:F,"aria-hidden":!0,onChange:e=>{const t=Z.find((t=>t.props.value===e.target.value));void 0!==t&&(x(t.props.value),S&&S(e,t))},tabIndex:-1,disabled:h,className:ce.nativeInput,autoFocus:s,ownerState:ae},D)),(0,qn.jsx)(Zf,{as:m,className:ce.icon,ownerState:ae}),(0,qn.jsx)(Df,(0,En.Z)({id:"menu-".concat(y||""),anchorEl:K,open:X,onClose:e=>{Y(!1,e)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},E,{MenuListProps:(0,En.Z)({"aria-labelledby":_,role:"listbox","aria-multiselectable":v?"true":void 0,disableListWrap:!0,id:ue},E.MenuListProps),slotProps:(0,En.Z)({},E.slotProps,{paper:(0,En.Z)({},le,{style:(0,En.Z)({minWidth:oe},null!=le?le.style:null)})}),children:re}))]})})),em=$f,tm=(0,rd.Z)((0,qn.jsx)("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown");var nm=__webpack_require__(2254);const rm=["onChange","maxRows","minRows","style","value"];function im(e){return parseInt(e,10)||0}const om={visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"};function sm(e){return void 0===e||null===e||0===Object.keys(e).length||0===e.outerHeightStyle&&!e.overflow}const am=n.forwardRef((function(e,t){const{onChange:r,maxRows:i,minRows:o=1,style:s,value:a}=e,c=(0,_n.Z)(e,rm),{current:l}=n.useRef(null!=a),u=n.useRef(null),d=(0,Fu.Z)(t,u),h=n.useRef(null),p=n.useRef(0),[f,m]=n.useState({outerHeightStyle:0}),g=n.useCallback((()=>{const t=u.current,n=(0,xp.Z)(t).getComputedStyle(t);if("0px"===n.width)return{outerHeightStyle:0};const r=h.current;r.style.width=n.width,r.value=t.value||e.placeholder||"x","\n"===r.value.slice(-1)&&(r.value+=" ");const s=n.boxSizing,a=im(n.paddingBottom)+im(n.paddingTop),c=im(n.borderBottomWidth)+im(n.borderTopWidth),l=r.scrollHeight;r.value="x";const d=r.scrollHeight;let p=l;o&&(p=Math.max(Number(o)*d,p)),i&&(p=Math.min(Number(i)*d,p)),p=Math.max(p,d);return{outerHeightStyle:p+("border-box"===s?a+c:0),overflow:Math.abs(p-l)<=1}}),[i,o,e.placeholder]),_=(e,t)=>{const{outerHeightStyle:n,overflow:r}=t;return p.current<20&&(n>0&&Math.abs((e.outerHeightStyle||0)-n)>1||e.overflow!==r)?(p.current+=1,{overflow:r,outerHeightStyle:n}):e},E=n.useCallback((()=>{const e=g();sm(e)||m((t=>_(t,e)))}),[g]);(0,Kp.Z)((()=>{const e=()=>{p.current=0,(()=>{const e=g();sm(e)||fp.flushSync((()=>{m((t=>_(t,e)))}))})()};let t;const n=(0,nm.Z)(e),r=u.current,i=(0,xp.Z)(r);let o;return i.addEventListener("resize",n),"undefined"!==typeof ResizeObserver&&(o=new ResizeObserver(e),o.observe(r)),()=>{n.clear(),cancelAnimationFrame(t),i.removeEventListener("resize",n),o&&o.disconnect()}}),[g]),(0,Kp.Z)((()=>{E()})),n.useEffect((()=>{p.current=0}),[a]);return(0,qn.jsxs)(n.Fragment,{children:[(0,qn.jsx)("textarea",(0,En.Z)({value:a,onChange:e=>{p.current=0,l||E(),r&&r(e)},ref:d,rows:o,style:(0,En.Z)({height:f.outerHeightStyle,overflow:f.overflow?"hidden":void 0},s)},c)),(0,qn.jsx)("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:h,tabIndex:-1,style:(0,En.Z)({},om,s,{paddingTop:0,paddingBottom:0})})]})}));function cm(e){const{styles:t,defaultTheme:n={}}=e,r="function"===typeof t?e=>{return t(void 0===(r=e)||null===r||0===Object.keys(r).length?n:e);var r}:t;return(0,qn.jsx)(Vn,{styles:r})}const lm=function(e){let{styles:t,themeId:n,defaultTheme:r={}}=e;const i=(0,Wu.Z)(r),o="function"===typeof t?t(n&&i[n]||i):t;return(0,qn.jsx)(cm,{styles:o})};const um=function(e){return(0,qn.jsx)(lm,(0,En.Z)({},e,{defaultTheme:zu.Z,themeId:Hu.Z}))};function dm(e){return(0,lr.Z)("MuiInputBase",e)}const hm=(0,zn.Z)("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]),pm=["aria-describedby","autoComplete","autoFocus","className","color","components","componentsProps","defaultValue","disabled","disableInjectingGlobalStyles","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","maxRows","minRows","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","size","slotProps","slots","startAdornment","type","value"],fm=(e,t)=>{const{ownerState:n}=e;return[t.root,n.formControl&&t.formControl,n.startAdornment&&t.adornedStart,n.endAdornment&&t.adornedEnd,n.error&&t.error,"small"===n.size&&t.sizeSmall,n.multiline&&t.multiline,n.color&&t["color".concat((0,gr.Z)(n.color))],n.fullWidth&&t.fullWidth,n.hiddenLabel&&t.hiddenLabel]},mm=(e,t)=>{const{ownerState:n}=e;return[t.input,"small"===n.size&&t.inputSizeSmall,n.multiline&&t.inputMultiline,"search"===n.type&&t.inputTypeSearch,n.startAdornment&&t.inputAdornedStart,n.endAdornment&&t.inputAdornedEnd,n.hiddenLabel&&t.inputHiddenLabel]},gm=(0,bn.ZP)("div",{name:"MuiInputBase",slot:"Root",overridesResolver:fm})((e=>{let{theme:t,ownerState:n}=e;return(0,En.Z)({},t.typography.body1,{color:(t.vars||t).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",["&.".concat(hm.disabled)]:{color:(t.vars||t).palette.text.disabled,cursor:"default"}},n.multiline&&(0,En.Z)({padding:"4px 0 5px"},"small"===n.size&&{paddingTop:1}),n.fullWidth&&{width:"100%"})})),_m=(0,bn.ZP)("input",{name:"MuiInputBase",slot:"Input",overridesResolver:mm})((e=>{let{theme:t,ownerState:n}=e;const r="light"===t.palette.mode,i=(0,En.Z)({color:"currentColor"},t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:r?.42:.5},{transition:t.transitions.create("opacity",{duration:t.transitions.duration.shorter})}),o={opacity:"0 !important"},s=t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:r?.42:.5};return(0,En.Z)({font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":i,"&::-moz-placeholder":i,"&:-ms-input-placeholder":i,"&::-ms-input-placeholder":i,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},["label[data-shrink=false] + .".concat(hm.formControl," &")]:{"&::-webkit-input-placeholder":o,"&::-moz-placeholder":o,"&:-ms-input-placeholder":o,"&::-ms-input-placeholder":o,"&:focus::-webkit-input-placeholder":s,"&:focus::-moz-placeholder":s,"&:focus:-ms-input-placeholder":s,"&:focus::-ms-input-placeholder":s},["&.".concat(hm.disabled)]:{opacity:1,WebkitTextFillColor:(t.vars||t).palette.text.disabled},"&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}},"small"===n.size&&{paddingTop:1},n.multiline&&{height:"auto",resize:"none",padding:0,paddingTop:0},"search"===n.type&&{MozAppearance:"textfield"})})),Em=(0,qn.jsx)(um,{styles:{"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}}),vm=n.forwardRef((function(e,t){var r;const i=(0,Sn.Z)({props:e,name:"MuiInputBase"}),{"aria-describedby":o,autoComplete:s,autoFocus:a,className:c,components:l={},componentsProps:u={},defaultValue:d,disabled:h,disableInjectingGlobalStyles:p,endAdornment:f,fullWidth:m=!1,id:g,inputComponent:_="input",inputProps:E={},inputRef:v,maxRows:y,minRows:b,multiline:S=!1,name:T,onBlur:w,onChange:C,onClick:R,onFocus:I,onKeyDown:O,onKeyUp:A,placeholder:N,readOnly:k,renderSuffix:P,rows:D,slotProps:L={},slots:x={},startAdornment:M,type:U="text",value:F}=i,j=(0,_n.Z)(i,pm),V=null!=E.value?E.value:F,{current:B}=n.useRef(null!=V),G=n.useRef(),q=n.useCallback((e=>{0}),[]),W=(0,Tn.Z)(G,v,E.ref,q),[z,H]=n.useState(!1),K=bh();const Y=vh({props:i,muiFormControl:K,states:["color","disabled","error","hiddenLabel","size","required","filled"]});Y.focused=K?K.focused:z,n.useEffect((()=>{!K&&h&&z&&(H(!1),w&&w())}),[K,h,z,w]);const Z=K&&K.onFilled,J=K&&K.onEmpty,X=n.useCallback((e=>{zh(e)?Z&&Z():J&&J()}),[Z,J]);(0,$u.Z)((()=>{B&&X({value:V})}),[V,X,B]);n.useEffect((()=>{X(G.current)}),[]);let Q=_,$=E;S&&"input"===Q&&($=D?(0,En.Z)({type:void 0,minRows:D,maxRows:D},$):(0,En.Z)({type:void 0,maxRows:y,minRows:b},$),Q=am);n.useEffect((()=>{K&&K.setAdornedStart(Boolean(M))}),[K,M]);const ee=(0,En.Z)({},i,{color:Y.color||"primary",disabled:Y.disabled,endAdornment:f,error:Y.error,focused:Y.focused,formControl:K,fullWidth:m,hiddenLabel:Y.hiddenLabel,multiline:S,size:Y.size,startAdornment:M,type:U}),te=(e=>{const{classes:t,color:n,disabled:r,error:i,endAdornment:o,focused:s,formControl:a,fullWidth:c,hiddenLabel:l,multiline:u,readOnly:d,size:h,startAdornment:p,type:f}=e,m={root:["root","color".concat((0,gr.Z)(n)),r&&"disabled",i&&"error",c&&"fullWidth",s&&"focused",a&&"formControl",h&&"medium"!==h&&"size".concat((0,gr.Z)(h)),u&&"multiline",p&&"adornedStart",o&&"adornedEnd",l&&"hiddenLabel",d&&"readOnly"],input:["input",r&&"disabled","search"===f&&"inputTypeSearch",u&&"inputMultiline","small"===h&&"inputSizeSmall",l&&"inputHiddenLabel",p&&"inputAdornedStart",o&&"inputAdornedEnd",d&&"readOnly"]};return(0,yn.Z)(m,dm,t)})(ee),ne=x.root||l.Root||gm,re=L.root||u.root||{},ie=x.input||l.Input||_m;return $=(0,En.Z)({},$,null!=(r=L.input)?r:u.input),(0,qn.jsxs)(n.Fragment,{children:[!p&&Em,(0,qn.jsxs)(ne,(0,En.Z)({},re,!ju(ne)&&{ownerState:(0,En.Z)({},ee,re.ownerState)},{ref:t,onClick:e=>{G.current&&e.currentTarget===e.target&&G.current.focus(),R&&R(e)}},j,{className:(0,vn.Z)(te.root,re.className,c,k&&"MuiInputBase-readOnly"),children:[M,(0,qn.jsx)(yh.Provider,{value:null,children:(0,qn.jsx)(ie,(0,En.Z)({ownerState:ee,"aria-invalid":Y.error,"aria-describedby":o,autoComplete:s,autoFocus:a,defaultValue:d,disabled:Y.disabled,id:g,onAnimationStart:e=>{X("mui-auto-fill-cancel"===e.animationName?G.current:{value:"x"})},name:T,placeholder:N,readOnly:k,required:Y.required,rows:D,value:V,onKeyDown:O,onKeyUp:A,type:U},$,!ju(ie)&&{as:Q,ownerState:(0,En.Z)({},ee,$.ownerState)},{ref:W,className:(0,vn.Z)(te.input,$.className,k&&"MuiInputBase-readOnly"),onBlur:e=>{w&&w(e),E.onBlur&&E.onBlur(e),K&&K.onBlur?K.onBlur(e):H(!1)},onChange:function(e){if(!B){const t=e.target||G.current;if(null==t)throw new Error((0,Qh.Z)(1));X({value:t.value})}for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];E.onChange&&E.onChange(e,...n),C&&C(e,...n)},onFocus:e=>{Y.disabled?e.stopPropagation():(I&&I(e),E.onFocus&&E.onFocus(e),K&&K.onFocus?K.onFocus(e):H(!0))}}))}),f,P?P((0,En.Z)({},Y,{startAdornment:M})):null]}))]})})),ym=vm;function bm(e){return(0,lr.Z)("MuiInput",e)}const Sm=(0,En.Z)({},hm,(0,zn.Z)("MuiInput",["root","underline","input"])),Tm=["disableUnderline","components","componentsProps","fullWidth","inputComponent","multiline","slotProps","slots","type"],wm=(0,bn.ZP)(gm,{shouldForwardProp:e=>(0,bn.FO)(e)||"classes"===e,name:"MuiInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[...fm(e,t),!n.disableUnderline&&t.underline]}})((e=>{let{theme:t,ownerState:n}=e;let r="light"===t.palette.mode?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(r="rgba(".concat(t.vars.palette.common.onBackgroundChannel," / ").concat(t.vars.opacity.inputUnderline,")")),(0,En.Z)({position:"relative"},n.formControl&&{"label + &":{marginTop:16}},!n.disableUnderline&&{"&:after":{borderBottom:"2px solid ".concat((t.vars||t).palette[n.color].main),left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},["&.".concat(Sm.focused,":after")]:{transform:"scaleX(1) translateX(0)"},["&.".concat(Sm.error)]:{"&:before, &:after":{borderBottomColor:(t.vars||t).palette.error.main}},"&:before":{borderBottom:"1px solid ".concat(r),left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},["&:hover:not(.".concat(Sm.disabled,", .").concat(Sm.error,"):before")]:{borderBottom:"2px solid ".concat((t.vars||t).palette.text.primary),"@media (hover: none)":{borderBottom:"1px solid ".concat(r)}},["&.".concat(Sm.disabled,":before")]:{borderBottomStyle:"dotted"}})})),Cm=(0,bn.ZP)(_m,{name:"MuiInput",slot:"Input",overridesResolver:mm})({}),Rm=n.forwardRef((function(e,t){var n,r,i,o;const s=(0,Sn.Z)({props:e,name:"MuiInput"}),{disableUnderline:a,components:c={},componentsProps:l,fullWidth:u=!1,inputComponent:d="input",multiline:h=!1,slotProps:p,slots:f={},type:m="text"}=s,g=(0,_n.Z)(s,Tm),_=(e=>{const{classes:t,disableUnderline:n}=e,r={root:["root",!n&&"underline"],input:["input"]},i=(0,yn.Z)(r,bm,t);return(0,En.Z)({},t,i)})(s),E={root:{ownerState:{disableUnderline:a}}},v=(null!=p?p:l)?(0,xd.Z)(null!=p?p:l,E):E,y=null!=(n=null!=(r=f.root)?r:c.Root)?n:wm,b=null!=(i=null!=(o=f.input)?o:c.Input)?i:Cm;return(0,qn.jsx)(ym,(0,En.Z)({slots:{root:y,input:b},slotProps:v,fullWidth:u,inputComponent:d,multiline:h,ref:t,type:m},g,{classes:_}))}));Rm.muiName="Input";const Im=Rm;function Om(e){return(0,lr.Z)("MuiFilledInput",e)}const Am=(0,En.Z)({},hm,(0,zn.Z)("MuiFilledInput",["root","underline","input"])),Nm=["disableUnderline","components","componentsProps","fullWidth","hiddenLabel","inputComponent","multiline","slotProps","slots","type"],km=(0,bn.ZP)(gm,{shouldForwardProp:e=>(0,bn.FO)(e)||"classes"===e,name:"MuiFilledInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[...fm(e,t),!n.disableUnderline&&t.underline]}})((e=>{let{theme:t,ownerState:n}=e;var r;const i="light"===t.palette.mode,o=i?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",s=i?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",a=i?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",c=i?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return(0,En.Z)({position:"relative",backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:a,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s}},["&.".concat(Am.focused)]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s},["&.".concat(Am.disabled)]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:c}},!n.disableUnderline&&{"&:after":{borderBottom:"2px solid ".concat(null==(r=(t.vars||t).palette[n.color||"primary"])?void 0:r.main),left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},["&.".concat(Am.focused,":after")]:{transform:"scaleX(1) translateX(0)"},["&.".concat(Am.error)]:{"&:before, &:after":{borderBottomColor:(t.vars||t).palette.error.main}},"&:before":{borderBottom:"1px solid ".concat(t.vars?"rgba(".concat(t.vars.palette.common.onBackgroundChannel," / ").concat(t.vars.opacity.inputUnderline,")"):o),left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},["&:hover:not(.".concat(Am.disabled,", .").concat(Am.error,"):before")]:{borderBottom:"1px solid ".concat((t.vars||t).palette.text.primary)},["&.".concat(Am.disabled,":before")]:{borderBottomStyle:"dotted"}},n.startAdornment&&{paddingLeft:12},n.endAdornment&&{paddingRight:12},n.multiline&&(0,En.Z)({padding:"25px 12px 8px"},"small"===n.size&&{paddingTop:21,paddingBottom:4},n.hiddenLabel&&{paddingTop:16,paddingBottom:17},n.hiddenLabel&&"small"===n.size&&{paddingTop:8,paddingBottom:9}))})),Pm=(0,bn.ZP)(_m,{name:"MuiFilledInput",slot:"Input",overridesResolver:mm})((e=>{let{theme:t,ownerState:n}=e;return(0,En.Z)({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:"light"===t.palette.mode?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===t.palette.mode?null:"#fff",caretColor:"light"===t.palette.mode?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},t.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},"small"===n.size&&{paddingTop:21,paddingBottom:4},n.hiddenLabel&&{paddingTop:16,paddingBottom:17},n.startAdornment&&{paddingLeft:0},n.endAdornment&&{paddingRight:0},n.hiddenLabel&&"small"===n.size&&{paddingTop:8,paddingBottom:9},n.multiline&&{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0})})),Dm=n.forwardRef((function(e,t){var n,r,i,o;const s=(0,Sn.Z)({props:e,name:"MuiFilledInput"}),{components:a={},componentsProps:c,fullWidth:l=!1,inputComponent:u="input",multiline:d=!1,slotProps:h,slots:p={},type:f="text"}=s,m=(0,_n.Z)(s,Nm),g=(0,En.Z)({},s,{fullWidth:l,inputComponent:u,multiline:d,type:f}),_=(e=>{const{classes:t,disableUnderline:n}=e,r={root:["root",!n&&"underline"],input:["input"]},i=(0,yn.Z)(r,Om,t);return(0,En.Z)({},t,i)})(s),E={root:{ownerState:g},input:{ownerState:g}},v=(null!=h?h:c)?(0,xd.Z)(E,null!=h?h:c):E,y=null!=(n=null!=(r=p.root)?r:a.Root)?n:km,b=null!=(i=null!=(o=p.input)?o:a.Input)?i:Pm;return(0,qn.jsx)(ym,(0,En.Z)({slots:{root:y,input:b},componentsProps:v,fullWidth:l,inputComponent:u,multiline:d,ref:t,type:f},m,{classes:_}))}));Dm.muiName="Input";const Lm=Dm;var xm;const Mm=["children","classes","className","label","notched"],Um=(0,bn.ZP)("fieldset",{shouldForwardProp:bn.FO})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),Fm=(0,bn.ZP)("legend",{shouldForwardProp:bn.FO})((e=>{let{ownerState:t,theme:n}=e;return(0,En.Z)({float:"unset",width:"auto",overflow:"hidden"},!t.withLabel&&{padding:0,lineHeight:"11px",transition:n.transitions.create("width",{duration:150,easing:n.transitions.easing.easeOut})},t.withLabel&&(0,En.Z)({display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:n.transitions.create("max-width",{duration:50,easing:n.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}},t.notched&&{maxWidth:"100%",transition:n.transitions.create("max-width",{duration:100,easing:n.transitions.easing.easeOut,delay:50})}))}));function jm(e){return(0,lr.Z)("MuiOutlinedInput",e)}const Vm=(0,En.Z)({},hm,(0,zn.Z)("MuiOutlinedInput",["root","notchedOutline","input"])),Bm=["components","fullWidth","inputComponent","label","multiline","notched","slots","type"],Gm=(0,bn.ZP)(gm,{shouldForwardProp:e=>(0,bn.FO)(e)||"classes"===e,name:"MuiOutlinedInput",slot:"Root",overridesResolver:fm})((e=>{let{theme:t,ownerState:n}=e;const r="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return(0,En.Z)({position:"relative",borderRadius:(t.vars||t).shape.borderRadius,["&:hover .".concat(Vm.notchedOutline)]:{borderColor:(t.vars||t).palette.text.primary},"@media (hover: none)":{["&:hover .".concat(Vm.notchedOutline)]:{borderColor:t.vars?"rgba(".concat(t.vars.palette.common.onBackgroundChannel," / 0.23)"):r}},["&.".concat(Vm.focused," .").concat(Vm.notchedOutline)]:{borderColor:(t.vars||t).palette[n.color].main,borderWidth:2},["&.".concat(Vm.error," .").concat(Vm.notchedOutline)]:{borderColor:(t.vars||t).palette.error.main},["&.".concat(Vm.disabled," .").concat(Vm.notchedOutline)]:{borderColor:(t.vars||t).palette.action.disabled}},n.startAdornment&&{paddingLeft:14},n.endAdornment&&{paddingRight:14},n.multiline&&(0,En.Z)({padding:"16.5px 14px"},"small"===n.size&&{padding:"8.5px 14px"}))})),qm=(0,bn.ZP)((function(e){const{className:t,label:n,notched:r}=e,i=(0,_n.Z)(e,Mm),o=null!=n&&""!==n,s=(0,En.Z)({},e,{notched:r,withLabel:o});return(0,qn.jsx)(Um,(0,En.Z)({"aria-hidden":!0,className:t,ownerState:s},i,{children:(0,qn.jsx)(Fm,{ownerState:s,children:o?(0,qn.jsx)("span",{children:n}):xm||(xm=(0,qn.jsx)("span",{className:"notranslate",children:"\u200b"}))})}))}),{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(e,t)=>t.notchedOutline})((e=>{let{theme:t}=e;const n="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:t.vars?"rgba(".concat(t.vars.palette.common.onBackgroundChannel," / 0.23)"):n}})),Wm=(0,bn.ZP)(_m,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:mm})((e=>{let{theme:t,ownerState:n}=e;return(0,En.Z)({padding:"16.5px 14px"},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:"light"===t.palette.mode?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===t.palette.mode?null:"#fff",caretColor:"light"===t.palette.mode?null:"#fff",borderRadius:"inherit"}},t.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},"small"===n.size&&{padding:"8.5px 14px"},n.multiline&&{padding:0},n.startAdornment&&{paddingLeft:0},n.endAdornment&&{paddingRight:0})})),zm=n.forwardRef((function(e,t){var r,i,o,s,a;const c=(0,Sn.Z)({props:e,name:"MuiOutlinedInput"}),{components:l={},fullWidth:u=!1,inputComponent:d="input",label:h,multiline:p=!1,notched:f,slots:m={},type:g="text"}=c,_=(0,_n.Z)(c,Bm),E=(e=>{const{classes:t}=e,n=(0,yn.Z)({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},jm,t);return(0,En.Z)({},t,n)})(c),v=bh(),y=vh({props:c,muiFormControl:v,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),b=(0,En.Z)({},c,{color:y.color||"primary",disabled:y.disabled,error:y.error,focused:y.focused,formControl:v,fullWidth:u,hiddenLabel:y.hiddenLabel,multiline:p,size:y.size,type:g}),S=null!=(r=null!=(i=m.root)?i:l.Root)?r:Gm,T=null!=(o=null!=(s=m.input)?s:l.Input)?o:Wm;return(0,qn.jsx)(ym,(0,En.Z)({slots:{root:S,input:T},renderSuffix:e=>(0,qn.jsx)(qm,{ownerState:b,className:E.notchedOutline,label:null!=h&&""!==h&&y.required?a||(a=(0,qn.jsxs)(n.Fragment,{children:[h,"\u2009","*"]})):h,notched:"undefined"!==typeof f?f:Boolean(e.startAdornment||e.filled||e.focused)}),fullWidth:u,inputComponent:d,multiline:p,ref:t,type:g},_,{classes:(0,En.Z)({},E,{notchedOutline:null})}))}));zm.muiName="Input";const Hm=zm,Km=["autoWidth","children","classes","className","defaultOpen","displayEmpty","IconComponent","id","input","inputProps","label","labelId","MenuProps","multiple","native","onClose","onOpen","open","renderValue","SelectDisplayProps","variant"],Ym=["root"],Zm={name:"MuiSelect",overridesResolver:(e,t)=>t.root,shouldForwardProp:e=>(0,bn.FO)(e)&&"variant"!==e,slot:"Root"},Jm=(0,bn.ZP)(Im,Zm)(""),Xm=(0,bn.ZP)(Hm,Zm)(""),Qm=(0,bn.ZP)(Lm,Zm)(""),$m=n.forwardRef((function(e,t){const r=(0,Sn.Z)({name:"MuiSelect",props:e}),{autoWidth:i=!1,children:o,classes:s={},className:a,defaultOpen:c=!1,displayEmpty:l=!1,IconComponent:u=tm,id:d,input:h,inputProps:p,label:f,labelId:m,MenuProps:g,multiple:_=!1,native:E=!1,onClose:v,onOpen:y,open:b,renderValue:S,SelectDisplayProps:T,variant:w="outlined"}=r,C=(0,_n.Z)(r,Km),R=E?Gf:em,I=vh({props:r,muiFormControl:bh(),states:["variant","error"]}),O=I.variant||w,A=(0,En.Z)({},r,{variant:O,classes:s}),N=(e=>{const{classes:t}=e;return t})(A),k=(0,_n.Z)(N,Ym),P=h||{standard:(0,qn.jsx)(Jm,{ownerState:A}),outlined:(0,qn.jsx)(Xm,{label:f,ownerState:A}),filled:(0,qn.jsx)(Qm,{ownerState:A})}[O],D=(0,Tn.Z)(t,P.ref);return(0,qn.jsx)(n.Fragment,{children:n.cloneElement(P,(0,En.Z)({inputComponent:R,inputProps:(0,En.Z)({children:o,error:I.error,IconComponent:u,variant:O,type:void 0,multiple:_},E?{id:d}:{autoWidth:i,defaultOpen:c,displayEmpty:l,labelId:m,MenuProps:g,onClose:v,onOpen:y,open:b,renderValue:S,SelectDisplayProps:(0,En.Z)({id:d},T)},p,{classes:p?(0,xd.Z)(k,p.classes):k},h?h.props.inputProps:{})},_&&E&&"outlined"===O?{notched:!0}:{},{ref:D,className:(0,vn.Z)(P.props.className,a,N.root)},!h&&{variant:O},C))})}));$m.muiName="Select";const eg=$m;function tg(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}const ng=function(e){const{hostRoomId:t,setIsCallHosted:r}=e,[i,o]=(0,n.useState)(!0),[s,a]=(0,n.useState)(!1),[c,l]=(0,n.useState)(""),[u,d]=(0,n.useState)(""),[h,p]=(0,n.useState)("en"),[f,m]=n.useState(0);we.ZP.startListening({continuous:!0});const{transcript:g,listening:_,resetTranscript:E,browserSupportsSpeechRecognition:v}=(0,we.x6)();(0,n.useEffect)((()=>{ku(Cu(Uu,"chat/"+t),(e=>{const t=e.val();l(t.original)}))}),[]);return(async()=>{const e=await(async(e,t)=>{const n=window.location.origin,r="".concat(n,"/api/translate/translate");return(await gn.post(r,{text:e,targetLanguage:t})).data})(g,h),n=localStorage.getItem("chat"),{isHost:r}=JSON.parse(n);r&&Iu(Cu(Uu,"chat/"+t),{original:g,transulation:e}),d(e)})(),v?(0,qn.jsxs)("div",{className:"App",children:[(0,qn.jsx)(Sr,{color:"primary","aria-label":"add",style:{position:"absolute",top:"20px",right:s?"20vw":"20px"},onClick:()=>a(!s),children:s?(0,qn.jsx)(sh.Z,{}):(0,qn.jsx)(oh.Z,{})}),(0,qn.jsxs)("div",{style:{display:"flex",width:"100vw",height:"100vh"},children:[(0,qn.jsx)(Se,{styleProps:{},rtcProps:{appId:"2e97fd6ad99d4aae9c4cc28f04772392",channel:"channel1",token:Te.w,role:i?"host":"audience",layout:!0,enableScreensharing:!1},callbacks:{EndCall:()=>{localStorage.removeItem("chat"),r(!1),window.location.reload()}}}),s?(0,qn.jsxs)(ih,{elevation:0,style:{width:"20vw",height:"100vh",border:"1px solid black"},children:[(0,qn.jsx)(Hd,{sx:{borderBottom:1,borderColor:"divider"},children:(0,qn.jsxs)(Rd,{value:f,onChange:(e,t)=>{m(t)},"aria-label":"basic tabs example",children:[(0,qn.jsx)(Pd,{label:"Transcription",...tg(0)}),(0,qn.jsx)(Pd,{label:"Transulation",...tg(1)})]})}),0===f?(0,qn.jsx)(dh,{children:(0,qn.jsx)(Eh,{sx:{fontSize:14},color:"text.secondary",gutterBottom:!0,children:c})}):(0,qn.jsx)(qn.Fragment,{}),1===f?(0,qn.jsxs)(dh,{children:[(0,qn.jsxs)(Xh,{fullWidth:!0,children:[(0,qn.jsx)(Dh,{id:"demo-simple-select-label",children:"Language"}),(0,qn.jsx)(eg,{value:h,label:"Language",onChange:e=>p(e.target.value),children:[{id:"en",name:"English-EN"},{id:"te",name:"Telugu-TE"},{id:"hi",name:"Hindi-HI"},{id:"es",name:"Spanish-ES"}].map((e=>(0,qn.jsx)(qh,{value:e.id,children:e.name})))})]}),(0,qn.jsx)(Eh,{style:{marginTop:"20px"},sx:{fontSize:14},color:"text.secondary",gutterBottom:!0,children:u})]}):(0,qn.jsx)(qn.Fragment,{})]}):(0,qn.jsx)("div",{})]})]}):(0,qn.jsx)("span",{children:"Browser doesn't support speech recognition."})};function rg(e){return(0,lr.Z)("MuiCardActions",e)}(0,zn.Z)("MuiCardActions",["root","spacing"]);const ig=["disableSpacing","className"],og=(0,bn.ZP)("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableSpacing&&t.spacing]}})((e=>{let{ownerState:t}=e;return(0,En.Z)({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(:first-of-type)":{marginLeft:8}})})),sg=n.forwardRef((function(e,t){const n=(0,Sn.Z)({props:e,name:"MuiCardActions"}),{disableSpacing:r=!1,className:i}=n,o=(0,_n.Z)(n,ig),s=(0,En.Z)({},n,{disableSpacing:r}),a=(e=>{const{classes:t,disableSpacing:n}=e,r={root:["root",!n&&"spacing"]};return(0,yn.Z)(r,rg,t)})(s);return(0,qn.jsx)(og,(0,En.Z)({className:(0,vn.Z)(a.root,i),ownerState:s,ref:t},o))})),ag=sg;var cg=__webpack_require__(5735);function lg(e){return(0,lr.Z)("MuiButton",e)}const ug=(0,zn.Z)("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]);const dg=n.createContext({});const hg=n.createContext(void 0),pg=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],fg=e=>(0,En.Z)({},"small"===e.size&&{"& > *:nth-of-type(1)":{fontSize:18}},"medium"===e.size&&{"& > *:nth-of-type(1)":{fontSize:20}},"large"===e.size&&{"& > *:nth-of-type(1)":{fontSize:22}}),mg=(0,bn.ZP)(mr,{shouldForwardProp:e=>(0,bn.FO)(e)||"classes"===e,name:"MuiButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t["".concat(n.variant).concat((0,gr.Z)(n.color))],t["size".concat((0,gr.Z)(n.size))],t["".concat(n.variant,"Size").concat((0,gr.Z)(n.size))],"inherit"===n.color&&t.colorInherit,n.disableElevation&&t.disableElevation,n.fullWidth&&t.fullWidth]}})((e=>{let{theme:t,ownerState:n}=e;var r,i;const o="light"===t.palette.mode?t.palette.grey[300]:t.palette.grey[800],s="light"===t.palette.mode?t.palette.grey.A100:t.palette.grey[700];return(0,En.Z)({},t.typography.button,{minWidth:64,padding:"6px 16px",borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":(0,En.Z)({textDecoration:"none",backgroundColor:t.vars?"rgba(".concat(t.vars.palette.text.primaryChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,Kd.Fq)(t.palette.text.primary,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"text"===n.variant&&"inherit"!==n.color&&{backgroundColor:t.vars?"rgba(".concat(t.vars.palette[n.color].mainChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,Kd.Fq)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"outlined"===n.variant&&"inherit"!==n.color&&{border:"1px solid ".concat((t.vars||t).palette[n.color].main),backgroundColor:t.vars?"rgba(".concat(t.vars.palette[n.color].mainChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,Kd.Fq)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"contained"===n.variant&&{backgroundColor:t.vars?t.vars.palette.Button.inheritContainedHoverBg:s,boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2],backgroundColor:(t.vars||t).palette.grey[300]}},"contained"===n.variant&&"inherit"!==n.color&&{backgroundColor:(t.vars||t).palette[n.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[n.color].main}}),"&:active":(0,En.Z)({},"contained"===n.variant&&{boxShadow:(t.vars||t).shadows[8]}),["&.".concat(ug.focusVisible)]:(0,En.Z)({},"contained"===n.variant&&{boxShadow:(t.vars||t).shadows[6]}),["&.".concat(ug.disabled)]:(0,En.Z)({color:(t.vars||t).palette.action.disabled},"outlined"===n.variant&&{border:"1px solid ".concat((t.vars||t).palette.action.disabledBackground)},"contained"===n.variant&&{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground})},"text"===n.variant&&{padding:"6px 8px"},"text"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].main},"outlined"===n.variant&&{padding:"5px 15px",border:"1px solid currentColor"},"outlined"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].main,border:t.vars?"1px solid rgba(".concat(t.vars.palette[n.color].mainChannel," / 0.5)"):"1px solid ".concat((0,Kd.Fq)(t.palette[n.color].main,.5))},"contained"===n.variant&&{color:t.vars?t.vars.palette.text.primary:null==(r=(i=t.palette).getContrastText)?void 0:r.call(i,t.palette.grey[300]),backgroundColor:t.vars?t.vars.palette.Button.inheritContainedBg:o,boxShadow:(t.vars||t).shadows[2]},"contained"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].contrastText,backgroundColor:(t.vars||t).palette[n.color].main},"inherit"===n.color&&{color:"inherit",borderColor:"currentColor"},"small"===n.size&&"text"===n.variant&&{padding:"4px 5px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"text"===n.variant&&{padding:"8px 11px",fontSize:t.typography.pxToRem(15)},"small"===n.size&&"outlined"===n.variant&&{padding:"3px 9px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"outlined"===n.variant&&{padding:"7px 21px",fontSize:t.typography.pxToRem(15)},"small"===n.size&&"contained"===n.variant&&{padding:"4px 10px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"contained"===n.variant&&{padding:"8px 22px",fontSize:t.typography.pxToRem(15)},n.fullWidth&&{width:"100%"})}),(e=>{let{ownerState:t}=e;return t.disableElevation&&{boxShadow:"none","&:hover":{boxShadow:"none"},["&.".concat(ug.focusVisible)]:{boxShadow:"none"},"&:active":{boxShadow:"none"},["&.".concat(ug.disabled)]:{boxShadow:"none"}}})),gg=(0,bn.ZP)("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.startIcon,t["iconSize".concat((0,gr.Z)(n.size))]]}})((e=>{let{ownerState:t}=e;return(0,En.Z)({display:"inherit",marginRight:8,marginLeft:-4},"small"===t.size&&{marginLeft:-2},fg(t))})),_g=(0,bn.ZP)("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.endIcon,t["iconSize".concat((0,gr.Z)(n.size))]]}})((e=>{let{ownerState:t}=e;return(0,En.Z)({display:"inherit",marginRight:-4,marginLeft:8},"small"===t.size&&{marginRight:-2},fg(t))})),Eg=n.forwardRef((function(e,t){const r=n.useContext(dg),i=n.useContext(hg),o=(0,cg.Z)(r,e),s=(0,Sn.Z)({props:o,name:"MuiButton"}),{children:a,color:c="primary",component:l="button",className:u,disabled:d=!1,disableElevation:h=!1,disableFocusRipple:p=!1,endIcon:f,focusVisibleClassName:m,fullWidth:g=!1,size:_="medium",startIcon:E,type:v,variant:y="text"}=s,b=(0,_n.Z)(s,pg),S=(0,En.Z)({},s,{color:c,component:l,disabled:d,disableElevation:h,disableFocusRipple:p,fullWidth:g,size:_,type:v,variant:y}),T=(e=>{const{color:t,disableElevation:n,fullWidth:r,size:i,variant:o,classes:s}=e,a={root:["root",o,"".concat(o).concat((0,gr.Z)(t)),"size".concat((0,gr.Z)(i)),"".concat(o,"Size").concat((0,gr.Z)(i)),"inherit"===t&&"colorInherit",n&&"disableElevation",r&&"fullWidth"],label:["label"],startIcon:["startIcon","iconSize".concat((0,gr.Z)(i))],endIcon:["endIcon","iconSize".concat((0,gr.Z)(i))]},c=(0,yn.Z)(a,lg,s);return(0,En.Z)({},s,c)})(S),w=E&&(0,qn.jsx)(gg,{className:T.startIcon,ownerState:S,children:E}),C=f&&(0,qn.jsx)(_g,{className:T.endIcon,ownerState:S,children:f}),R=i||"";return(0,qn.jsxs)(mg,(0,En.Z)({ownerState:S,className:(0,vn.Z)(r.className,T.root,u,R),component:l,disabled:d,focusRipple:!p,focusVisibleClassName:(0,vn.Z)(T.focusVisible,m),ref:t,type:v},b,{classes:T,children:[w,a,C]}))})),vg=Eg;function yg(e){return(0,lr.Z)("MuiFormHelperText",e)}const bg=(0,zn.Z)("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var Sg;const Tg=["children","className","component","disabled","error","filled","focused","margin","required","variant"],wg=(0,bn.ZP)("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.size&&t["size".concat((0,gr.Z)(n.size))],n.contained&&t.contained,n.filled&&t.filled]}})((e=>{let{theme:t,ownerState:n}=e;return(0,En.Z)({color:(t.vars||t).palette.text.secondary},t.typography.caption,{textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,["&.".concat(bg.disabled)]:{color:(t.vars||t).palette.text.disabled},["&.".concat(bg.error)]:{color:(t.vars||t).palette.error.main}},"small"===n.size&&{marginTop:4},n.contained&&{marginLeft:14,marginRight:14})})),Cg=n.forwardRef((function(e,t){const n=(0,Sn.Z)({props:e,name:"MuiFormHelperText"}),{children:r,className:i,component:o="p"}=n,s=(0,_n.Z)(n,Tg),a=vh({props:n,muiFormControl:bh(),states:["variant","size","disabled","error","filled","focused","required"]}),c=(0,En.Z)({},n,{component:o,contained:"filled"===a.variant||"outlined"===a.variant,variant:a.variant,size:a.size,disabled:a.disabled,error:a.error,filled:a.filled,focused:a.focused,required:a.required}),l=(e=>{const{classes:t,contained:n,size:r,disabled:i,error:o,filled:s,focused:a,required:c}=e,l={root:["root",i&&"disabled",o&&"error",r&&"size".concat((0,gr.Z)(r)),n&&"contained",a&&"focused",s&&"filled",c&&"required"]};return(0,yn.Z)(l,yg,t)})(c);return(0,qn.jsx)(wg,(0,En.Z)({as:o,ownerState:c,className:(0,vn.Z)(l.root,i),ref:t},s,{children:" "===r?Sg||(Sg=(0,qn.jsx)("span",{className:"notranslate",children:"\u200b"})):r}))})),Rg=Cg;function Ig(e){return(0,lr.Z)("MuiTextField",e)}(0,zn.Z)("MuiTextField",["root"]);const Og=["autoComplete","autoFocus","children","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","id","InputLabelProps","inputProps","InputProps","inputRef","label","maxRows","minRows","multiline","name","onBlur","onChange","onFocus","placeholder","required","rows","select","SelectProps","type","value","variant"],Ag={standard:Im,filled:Lm,outlined:Hm},Ng=(0,bn.ZP)(Xh,{name:"MuiTextField",slot:"Root",overridesResolver:(e,t)=>t.root})({}),kg=n.forwardRef((function(e,t){const n=(0,Sn.Z)({props:e,name:"MuiTextField"}),{autoComplete:r,autoFocus:i=!1,children:o,className:s,color:a="primary",defaultValue:c,disabled:l=!1,error:u=!1,FormHelperTextProps:d,fullWidth:h=!1,helperText:p,id:f,InputLabelProps:m,inputProps:g,InputProps:_,inputRef:E,label:v,maxRows:y,minRows:b,multiline:S=!1,name:T,onBlur:w,onChange:C,onFocus:R,placeholder:I,required:O=!1,rows:A,select:N=!1,SelectProps:k,type:P,value:D,variant:L="outlined"}=n,x=(0,_n.Z)(n,Og),M=(0,En.Z)({},n,{autoFocus:i,color:a,disabled:l,error:u,fullWidth:h,multiline:S,required:O,select:N,variant:L}),U=(e=>{const{classes:t}=e;return(0,yn.Z)({root:["root"]},Ig,t)})(M);const F={};"outlined"===L&&(m&&"undefined"!==typeof m.shrink&&(F.notched=m.shrink),F.label=v),N&&(k&&k.native||(F.id=void 0),F["aria-describedby"]=void 0);const j=(0,$h.Z)(f),V=p&&j?"".concat(j,"-helper-text"):void 0,B=v&&j?"".concat(j,"-label"):void 0,G=Ag[L],q=(0,qn.jsx)(G,(0,En.Z)({"aria-describedby":V,autoComplete:r,autoFocus:i,defaultValue:c,fullWidth:h,multiline:S,name:T,rows:A,maxRows:y,minRows:b,type:P,value:D,id:j,inputRef:E,onBlur:w,onChange:C,onFocus:R,placeholder:I,inputProps:g},F,_));return(0,qn.jsxs)(Ng,(0,En.Z)({className:(0,vn.Z)(U.root,s),disabled:l,error:u,fullWidth:h,ref:t,required:O,color:a,variant:L,ownerState:M},x,{children:[null!=v&&""!==v&&(0,qn.jsx)(Dh,(0,En.Z)({htmlFor:j,id:B},m,{children:v})),N?(0,qn.jsx)(eg,(0,En.Z)({"aria-describedby":V,id:j,labelId:B,value:D,input:q},k,{children:o})):q,p&&(0,qn.jsx)(Rg,(0,En.Z)({id:V},d,{children:p}))]}))})),Pg=kg;const Dg=function(e){const{setIsCallHosted:t}=e,[r,i]=(0,n.useState)(!0),[o,s]=(0,n.useState)(),[a,c]=(0,n.useState)();return(0,n.useEffect)((()=>{let e=new Date;s(Math.floor(e.getTime()/1e3))}),[]),(0,qn.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,qn.jsxs)(ih,{style:{width:400,padding:20,border:"1px solid black"},elevation:0,children:[(0,qn.jsx)("h1",{children:"Create Room"}),(0,qn.jsx)(dh,{children:r?(0,qn.jsx)(Pg,{value:o,type:"number",variant:"outlined",onChange:e=>s(e.target.value),style:{borderColor:"black",borderRadius:16,marginBottom:"10px",width:"100%"},label:"New Room ID",InputProps:{readOnly:!0}}):(0,qn.jsx)(Pg,{value:a,type:"number",variant:"outlined",onChange:e=>c(e.target.value),style:{borderColor:"black",borderRadius:16,marginBottom:"10px",width:"100%"},label:"Join Room ID",InputProps:{readOnly:!1}})}),(0,qn.jsxs)(ag,{children:[(0,qn.jsx)(vg,{style:{width:"50%"},disableElevation:!0,variant:"contained",onClick:()=>{r?(localStorage.setItem("chat",JSON.stringify({roomId:o,status:"active",isHost:r})),Iu(Cu(Uu,"chat/"+o),{original:"",transulation:""}).then((e=>{console.log(e),t(o)}))):i(!0)},children:"Create"}),(0,qn.jsx)("br",{}),(0,qn.jsx)(vg,{style:{width:"50%"},disableElevation:!0,variant:"outlined",onClick:()=>{r?i(!1):(localStorage.setItem("chat",JSON.stringify({roomId:a,status:"active",isHost:r})),t(a))},children:"Join"})]})]})})};const Lg=function(){const[e,t]=(0,n.useState)(!1),[r,i]=(0,n.useState)();return(0,n.useEffect)((()=>{const e=localStorage.getItem("chat");if(e){const{roomId:n,status:r}=JSON.parse(e);"active"===r&&(i(n),t(!0))}}),[]),(0,qn.jsx)("div",{className:"App",children:e?(0,qn.jsx)(ng,{hostRoomId:r,setIsCallHosted:t}):(0,qn.jsx)(Dg,{setIsCallHosted:e=>{i(e),t(!0)}})})},xg=e=>{e&&e instanceof Function&&__webpack_require__.e(787).then(__webpack_require__.bind(__webpack_require__,787)).then((t=>{let{getCLS:n,getFID:r,getFCP:i,getLCP:o,getTTFB:s}=t;n(e),r(e),i(e),o(e),s(e)}))};r.createRoot(document.getElementById("root")).render((0,qn.jsx)(n.StrictMode,{children:(0,qn.jsx)(Lg,{})})),xg()})()})();
//# sourceMappingURL=main.d773c611.js.map